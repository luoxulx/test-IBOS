{"version":3,"sources":["app.js","controllers.js","datetime.js","directives.js","filters.js","services.js","wechat.js","activity/activity.js","activity/controllers.js","activity/services.js","assignment/assignment.js","assignment/controllers.js","assignment/services.js","cabinet/cabinet.js","cabinet/controllers.js","cabinet/filters.js","cabinet/services.js","calendar/calendar.js","calendar/controllers.js","calendar/filters.js","calendar/services.js","contacts/contacts.js","contacts/controllers.js","contacts/services.js","crm/controllers.js","crm/crm.js","crm/services.js","diary/controllers.js","diary/diary.js","diary/filters.js","diary/services.js","docs/controllers.js","docs/docs.js","docs/filters.js","docs/services.js","news/controllers.js","news/filters.js","news/news.js","news/services.js","report/controllers.js","report/report.js","report/services.js","email/controllers.js","email/email.js","email/services.js","thread/controllers.js","thread/services.js","thread/thread.js","vote/controllers.js","vote/services.js","vote/vote.js","workflow/controllers.js","workflow/directives.js","workflow/filters.js","workflow/services.js","workflow/workflow.js"],"names":["getProvider","name","angular","element","document","body","injector","get","module","controller","$scope","$state","Settings","User","user","username","password","submitLogin","logining","login","success","res","go","mainState","$ionicModal","$localstorage","$timeout","Utils","Apps","orderFilter","key","a","b","as","localPortalSettings","bs","LOCAL_SETTINGS_KEY","getObject","apps","all","moduleDisabled","icon","panel","forEach","value","settings","ins","isDisabled","app","indexOf","getApps","this","filter","isShow","bind","sort","toggleShow","$event","target","checked","setObject","reorder","$fromIndex","$toIndex","splice","index","refresh","$broadcast","fromTemplateUrl","scope","animation","then","modal","setModal","$on","remove","hide","orderModal","$http","personal","url","rootUrl","loading","load","that","list","data","datas","review","diary","follow","tabOn","tab","tabName","todo","done","Calendar","CalendarUtil","getData","calendar","params","getDateRange","parseEvents","events","isInterDay","cal","endtime","starttime","unfinished","chargeData","finished","isOverdue","item","Date","now","haveRemind","remindtime","unsigned","published","unread","inbox","activity","console","log","factory","dateFilter","DAYTIME","floorDate","date","isDate","setHours","setMinutes","setSeconds","setMilliseconds","ceilDate","setTime","isToday","relative","isTomorrow","tomorrow","isYesterday","yesterday","inThisWeek","today","timestamp","getTime","weekStartTime","getDay","weekEndTime","inThisYear","getFullYear","format","postfix","fromNow","Math","abs","floor","day","DateUtils","defaultFormats","thisWeek","thisYear","default","formats","type","extend","directive","restrict","require","link","$element","$attrs","$ngModelCtrl","dateStrInput","$parsers","push","val","$formatters","template","replace","$rootScope","$el","hideTabs","ImgViewer","map","Array","prototype","priority","compile","attr","$elem","attrs","srcs","tagName","toLowerCase","groupName","imgPreview","on","src","getAttribute","siblings","querySelectorAll","call","sibling","view","evt","toUpperCase","imgs","img","$location","$document","$ionicLoading","$ionicScrollDelegate","$ionicLoadingConfig","createTemplate","split","join","addClass","getPos","find","anchor","top","offsetTop","bottom","clientHeight","flag","getFlag","pos","length","i","_mousemove","cancel","timer","ionic","off","clientY","touches","elemTop","scrollTo","stopPropagation","preventDefault","hash","elem","show","noBackdrop","prefix","getElementById","style","display","anchorScroll","_mousedown","oldIonicLoadingConfig","getBoundingClientRect","_mouseup","removeClass","letter","parentScope","$watch","$hasHeader","$hasSubheader","$hasFooter","$hasSubfooter","className","oldClassName","$filter","removeFilter","userInfoFilter","departmentInfoFilter","positionInfoFilter","input","ng-value","ngValue","ng-model","ngModel","ng-disabled","ngDisabled","ng-change","ngChange","required","isDefined","selectType","getName","collection","$setViewValue","$render","isString","$viewValue","UserSelector","$attr","osSelect","selected","userSelector","showUserSelector","enabled","options","enabledUsers","$eval","values","createOptions","maxSelection","create","outRemoveMode","removeMode","toRemoveMode","transclude","max","isNaN","countdown","count","valCount","getCharLength","$setValidity","Downloader","prelink","down","ibDownload","pre","isDateTimeLocalSupport","placeholder","onChangeFunc","fileOnChange","apply","arguments","$parse","testFileType","file","reg","test","alert","fileImageData","maxLength","fileImageMaxlength","files","images","isArray","error","currentLength","getImagePreviewUrl","$apply","_stopPropagation","eventList","eventName","focusOn","shouldFocus","focus","focusDelay","size","avatarDefaultSize","defaultUrl","avatarDefaultUrl","avatar","fullUrlFilter","retrict","templateUrl","attach","download","att","entireattachurl","officereadurl","toggleHeaderClass","status","toggleClass","onScroll","detail","scrollTop","$ionContent","getScrollPosition","$ionicHistory","$ionicConfig","$ionicPlatform","DefaultBack","backTitle","defaultBack","backButton","previousTitleText","title","goBack","$arr","e","nodeName","toLocaleLowerCase","parentNode","querySelector","click","createGetProp","id","prop","idArr","text","String","unit","digit","pow","toFixed","source","start","lastIndexOf","end","substring","FileUtils","getFileIconByExtname","fileIconByExtnameFilter","filename","pop","httpReg","hostUrl","uid","users","userData","uids","removePrefix","positionData","departmentData","$sce","html","trustAsHtml","str","currencyToNumber","currency","ret","Number","constant","notempty","chinese","num","idcard","mobile","money","tel","zipcode","email","provider","resolvers","qqmap","$ocLazyLoad","canvasPainter","nameArr","$get","$window","$ionicPopup","getOrigin","result","location","href","match","requestError","headers","config","errorMsg","toJson","appName","searchParams","parseSearch","search","host","corptoken","window","$q","$ionicViewSwitcher","IbPopup","isFile","obj","toString","isBlob","isFormTypeSupported","createElement","setAttribute","decodeURIComponent","searchField","kt","capitalize","charAt","slice","commasInclude","pick","keys","hasOwnProperty","eliminate","arr","toggle","idx","concatTo","arr1","arr2","unique","removeFrom","promptNoPermission","nextDirection","containsArray","byteLength","sChar","opt","surl","p","trim","total","m","len","o","ceil","serverWarning","isSuccess","msg","serverError","postJsonData","httpConf","method","Content-type","transformRequest","d","isObject","postFormData","formData","Content-Type","undefined","identity","callback","isFunction","URL","createObjectURL","webkitURL","readFile","setDocumentTitle","Platform","isIOS","$iframe","setTimeout","append","httpPromise","promise","fn","disableBack","nextViewOptions","triggerScrollViewPullToRefresh","scrollView","__publish","__scrollLeft","__refreshHeight","__zoomLevel","refreshStartTime","__refreshActive","__refreshHidden","__refreshShow","__refreshActivate","__refreshStart","triggerScrollViewPullToRefreshByHandle","delegateHandle","$getByHandle","getScrollView","clearStateCacheAndGo","state","clearCache","checkFormDirtyBeforeLeave","formCtrlKey","tip","to","toParams","formCtrl","$dirty","history","pushState","confirm","content","back","localStorage","set","setItem","defaultValue","getItem","removeItem","JSON","stringify","parse","noop","onEvent","evtId","label","mapKv","TDAPP","install","conf","userResolve","TalkingData","API_SERVER","isLogin","_promise","resolve","loginFailed","getUserInfo","loginData","responseType","group","formhash","getServerInfo","jsonp","getRedirectUri","redirect","pathArr","loginByCorptoken","_corptoken","defer","code","systemurl","reject","message","setDocumentTitleWithCorpName","shortname","$$addPrefix","$$removePrefix","_id","RegExp","logout","getAuthority","getUser","groupUidByLetter","_uids","_uid","Prefix","PositionPrefix","DepartmentPrefix","prefx","Department","getDepartments","getSubDepartments","deptId","depts","departments","dept","pid","getUserByDepartment","deptid","getUidGroupByDepartment","getPositions","getUserByPosition","posId","positionid","getUidGroupByPosition","$ionicSlideBoxDelegate","WeixinJSBridge","invoke","current","urls","viewerModal","$new","hideDelay","closeModal","$evt","instance","slide","zoomImg","width","zoomFlag","isOfficeFile","officeFileTypes","isImage","imageTypes","getExtname","dotIndex","extname","pathnameOrigin","pathname","pathnameArr","safePathname","concat","protocol","filtIconMap","unknown","showDownloadTip","getTrustedHtml","isWeiXin","zip","7z","ai","exe","fla","pdf","psd","rar","swf","txt","php","js","asp","aspx","jsp","xls","xlsx","doc","docx","ppt","pptx","pps","ppsx","mp3","wav","wma","flac","ape","png","jpg","jpeg","gif","mp4","rmvb","rm","avi","flv","mkv","wmv","WX_SUPPORT_FILETYPE","DOWNLOAD_PAGE","frags","filetype","downloadInWx","encodeURIComponent","IS_WEIXIN","getLocation","onsuccess","onerror","wx","ready","fail","navigator","geolocation","getCurrentPosition","latitude","coords","longitude","openLocation","opts","open","isEmptyFilter","toArrayFilter","Position","filterGroup","disabled","ids","enabledIds","$$create","lastSelected","usid","positions","groups","getSelected","getSelectedCount","setGroup","toggleSelect","toggleSelectAll","isSelected","isSelectAllShow","$watchCollection","scrollBottom","_show","_options","save","setData","userGroups","paths","openDepartment","openPosition","createPosition","createDepartment","$ionicBackdrop","okText","cancelText","prompt","timeout","popup","cssClass","release","close","IbList","hasMore","items","idAttr","showLoading","hideLoading","fetch","reset","_this","req","hasItems","getOffset","keyword","offset","loadMore","checkNoData","SearchModal","lastKey","searchFunc","send","debounce","canceler","searching","defaultParams","showModal","hideModal","removeModal","$stateParams","getDefaultBack","goDefaultBack","historyRoot","getStateParams","backView","uploadAttach","uploadBase64Img","base64","post","service","This","encodeURI","upload","xhr","XMLHttpRequest","addEventListener","onProgress","loaded","onTimeout","onreadystatechange","readyState","onSuccess","responseText","fromJson","onFail","useXDomain","withCredentials","setRequestHeader","API_APP_URL","WECHAT_PUBLIC_APPID","WECHAT_API_URL","WechatApi","when","getInfo","openid","_res","cleanAuthParams","$0","$1","getJsSdkSign","getOAuthUrl","redirectUri","getAuth","initJsSdk","debug","jsApiList","appId","nonceStr","noncestr","signature","initShareConfig","onMenuShareAppMessage","onMenuShareTimeline","onMenuShareQQ","onMenuShareWeibo","run","route","$stateProvider","$urlRouterProvider","UserProvider","abstract","views","cache","ActivityList","stateName","$current","resize","reload","Activity","activityId","toggleOpen","toggleView","openMap","address","fields","form","note","formField","formdata","formdataid","field","fieldtype","fieldname","realname","moduleid","signUpList","infos","info","ok","deleteSignUp","arrangeList","moduleUrl","createSignUp","updateSignUp","page","hasmore","REGEXP_ENUM","phone","talkingDataLabel","assignment","Assignment","getSubordinates","subordinates","openSubordinateModal","backSubordinateModal","closeSubordinateModal","$ionicActionSheet","AssignmentUnfinished","createMenuOptions","roleText","getRoleText","titleText","buttons","buttonClicked","handler","ops","getEnableOperation","op","destructiveText","destructiveButtonClicked","userName","getSubList","myself","delayModal","cancelModal","openDelayApplyModal","delayApplySubmitting","delayData","assignmentid","delayReason","isDesignee","designeeuid","applyDelay","func","delay","formatDatetime","openCancelApplyModal","cancelApplySubmitting","cancelData","cancelReason","applyCancel","edit","isRemove","urge","restart","remindModal","openRemingModal","remindSubmitting","remindData","remindContent","getRemindData","remindTime","convertDateTime","reminddate","remind","showMenu","hideMenu","AssignmentFinished","init","groupByFinishTime","finishDate","finishtime","groupedItems","getStampPath","stamps","resetForm","chargeuid","submitting","isDisabledSubmit","assignmentForm","$valid","correctFormData","update","subject","participantuid","description","_confirm","onresolve","onreject","onTap","confirmDelayApply","dealDelayApply","agree","reloadInfo","confirmCancelApply","dealCancelApply","loadInfo","getFullInfo","isCharge","applyData","startTime","stampModal","selectStamp","stamp","DATETIME_FORMAT","operation","designee","0","1","2","3","4","charge","getRole","task","participant","path","stampPath","getTimezoneOffset","toJSON","correctDateTime","dateStr","addPrefix","attachmentid","assignmentId","assignmentFinished","param","statusMap","cabinet-personal","cabinet-company","cabinet-received","Cabinet","cb","pDir","ACCESS","openFolder","fid","_showMenu","access","WRITABLE","CabinetReceived","normal_search","breadCrumbs","READABLE","FOLDER","FILE","FILETYPE","removeFile","f","thumb","openImage","fileurl","handlers","share","fids","calendars","groupEvents","DAY_MILLISECOND","resetSubmit","isSubmiting","doSubmit","getCurrentDateTime","isalldayevent","editable","category","startDate","endDate","endTime","newStartDate","submit","formatSubmitData","calendarId","parseTime","removeOne","calendarid","finish","parsed","unfinish","themeSeries","DATE_FORMAT","formatDate","dayOffset","TIME_FORMAT","$cacheFactory","transformResponse","defaults","fromCache","parseEvent","startDatetime","formatTime","endDatetime","CalendarTitle","Subject","Category","IsAllDayEvent","CalendarStartTime","CalendarStartTimeed","CalendarEndTime","CalendarEndTimeed","doption","parseDateStr","results","dateReg","exec","cEvts","cEvt","substr","instancetype","allDay","dayFormToday","getMonth","getDate","timeOffset","dateField","isDateField","minuteOffset","calendarData","year","month","modalTemplate","fromTemplate","ngModelController","colors","colorpickerModal","showColorPicker","hideColorPicker","selectColor","$ionicPosition","position","contacts","Contact","getDeptList","deptInfo","categories","currentCategory","categorys","crumb","popupPromise","$$state","getUserList","distance","$applyAsync","showsearchbar","enterCategory","toCategory","breadcrumbScrollInstance","getDeptInfo","corp","getCorpInfo","userid","CRM","CRM_REPORT_TIMETYPES","crm","stage","todayReport","newModal","TIME_TODAY","getReport","time","setReportTimeType","timeType","reportTimeType","report","getTarget","getOppSurvey","oppSurver","showTargetSetupTip","groupByFilter","orderByFilter","CRMContact","addOrderFieldToList","firstCase","formattedDate","createtime","company","tabs","onTab","contactList","queryParams","range","confirmFilters","orderType","orderDesc","tagList","tagGroups","limit","order","CRMUtils","isContactInfoShowed","initTagsToForm","selectClient","openClientModal","cid","client","showContactInfo","contactWayModal","contactWays","select","onSubmitSuccess","contactid","contactForm","$setPristine","relatedClient","related","$controller","gender","buildContactFormData","formValidateError","_oldClient","birthday","setTagsToForm","tags","removeContact","confirmRemoveContact","contact","CRMClient","filterGroups","groupKey","selectFilterItem","clientList","lasteventtime","mapFilter","getContactIds","sessionStorage","attachContact","openContactModal","detachContact","submitAttachContact","submitPromise","clientForm","isClientInfoShowed","addMoreInfo","removeClient","confirmRemoveClient","CRMEvent","CRMOpportunity","loadRelatedEvent","eventListLoaded","loadRelatedOpportunity","oppListLoaded","oppList","activeTab","setClientTab","openAttachModal","__attachOpts","selectContact","selectContactToClient","updatetime","tag","groupid","tagid","oid","opp","newOpp","newContact","opportunity","setActiveTab","dealchance","isOppFormMoreShowed","showOppFormMore","attachClient","oppForm","buildOpportunityFormData","currencyToNumberFilter","expectendtime","expectincome","removeOpp","confirmRemoveOpportunity","selectOpportunity","openOpportunityModal","eventForm","aid","removeEvent","confirmRemoveEvent","ev","ResolversProvider","FormData","wrapRemovePromise","clearState","clientScope","clients","firstLetter","opps","oppScope","restoreSelected","contactScope","selectedIds","newEvent","clientAttachModal","tagGroup","taglist","groupBy","grouped","Object","multi","mode","onRemove","angle","ele","percent","plus","searchModal","tabTo","$index","activeIndex","$tab","$compile","$ionicTemplateLoader","onSelect","filterShown","color","$locale","reformat","active","$options","updateOn","$$rawModelValue","revalidate","$validate","keepInRange","fraction","$commitViewValue","hardCap","min","decimalRex","dChar","clearRex","clearValue","dSeparator","NUMBER_FORMATS","DECIMAL_SEP","cleared","neg_dummy","getCurrencySymbol","neg_regexp","GROUP_SEP","neg_dummy_txt","value_dummy_txt","currencySymbol","CURRENCY_SYM","ngRequired","$observe","$validators","groupRegex","triggerHandler","hasSelectedGroups","g","Diary","openSettingModel","settingModel","defaultShareList","direct","attentionList","setting","dashboardConfig","savesetting","$ionicListDelegate","mine","pages","groupByYearMonth","diarytime","closeOptionButtons","diaryid","allsubs","isfavor","groupByTime","other","loadDiary","imgReg","nextDay","nextDiarytime","planned","originalPlanList","unplanned","outsidePlanList","plans","tomorrowPlanList","originalPlan","next","prevAndNextPK","nextPK","prev","prevPK","readers","readeruid","isShare","isSup","comment","allStamps","commentList","cm","user_info","avatar_middle","stampUrl","toDiary","showMore","hideMore","showCommentModal","commentModel","touid","commentType","rowid","tocid","addComment","DiaryUtils","SCHEDULE","planOutside","plan","uploadImagesPreviews","diaryContent","todayDate","plantime","shareuid","isSubmitting","addUnplanned","schedule","removeUnplanned","addPlan","removePlan","allowSubmit","fd","planfromschedule","c","selectedStartDate","selectedEndDate","setRemind","delRemind","openSharingModel","sharingModel","handleFormData","oldDate","add","isInstallCalendar","workStart","recordid","todayWeekday","weekday","tomorrowWeekday","isattention","groupByMonth","attention","unattention","fillZero","hour","minute","numToHHmmFilter","timeremind","timeArr","diaryids","from","diaryDate","auid","popupContinueTime","remindConf","continueTime","getStartHours","getContinueTimes","DocsPublished","$root","docs","n","docid","hasDocs","catid","DocsUnsigned","DocsSigned","rootDir","news","Docs","signing","sign","issign","docs-published","docs-unsigned","docs-signed","docs-category","DocsList","pageCount","NewsIndex","News","hasNews","NewsUnread","markRead","readall","loadNewsList","getCategories","categoryList","_category","histories","getCommentParams","articleid","isDesc","getComments","istop","articleids","topEndTime","moveModel","categoryTree","temp","showChildrenList","childrenList","currentPid","selectCategory","move","openComment","commentModal","openCommentDetail","commentTetailModal","openReaderDetail","readerTetailModal","getReaders","checkNews","verify","currentView","stateId","reason","read","detailState","readstatus","delete","NewsList","NEWS_APT_URL","uniqueFilter","Report","filterItem","originTempArr","localTempArr","localTids","tid","orderTpl","originTemp","localTemp","diffArr","updateUnreadCount","getUnreadCount","unreadCount","updateUserTemplate","getUserTemplate","localReportSettings","templates","isSet","closeMode","openManageModel","manageModel","settingTpls","openOrderList","moveTpl","tpl","fromIndex","toIndex","orderFinish","manageTypes","uptype","getcharge","managers","outRemoveTypeMode","removeTypeMode","toRemoveTypeMode","openSelectManagerModal","chargeModel","addManager","manageTypeids","removeType","settemplate","defaultReceiveList","upuid","setTemplate","openAddModal","addModel","getShopList","templateData","isAdd","addTemplate","External","CommonApi","fileSizeFilter","ReportUtils","changeDataType","merge","fieldvalue","repid","getTemplateData","toid","remark","place","templateField","defaultuid","accessories","annex","saveReport","saveDraft","reportForm","addImage","uploading","uploadedImage","err","uploadingAccessories","removeImage","addtime","readReport","isreview","setTab","getList","addRead","allRead","currentUserUid","showReport","getCommentList","commentData","lists","reader","isStampsBoxShow","getStamp","moduleuid","stampid","setStamp","operateMore","delReport","getSortTemplate","getManagerTemplate","repids","Email","hasMails","mail","emailid","reply","forward","actionButtons","sref","EmailList","EmailInbox","EmailTodo","EmailOutbox","removeCompletelyConfirm","removeOutbox","EmailTrash","recovery","removeCompletely","EmailUtils","goBackOrHome","toggleMark","mark","ismark","replyAll","setSource","toids","fromid","concatToids","copytoids","ccids","mcids","showOther","isShowOther","emailForm","innerHTML","showSendedPopup","argu","tomark","mails","lastid","getLastId","isread","outbox","trash","Thread","ThreadUtils","ThreadProgress","thread","isAttention","th","getDayLeft","isInCharge","refreshing","ThreadFinished","setChargeFirstInMembers","members","unshift","ThreadRalatedList","more","dayLeft","slideChanged","feed","flow","VoteUtils","Vote","statusTab","setParticipationTab","voteList","setStatusTab","isOpenMore","openMore","openCrewModal","crewModal","showvoteusers","voteUsers","joined","showVote","checkMaxSelected","topicid","currentItemid","topic","topics","checkedNum","isChecked","itemid","lastItemid","voteid","validForm","mainConvert","vote","arrayToObject","convertSubItem","topicsObj","itemIds","itemids","workflow","Flow","FlowTodo","del","confirmRemove","FlowTrans","takeback","confirmTakeback","rollback","FlowDone","FlowFollow","processes","flowid","cateModal","cateModalScope","openCate","cate","getProcess","common","FlowUtils","icFactory","FlowUpload","imageAttach","fileAttach","serialize","enableArr","saveFlow","saveRollback","showRollBackModel","backlist","rollbackData","stepId","rollbackModal","classifyAttach","attachData","safeImgTypes","obj2Arr","isReadonly","readonly","viewSource","handover","topflag","rp","process","allowback","signFlow","opflag","safeSize","isSafeFile","isSafeSize","processid","isIos","checkIos","addFile","hasEmptyFile","safeFileTypes","downloadFile","workflowDownload","getFlow","feedback","hidden","fbattachmentid","saveflag","enablefiled","ics","valueArr","prcs_user_op","prcs_user","prcs_choose","notAllFinished","turnpriv","runid","flowprocess","processto","prcsback","v","isover","prcs_user_op0","prcs_user0","topflag0","onHandoverSuccess","initStep","step","selectStep","syncdeal","s","notChildFlow","childflow","validate","getNext","valiStep","prcsUserOp","prcsUser","preset","addPreset","removePreset","getPresetIndex","topflagOld","freeItemOld","tmpCount","lineCount","handoverFree","getFreeNext","runName","icPatternByTypeFilter","addPattern","patternType","icPatternValidator","validaty","$error","icModelCtrls","ic","getIc","icId","_ic","setValue","getValue","$content","prepend","getStyle","text-align","font-weight","font-size","font-style","text-decoration","ROW_SPLITTER","COL_SPLITTER","VAL_SPLITTER","raw","splitter","splitRaws","rawRows","rawRow","rows","lvTitles","lvColtypes","lvColvalues","lvSums","joinRows","row","getOptions","colIndex","optionsRaw","getRadios","radioColValue","getCheckbox","ckbColValue","scrollDeletage","sv","container","__container","removeEventListener","touchStart","mouseDown","touchMove","mouseMove","originalHandler","getDefaultValue","colType","colValue","getRowDefalutValue","updateViewValue","viewValue","addRow","removeRow","exp","rowData","__parseInt","parseInt","Error","watchExp","isUndefined","SPLITTER","checkboxs","newValue","checkedArr","attrFromTemplateFilter","setSizeAdjustWidth","parentElem","dataWidth","dataHeight","clientWidth","height","initAutoSizeAdjust","hasSrc","localSrc","originSrc","File","updateFile","dataset","selectFile","iseditable","getDrawImageRect","cvs","rgba","offsetLeft","offsetRight","offsetBottom","getContext","getImageData","x","y","cr","cg","ca","getDataURI","PADDING","dataURL","rect","tempCvs","tempCtx","drawImage","toDataURL","customCanvasId","pwCanvas","undo","innerWidth","innerHeight","lineWidth","version","dataURI","hasExec","script","appendChild","hiddenField","isHidden","emptyFieldShown","toggleFieldShown","HorizontalScrollFix","mainScrollID","horizontalScrollFix","scrollID","getEventTouches","pageX","pageY","fixHorizontalAndVerticalScroll","mainScroll","scroll","startY","startCoordinates","tap","pointerCoord","ignoreScrollStart","__isDown","containsOrIsTextInput","__hasStarted","__isSelectable","__enableScrollY","doTouchStart","timeStamp","__scrollTop","animate","yMovement","__isDragging","__isTracking","doTouchEnd","flagMap","5","6","filters","removeDepartmentPrefix","removePositionPrefix","dataType","getCheckItemMap","parts","icTitle","checkItem","checkItemMap","icPatternTypeFilter","htmlDecode","$","$2","fromCharCode","strArr","ext","filenameWithoutExt","arrs","indexArr","reduce","backViewStateId","currentViewStateId","removeByKey","flowTodo","FlowListUtil","flowTrans","flowDone","flowFollow","UploadFile","types","maxSize","closeLoading","tmp","uploaded","filesize","progress","errMsg","removeStyle","modelName","textarea","radio","radios","checkbox","dateFormat","dateArr","isDateType","isDatetimeType","single","auto","calc","setPrec","getVal","targetIc","parseFloat","sum","mod","firstNum","secondNum","avg","rmb","currencyDigits","integral","decimal","outputCharacters","digits","radices","bigRadices","decimals","zeroCount","quotient","modulus","MAXIMUM_NUMBER","olist","col","output","tableID","table","listView","getTable","row_length","children","j","cells","child_obj","firstChild","olist_val","NaN","icIds","evalExp","eval","imgupload","listview","progressbar","qrcode","pattern","serializes","addPositionPrefix","addDepartmentPrefix","installed","$injector","allServices","r","inj","requires","_invokeQueue","$httpProvider","$httpParamSerializerJQLikeProvider","$httpParamSerializer","ISCORS","$animateProvider","classNameFilter","$compileProvider","imgSrcSanitizationWhitelist","otherwise","$ionicConfigProvider","navBar","alignTitle","positionPrimaryButtons","positionSecondaryButtons","transition","spinner","$provide","decorator","$delegate","removeBackView","self","viewHistory","currentHistory","currentHistoryId","currentCursor","cursor","stack","replacementView","viewId","backViewId","forwardViewId","userAgent","hasBackView","isBackView","toState","toStateParams","fromState","talkingDataParams","bootstrap"],"mappings":"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","file":"all.js","sourcesContent":["// Test Function\nfunction getProvider(name){\n  return angular.element(document.body).injector().get(name);\n}\n\ntry {\n  angular.module('ibosApp.templates');\n} catch(e) {\n  angular.module('ibosApp.templates', []);\n}\n\nvar installed = [\n  'calendar',\n  'cabinet',\n  'diary',\n  'news',\n  'docs',\n  'contacts',\n  'email',\n  'workflow',\n  'assignment',\n  'thread',\n  'activity',\n  'vote',\n  'crm',\n  'report'\n];\n\n/**\n * @ngdoc module\n * @name ibosApp\n * @module ibosApp\n * @description\n *   Ibos app 入口模块\n */\nangular.module('ibosApp', [\n  'ionic',\n  'oc.lazyLoad',\n  'angular.filter',\n  'datetime',\n  'ibosApp.templates',\n  'ibosApp.services',\n  'ibosApp.filters',\n  'ibosApp.directives',\n  'ibosApp.controllers'\n].concat(installed))\n\n// @Debug: 调试用，将所有服务指向 window.sv \n.run(function($window, $injector) {\n  $window.addEventListener('load', function() {\n    var inj;\n    function allServices(mod, r) {\n      if (!r) {\n        r = {};\n        inj = angular.element(document.body).injector().get;\n      }\n      angular.forEach(angular.module(mod).requires, function(m) {allServices(m,r)});\n      angular.forEach(angular.module(mod)._invokeQueue, function(a) {\n        try { r[a[2][0]] = inj(a[2][0]); } catch (e) {}\n      });\n      return r;\n    }\n\n    $window.sv = allServices('ibosApp');\n  }, false);\n})\n\n.run(function($rootScope, Utils) {\n  // Set the document title when a new view is shown\n  $rootScope.$on('$ionicView.afterEnter', function(ev, data) {\n    if (data && data.title) {\n      Utils.setDocumentTitle(data.title);\n    }\n  });\n})\n\n.config(function($httpProvider, $httpParamSerializerJQLikeProvider) {\n  var $httpParamSerializer = $httpParamSerializerJQLikeProvider.$get();\n\n  //Enable cross domain calls\n  $httpProvider.defaults.useXDomain = true;\n  $httpProvider.defaults.withCredentials = true;\n\n  // 此参数作为后端判断请求是否来自 cors 的依据\n  $httpProvider.defaults.headers.common.ISCORS = true;\n\n  // delete $httpProvider.defaults.headers.common['X-Requested-With'];\n  // $httpProvider.defaults.transformResponse.push(function(data){})\n\n  // 由于 $http 默认的数据格式为 application/json，但目前后端使用的是 form data\n  // 所以此处做数据格式转换\n  // Use x-www-form-urlencoded Content-Type\n  // http://victorblog.com/2012/12/20/make-angularjs-http-service-behave-like-jquery-ajax/\n  $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';\n\n  // Override $http service's default transformRequest\n  $httpProvider.defaults.transformRequest = [function(data) {\n    return angular.isObject(data) && String(data) !== '[object File]' ? $httpParamSerializer(data) : data;\n  }];\n})\n\n.config(function($animateProvider) {\n  // $animateProvider.classNameFilter(/angular-animate/);\n  $animateProvider.classNameFilter(/^(?:(?!no-animation).)*$/);\n})\n\n.config(function($compileProvider) {\n  // Default /^\\s*((https?|ftp|file):|data:image\\/)/\n  // 添加 blob 协议进 angular 模板解析的白名单\n  $compileProvider.imgSrcSanitizationWhitelist(/^\\s*((https?|ftp|file|blob):|data:image\\/)/);\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n  // Ionic uses AngularUI Router which uses the concept of states\n  // Learn more here: https://github.com/angular-ui/ui-router\n  // Set up the various states which the app can be in.\n  // Each state's controller can be found in controllers.js\n  \n\n  $stateProvider\n    .state('login', {\n      url: '/login',\n      templateUrl: 'templates/login.html',\n      controller: 'LoginCtrl'\n    })\n\n    .state('portal', {\n      url: '/portal',\n      templateUrl: 'templates/tab-apps.html',\n      controller: 'AppsCtrl',\n      resolve: UserProvider.resolve\n    })\n\n  // if none of the above states are matched, use this as the fallback\n  $urlRouterProvider.otherwise('/portal');\n})\n\n.constant('$ionicLoadingConfig', {\n  noBackdrop: true,\n  template: '<ion-spinner></ion-spinner>'\n})\n\n// ionic 框架一些基本配置\n.config(function($ionicConfigProvider) {\n\n  // $ionicConfigProvider.platform.ios.backButton.text('返回');\n\n  $ionicConfigProvider.backButton.text('返回').icon('ion-ios-arrow-back').previousTitleText(true);\n  $ionicConfigProvider.tabs.style('standard').position('bottom');\n  $ionicConfigProvider.navBar.alignTitle('center').positionPrimaryButtons('left').positionSecondaryButtons('right');\n  $ionicConfigProvider.views.transition('ios');\n\n  // 加载中动画风格\n  // android, ios, ios-small, bubbles, circles, crescent, dots, lines, ripple, or spiral.\n  $ionicConfigProvider.spinner.icon('android');\n})\n\n.config(function($provide) {\n\n  $provide.decorator('$ionicHistory', function ($delegate) {\n\n    /**\n     * @ngdoc method\n     * @name $ionicHistory#removeBackView\n     * @description Remove the previous view from the history completely, including the \n     * cached element and scope (if they exist).\n     */\n    $delegate.removeBackView = function(){\n      var self = this;\n      var viewHistory = self.viewHistory();\n      var currentHistory = viewHistory.histories[this.currentHistoryId()];\n      var currentCursor = currentHistory.cursor;\n\n      var currentView = currentHistory.stack[currentCursor];\n      var backView = currentHistory.stack[currentCursor - 1];\n      var replacementView = currentHistory.stack[currentCursor - 2];\n\n      // fail if we dont have enough views in the history\n      if (!backView || !replacementView) {\n        return;\n      }\n\n      // remove the old backView and the cached element/scope\n      currentHistory.stack.splice(currentCursor - 1, 1);\n      self.clearCache([backView.viewId]);\n      // make the replacementView and currentView point to each other (bypass the old backView)\n      currentView.backViewId = replacementView.viewId;\n      currentView.index = currentView.index - 1;\n      replacementView.forwardViewId = currentView.viewId;\n      // update the cursor and set new backView\n      viewHistory.backView = replacementView;\n      currentHistory.currentCursor += -1;\n    };\n\n    return $delegate;\n  })\n})\n\n.run(function($document, $rootScope, $ionicHistory, Settings){\n  $rootScope.isWeiXin = /micromessenger/.test(window.navigator.userAgent.toLowerCase());\n\n  $rootScope.hasBackView = function() {\n    return !!$ionicHistory.backView();\n  };\n\n  $rootScope.isBackView = function(stateId) {\n    var backView = $ionicHistory.backView();\n    if(backView) {\n      if(angular.isString(stateId)) {\n        return backView.stateId == stateId;\n      } else if(angular.isArray(stateId)) {\n        return stateId.indexOf(backView.stateId) !== -1;\n      }\n    }\n    return false;\n  };\n})\n\n.run(function($rootScope, TalkingData) {\n\n  $rootScope.$on('$stateChangeSuccess', function($event, toState, toStateParams, fromState) {\n    if(toState.talkingDataLabel) {\n      if(toState.talkingDataParams) {\n        TalkingData.onEvent(toState.talkingDataLabel, '', toStateParams);\n      } else {\n        TalkingData.onEvent(toState.talkingDataLabel, '');\n      }\n    }\n  });\n})\n\nangular.bootstrap(document.body, ['ibosApp']);","\nangular.module('ibosApp.controllers', [])\n\n  .controller('LoginCtrl', function($scope, $state, Settings, User) {\n    $scope.user = {\n      username: \"\",\n      password: \"\"\n    };\n\n    $scope.submitLogin = function() {\n      $scope.logining = true;\n      User.login($scope.user)\n        .success(function(res) {\n          res.login && $state.go(Settings.mainState);\n        })\n        .finally(function() {\n          $scope.logining = false;\n        });\n    };\n  })\n\n// Apps 应用列表页\n  .controller('AppsCtrl', function($scope, $ionicModal, $localstorage, $timeout,Utils, User, Apps) {\n\n    var LOCAL_SETTINGS_KEY = 'portal.settings';\n    var localPortalSettings = $localstorage.getObject(LOCAL_SETTINGS_KEY) || {};\n\n    $scope.apps = Apps.all();\n    $scope.user = User.user;\n\n    function orderFilter(key) {\n      return function(a, b) {\n        var as = localPortalSettings[a.name];\n        var bs = localPortalSettings[b.name];\n\n        if(as && typeof as[key] !== 'undefined') {\n          if(bs && typeof bs[key] !== 'undefined') {\n            return as[key] > bs[key] ? 1 : -1;\n          } else {\n            return 1;\n          }\n        }\n      };\n    }\n\n    var moduleDisabled = {\n      icon: [],\n      panel: ['cabinet', 'contacts', 'thread']\n    };\n\n    ['icon', 'panel'].forEach(function(value) {\n      $scope.settings = $scope.settings || {};\n\n      var ins = $scope.settings[value] = {\n        apps: [],\n\n        isDisabled: function(app) {\n          return moduleDisabled[value].indexOf(app.name) !== -1;\n        },\n\n        getApps: function() {\n          this.apps = $scope.apps.filter(this.isShow.bind(this)).sort(orderFilter(value + 'Index'));\n          return this.apps;\n        },\n\n        // 检查设置模块图标、面板是否在快速入口显示\n        // 只有用户明确设置为 false 才不显示，默认则显示\n        // 判断 icon、panel 是否显示\n        isShow: function(app) {\n          if(this.isDisabled(app)) return false;\n          if(localPortalSettings && localPortalSettings[app.name] && localPortalSettings[app.name][value] === false) return false;\n          return true;\n        },\n\n        // 切换 icon、panel 显示状态\n        toggleShow: function($event, app) {\n          localPortalSettings[app.name] = localPortalSettings[app.name] || {};\n          // 设置 icon、panel 的显示状态\n          localPortalSettings[app.name][value] = $event.target.checked;\n\n          // 删除排序序号\n          delete localPortalSettings[app.name][value + 'Index'];\n\n          // 保存显示状态到本地\n          $localstorage.setObject(LOCAL_SETTINGS_KEY, localPortalSettings);\n\n          this.getApps();\n        },\n\n        reorder: function(app, $fromIndex, $toIndex) {\n          this.apps.splice($fromIndex, 1);\n          this.apps.splice($toIndex, 0, app);\n\n          this.apps.forEach(function(app, index) {\n            localPortalSettings[app.name] = localPortalSettings[app.name] || {};\n            localPortalSettings[app.name][value + 'Index'] = index;\n          });\n\n          $localstorage.setObject(LOCAL_SETTINGS_KEY, localPortalSettings);\n        }\n      };\n\n      ins.getApps();\n      $scope.refresh = function() {\n        $scope.$broadcast('portal');\n        $timeout(function() {\n          $scope.$broadcast('scroll.refreshComplete')\n        }, 1000);\n      };\n    });\n\n    // 设置显示/隐藏窗口\n    $ionicModal.fromTemplateUrl('templates/portal-setting.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal){\n      $scope.setModal = modal;\n      $scope.$on('$destroy', function() {\n        modal.remove();\n      });\n      $scope.$on('$ionicView.leave', function() {\n        modal.hide();\n      });\n    });\n\n    // 排序窗口\n    $ionicModal.fromTemplateUrl('templates/portal-order.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal){\n      $scope.orderModal = modal;\n      $scope.$on('$destroy', function() {\n        modal.remove();\n      });\n      $scope.$on('$ionicView.leave', function() {\n        modal.hide();\n      });\n    });\n  })\n\n// 工作日志控制器\n  .controller('AppsDiaryCtrl', function($scope, $http, Settings) {\n\n    $scope.personal = {\n      url: Settings.rootUrl + '/diary',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.review = {\n      url: Settings.rootUrl + '/diary/allsubs',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.diary;\n          });\n      }\n    };\n\n    $scope.follow = {\n      url: Settings.rootUrl + '/diary/attention',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.diary;\n          });\n      }\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('personal');\n\n    $scope.$on('portal', function(){\n      $scope.tab('personal')\n    });\n  })\n\n// 工作流控制器\n  .controller('AppsWorkflowCtrl', function($scope, $http, Settings) {\n\n    $scope.todo = {\n      loading: false,\n      url: Settings.rootUrl + '/work&type=todo'\n    };\n    $scope.follow = {\n      loading: false,\n      url: Settings.rootUrl + '/work/follow'\n    };\n    $scope.done = {\n      loading: false,\n      url: Settings.rootUrl + '/work&type=done'\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n\n      $http.get($scope[tabName].url)\n        .success(function(res) {\n          $scope[tabName].list = res.data || res.datas;\n        })\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('todo');\n    $scope.$on('portal', function(){\n      $scope.tab('todo')\n    });\n  })\n\n// 日程控制器\n  .controller('AppsCalendarCtrl', function($scope, $http, Settings, Calendar, CalendarUtil) {\n    $scope.calendar = {\n      loading: true,\n      url: Settings.rootUrl + '/calendar'\n    };\n\n    // 初始化控制器时，自动获取数据, 自动获取下月和本月的日程\n    function getData(){\n      $http.get($scope.calendar.url, {\n        params: CalendarUtil.getDateRange(),\n      })\n        .success(function(data){\n          $scope.calendar.list = CalendarUtil.parseEvents(data.events);\n        })\n        .finally(function() {\n          $scope.calendar.loading = false;\n        })\n    }\n    getData();\n\n    // 判断日程是否跨天\n    $scope.isInterDay = function(cal) {\n      return cal.endtime - cal.starttime > 86400000;\n    };\n    $scope.$on('portal', getData);\n  })\n\n// 任务指派控制器\n  .controller('AppsAssignmentCtrl', function($scope, $http, Settings) {\n\n    $scope.unfinished = {\n      url: Settings.rootUrl + '/assignmentunfinished',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.chargeData;\n          });\n      }\n    };\n\n    $scope.finished = {\n      url: Settings.rootUrl + '/assignmentfinished',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n\n          });\n      }\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('unfinished');\n\n    // 是否已过期\n    $scope.isOverdue = function(item) {\n      return item &&\n        item.endtime &&\n        Date.now() > item.endtime * 1000;\n    };\n\n    // 是否设置了提醒\n    $scope.haveRemind = function(item) {\n      return item &&\n          // 过期时不显示提醒\n        !$scope.isOverdue(item) &&\n        item.remindtime > 0;\n    };\n\n    $scope.$on('portal', function(){\n      $scope.tab('unfinished')\n    });\n  })\n\n// 公文控制器\n  .controller('AppsDocsCtrl', function($scope, $http, Settings) {\n    $scope.unsigned = {\n      url: Settings.rootUrl + '/docs&type=nosign',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.published = {\n      url: Settings.rootUrl + '/docs',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('unsigned');\n    $scope.$on('portal', function(){\n      $scope.tab('unsigned')\n    });\n  })\n\n// 信息中心控制器\n  .controller('AppsNewsCtrl', function($scope, $http, Settings) {\n    $scope.unread = {\n      url: Settings.rootUrl + '/news&type=new',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.published = {\n      url: Settings.rootUrl + '/news',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('unread');\n    $scope.$on('portal', function() {\n      $scope.tab('unread');\n    });\n  })\n\n// 邮件控制器\n  .controller('AppsEmailCtrl', function($scope, $http, Settings) {\n    $scope.inbox = {\n      url: Settings.rootUrl + '/mail&type=inbox',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.todo = {\n      url: Settings.rootUrl + '/mail&type=todo',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('inbox');\n    $scope.$on('portal', function(){\n      $scope.tab('inbox');\n    });\n  })\n\n//活动控制器\n  .controller('AppsActivityCtrl', function($scope, $http, Settings) {\n    $scope.activity = {\n      url: Settings.rootUrl + '/activity',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n            console.log(that.list,\"活动\")\n          });\n      }\n    };\n\n    //$scope.todo = {\n    //  url: Settings.rootUrl + '/mail&type=todo',\n    //  loading: false,\n    //  load: function() {\n    //    var that = this;\n    //    return $http.get(this.url)\n    //      .success(function(res) {\n    //        that.list = res.data || res.datas;\n    //      });\n    //  }\n    //};\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('inbox');\n    $scope.$on('portal',function(){\n      $scope.tab('inbox');\n    });\n  });","angular.module('datetime', [])\n\n/**\n * @ngdoc service\n * @name datetime.DateUtils\n * @description\n *   日期时间相关的工具函数\n */\n.factory('DateUtils', function(dateFilter) {\n\n  var DAYTIME = 86400000;\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#floorDate\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 设置日期到该日起始点，即 0 时 0 分 0 秒 0 毫秒\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @returns   {Date}    日期\n     */\n    floorDate: function(date) {\n      date = angular.isDate(date) ? date : typeof date !== 'undefined' ? new Date(date) : new Date();\n      date.setHours(0);\n      date.setMinutes(0);\n      date.setSeconds(0);\n      date.setMilliseconds(0);\n      return date;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#ceilDate\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 设置日期到该日结束点\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @returns   {Date}    日期\n     */\n    ceilDate: function(date) {\n      date = angular.isDate(date) ? date : typeof date !== 'undefined' ? new Date(date) : new Date();\n      date.setTime(+this.floorDate(date) + DAYTIME - 1);\n      return date;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#isToday\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 指定日期是否在今日范围内\n     *\n     * @param     {Date|String|Number}     date       日期类型，或可转化为日期的值\n     * @param     {Date|String|Number}     relative   用于作为对比的日期\n     * @returns   {Boolean}    指定日期在今日范围内为 true\n     */\n    isToday: function(date, relative) {\n      date = new Date(date);\n      relative = relative ? new Date(relative) : new Date();\n\n      return date >= this.floorDate(relative) &&\n        date <= this.ceilDate(relative);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#isTomorrow\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 指定日期是否在明日范围内\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @param     {Date|String|Number}     relative   用于作为对比的日期\n     * @returns   {Boolean}    指定日期在明日范围内为 true\n     */\n    isTomorrow: function(date, relative) {\n      date = new Date(date);\n      relative = relative ? new Date(relative) : new Date();\n\n      var tomorrow = new Date(+relative + DAYTIME);\n\n      return date >= this.floorDate(tomorrow) &&\n        date <= this.ceilDate(tomorrow);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#isYesterday\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 指定日期是否在昨日范围内\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @param     {Date|String|Number}     relative   用于作为对比的日期\n     * @returns   {Boolean}    指定日期在昨日范围内为 true\n     */\n    isYesterday: function(date, relative) {\n      date = new Date(date);\n      relative = relative ? new Date(relative) : new Date();\n\n      var yesterday = new Date(+relative - DAYTIME);\n\n      return date >= this.floorDate(yesterday) &&\n        date <= this.ceilDate(yesterday);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#inThisWeek\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 指定日期是否在本周范围内\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @returns   {Boolean}    指定日期在本周范围内为 true\n     */\n    inThisWeek: function(date) {\n      date = new Date(date);\n      var today = new Date();\n      var timestamp = date.getTime();\n\n      var weekStartTime = +this.floorDate(today) - today.getDay() * DAYTIME;\n      var weekEndTime = +this.ceilDate(today) + (6 - today.getDay()) * DAYTIME;\n\n      return timestamp >= weekStartTime &&\n        timestamp <= weekEndTime;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#inThisYear\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 指定日期是否在今年范围内\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @returns   {Boolean}    指定日期在今年范围内为 true\n     */\n    inThisYear: function(date) {\n      date = new Date(date);\n      var today = new Date();\n      return today.getFullYear() === date.getFullYear();\n    }\n  };\n})\n\n/**\n * @ngdoc filter\n * @name datetime.filter:humanizedTime\n * @function\n * @description\n *   计算给出时间与当前时间的差，并以人性化的格式显示\n *   \n * @param   {date|number}  date  日期或时间戳\n * @returns {string}       人性化格式的时间\n */\n.filter('humanizedTime', function(dateFilter) {\n\n  return function(date, format) {\n    date = +date;\n    format = format || 'yyyy-MM-dd';\n    var now = +new Date();\n\n    var postfix = now >= date ? \n      ['秒前', '分钟前', '小时前', '天前'] : \n      ['秒后', '分钟后', '小时后', '天后'];\n\n    var fromNow = Math.abs(now - date) / 1000;\n    if(fromNow < 60) {\n      return Math.floor(fromNow) + postfix[0];\n    }\n\n    fromNow = fromNow / 60;\n    if(fromNow < 60) {\n      return Math.floor(fromNow) + postfix[1];\n    }\n\n    fromNow = fromNow / 60;\n    if(fromNow < 24) {\n      return Math.floor(fromNow) + postfix[2];\n    }\n\n    fromNow = fromNow / 24;\n    if(fromNow < 7) {\n      return Math.floor(fromNow) + postfix[3];\n    }\n\n    return dateFilter(date, format);\n  }\n\n})\n\n/**\n * @ngdoc filter\n * @name datetime.filter:humanizedDate\n * @function\n * @description\n *   以人性化的格式显示日期\n *   \n * @param   {date|number}  date    日期或时间戳\n * @param   {string}       format  默认的日期格式\n * @returns {string}       人性化格式的时间\n */\n.filter('humanizedDate', function(dateFilter) {\n\n  return function(date, format) {\n    date = +date;\n    format = format || 'yyyy-MM-dd';\n    var now = new Date();\n    now.setHours(0);\n    now.setMinutes(0);\n    now.setSeconds(0);\n    now.setMilliseconds(0);\n    var day = (date - now) / 86400000;\n\n    switch(Math.floor(day)) {\n      case -2:\n        return '前天';\n      case -1:\n        return '昨天';\n      case 0:\n        return '今天';\n      case 1:\n        return '明天';\n      case 2:\n        return '后天';\n      default:\n        return dateFilter(date, format);\n    }\n  };\n})\n\n\n/**\n * @ngdoc filter\n * @name datetime.filter:humanizedDateTime\n * @function\n * @description\n *   以人性化的格式显示日期\n *   同一天内显示格式如 10:30\n *   昨天、明天分别以文字显示\n *   同一年内显示格式如 01-01\n *   其他显示格式如 2016-01-01\n *   \n * @param   {date|number}  date    日期或时间戳\n * @returns {string}       人性化格式的时间\n */\n.filter('humanizedDateTime', function(dateFilter, DateUtils) {\n\n  var defaultFormats = {\n    'today': 'HH:mm',\n    'yesterday': '昨天',\n    'tomorrow': '明天',\n    'thisWeek': 'EEE',\n    'thisYear': 'MM-dd',\n    'default': 'yyyy-MM-dd'\n  };\n\n  return function(date, formats) {\n    var type = 'default';\n    formats = angular.extend({}, defaultFormats, formats);\n\n    if(DateUtils.isToday(date)) {\n      type = 'today';\n    } else if(DateUtils.isYesterday(date)){\n      type = 'yesterday';\n    } else if(DateUtils.isTomorrow(date)){\n      type = 'tomorrow';\n    } else if(DateUtils.inThisWeek(date)) {\n      type = 'thisWeek';\n    } else if(DateUtils.inThisYear(date)) {\n      type = 'thisYear';\n    }\n\n    return dateFilter(date, formats[type]);\n  };\n})\n\n/**\n * @ngdoc filter\n * @name datetime.filter:isToday\n * @function\n * @description\n *   判断一个时间戳是否是今天\n *    \n * @param  {String|Number}  timestampe  时间戳\n * @return {Boolean}        是否今天\n */\n.filter('isToday', function(dateFilter) {\n  return function(timestamp) {\n    return dateFilter(new Date(), 'yyyyMMdd') === dateFilter(timestamp, 'yyyyMMdd');\n  }\n})\n\n/**\n * @ngdoc filter\n * @name datetime.filter:isAfterThanNow\n * @function\n * @description\n *   时间是否在现在之后\n *     \n * @param   {string|number}       timestamp    时间戳\n * @returns {boolean}             true 表示时间在现在之后\n */\n.filter('isAfterThanNow', function() {\n  return function(timestamp) {\n    return timestamp > +new Date();\n  };\n})\n\n/**\n * @ngdoc filter\n * @name datetime.filter:isBeforeThanNow\n * @function\n * @description\n *   时间是否在现在之前\n *     \n * @param   {string|number}       timestamp    时间戳\n * @returns {boolean}             true 表示时间在现在之前\n */\n.filter('isBeforeThanNow', function() {\n  return function(timestamp) {\n    return timestamp < +new Date();\n  };\n})\n\n/**\n * @ngdoc filter\n * @name  datetime.directive:dateStrInput\n * @restrict A\n * @element input[type=\"date\"]\n * @require ngModel\n * @description\n *   使日期控件能接收字符串格式的日期\n *     \n * @param   {string}       dateStrInput    日期格式\n */\n.directive('dateStrInput', function(dateFilter) {\n  return {\n    restrict: 'A',\n    require: 'ngModel',\n    link: function($scope, $element, $attrs, $ngModelCtrl) {\n      var format = $attrs.dateStrInput || 'yyyy-MM-dd'\n      $ngModelCtrl.$parsers.push(function(val) {\n        return dateFilter(val, format)\n      })\n      $ngModelCtrl.$formatters.push(function(val) {\n        return new Date(val)\n      })\n    }\n  }\n})","/**\n * @ngdoc overview\n * @name  ibosApp.directives\n * @description\n *   通用指令\n */\nangular.module('ibosApp.directives', [])\n\n.directive('copyright', function() {\n  return {\n    restrict: 'E',\n    template: '<p>Copyright © 2009-2017 IBOS 深圳市博思协创网络科技有限公司</p>',\n    replace: true\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     ibosApp.directives.directive:hideTabs\n * @element  ANY\n * @function\n * @restrict A\n *\n * @description\n *  是否隐藏当前面板的 tab 栏\n */\n.directive('hideTabs', function($rootScope, $timeout) {\n  return {\n    restrict: 'A',\n    link: function($scope, $el) {\n      $rootScope.hideTabs = true;\n\n      // $scope.$on('$ionicView.beforeLeave', function() {\n      $scope.$on('$destroy', function() {\n        $rootScope.hideTabs = false;\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc    directive\n * @name     ibosApp.directives.directive:imgPreview\n * @element  ANY\n * @restrict A\n *\n * @description\n *   为编辑器内容里的图片添加预览功能\n *   img-preview 的值用以分组，同一组图片在微信图片查看器内\n *   可通过上下张查看\n *   img-preview-src 用于指定查看大图时的大图地址，没有时默认取 src 的值\n */\n.directive('imgPreview', function(ImgViewer) {\n    var map = Array.prototype.map;\n\n    return {\n      restrict: 'AC',\n      priority: 1,\n      compile: function(element, attr) {\n        return function(scope, $elem, attrs) {\n          var src, srcs;\n          var tagName = $elem[0].tagName.toLowerCase();\n\n          // 如果指令绑定在 img 节点，则处理单个节点\n          // img-preivew\n          if (tagName === 'img') {\n            var groupName = attrs.imgPreview || '';\n\n            $elem.on('click', function() {\n              var src = this.getAttribute('img-preview-src') || this.src;\n              var siblings = document.querySelectorAll('img[img-preview=\"' + groupName + '\"]');\n\n              var srcs = map.call(siblings, function(sibling) {\n                return sibling.getAttribute('img-preview-src') || sibling.src;\n              });\n\n              ImgViewer.view(src, srcs);\n            });\n            // 否则，以该节点下找到的所有 img 为一组\n          } else {\n            element.on('click', function(evt) {\n              if (evt.target.tagName.toUpperCase() === 'IMG') {\n                var imgs = $elem[0].querySelectorAll('img');\n                srcs = map.call(imgs, function(img) {\n                  return img.src;\n                });\n                ImgViewer.view(evt.target.src, srcs);\n              }\n            });\n          }\n        }\n      }\n    }\n  })\n  /**\n   * @ngdoc    directive\n   * @name     ibosApp.directives.directive:letter\n   * @element  ANY\n   * @restrict A\n   * @todo 需要完善，监控 $hasHeader 等变量状态，为节点加上相关的class\n   *  以自适应不同视图下的高度\n   * @description\n   *   生成字母索引工具条\n   * @param  {string}  letter 索引 id 前缀\n   */\n  .directive('letter', function($location, $document, $timeout, $ionicLoading, $ionicScrollDelegate, $ionicLoadingConfig) {\n    var map = Array.prototype.map;\n\n    function createTemplate() {\n      return '#ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').map(function(value, key) {\n        return '<a flag=\"' + value + '\">' + value + '</a>';\n      }).join('');\n    }\n\n    return {\n      restrict: 'A',\n\n      template: createTemplate(),\n\n      compile: function(element, attr) {\n        element.addClass(\"letter-bar\");\n\n        return function($scope, $elem, attrs) {\n          var prefix = attrs.letter;\n          var elemTop;\n          var pos = getPos();\n          var timer;\n\n          // 获取所有字母索引的位置\n          function getPos() {\n            return map.call($elem.find('a'), function(anchor) {\n              return {\n                top: anchor.offsetTop,\n                bottom: anchor.offsetTop + anchor.clientHeight,\n                flag: anchor.getAttribute('flag')\n              }\n            });\n          }\n\n          // 根据触摸点与 letterBar 的距离获取此时对应的字母索引\n          function getFlag(offsetTop) {\n            if (offsetTop < pos[0].top) {\n              return pos[0].flag;\n            }\n            if (offsetTop > pos[pos.length - 1].bottom) {\n              return pos[pos.length - 1].flag;\n            }\n\n            for (var i = 0; i < pos.length; i++) {\n              if (pos[i].top <= offsetTop && pos[i].bottom >= offsetTop) {\n                return pos[i].flag;\n              }\n            }\n          }\n\n          // 延时至每 50 ms 执行一次\n          function _mousemove(evt) {\n            $timeout.cancel(timer);\n\n            ionic.off('touchmove', _mousemove, $document[0]);\n\n            var top = (evt.clientY || evt.touches[0].clientY) - elemTop;\n\n            scrollTo(getFlag(top));\n\n            timer = $timeout(function() {\n              ionic.on('touchmove', _mousemove, $document[0]);\n            }, 50);\n\n            evt.stopPropagation();\n            evt.preventDefault();\n          }\n\n          function scrollTo(flag) {\n            var hash;\n            var elem;\n\n            flag = flag || \"\";\n            $ionicLoading.show({\n              noBackdrop: true,\n              template: '<div class=\"letter-text\">' + flag + '</div>'\n            });\n\n            hash = prefix + '_' + flag;\n            // 对应节点存在时且处于显示状态时，才触发定位，否则会引发 anchorScroll 错误\n            elem = document.getElementById(hash);\n            if (elem && elem.style.display !== 'none') {\n              // $anchorScroll(hash);\n              $location.replace().hash(hash);\n              $ionicScrollDelegate.anchorScroll();\n            }\n          }\n\n          var oldIonicLoadingConfig;\n\n          function _mousedown(evt) {\n            var flag = this.getAttribute('flag');\n            oldIonicLoadingConfig = angular.extend({}, $ionicLoadingConfig);\n            elemTop = $elem[0].getBoundingClientRect().top;\n\n            $elem.addClass('active');\n\n            pos = getPos();\n\n            scrollTo(flag);\n\n            ionic.on('touchmove', _mousemove, $document[0]);\n            ionic.on('touchend', _mouseup, $document[0]);\n            ionic.on('touchcancel', _mouseup, $document[0]);\n\n            evt.stopPropagation();\n          }\n\n          function _mouseup() {\n            $timeout.cancel(timer);\n            $elem.removeClass('active');\n            $ionicLoading.hide();\n            // 由于 $ionicLoading.show 方法传入 template 属性会影响到 $ionicLoadingConfig\n            // 所以在 hide 之后，要还原回之前的值\n            $ionicLoadingConfig.template = oldIonicLoadingConfig.template;\n\n            ionic.off('touchmove', _mousemove, $document[0]);\n            ionic.off('touchend', _mousemove, $document[0]);\n            ionic.off('touchcancel', _mousemove, $document[0]);\n          }\n\n          angular.forEach($elem.find('a'), function(elem, index) {\n            ionic.on('touchstart', _mousedown, elem);\n          });\n\n          var parentScope = $scope;\n          $scope.$watch(function() {\n            return (parentScope.$hasHeader ? ' has-header' : '') +\n              (parentScope.$hasSubheader ? ' has-subheader' : '') +\n              (parentScope.$hasFooter ? ' has-footer' : '') +\n              (parentScope.$hasSubfooter ? ' has-subfooter' : '')\n          }, function(className, oldClassName) {\n            element.removeClass(oldClassName);\n            element.addClass(className);\n          });\n        }\n      }\n    };\n  })\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:userSelector\n * @element   INPUT\n * @restrict  E\n * @requires  ngModel\n *\n * @description\n *   人员选择显示区\n * @param     {String}  selectType             选择的数据类型\n * @param     {String}  userInfoFilter         数据过滤，过滤出要在列表项显示的数据\n */\n.directive('userSelector', function($filter, removeFilter, userInfoFilter, departmentInfoFilter, positionInfoFilter) {\n\n  return {\n    restrict: 'E',\n    replace: true,\n    require: 'ngModel',\n    scope: true,\n    // transclude: true,\n    template: '<div>' +\n      '<div class=\"user-selector\">' +\n      '<span ng-repeat=\"val in collection\" ng-click=\"remove(val)\">{{ getName(val) }}</span>' +\n      '</div>' +\n      '<input type=\"hidden\">' +\n      '</div>',\n\n    compile: function(element, attr) {\n      // 过继各种有效属性到内部的 input\n      var input = element.find('input');\n\n      angular.forEach({\n        'name': attr.name,\n        'ng-value': attr.ngValue,\n        'ng-model': attr.ngModel,\n        'ng-disabled': attr.ngDisabled,\n        'ng-change': attr.ngChange,\n        'required': attr.required\n      }, function(value, name) {\n        if (angular.isDefined(value)) {\n          input.attr(name, value);\n        }\n      });\n\n      // Link\n      return function($scope, $elem, attrs, $ngModelCtrl) {\n        var selectType = attrs.selectType || 'user';\n\n        $scope.getName = function(val) {\n          if (selectType == 'user') {\n            return userInfoFilter(val, 'realname');\n          } else if (selectType == 'position') {\n            return positionInfoFilter(val, 'posname');\n          } else if (selectType == 'department') {\n            return departmentInfoFilter(val, 'deptname');\n          }\n        };\n\n        $scope.remove = function(val) {\n          var index = $scope.collection.indexOf(val);\n\n          if (index !== -1) {\n            $scope.collection.splice(index, 1);\n            $ngModelCtrl.$setViewValue($scope.collection.join(','));\n          }\n        };\n\n        $ngModelCtrl.$render = function() {\n          if (angular.isString($ngModelCtrl.$viewValue)) {\n            // 过滤空值\n            $scope.collection = removeFilter($ngModelCtrl.$viewValue ? $ngModelCtrl.$viewValue.split(',') : [], '');\n          } else {\n            $scope.collection = [];\n          }\n        };\n      }\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:userSelectorTrigger\n * @element   INPUT\n * @restrict  E\n * @requires  ngModel\n * @description\n *   人员选择控件触发器\n * @param     {string|number}  maxSelection    最大可选数\n * @param     {expression}     enabledUsers     可选 uid 数组或以 ',' 分隔的字符串\n */\n.directive('userSelectorTrigger', function(UserSelector) {\n\n  return {\n    restrict: 'A',\n    require: 'ngModel',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      var userSelector;\n\n      function osSelect(selected) {\n        $ngModelCtrl.$setViewValue(selected.join(','));\n        userSelector.hide();\n      }\n\n      function showUserSelector() {\n        var enabled;\n        var options;\n\n        if ($attr.enabledUsers) {\n          enabled = $scope.$eval($attr.enabledUsers);\n          if (angular.isString(enabled)) {\n            enabled = enabled.split(',');\n          }\n        }\n\n        options = {\n          values: $ngModelCtrl.$viewValue ? $ngModelCtrl.$viewValue.split(',') : [],\n        };\n\n        if (userSelector) {\n          userSelector.show(options, osSelect);\n        } else {\n          var createOptions = {};\n          if ($attr.maxSelection) {\n            createOptions.maxSelection = $attr.maxSelection;\n          }\n          if (enabled) {\n            createOptions.enabled = enabled;\n          }\n\n          UserSelector.create(createOptions).then(function(modal) {\n            userSelector = modal;\n            userSelector.show(options, osSelect);\n          });\n        }\n      }\n\n      $element.on('click', showUserSelector);\n\n      $scope.$on('$destroy', function() {\n        userSelector && userSelector.remove();\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:userAvatarSelector\n * @element   INPUT\n * @restrict  E\n * @requires  ngModel\n *\n * @description\n *   选择用户，以头像的方式呈现；\n * @param     {String}  selectType             选择的数据类型\n * @param     {String}  userInfoFilter         数据过滤，过滤出要在列表项显示的数据\n */\n.directive('userAvatarSelector', function($filter, removeFilter, userInfoFilter, departmentInfoFilter, positionInfoFilter) {\n  return {\n    restrict: 'E',\n    //replace: true,\n    require: 'ngModel',\n    scope: {\n      ngModel: '='\n    },\n    // transclude: true,\n    template: '<div class=\"cslist\" ng-click=\"outRemoveMode()\">' +\n      '<li ng-repeat=\"val in collection track by $index\">' +\n      '<i class=\"o40-minus-assertive-so\" ng-show=\"removeMode\" ng-click=\"remove($event, val)\"></i>' +\n      '<img avatar=\"{{ val | userInfo:\\'avatar_middle\\' | fullUrl }}\" alt=\"{{ uid | userInfo:\\'realname\\' }}\"/>' +\n      '<div class=\"cslist-desc ellipsis\">{{ val | userInfo: \\'realname\\'}} </div>' +\n      '</li>' +\n      '<li class=\"cslist-plus\">' +\n      '<div class=\"cslist-plus-icon\">' +\n      '<i class=\"ion-ios-plus-empty\" user-selector-trigger ng-model=\"ngModel\"></i>' +\n      '</div>' +\n      '</li>' +\n      '<li class=\"cslist-plus\" ng-show=\"!removeMode && collection.length\" ng-click=\"toRemoveMode($event)\">' +\n      '<div class=\"cslist-plus-icon\">' +\n      '<i class=\"ion-ios-minus-empty\"></i>' +\n      '</div>' +\n      '</li>' +\n      '</div>',\n\n    compile: function(element, attr) {\n      // 过继各种有效属性到内部的 input\n      var input = element.find('input');\n\n      angular.forEach({\n        'name': attr.name,\n        'ng-value': attr.ngValue,\n        'ng-model': attr.ngModel,\n        'ng-disabled': attr.ngDisabled,\n        'ng-change': attr.ngChange,\n        'required': attr.required\n      }, function(value, name) {\n        if (angular.isDefined(value)) {\n          input.attr(name, value);\n        }\n      });\n\n      // Link\n      return function($scope, $elem, attrs, $ngModelCtrl) {\n        var selectType = attrs.selectType || 'user';\n\n        $scope.getName = function(val) {\n          if (selectType == 'user') {\n            return userInfoFilter(val, 'realname');\n          } else if (selectType == 'position') {\n            return positionInfoFilter(val, 'posname');\n          } else if (selectType == 'department') {\n            return departmentInfoFilter(val, 'deptname');\n          }\n        };\n\n        $scope.outRemoveMode = function(evt) {\n          $scope.removeMode = false\n        }\n\n        $scope.removeMode = false;\n        $scope.toRemoveMode = function($event) {\n          $scope.removeMode = true;\n          $event.stopPropagation();\n        };\n\n        $scope.remove = function($event, val) {\n          var index = $scope.collection.indexOf(val);\n          if (index !== -1) {\n            $scope.collection.splice(index, 1);\n            $ngModelCtrl.$setViewValue($scope.collection.join(','));\n          }\n          if (!$scope.collection.length) $scope.removeMode = false;\n          $event.stopPropagation();\n        };\n\n        $ngModelCtrl.$render = function() {\n          if (angular.isString($ngModelCtrl.$viewValue)) {\n            // 过滤空值\n            $scope.collection = removeFilter($ngModelCtrl.$viewValue ? $ngModelCtrl.$viewValue.split(',') : [], '');\n          } else {\n            $scope.collection = [];\n          }\n        };\n      }\n    }\n  };\n})\n\n\n/**\n * @ngdoc    directive\n * @name     ibosApp.directives.directive:charcount\n * @element  ANY\n * @restrict E\n *\n * @description\n *   输入字数统计\n *\n * @param     {Number}   max           字数允许的最大值\n * @param     {Boolean}  countdown     是否倒数\n */\n.directive('charcount', function(Utils) {\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    replace: true,\n    scope: true,\n    transclude: true, // 允许内嵌内容\n    template: '<span class=\"charcount\"> <em>{{count}}</em> <span ng-transclude></span> </span>',\n    link: function($scope, elem, attrs, $ngModelCtrl) {\n      // 字数允许的最大值\n      var max = isNaN(+attrs.max) ? 0 : +attrs.max;\n      // 是否倒数\n      var countdown = attrs.countdown == 'true';\n      $scope.count = countdown ? max : 0;\n\n      $ngModelCtrl.$render = function() {\n        var valCount = Utils.getCharLength($ngModelCtrl.$viewValue || '');\n        $scope.count = countdown ?\n          max - valCount :\n          valCount;\n        $ngModelCtrl.$setValidity('charcount', valCount <= max);\n      };\n    }\n  }\n})\n\n.directive('ibDownload', function(Downloader) {\n\n  return {\n    restrict: 'A',\n    compile: function($elem) {\n      function prelink($scope, $element, $attrs) {\n        $element.on('click', function() {\n          Downloader.down($attrs.ibDownload);\n        });\n      }\n\n      return {\n        pre: prelink\n      };\n    }\n  }\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:datetimeLocal\n * @element   ANY\n * @restrict  E\n * @requires  ngModel\n * @todo\n *   text 类型时，做格式验证，并同步到 ng-valid 状态\n * @description\n *   对于不支持 datetime-local 类型表单控件的浏览器，使用 text 代替\n */\n.directive('datetimeLocal', function(Utils) {\n  return {\n    restrict: 'E',\n    replace: true,\n    require: 'ngModel',\n    template: function() {\n      return Utils.isDateTimeLocalSupport ? '<input type=\"datetime-local\" />' : '<input type=\"text\" />';\n    },\n    compile: function(element, attr) {\n      angular.forEach({\n        'name': attr.name,\n        'ng-value': attr.ngValue,\n        'ng-model': attr.ngModel,\n        'ng-disabled': attr.ngDisabled,\n        'ng-change': attr.ngChange,\n        'required': attr.required,\n        'placeholder': attr.placeholder\n      }, function(value, name) {\n        if (angular.isDefined(value)) {\n          element.attr(name, value);\n        }\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:fileOnChange\n * @element   INPUT\n * @restrict  A\n * @description\n *   input[type=\"file\"] 发生变化时触发相应回调\n *\n * @param     {expression}  fileOnChange  回调函数\n */\n.directive('fileOnChange', function() {\n  return {\n    restrict: 'A',\n    link: function(scope, element, attrs) {\n      element.bind('change', function() {\n        var onChangeFunc = scope.$eval(attrs.fileOnChange);\n        onChangeFunc.apply(element, arguments);\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:fileImageData\n * @element   INPUT\n * @restrict  A\n * @todo      迁移至 file-util 模块\n * @description\n *   input[type=\"file\"] 发生变化时，将选择的文件以 dataURL 的形式赋值到指定变量\n *\n * @param     {String}   fileImageData         用于保存 dataURL 的属性\n * @param     {Number}   fileImageMaxlength    最多允许选择的文件数\n */\n.directive('fileImageData', function($parse, Utils) {\n  var reg = /image\\/(jpg|jpeg|png|bmp|gif)/;\n\n  function testFileType(file) {\n    if (!reg.test(file.type)) {\n      alert('“' + file.name + '” 为不支持的文件格式 ' + file.type);\n      return false;\n    }\n    return true;\n  }\n\n  return {\n    restrict: 'A',\n    link: function(scope, element, attrs) {\n      var key = attrs.fileImageData;\n      var maxLength = attrs.fileImageMaxlength;\n\n      element.on('change', function($event) {\n        var files = $event.target.files;\n        var file;\n        if (!files.length) {\n          return;\n        }\n\n        // 单选时\n        if (!maxLength) {\n          file = files[0];\n\n          if (!testFileType(file)) return;\n\n          Utils.getImagePreviewUrl(file, function(url) {\n              scope.$eval(key + ' = \"' + url + '\"');\n              scope.$apply(key);\n            })\n            // 多选时，绑定模型必须为数组，否则报错\n        } else {\n          var images = $parse(key)(scope);\n\n          if (!angular.isArray(images)) {\n            console.error(key + ' 不是一个数组！');\n            return;\n          }\n\n          var currentLength = images.length;\n\n          for (var i = 0; i < files.length; i++) {\n            file = files[i];\n            if (!testFileType(file)) continue;\n            // 判断最大选择数\n            if (maxLength && currentLength >= maxLength) {\n              alert('已达到最大选择数 ' + maxLength);\n              break;\n            }\n            currentLength++;\n            Utils.getImagePreviewUrl(file, function(url) {\n              images.push(url);\n              scope.$apply(key);\n            });\n          }\n        }\n      });\n    }\n  }\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:stopPropagation\n * @element   ANY\n * @restrict  A\n *\n * @description\n *  阻止指定节点上的指定事件冒泡\n *  stop-propagation=\"click,touch,tap\"\n * @param    {String}   stopPropagation   以事件名组成的字符串，用“,”分隔\n */\n.directive('stopPropagation', function() {\n  function _stopPropagation(evt) {\n    evt.stopPropagation();\n  }\n\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $attrs) {\n      var eventList = $attrs.stopPropagation;\n      angular.forEach(eventList.split(','), function(eventName) {\n        $element.on(eventName, _stopPropagation);\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:focusOn\n * @element   input|textarea|select|element[contenteditable]\n * @restrict  A\n *\n * @description\n *  自动焦点到表单控件上\n *\n * @param     {expression}   focusOn    当此值为 true 时，表单控件将获得焦点\n */\n.directive('focusOn', function($timeout) {\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $attr) {\n      $scope.$watch($attr.focusOn, function(shouldFocus) {\n        $timeout(function() {\n          if(shouldFocus) {\n            $element[0].focus()\n          }\n        }, $scope.$eval($attr.focusDelay) || 0);\n      });\n    }\n  };\n})\n\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:avatar\n * @element   ANY\n * @restrict  A\n *\n * @description\n *  头像，一开始设置为默认头像，读取真实头像成功后再替换\n *\n * @param    {string}   avatar                真实头像地址\n * @param    {string}   avatar-default-size   默认头像尺寸\n * @param    {string}   avatar-default-url    默认头像地址\n */\n.directive('avatar', function() {\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $attr) {\n      // 默认头像尺寸\n      var size = ['big', 'middle', 'small'].indexOf($attr.avatarDefaultSize) !== -1 ? $attr.avatarDefaultSize : 'middle';\n      // 默认图像地址，有设置此值时，不使用默认头像\n      var defaultUrl = $attr.avatarDefaultUrl || './img/noavatar_' + size + '.png';\n\n      if ($element[0].tagName.toLowerCase() === 'img') {\n        $scope.$watch(function() {\n          return $attr.avatar;\n        }, function(url) {\n          $element.attr('src', defaultUrl);\n          if (url) {\n            angular.element('<img />').on('load', function() {\n                $element.attr('src', url);\n              })\n              .attr('src', url);\n          }\n        });\n      }\n    }\n  };\n})\n\n.directive('attachList', function(fullUrlFilter, Downloader) {\n  return {\n    retrict: 'E',\n    templateUrl: 'templates/attach.html',\n    replace: true,\n    scope: {\n      'attach': '='\n    },\n    link: function($scope, $element, $attr) {\n      $scope.download = function(att) {\n        Downloader.down(fullUrlFilter(att.entireattachurl || att.officereadurl));\n      };\n    }\n  }\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:transheader\n * @element   ANY\n * @restrict  A\n *\n * @description\n *  设置头部条为透明，并随着滚动位置变换颜色\n *\n */\n.directive('transheader', function($ionicScrollDelegate) {\n\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $attrs) {\n      var $ionContent = $element.find('ion-content');\n\n      function toggleHeaderClass(status) {\n        angular.forEach(document.querySelectorAll('ion-header-bar'), function(elem) {\n          angular.element(elem).toggleClass('trans-header', status);\n        });\n      }\n\n      function onScroll(evt) {\n        toggleHeaderClass(evt.detail.scrollTop <= 0);\n      }\n\n      $scope.$on('$ionicView.enter', function() {\n        toggleHeaderClass($ionicScrollDelegate.getScrollPosition().top <= 0);\n        $ionContent.on('scroll', onScroll);\n      });\n\n      $scope.$on('$ionicView.leave', function() {\n        toggleHeaderClass(false);\n        $ionContent.off('scroll', onScroll);\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:backState\n * @element   ANY\n * @restrict  A\n *\n * @description\n *  当没有历史时设置默认返回按钮\n *  `method:goBack()`    触发返回\n *  `method:getTitle()`  获取默认文本\n *\n */\n.directive('defaultNavBackButton', function($ionicHistory, $ionicConfig, $ionicPlatform, DefaultBack) {\n\n  return {\n    link: link,\n    restrict: 'EA'\n  };\n\n  function link(scope, element, attrs) {\n\n    scope.backTitle = function() {\n      var defaultBack = DefaultBack.get();\n      if ($ionicConfig.backButton.previousTitleText() && defaultBack) {\n        return $ionicHistory.backTitle() || defaultBack.title;\n      }\n    };\n\n    scope.goBack = DefaultBack.goBack;\n\n    scope.$on('$stateChangeSuccess', function() {\n      element.toggleClass('hide', !DefaultBack.get());\n    });\n\n    // $ionicPlatform.registerBackButtonAction(function() {\n    //   if ($ionicHistory.backView()) {\n    //     $ionicHistory.goBack();\n    //   } else if (DefaultBack.get()) {\n    //     goDefaultBack();\n    //   } else {\n    //     navigator.app.exitApp();\n    //   }\n    // }, 100);\n\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     ibosApp.directives.directive:clickInput\n * @element  DIV\n * @function\n * @restrict A\n * @description\n * 给input节点添加点击事件\n */\n.directive('clickInput', function() {\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $arr) {\n      $element.on('click', function(e) {\n        var nodeName = e.target.nodeName.toLocaleLowerCase();\n        // if (nodeName !== 'div' && nodeName === 'i') {\n        //   e.target.parentNode.querySelector('input').click();\n        // } else {\n        //   e.target.parentNode.querySelector('input').click();\n        // }\n        e.target.parentNode.querySelector('input').click();\n      });\n    }\n  };\n})\n","/**\n * @ngdoc overview\n * @name  ibosApp.filters\n * @description\n *   通用过滤器\n */\n;(function() {\n\nvar appFilter = angular.module('ibosApp.filters', [])\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:htmlToPlaintext\n * @function\n * @description\n *  清理内容中包含的 html 标签\n *\n * @param   {string}  text 源文本内容\n * @returns {string}  清理后的内容\n */\n.filter('htmlToPlaintext', function() {\n  return function(text) {\n        return text ? String(text).replace(/<[^>]+>/gm, '') : '';\n  };\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:fileSize\n * @function\n * @description\n *  将文件大小转化成带单位的更易阅读的格式\n * @param   {number}  size 文件大小\n * @param   {number=} digit 保留的小数位数\n * @returns {string}  带单位的文件大小\n */\n.filter('fileSize', function() {\n\n  var unit = ['B', 'KB', 'MB', 'GB'];\n\n  return function(size, digit){\n    size = +size || 0;\n    digit = digit == null ?  2 : digit;\n    \n    var pow = 1;\n\n    while(size > 1024){\n      size = size / 1024;\n      pow++;\n    }\n\n    return digit ? \n      size.toFixed(digit) + unit[pow - 1] :\n      size + unit[pow - 1]\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:filetypeIcon\n * @function\n * @description\n *  根据服务器端返回的文件类型图标路径解析出在 app 中的图标路径\n *\n * @param   {string}  source 服务器端文件类型图标\n * @returns {string}  文件类型图标路径\n */\n.filter('filetypeIcon', function() {\n  return function(source, size){\n\n    if(!source) return '';\n\n    var start = source.lastIndexOf('/');\n    var end = source.lastIndexOf('.');\n\n    if(start !== -1){\n      source = source.substring(start + 1, end);\n    }\n\n    if(size) {\n      source += '_' + size;\n    }\n\n    return 'img/filetype/' + source + '.png';\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:fileIconByExtname\n * @function\n * @description\n *   根据后缀名获取对应图标地址\n *\n * @param   {string}  extname  后缀名\n * @param   {string}  size     尺寸\n * @returns {string}  文件类型图标路径\n */\n.filter('fileIconByExtname', function(FileUtils) {\n  return FileUtils.getFileIconByExtname;\n})\n\n.filter('fileIconByFilename', function(fileIconByExtnameFilter) {\n  return function(filename, size) {\n    if(typeof filename === 'string') {\n      return fileIconByExtnameFilter(filename.split('.').pop(), size)\n    }\n    return ''\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:fullUrl\n * @function\n * @description\n *   由于部分后端输出的文件路径是相对服务器的\n *   此 filter 用于将其拼接为完整路径\n *\n * @param   {string}  source 原文件路径\n * @returns {string}  完整路径\n */\n.filter('fullUrl', function(Settings) {\n  var httpReg = /^https?:\\/\\//;\n  return function(source) {\n    source = source || '';\n    if(httpReg.test(source)) {\n      return source\n    }\n    return Settings.hostUrl + source;\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:editorContent\n * @function\n * @description\n *   编辑器文本，可能包括图片等资源地址，此处需要对这些地址做处理以指向正确资源\n *\n * @returns {string}  编辑器文本\n */\n.filter('editorContent', function($filter) {\n  return function(source) {\n    if(!source) return source;\n\n    var reg = /src\\s*=\\s*['\"]\\/?((data|static).*?)['\"]/g;\n    return source.replace(reg, function(a, b) {\n      return 'src=\"' + $filter('fullUrl')(b) + '\"';\n    });\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:avatar\n * @function\n * @description\n *   根据 uid 从 User[service] 里获取头像\n *\n * @param   {string} uid   用于标识用户的唯一id\n * @param   {string} size  头像的尺寸，有大中小三种尺寸\n * @returns {string} 头像地址\n */\n.filter('avatar', function($filter, User) {\n  return function(uid, size) {\n    size = size || 'middle';\n\n    return uid && User.users[uid] ?\n      $filter('fullUrl')(User.users[uid]['avatar_' + size]) :\n      'img/noavatar_' + size + '.png';\n  }\n})\n\n/**\n * @ngdoc filter\n *  @name ibosApp.filters.filter:userInfo\n * @function\n * @description\n *   根据 uid 获取用户某项信息\n *\n * @param   {string} uid   用于标识用户的唯一id; 格式为 '1,2,3,4...'\n * @param   {string} prop  需要获取的属性\n * @returns {string} 属性值\n */\n.filter('userInfo', function(User) {\n  return createGetProp(User.userData.datas);\n})\n\n.filter('removeUserPrefix', function(User) {\n  return function(uids) {\n    return User.removePrefix(uids);\n  };\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:positionInfo\n * @function\n * @description\n *   根据 pid 获取岗位某项信息\n *\n * @param   {string} pid   用于标识岗位的唯一id; 格式为 '1,2,3,4...'\n * @param   {string} prop  需要获取的属性\n * @returns {string} 属性值\n */\n.filter('positionInfo', function(User) {\n  return createGetProp(User.positionData.datas);\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:departmentInfo\n * @function\n * @description\n *   根据 did 获取部门某项信息\n *\n * @param   {string} did   用于标识部门的唯一id; 格式为 '1,2,3,4...'\n * @param   {string} prop  需要获取的属性\n * @returns {string} 属性值\n */\n.filter('departmentInfo', function(User) {\n  return createGetProp(User.departmentData.datas);\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:asHtml\n * @function\n * @description\n *   作为安全的html显示\n *   angular会自动将不安全的 html 过滤，此 filter 用于保留所有 html 内容\n *   \n * @param   {string}       html  源 html\n * @returns {object}       生成 sce 对象\n */\n.filter('asHtml', function($sce) {\n  return function(html){\n    return $sce.trustAsHtml(html);\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:httpPrefix\n * @function\n * @description\n *   补全网址的 http:// 前缀\n *   \n * @param   {string}       str  网址\n * @returns {string}       补全后的网址\n */\n.filter('httpPrefix', function() {\n  return function(str) {\n    if(!str) return '';\n    if(/^https?:\\/\\//i.test(str)) {\n      return str;\n    } else {\n      return 'http://' + str;\n    }\n  };\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:defaultAvatar\n * @function\n * @description\n *   没有头像时获取默认头像\n *     \n * @param   {string}       src    头像地址\n * @param   {string}       size   默认头像尺寸 small, middle, big\n * @returns {string}       最终应显示的头像\n */\n.filter('defaultAvatar', function() {\n  return function(src, size) {\n    size = size || 'middle';\n    return src ? src : 'img/noavatar_' + size + '.png';\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:attachUrl\n * @function\n * @description\n *   附件真实地址\n *     \n * @param   {string}       url    原始地址\n * @returns {string}       预览地址\n */\n.filter('attachUrl', function(Settings) {\n  return function(url) {\n    // @Todo: 此处希望后端统一一下数据格式 \n    return url.indexOf('data/attachment/') === 0 ? Settings.hostUrl + url : url;\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:currencyToNumber\n * @function\n * @description\n *   将货币格式的字符串转为数字\n *   主要作用是去除千分号\n * @param   {string}       currency    货币\n * @returns {number}       数字\n */\n.filter('currencyToNumber', function() {\n  function currencyToNumber(currency) {\n    var ret = Number(currency)\n\n    if(isNaN(ret)) {\n      if(typeof currency === 'string') {\n        return currencyToNumber(currency.replace(/,/g, ''))\n      }\n      return 0\n    }\n\n    return ret\n  }\n\n  return currencyToNumber  \n})\n\nfunction createGetProp(data) {\n  return function(id, prop) {\n    if(id == null) {\n      return '';\n    }\n    // 转为字符串\n    id = id + '';\n\n    var idArr = id.split(',');\n\n    if(idArr.length > 1) {\n      \n      return idArr.map(function(i) {\n        return data[i] ? (prop ? data[i][prop] : data[i]) : '';\n      }).join(',');\n\n    } else {\n      return data[id] ? (prop ? data[id][prop] : data[id]) : '';\n    }\n  }\n}\n\n})();\n","/**\n * @ngdoc overview\n * @name  ibosApp.services\n * @description\n *   通用服务\n */\n\nangular.module('ibosApp.services', [])\n\n.constant('REGEXP_ENUM', {\n  notempty: '\\\\S+', //非空\n  chinese: '^[\\\\u4E00-\\\\u9FA5\\\\uF900-\\\\uFA2D]+$', //仅中文\n  letter: '^[A-Za-z]+$', //字母\n  num: '^([+-]?)\\\\d*\\\\.?\\\\d+$', //数字\n  idcard: '^[1-9]([0-9]{14}|[0-9]{17})$', //身份证\n  mobile: '^1\\\\d{10}$', //手机\n  money: '^(-)?(([1-9]{1}\\d*)|([0]{1}))(\\.(\\d){1,2})?$', //精确到小数点两位的金额格式\n  tel: '^(([0\\\\+]\\\\d{2,3}-)?(0\\\\d{2,3})-)?(\\\\d{7,8})(-(\\\\d{3,}))?$', //电话号码的函数(包括验证国内区号,国际区号,分机号)\n  zipcode: '^\\\\d{6}$', //邮编\n  email: '^\\\\w+((-\\\\w+)|(\\\\.\\\\w+))*\\\\@[A-Za-z0-9]+((\\\\.|-)[A-Za-z0-9]+)*\\\\.[A-Za-z0-9]+$', //邮件\n})\n\n.constant('API_SERVER', 'https://api.ibos.cn/v1')\n\n.provider('Resolvers', function() {\n\n  var resolvers = {\n    qqmap: ['$ocLazyLoad', function($ocLazyLoad) {\n      return $ocLazyLoad.load('components/qqmap/qqmap.js')\n    }],\n\n    canvasPainter: ['$ocLazyLoad', function($ocLazyLoad) {\n      return $ocLazyLoad.load('components/angular-canvas-painter/angular-canvas-painter.min.js')\n    }],\n  }\n\n  return {\n    get: function(nameArr) {\n      var ret = {}\n      if(nameArr && nameArr.length) {\n        angular.forEach(nameArr, function(name) {\n          ret[name] = resolvers[name]\n        })\n      }\n      return ret\n    },\n\n    $get: function() {\n      return {}\n    }\n  }\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.Settings\n * @todo 企业令牌放在此服务不合适\n *\n * @property {String}  appName    程序名\n * @property {String}  corptoken  企业令牌\n * @property {String}  hostUrl    服务器 URL\n * @property {String}  rootUrl    接口基本 URL\n * @property {String}  mainState  初始状态state\n *\n * @description\n *   程序基础设置\n */\n.factory('Settings', function($http, $state, $location, $window, $ionicPopup, $document, Utils) {\n  var appName = '微办公';\n  var searchParams = Utils.parseSearch($window.location.search);\n\n  function getOrigin() {\n    var result = $window.location.href.match(/(^.*\\/)mobile/);\n    return result ? result[1] : '';\n  }\n\n  var hostUrl = searchParams && searchParams.host ?\n    searchParams.host.replace(/\\/*$/, '/') :\n    getOrigin();\n\n  var rootUrl = hostUrl + '?r=mobile';\n\n  var corptoken = window.corptoken ? window.corptoken :\n    ($location.search().corptoken ?\n      $location.search().corptoken :\n      searchParams && searchParams.corptoken || '');\n\n  var mainState = 'portal';\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.Settings#requestError\n   * @methodOf  ibosApp.services.Settings\n   * @description\n   *    jsonp 出现错误弹出提示消息，由于 $ionicPopup 是一个promise\n   *    可以使用相关功能进行后续处理\n   *    参数是一个 HttpPromise 的返回结果\n   *\n   * @returns   {Promise}    Promise\n   */\n  function requestError(data, status, headers, config) {\n    data = data || {};\n    config = config || {};\n\n    var errorMsg = (status == 0 && data == null) ? 'CORS 跨域请求失败，请参考 <a href=\"http://doc.ibos.com.cn/article/detail/id/268\">http://doc.ibos.com.cn/article/detail/id/268</a> 配置服务器' : (typeof data == 'string' ? data : angular.toJson(data))\n\n    return $ionicPopup.alert({\n      title: '服务器连接失败',\n      template: '<strong>url</strong>: ' + config.url +\n        '<br> <strong>status</strong>: ' + status +\n        '<br> <strong>msg</strong>: ' + errorMsg\n    });\n  }\n\n  return {\n    appName: appName,\n    corptoken: corptoken,\n    hostUrl: hostUrl,\n    rootUrl: rootUrl,\n    mainState: mainState,\n    requestError: requestError\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.Utils\n * @description\n *   一些工具函数\n */\n.factory('Utils', function($http, $q, $window, $timeout, $state, $ionicHistory, $ionicScrollDelegate, $ionicViewSwitcher, IbPopup) {\n  function isFile(obj) {\n    return toString.call(obj) === '[object File]';\n  }\n\n  function isBlob(obj) {\n    return toString.call(obj) === '[object Blob]';\n  }\n\n  var ret = {\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#isFormTypeSupported\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    表单支持类型检测\n     * @param   {String}    type   表单控件类型\n     * @returns {Boolean}   支持情况\n     */\n    isFormTypeSupported: function(type) {\n      var elem = document.createElement(\"input\");\n      elem.setAttribute(\"type\", type);\n      return elem.type == type;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#parseSearch\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    将url查询参数解析成对象\n     *\n     * @param   {String}   search   url查询参数\n     * @returns {Object}   参数对象\n     */\n    parseSearch: function(search) {\n      search = decodeURIComponent(search).replace(/^\\?/, '');\n      var searchField = search.split('&');\n      var ret = {};\n\n      for (var i = 0; i < searchField.length; i++) {\n        var kt = searchField[i].split('=');\n        ret[kt[0]] = kt[1]\n      }\n\n      return ret;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#capitalize\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    把字符串转化首字母大写\n     *\n     * @param   {String} str  要操作的字符串\n     * @returns {String}      首字母大写的字符串\n     */\n    capitalize: function(str) {\n      str = str == null ? '' : String(str);\n      return str.charAt(0).toUpperCase() + str.slice(1);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#commasInclude\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    判断格式如“1,2,3,4”的字符串中，是否包含某个值\n     *\n     * @param   {String} str  以“,”分隔的字符串\n     * @param   {String} key  要检查的值\n     * @returns {Boolean}     是否包含\n     */\n    commasInclude: function(str, key) {\n      return str.split(',').indexOf(key) !== -1;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#pick\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    从对象中获取需要的属性组合成新对象\n     *\n     * @param   {Object}   obj    源对象\n     * @param   {Array}    keys   属性名数组\n     *\n     * @returns {Object}   由指定属性组成的新对象\n     */\n    pick: function(obj, keys) {\n      var ret = {};\n      if (!obj || !keys) {\n        return obj;\n      } else {\n        angular.forEach(keys, function(key) {\n          if (obj.hasOwnProperty(key)) {\n            ret[key] = obj[key];\n          }\n        });\n      }\n      return ret;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#eliminate\n     * @methodOf  ibosApp.services.Utils\n     * @todo      支持剔除多个相同值\n     * @description\n     *    从数组中剔除指定元素，此方法直接操作源数组，且只会剔除查找到的第一个值\n     *\n     * @param   {Array}     arr    要操作的数组\n     * @param   {*}         item    要剔除的值\n     * @returns {Number}    被剔除值的索引\n     */\n    eliminate: function(arr, item) {\n      var index = arr.indexOf(item);\n      if (index !== -1) {\n        arr.splice(index, 1);\n      }\n      return index;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#toggle\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    数组里有目标项时，剔除该项，没有则增加\n     *\n     * @param   {Array}     arr    要操作的数组\n     * @param   {*}         item   目标项\n     * @returns {Array}     源数组\n     */\n    toggle: function(arr, item) {\n      var idx = arr.indexOf(item);\n\n      if (idx > -1) {\n        arr.splice(idx, 1);\n      } else {\n        arr.push(item);\n      }\n\n      return arr;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#concatTo\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    合并目标数组到源数组，这里会直接修改源数组\n     *\n     * @param   {Array}     arr1    源数组\n     * @param   {Array}     arr2    目标数组\n     * @param   {Boolean}   unique  是否不添加源数组中已有的元素\n     * @returns {Array}     源数组\n     */\n    concatTo: function(arr1, arr2, unique) {\n      angular.forEach(arr2, function(val) {\n        if (unique && arr1.indexOf(val) !== -1) {\n          return;\n        }\n        arr1.push(val);\n      });\n      return arr1;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#removeFrom\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    剔除目标数组与源数组相同的元素，这里会直接修改源数组\n     *\n     * @param   {Array}     arr1    源数组\n     * @param   {Array}     arr2    目标数组\n     * @returns {Array}     源数组\n     */\n    removeFrom: function(arr1, arr2) {\n      angular.forEach(arr2, function(val) {\n        var idx = arr1.indexOf(val);\n        if (idx !== -1) {\n          arr1.splice(idx, 1);\n        }\n      });\n      return arr1;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#promptNoPermission\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    提示无权限使用模块并返回门户页\n     */\n    promptNoPermission: function() {\n      IbPopup.alert({\n        title: \"权限错误,请检查您有无相应的权限进行操作\"\n      }).then(function() {\n        $ionicViewSwitcher.nextDirection('back')\n        $state.go('portal')\n      })\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#containsArray\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    判断源数组是否包含目标数组\n     *\n     * @param   {Array}     arr1    源数组\n     * @param   {Array}     arr2    目标数组\n     * @returns {Boolean}   源数组是否包含目标数组\n     */\n    containsArray: function(arr1, arr2) {\n      for (var i = 0; i < arr2.length; i++) {\n        if (arr1.indexOf(arr2[i]) === -1) {\n          return false;\n        }\n      }\n      return true;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#getCharLength\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    获取字符串长度\n     *    计算方式为字母长度为0.5，中文长度为1，对url会做特殊处理\n     *\n     * @param   {String}   str   要计算长度的字符串\n     * @returns {Number}         长度\n     */\n    getCharLength: (function() {\n      var byteLength = function(str) {\n        if (typeof str == \"undefined\") {\n          return 0\n        }\n\n        var sChar = str.match(/[^\\x00-\\x80]/g);\n        // 匹配出中文字符的数目并再次加上，这样子每个中文字符占位为2\n        return (str.length + (!sChar ? 0 : sChar.length))\n      };\n\n      return function(str, opt) {\n        opt = opt || {};\n        opt.max = opt.max || 140;\n        // opt.min = opt.min || 41;\n        opt.surl = opt.surl || 20;\n        var p = str.trim().length;\n        if (p > 0) {\n          // 下面这段正则用于匹配URL\n          var result = str.match(/(http|https):\\/\\/[a-zA-Z0-9]+(\\.[a-zA-Z0-9]+)+([-A-Z0-9a-z\\$\\.\\+\\!\\_\\*\\(\\)\\/\\,\\:;@&=\\?~#%]*)*/gi) || [];\n          var total = 0;\n          for (var m = 0,\n              len = result.length; m < len; m++) {\n            var o = byteLength(result[m]);\n\n            total += o <= opt.max ? opt.surl : (o - opt.max + opt.surl)\n\n            str = str.replace(result[m], \"\")\n          }\n          return Math.ceil((total + byteLength(str)) / 2)\n        } else {\n          return 0\n        }\n      }\n    })(),\n\n    serverWarning: function(res) {\n      if (!res.isSuccess) {\n        return IbPopup.alert({\n          title: res && res.msg\n        });\n      }\n    },\n\n    serverError: function(res) {\n      return IbPopup.alert({\n        title: res && res.msg\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#postJsonData\n     * @methodOf  ibosApp.services.Utils\n     * @todo：(ノ=Д=)ノ┻━┻  现在又说要改回默认用 json\n     * @description\n     *    使用 json 格式提交表单\n     *\n     *    本来 angular 默认是使用 json 格式提交数据的\n     *    但由于之前后端规范使用了 FormData，所以默认修改成了 json 格式\n     *    此方法用于临时需要使用 json 格式的情形\n     *\n     * @param     {String}    url         要提交的地址\n     * @param     {Object}    data        要提交的数据\n     * @param     {Object}    httpConf    ajax配置\n     * @returns   {Promise}   Promise\n     */\n    postJsonData: function(url, data, httpConf) {\n      return $http(angular.extend({\n        method: 'POST',\n        url: url,\n        // headers: { 'Content-Type': undefined },\n        headers: {\n          'Content-type': 'application/json'\n        },\n        data: data,\n        transformRequest: [function(d) {\n          return angular.isObject(d) && !isFile(d) && !isBlob(d) ? angular.toJson(d) : d;\n        }]\n      }, httpConf));\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#postFormData\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     * 提交 FormData 类型的数据\n     *\n     * @param     {String}    url         提交地址\n     * @param     {FormData}  formData    FormData 类型的数据\n     * @returns   {Promise}   Promise\n     */\n    postFormData: function(url, formData, config) {\n      // 此处由于使用了 FormData 对象提交，需要配置 header 跟 transformRequest 方法\n      return $http(angular.extend({\n        method: 'POST',\n        url: url,\n        headers: {\n          'Content-Type': undefined\n        },\n        data: formData,\n        transformRequest: angular.identity\n      }, config));\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#getImagePreviewUrl\n     * @methodOf  ibosApp.services.Utils\n     * @todo      迁移至 file-util 模块\n     * @description\n     * 获取图片预览地址，先尝试创建 Blob 地址，没有时使用 fileReader\n     *\n     * @param     {File|Blob}      file       File 对象或 Blob 对象\n     * @param     {Function}       callback   回调函数\n     * @returns   {FileReader}     FileReader 对象\n     */\n    getImagePreviewUrl: function(file, callback) {\n      if (!angular.isFunction(callback)) return;\n      if ($window.URL) {\n        callback($window.URL.createObjectURL(file));\n      } else if ($window.webkitURL) {\n        callback($window.webkitURL.createObjectURL(file));\n      } else {\n        this.readFile(file, function(evt) {\n          callback(evt.target.result);\n        })\n      }\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#setDocumentTitle\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *   设置文档标题\n     *   微信下 iOS 的 document title 在页面加载完成后再设置不起效\n     *   于是有了这个 hack 方法\n     *\n     * @param     {String}    title    文档标题\n     */\n    setDocumentTitle: function(title) {\n      document.title = title;\n\n      if (ionic.Platform.isIOS()) {\n        var $iframe = angular.element('<iframe src=\"/favicon.ico\" style=\"display: none;\"></iframe>').on('load', function() {\n          setTimeout(function() {\n            $iframe.off('load').remove();\n          }, 0);\n        });\n        angular.element(document.body).append($iframe);\n      }\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#httpPromise\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *   angular 的 http 请求继承于 $q.defer，但比普通的defer.promise 多了success和error方法\n     *     此方法将普通的 defer.promise 封装类似 http 返回的 promise\n     *\n     * @param     {Promise}      promise    promise对象\n     * @returns   {HttpPromise}  HttpPromise\n     */\n    httpPromise: function(promise) {\n      promise.success = function(fn) {\n        promise.then(fn);\n        return promise;\n      };\n\n      promise.error = function(fn) {\n        promise.then(null, fn);\n        return promise;\n      };\n      return promise;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#disableBack\n     * @methodOf  ibosApp.services.Utils\n     * @deprecated\n     * @description\n     *   禁止下一个视图的后退功能（即不允许下一个视图返回当前这个视图）\n     *\n     * @param     {Object}   options   视图选项\n     */\n    disableBack: function(options) {\n      return $ionicHistory.nextViewOptions(angular.extend({\n        disableBack: true\n      }, options));\n    },\n\n    triggerScrollViewPullToRefresh: function(scrollView) {\n      $timeout(function() {\n        scrollView.__publish(\n          scrollView.__scrollLeft, -scrollView.__refreshHeight,\n          scrollView.__zoomLevel, true);\n\n        var d = new Date();\n\n        scrollView.refreshStartTime = d.getTime();\n\n        scrollView.__refreshActive = true;\n        scrollView.__refreshHidden = false;\n        if (scrollView.__refreshShow) {\n          scrollView.__refreshShow();\n        }\n        if (scrollView.__refreshActivate) {\n          scrollView.__refreshActivate();\n        }\n        if (scrollView.__refreshStart) {\n          scrollView.__refreshStart();\n        }\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#triggerScrollViewPullToRefreshByHandle\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    手动触发面板的下拉刷新功能\n     *\n     * @param     {String}      delegateHandle    指定某个具体的滚动对象\n     */\n    triggerScrollViewPullToRefreshByHandle: function(delegateHandle) {\n      var scrollView = $ionicScrollDelegate.$getByHandle(delegateHandle).getScrollView();\n      if (!scrollView) return;\n      this.triggerScrollViewPullToRefresh(scrollView);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#clearStateCacheAndGo\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    清除指定 state 的缓存及跳转至该 state\n     *\n     * @param     {String}      state    页面 state\n     * @returns   {Promise}     Promise\n     */\n    clearStateCacheAndGo: function(state) {\n      return $ionicHistory.clearCache([state]).then(function() {\n        $state.go(state);\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#checkFormDirtyBeforeLeave\n     * @methodOf  ibosApp.services.Utils\n     * @param     {Object} $scope       Scope\n     * @param     {String} formCtrlKey  表单控制器字段\n     * @param     {String} tip          提示文本\n     */\n    checkFormDirtyBeforeLeave: function($scope, formCtrlKey, tip) {\n      var off\n      tip = tip || '还有未保留的修改，是否确定离开'\n      off = $scope.$on('$stateChangeStart', function(e, to, toParams) {\n        var formCtrl = $scope[formCtrlKey]\n\n        // 表单发生了修改时\n        if(formCtrl && formCtrl.$dirty) {\n          e.preventDefault()\n          // 后退时历史记录会少一，这里加一个以保持历史纪录正确\n          $window.history.pushState(null, '', $window.location.href)\n    \n          IbPopup.confirm({\n            title: '提示',\n            content: tip\n          })\n          .then(function(res) {\n            if(res) {\n              off()\n              $window.history.back()\n            }\n          })\n        }\n      })\n    }\n  };\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.Utils#isDateTimeLocalSupport\n   * @methodOf  ibosApp.services.Utils\n   * @description\n   *    是否支持 input[type=\"datetime\"]\n   *\n   * @returns {boolean}   支持情况\n   */\n  ret.isDateTimeLocalSupport = ret.isFormTypeSupported('datetime-local');\n\n  return ret;\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.$localstorage\n * @description\n *   本地储存操作\n */\n.factory('$localstorage', ['$window', function($window) {\n  if ($window.localStorage) {\n    return {\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.$localstorage#set\n       * @methodOf  ibosApp.services.$localstorage\n       * @description\n       *    写入本地存储，针对基本类型\n       *\n       * @param   {String}    key      键名\n       * @param   {*}         value    键值\n       */\n      set: function(key, value) {\n        $window.localStorage.setItem(key, value);\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.$localstorage#get\n       * @methodOf  ibosApp.services.$localstorage\n       * @description\n       *    获取指定本地存储\n       *\n       * @param   {String}    key            键名\n       * @param   {*}         defaultValue   无结果时的默认值\n       * @returns {*}         对应键名的值\n       */\n      get: function(key, defaultValue) {\n        return $window.localStorage.getItem(key) || defaultValue;\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.$localstorage#remove\n       * @methodOf  ibosApp.services.$localstorage\n       * @description\n       *    删除指定本地存储\n       *\n       * @param   {String}    key            键名\n       */\n      remove: function(key) {\n        $window.localStorage.removeItem(key);\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.$localstorage#setObject\n       * @methodOf  ibosApp.services.$localstorage\n       * @description\n       *    写入本地存储，针对引入类型，会先转为JSON\n       *\n       * @param   {String}    key      键名\n       * @param   {*}         value    键值\n       */\n      setObject: function(key, value) {\n        $window.localStorage.setItem(key, JSON.stringify(value));\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.$localstorage#getObject\n       * @methodOf  ibosApp.services.$localstorage\n       * @description\n       *    获取指定本地存储，针对引入类型，获取后会从 JSON 转为对象\n       *\n       * @param   {String}    key      键名\n       * @returns {*}         经过JSON解析的对应键名的值\n       */\n      getObject: function(key) {\n        return JSON.parse($window.localStorage.getItem(key));\n      }\n    };\n  } else {\n    return {\n      set: angular.noop,\n      get: function(key, defaultValue) {\n        return defaultValue;\n      },\n      remove: angular.noop,\n      setObject: angular.noop,\n      getObject: angular.noop\n    };\n  }\n}])\n\n/**\n * @ngdoc service\n * @name ibosApp.services.TalkingData\n * @description\n *   TalkingData 统计\n */\n.factory('TalkingData', function($state, User) {\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.TalkingData#onEvent\n     * @methodOf  ibosApp.services.TalkingData\n     * @description\n     *   触发统计事件\n     *\n     * @param     {String}  evtId     事件标识\n     * @returns   {String}  [label]   标签\n     * @returns   {Object}  [mapKv]   其他参数\n     */\n    onEvent: function(evtId, label, mapKv) {\n      if (typeof TDAPP !== 'undefined') {\n\n        mapKv = angular.extend({}, mapKv, {\n          uid: User.uid\n        });\n\n        return TDAPP.onEvent(evtId, label, mapKv);\n      }\n    }\n  };\n})\n\n// App 数据\n.factory('Apps', function() {\n\n  var apps = [];\n\n  return {\n    install: function(conf) {\n      apps.push(conf);\n    },\n\n    all: function() {\n      return apps;\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.User\n * @description\n *   用户数据服务\n */\n.provider('User', function() {\n\n  var userResolve = [\n    '$rootScope',\n    '$state',\n    '$ionicModal',\n    'TalkingData',\n    'Settings',\n    'User',\n    'IbPopup',\n    'API_SERVER',\n\n    function($rootScope, $state, $ionicModal, TalkingData, Settings, User, IbPopup, API_SERVER) {\n      if (!User.isLogin) {\n        var _promise = User.login()\n          .success(function(res) {\n            if (res.login) {\n              TalkingData.onEvent('登录成功', '', {\n                hostUrl: Settings.hostUrl\n              });\n            } else {\n              TalkingData.onEvent('登录失败', '', {\n                hostUrl: Settings.hostUrl,\n                res: res\n              });\n            }\n          })\n          .error(function(res) {\n            console.log(res)\n            TalkingData.onEvent('登录出错', '', {\n              res: res,\n              hostUrl: Settings.hostUrl\n            });\n            $state.go('login');\n          })\n        return _promise;\n      }\n    }\n  ];\n\n  return {\n    // 所有数据的加载都要在用户登录之后才执行\n    resolve: {\n      user: userResolve\n    },\n\n    $get: function($http, $state, $rootScope, $q, $window, $ionicPopup, Settings, IbPopup, Utils, API_SERVER) {\n      var ret = {\n        uid: '',\n        user: {},\n        users: {},\n        isLogin: false\n      };\n\n      function loginFailed(res) {\n        $ionicPopup.alert({\n          title: '登录失败',\n          template: res.msg || '未知错误'\n        });\n        $state.go('login');\n      }\n\n      // 登录\n      function getUserInfo(loginData) {\n        var promise = $http.get(Settings.rootUrl + '/default/login', {\n          params: loginData,\n          responseType: \"json\"\n        })\n\n        .success(function(res) {\n          if (res.login) {\n            ret.uid = res.uid;\n            ret.user = res.user;\n            ret.users = res.userData.datas;\n            ret.group = res.userData.group;\n            ret.formhash = res.formhash;\n            ret.isLogin = true;\n\n            // 用户、部门、岗位数据，分别带有字母分组信息\n            ret.userData = res.userData;\n            ret.departmentData = res.departmentData;\n            ret.positionData = res.positionData;\n\n            // 将首字母字符直接放数据里\n            // @todo 此处让后端改成直接返回首字母在源数据里，而不需前端重新组合\n            // extendLetter(ret.userData.datas, ret.userData.group);\n            // extendLetter(ret.departmentData.datas, ret.departmentData.group);\n            // extendLetter(ret.positionData.datas, ret.positionData.group);\n\n            // 将用户信息绑定到 $rootScope，方便后续使用\n            $rootScope.user = res.user;\n          } else {\n            loginFailed(res);\n          }\n        })\n\n        .error(Settings.requestError)\n\n        return promise;\n      }\n\n      function getServerInfo(corptoken) {\n        return $http.jsonp(API_SERVER + '/oauth/connect', {\n          params: {\n            corptoken: corptoken,\n            callback: 'JSON_CALLBACK'\n          }\n        });\n      }\n\n      function getRedirectUri() {\n        var redirect;\n        if (/[?&]corptoken=/.test($window.location.search)) {\n          redirect = $window.location.href;\n        } else {\n          var pathArr = $window.location.href.split(/(?=#)/);\n\n          pathArr.splice(1, 0, (pathArr[0].indexOf('?') !== -1 ? '&' : '?') + 'corptoken=' + Settings.corptoken);\n          redirect = pathArr.join('');\n        }\n        return redirect;\n      }\n\n      // 以 corptoken 方式登录\n      function loginByCorptoken(_corptoken) {\n\n        var defer = $q.defer();\n\n        getServerInfo(_corptoken)\n          .success(function(res) {\n            if (res.code === 0) {\n              Settings.hostUrl = res.data.systemurl + (res.data.systemurl.charAt(res.data.systemurl.length - 1) === '/' ? '' : '/');\n              Settings.rootUrl = Settings.hostUrl + '?r=mobile';\n\n              delete res.data.systemurl;\n\n              var promise = $http.get(Settings.hostUrl + \"api/co/oauth/\", {\n                  params: res.data,\n                  responseType: \"json\"\n                })\n                .success(function(res) {\n                  if (res.isSuccess) {\n                    getUserInfo().success(function(res) {\n                        defer.resolve(res);\n                      })\n                      .error(function(res) {\n                        defer.reject(res);\n                      });\n                  } else {\n                    IbPopup.alert({\n                      title: '请先绑定IBOS账号！'\n                    }).then(function() {\n                      $window.location.href = API_SERVER + '/oauth/connect?corptoken=' + _corptoken + '&redirect_uri=' + getRedirectUri();\n                    });\n                  }\n                })\n                .error(Settings.requestError)\n\n              return promise;\n            } else {\n              alert(res.message || '登录失败：corptoken: ' + _corptoken);\n            }\n          });\n\n        return Utils.httpPromise(defer.promise);\n      }\n\n      function setDocumentTitleWithCorpName(res) {\n        if (res.login && res.unit) {\n          Utils.setDocumentTitle(res.unit.shortname);\n        }\n      }\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.User#login\n       * @methodOf  ibosApp.services.User\n       * @description\n       *    登录用户\n       *\n       * @param     {Object}      loginData     登录用数据\n       * @returns   {HttpPromise} HttpPromise\n       */\n      ret.login = function(loginData) {\n        if (Settings.corptoken) {\n          return loginByCorptoken(Settings.corptoken).success(setDocumentTitleWithCorpName);\n        } else if (Settings.hostUrl) {\n          return getUserInfo(loginData).success(setDocumentTitleWithCorpName)\n        } else {\n          return Utils.httpPromise($q.reject());\n        }\n      };\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.User#logout\n       * @methodOf  ibosApp.services.User\n       * @description\n       *    登出用户\n       * @returns   {HttpPromise}  HttpPromise\n       */\n      ret.logout = function() {\n        return $http.get(Settings.rootUrl + '/default/logout')\n          .success(function() {\n            $state.go('login');\n          });\n      };\n\n      /**\n       * @ngdoc     method\n       * @name       services.#authority\n       * @methodOf  services.\n       * @param；\n       *\n       * @description\n       *   用户是否有权限使用模块\n       *\n       * @returns   {HttpPromise}   HttpPromise\n       */\n      ret.getAuthority = function() {\n        return $http.get(Settings.hostUrl + '?r=mobile/authority/index')\n      };\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.User#getUser\n       * @methodOf  ibosApp.services.User\n       * @description\n       *    获取单个用户的数据\n       *\n       * @param     {String}      uid     用户id\n       * @returns   {Object}      用户数据\n       */\n      ret.getUser = function(uid) {\n        return ret.users[uid || ret.uid] || null;\n      };\n\n      /**\n       * @ngdoc method\n       * @name      ibosApp.services.User#groupUidByLetter\n       * @methodOf  ibosApp.services.User\n       * @todo 太绕太浪费性能了，有必要修改数据源格式\n       * @description\n       *   将 uid 按字母索引分组\n       *\n       * @param   {Array}    uids    用户数组 id\n       * @returns {Object}     用户分组\n       */\n      ret.groupUidByLetter = function(uids) {\n        var ret = {};\n        var group = this.group;\n\n        angular.forEach(group, function(_uids, letter) {\n          angular.forEach(_uids, function(_uid) {\n            if (uids.indexOf(+_uid) !== -1 || uids.indexOf('' + _uid) !== -1) {\n              ret[letter] = ret[letter] || [];\n              ret[letter].push(_uid);\n            }\n          });\n        });\n\n        return ret;\n      };\n\n      function $$addPrefix(id, prefix) {\n        if (!id) {\n          return id;\n        }\n        return (prefix + id).replace(/,/g, ',' + prefix);\n      }\n\n      function $$removePrefix(id, prefix) {\n        if (angular.isArray(id)) {\n          return id.map(function(_id) {\n            return _id.replace(new RegExp('^' + prefix), '');\n          });\n        }\n\n        if (angular.isString(id)) {\n          var reg = new RegExp(',' + prefix, 'g');\n          return id.replace(reg, ',').slice(2);\n        }\n\n        return id;\n      }\n      /**\n       * @ngdoc method\n       * @name      ibosApp.services.User#addPrefix\n       * @methodOf  ibosApp.services.User\n       * @description\n       *   给 uid 添加 u_ 前缀\n       *   某些情况下为了与后端数据一致会需要用到\n       *\n       * @param   {String}    [uid]    单个 uid 或以 ',' 作为分隔符的一组 uid\n       * @returns {String}             形如 'u_1,u_2...' 的字符串\n       */\n\n      /**\n       * @ngdoc method\n       * @name      ibosApp.services.User#removePrefix\n       * @methodOf  ibosApp.services.User\n       * @description\n       *   去掉 uid 的 u_ 前缀\n       *\n       * @param   {String}    [uid]    有前缀的 uid\n       * @returns {String}    形如 '1,2...' 的字符串\n       */\n      angular.forEach({\n        'Prefix': 'u_',\n        'PositionPrefix': 'p_',\n        'DepartmentPrefix': 'd_'\n      }, function(prefx, key) {\n        ret['add' + key] = function(id) {\n          return $$addPrefix(id, prefx);\n        };\n        ret['remove' + key] = function(id) {\n          return $$removePrefix(id, prefx);\n        };\n      });\n\n      return ret;\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.Department\n * @description\n *   部门数据服务\n */\n.factory('Department', function(Utils, User) {\n\n  var Department = {\n    getDepartments: function() {\n      return User.departmentData.datas;\n    },\n\n    /**\n     * @ngdoc method\n     * @name      ibosApp.services.Corp#getSubDepartments\n     * @methodOf  ibosApp.services.Corp\n     * @description\n     *   获取指定部门的子部门，若不传参数，则获取第一级部门\n     *\n     * @param   {String}    [deptId='0']   部门 id\n     * @returns {Array}     子部门数组\n     */\n    getSubDepartments: function(deptId) {\n      var depts = [];\n      var departments = this.getDepartments();\n\n      deptId = deptId || '0';\n      angular.forEach(departments, function(dept) {\n        if (dept.pid == deptId) {\n          depts.push(dept);\n        }\n      });\n      return depts;\n    },\n\n    /**\n     * @ngdoc method\n     * @name      ibosApp.services.Department#getUserByDepartment\n     * @methodOf  ibosApp.services.Department\n     * @description\n     *   获取指定部门的用户\n     *\n     * @param   {String}    [deptId='0']   部门 id\n     * @returns {Array}     用户数组\n     */\n    getUserByDepartment: function(deptId) {\n      var ret = [];\n      var users = User.userData.datas;\n\n      deptId = deptId || '0';\n      angular.forEach(users, function(user) {\n        // 由于用户可能同时属于多个部门，此处判断是否包含目标部门\n        if (Utils.commasInclude(user.deptid, deptId)) {\n          ret.push(user);\n        }\n      });\n\n      return ret;\n    },\n\n    /**\n     * @ngdoc method\n     * @name      ibosApp.services.Department#getUidGroupByDepartment\n     * @methodOf  ibosApp.services.Department\n     * @description\n     *   获取指定部门的用户分组\n     *\n     * @param   {String}    [deptId='0']   部门 id\n     * @returns {Object}     用户分组\n     */\n    getUidGroupByDepartment: function(deptId) {\n      var users = this.getUserByDepartment(deptId);\n      var uids = users.map(function(user) {\n        return user.uid\n      });\n\n      return User.groupUidByLetter(uids);\n    }\n  };\n\n  return Department;\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.Position\n * @description\n *   岗位数据服务\n */\n.factory('Position', function(Utils, User) {\n\n  function includeId(str, id) {\n    return str.split(',').indexOf(id) !== -1;\n  }\n\n  return {\n    getPositions: function() {\n      return User.positionData.datas;\n    },\n\n    /**\n     * @ngdoc method\n     * @name      ibosApp.services.Position#getUserByPosition\n     * @methodOf  ibosApp.services.Position\n     * @description\n     *   获取指定岗位的用户\n     *\n     * @param   {String}    [posId]   岗位 id\n     * @returns {Array}     用户数组\n     */\n    getUserByPosition: function(posId) {\n      var ret = [];\n      var users = User.userData.datas;\n\n      angular.forEach(users, function(user) {\n        // 由于用户可能同时属于多个部门，此处判断是否包含目标部门\n        if (Utils.commasInclude(user.positionid, posId)) {\n          ret.push(user);\n        }\n      });\n\n      return ret;\n    },\n\n    /**\n     * @ngdoc method\n     * @name      ibosApp.services.Position#getUidGroupByPosition\n     * @methodOf  ibosApp.services.Position\n     * @description\n     *   获取指定岗位的用户分组\n     *\n     * @param   {String}    posId   岗位 id\n     * @returns {Object}     用户分组\n     */\n    getUidGroupByPosition: function(posId) {\n      var users = this.getUserByPosition(posId);\n      var uids = users.map(function(user) {\n        return user.uid\n      });\n\n      return User.groupUidByLetter(uids);\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.ImgViewer\n * @description\n *   提供兼容多个平台的图片预览功能\n *   微信端调用微信提供的接口，其他（如PC端）暂时只做新窗口打开\n *\n */\n.factory('ImgViewer', function(Settings, $window, $timeout, $rootScope, $ionicModal, $ionicSlideBoxDelegate) {\n  var viewerModal;\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.ImgViewer#view\n   * @methodOf  ibosApp.services.ImgViewer\n   * @todo\n   *   此方法对非微信端的交互需要优化\n   * @description\n   *   预览一组图片，目前此功能调用微信 JSSDK\n   *   非微信端则直接打开在新窗口该图片\n   * @param     {String}    src      当前要查看的图片的 src\n   * @param     {Array}     srcs     提供一组图片的 srcs，src 参数也在此数组之中\n   */\n  function view(src, srcs) {\n    // 微信平台\n    if (typeof WeixinJSBridge !== \"undefined\") {\n      WeixinJSBridge.invoke(\"imagePreview\", {\n        \"current\": src,\n        \"urls\": srcs\n      });\n      // 其他情况，如 PC 端\n    } else {\n      // 如果已经存在查看器 Modal 实例\n      if (viewerModal) {\n        viewerModal.scope.urls = srcs;\n        viewerModal.scope.current = srcs.indexOf(src);\n        $timeout(function() {\n          viewerModal.show();\n        }, 50);\n        // 否则，新建 Modal\n      } else {\n        var scope = $rootScope.$new();\n        scope.urls = srcs;\n        scope.current = srcs.indexOf(src);\n\n        $ionicModal.fromTemplateUrl('templates/img-preview.html', {\n          scope: scope,\n          animation: 'none'\n        }).then(function(modal) {\n          viewerModal = modal;\n          modal.show();\n          modal.hideDelay = 1;\n          scope.closeModal = function() {\n            modal.hide();\n          };\n        });\n\n        scope.$on('modal.shown', function($evt, modal) {\n          var instance = $ionicSlideBoxDelegate.$getByHandle('imgPreviewSlide');\n          if (instance) {\n            instance.slide(modal.scope.current, -1);\n          }\n        });\n\n        scope.$on('modal.hidden', function($evt, modal) {\n          modal.scope.urls = [];\n          modal.scope.current = 0;\n        });\n\n        scope.zoomImg = function($event) {\n          $event.target.style.width = !$event.target.zoomFlag ? '100%' : 'auto';\n          $event.target.zoomFlag = !$event.target.zoomFlag;\n        }\n      }\n    }\n  }\n\n  return {\n    view: view\n  }\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.FileUtils\n * @description\n *   文件相关工具方法\n */\n.factory('FileUtils', function($window, $rootScope, $sce, IbPopup) {\n  var officeFileTypes = ['doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'pdf'];\n  var imageTypes = ['jpg', 'jpeg', 'png', 'bmp', 'gif'];\n  var filtIconMap = {\n    'zip': 'zip',\n    '7z': '7z',\n    'ai': 'ai',\n    'exe': 'exe',\n    'fla': 'fla',\n    'html': 'html',\n    'pdf': 'pdf',\n    'psd': 'psd',\n    'rar': 'rar',\n    'swf': 'swf',\n    'txt': 'txt',\n\n    'php': 'code',\n    'js': 'code',\n    'asp': 'code',\n    'aspx': 'code',\n    'jsp': 'code',\n\n    'xls': 'excel',\n    'xlsx': 'excel',\n\n    'doc': 'word',\n    'docx': 'word',\n\n    'ppt': 'ppt',\n    'pptx': 'ppt',\n    'pps': 'ppt',\n    'ppsx': 'ppt',\n\n    'mp3': 'music',\n    'wav': 'music',\n    'wma': 'music',\n    'flac': 'music',\n    'ape': 'music',\n\n    'png': 'photo',\n    'jpg': 'photo',\n    'jpeg': 'photo',\n    'gif': 'photo',\n\n    'mp4': 'video',\n    'rmvb': 'video',\n    'rm': 'video',\n    'avi': 'video',\n    'flv': 'video',\n    'mkv': 'video',\n    'wmv': 'video',\n\n    'unknown': 'unknown'\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.FileUtils#isOfficeFile\n   * @methodOf  ibosApp.services.FileUtils\n   * @description\n   *   判断是否是支持的文档类型\n   *\n   * @param     {String}    type      文件类型\n   * @returns   {Boolean}   是否支持\n   */\n  function isOfficeFile(type) {\n    type = ('' + type).toLowerCase();\n    return officeFileTypes.indexOf(type) !== -1;\n  }\n\n  function isImage(type) {\n    type = ('' + type).toLowerCase();\n    return imageTypes.indexOf(type) !== -1;\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.FileUtils#download\n   * @methodOf  ibosApp.services.FileUtils\n   * @description\n   *   获取文件后缀名\n   *\n   * @param     {String}    url      文件地址\n   * @returns   {String}    文件后缀名\n   */\n  function getExtname(url) {\n    url = url.split('?')[0];\n    var dotIndex = url.lastIndexOf('.');\n    var extname = dotIndex !== -1 ? url.slice(dotIndex + 1) : url;\n    return typeof extname == 'string' ? extname.toLowerCase() : '';\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.FileUtils#getFileIconByExtname\n   * @methodOf  ibosApp.services.FileUtils\n   * @description\n   *   根据文件后缀名获取对应的图标地址\n   *\n   * @param     {String}    extname      文件后缀名\n   * @param     {String}    [size]       尺寸，不传为默认大小，传 'lt' 时为小图标\n   * @returns   {String}    图标地址\n   */\n  function getFileIconByExtname(extname, size) {\n    extname = typeof extname == 'string' ? extname.toLowerCase() : '';\n    var pathnameOrigin = $window.location.pathname;\n    var pathnameArr = pathnameOrigin.split('/');\n    pathnameArr.pop();\n    var safePathname = pathnameArr.concat(['']).join('/');\n    return $window.location.protocol +\n      '//' +\n      $window.location.host +\n      safePathname +\n      '/img/filetype/' +\n      (filtIconMap[extname] || filtIconMap.unknown) +\n      (size ? '_' + size : '') + '.png';\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.FileUtils#showDownloadTip\n   * @methodOf  ibosApp.services.FileUtils\n   * @description\n   *   显示文件下载提示弹窗\n   *\n   * @param     {String}    url      文件地址\n   * @returns   {String}    文件后缀名\n   */\n  function showDownloadTip(url) {\n    var conf = {\n        title: '复制地址在浏览器中访问即可下载',\n        template: '<div class=\"selectable\">' + $sce.getTrustedHtml(url) + '</div>',\n      }\n      // 在微信里貌似使用不了 copy 命令，目前只能让用户手动复制了\n      // if($rootScope.isWeiXin) {\n    return IbPopup.alert(conf);\n    // } else {\n    //   conf.okText = '复制地址';\n    //   return IbPopup.confirm(conf).then(function(ok) {\n    //     if(ok) {\n    //       var selection = window.getSelection();\n    //       var range = document.createRange();\n    //       range.selectNodeContents(document.querySelector('.popup .selectable'));\n    //       selection.removeAllRanges();\n    //       selection.addRange(range);\n\n    //       if(document.execCommand('copy'));\n    //     }\n    //   });\n    // }\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.FileUtils#download\n   * @methodOf  ibosApp.services.FileUtils\n   * @description\n   *   下载文件\n   *\n   * @param     {String}    url      文件地址\n   */\n  function download(url) {\n    if (!url) return;\n    // 在微信中时，按文件类型处理\n    if ($rootScope.isWeiXin) {\n      var extname = getExtname(url);\n      // 微信只支持打开下载 office 相关文档格式\n      if (isOfficeFile(extname) || isImage(extname) || extname == 'html' || extname == 'htm') {\n        window.location = url;\n      } else {\n        showDownloadTip(url);\n      }\n      // 其他浏览直接打开下载\n    } else {\n      window.location = url;\n    }\n  }\n\n  return {\n    isOfficeFile: isOfficeFile,\n    isImage: isImage,\n    getExtname: getExtname,\n    showDownloadTip: showDownloadTip,\n    download: download,\n    getFileIconByExtname: getFileIconByExtname\n  }\n})\n\n.factory('Downloader', function($window, $rootScope, IbPopup) {\n\n  // 微信支持打开及下载的格式\n  var WX_SUPPORT_FILETYPE = [\n    'doc', 'docx',\n    'xls', 'xlsx',\n    'ppt', 'pptx',\n    'pdf', 'txt',\n    'png', 'gif', 'jpg', 'jpeg'\n  ];\n  var DOWNLOAD_PAGE = 'wxdownload.html';\n\n  return {\n    down: function(url) {\n      // 微信内置浏览器有格式限制\n      if ($rootScope.isWeiXin) {\n        var frags = url.split('.');\n        var filetype = frags[frags.length - 1];\n        if (WX_SUPPORT_FILETYPE.indexOf(filetype) === -1) {\n          // return IbPopup.alert({\n          //   title: '复制地址在浏览器中访问即可下载',\n          //   template: '<div class=\"selectable\">' + url + '</div>'\n          // });\n          this.downloadInWx(url);\n          return;\n        }\n      }\n      $window.location.href = url;\n    },\n    downloadInWx: function(url) {\n      $window.location.href = DOWNLOAD_PAGE + '?url=' + encodeURIComponent(url);\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.External\n * @description\n *   外部插口调用\n */\n.factory('External', function($rootScope, $window) {\n  var IS_WEIXIN = $rootScope.isWeiXin;\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.External#getLocation\n     * @methodOf  ibosApp.services.External\n     * @description\n     * 获取地理位置\n     *   onsuccess 回调参数（一些多端不一的参数在使用时要注意）\n     *   res.latitude    {Number}  纬度\n     *   res.longitude   {Number}  经度\n     *\n     * @param     {Function}     onsuccess    成功回调\n     * @param     {Function}     onsuccess    错误回调\n     */\n    getLocation: function(onsuccess, onerror) {\n      if (IS_WEIXIN) {\n        wx.ready(function() {\n          wx.getLocation({\n            success: function(res) {\n              onsuccess(res);\n            },\n            fail: onerror\n          });\n        });\n\n        // 使用浏览器自带的定位功能\n      } else {\n        if (navigator.geolocation) {\n          navigator.geolocation.getCurrentPosition(function(res) {\n            onsuccess({\n              latitude: res.coords.latitude,\n              longitude: res.coords.longitude\n            });\n          }, onerror);\n        }\n      }\n    },\n\n    openLocation: function(opts) {\n      // 在微信环境下直接使用微信自带的地图\n      if (IS_WEIXIN) {\n        wx.openLocation(opts);\n\n        // 否则，使用腾讯地图web/wap版\n      } else {\n        var url = 'http://apis.map.qq.com/uri/v1/geocoder?coord=' + opts.latitude + ',' + opts.longitude + '&referer=酷办公';\n        $window.open(url);\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.UserSelector\n * @description\n *   人员选择控件\n */\n.factory('UserSelector', function($rootScope, $q, $ionicModal, $ionicScrollDelegate, Utils, isEmptyFilter, toArrayFilter, User, Department, Position) {\n\n  var usid = 0;\n\n  // 根据可用 id 数组和禁用 id 数组，过滤掉不可用的 id\n  function filterGroup(group, enabled, disabled) {\n    var ret = {};\n\n    // 如果配置了可用 id 数组，则不在数组内的 id 不可用\n    if (enabled) {\n      if (enabled.length) {\n        angular.forEach(group, function(ids, letter) {\n          var enabledIds = ids.filter(function(id) {\n            return enabled.indexOf(+id) !== -1 || enabled.indexOf('' + id) !== -1;\n          });\n          if (enabledIds.length) {\n            ret[letter] = enabledIds;\n          }\n        });\n      }\n\n      return ret;\n      // 如果配置了禁用 id 数组，则不在数组内的 id 可用\n    } else if (disabled) {\n      if (disabled.length) {\n        angular.forEach(group, function(ids, letter) {\n          var enabledIds = ids.filter(function(id) {\n            return disabled.indexOf(+id) === -1 || disabled.indexOf('' + id) === -1;\n          });\n          if (enabledIds.length) {\n            ret[letter] = enabledIds;\n          }\n        });\n      } else {\n        ret = group;\n      }\n\n      return ret;\n\n    } else {\n      return group;\n    }\n  }\n\n  /**\n   * @ngdoc method\n   * @name       ibosApp.services.UserSelector#create\n   * @methodOf   ibosApp.services.UserSelector\n   * @description\n   *   创建人员选择器\n   *\n   * @param      {Obejct}   options   配置\n   *    groups        {object}          分组数据\n   *    tempateUrl    {String}          模板地址\n   *    maxSelection  {Number}          最大可选数\n   * @example\n   * ```js\n   * UserSelector.create().then(function(modal) {\n   *   $scope.userSelectorModal = modal;\n   *\n   *   modal.userSelector.then(function(selected) {\n   *     console.log('selected: ', selected);\n   *   });\n   * });\n   * @returns {Promise}     Promise\n   */\n  function $$create(options) {\n\n    options = options || {};\n\n    var scope = $rootScope.$new(true);\n    var promise = $ionicModal.fromTemplateUrl(options.template, {\n      scope: scope,\n      animation: 'slide-in-up'\n    });\n    var lastSelected;\n\n    scope.usid = usid++;\n    scope.selected = scope.selected || [];\n    scope.departments = {};\n    scope.positions = {};\n    scope.groups = {};\n\n    scope.getSelected = function() {\n      var ret = [];\n      for (var i in scope.selected) {\n        if (scope.selected.hasOwnProperty(i) && scope.selected[i]) {\n          ret.push(i);\n        }\n      }\n      return ret;\n    }\n\n    // 统计已选择用户数\n    scope.getSelectedCount = function() {\n      if (!options.maxSelection) {\n        return scope.selected.length || 0;\n        // 设置了最大可选人数时\n      } else {\n        return (scope.selected.length || 0) + '/' + options.maxSelection;\n      }\n    };\n\n    scope.setGroup = function(groups) {\n      scope.groups = filterGroup(groups, options.enabled, options.disabled);\n    };\n\n    scope.toggleSelect = function(id) {\n      id = '' + id;\n      // 移除\n      if (scope.selected.indexOf(id) !== -1) {\n        Utils.eliminate(scope.selected, id);\n        // 移除时，如果移除了记录着的 lastSelected，则更新 lastSelected 为选中数组的最后一个值\n        if (id === lastSelected) {\n          lastSelected = scope.selected[scope.selected.length - 1];\n        }\n        // 添加\n      } else {\n        scope.selected.push(id);\n        // 添加时，超过最大选择数，则剔除上一个选中项\n        if (scope.selected.length > options.maxSelection) {\n          Utils.eliminate(scope.selected, lastSelected);\n        }\n        lastSelected = id;\n      }\n    };\n\n    // 选中当前所有项\n    scope.toggleSelectAll = function($event) {\n      var ids = Array.prototype.concat.apply([], toArrayFilter(scope.groups));\n      ids = ids.map(function(id) {\n        return '' + id\n      });\n\n      if ($event.target.checked) {\n        Utils.concatTo(scope.selected, ids, true);\n      } else {\n        Utils.removeFrom(scope.selected, ids);\n      }\n    };\n\n    scope.isSelected = function(id) {\n      id = '' + id;\n      return scope.selected.indexOf(id) !== -1;\n    };\n\n    scope.isSelectAllShow = function() {\n      return !options.maxSelection && !isEmptyFilter(scope.groups);\n    };\n\n    // 监控选中项，有变化时滚动至最右侧\n    scope.$watchCollection('selected', function(val) {\n      $ionicScrollDelegate.$getByHandle('us-scroll').scrollBottom(true);\n    });\n\n    promise.then(function(modal) {\n      var _show = modal.show;\n\n      modal.show = function(_options, callback) {\n\n        _options = _options || {};\n\n        scope.group = {};\n        scope.selected = _options.values || [];\n\n        lastSelected = scope.selected[scope.selected.length - 1];\n\n        // 保存，触发回调函数\n        scope.save = function() {\n          angular.isFunction(callback) && callback.call(modal, scope.selected);\n        };\n\n        scope.setGroup(options.groups);\n\n        return _show.apply(modal);\n      };\n\n      scope.modal = modal;\n    });\n\n    return promise;\n  }\n\n  function create(options) {\n    return $$create(angular.extend({\n      groups: User.group,\n      template: 'templates/user-select-modal.html'\n    }, options)).then(function(modal) {\n      var scope = modal.scope;\n\n      function setData(conf) {\n        var departments = [];\n        var positions = [];\n        var userGroups = User.group;\n\n        if (conf) {\n          // 部门\n          if (conf.type === 'department') {\n            departments = Department.getSubDepartments(conf.id);\n            userGroups = Department.getUidGroupByDepartment(conf.id);\n            // 岗位\n          } else if (conf.type === 'position') {\n            // 岗位列表\n            if (!conf.id) {\n              positions = Position.getPositions();\n              userGroups = {};\n              // 人员\n            } else {\n              userGroups = Position.getUidGroupByPosition(conf.id);\n            }\n          }\n        }\n\n        scope.departments = departments;\n        scope.positions = positions;\n        scope.setGroup(userGroups);\n      }\n\n      scope.back = function() {\n        scope.paths.pop();\n        setData(scope.paths[scope.paths.length - 1]);\n      };\n\n      // 打开部门\n      scope.openDepartment = function(deptId) {\n        setData({\n          type: 'department',\n          id: deptId\n        });\n        scope.paths.push({\n          type: 'department',\n          id: deptId\n        });\n      };\n\n      // 打开岗位\n      scope.openPosition = function(posId) {\n        setData({\n          type: 'position',\n          id: posId\n        });\n        scope.paths.push({\n          type: 'position',\n          id: posId\n        });\n      };\n\n      // 弹窗打开时，重置数据\n      scope.$on('modal.shown', function() {\n        scope.paths = [];\n        setData();\n      });\n\n      return modal;\n    });\n  }\n\n  function createPosition(options) {\n    return $$create(angular.extend({\n      groups: User.positionData.group,\n      template: 'templates/user-select-position-modal.html'\n    }, options));\n  }\n\n  function createDepartment(options) {\n    return $$create(angular.extend({\n      groups: User.departmentData.group,\n      template: 'templates/user-select-department-modal.html'\n    }, options));\n  }\n\n  return {\n    create: create,\n    createPosition: createPosition,\n    createDepartment: createDepartment\n  };\n})\n\n.factory('IbPopup', function($timeout, $ionicPopup, $ionicBackdrop) {\n  var extend = angular.extend;\n\n  return {\n    confirm: function(opts) {\n      return $ionicPopup.confirm(extend({\n        title: '提示',\n        okText: '确定',\n        cancelText: '取消'\n      }, opts));\n    },\n\n    alert: function(opts) {\n      return $ionicPopup.alert(extend({\n        okText: '确定',\n      }, opts));\n    },\n\n    prompt: $ionicPopup.prompt,\n\n    show: $ionicPopup.show,\n\n    tip: function(msg, type, timeout) {\n      timeout = timeout || 1500;\n      type = type || 'info';\n\n      var popup = this.show({\n        // title: msg || '',\n        cssClass: 'ib-tip ib-tip-' + type,\n        content: msg\n      });\n\n      $ionicBackdrop.release();\n\n      $timeout(popup.close, timeout);\n      return popup;\n    },\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.IbList\n * @description\n *   基本列表构造器\n */\n.factory('IbList', function($http, $ionicLoading, Settings) {\n\n  function IbList(url, options) {\n    this.url = url;\n    this.options = options || {};\n\n    this.hasMore = true;\n    this.items = [];\n\n    this.params = {};\n\n    this.idAttr = this.options.idAttr || 'id';\n  }\n\n  angular.extend(IbList.prototype, {\n    parse: function(res) {\n      return res;\n    },\n\n    showLoading: function() {\n      $ionicLoading.show();\n    },\n\n    hideLoading: function() {\n      $ionicLoading.hide();\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.IbList#fetch\n     * @methodOf  ibosApp.services.IbList\n     * @description\n     *   获取文件列表数据\n     *   返回数据格式为\n     *   {\n     *     datas: [\n     *       { id:.. name:... }\n     *       ...\n     *     ],\n     *     hasMore: true\n     *   }\n     * @param {Obejct} param 查询条件\n     *    offset     {Number}         查询起始位置\n     * @returns {Object} promise\n     */\n    fetch: function(params, reset, extend) {\n      var _this = this;\n      if (reset) {\n        this.reset();\n      }\n\n      if (extend === false) {\n        this.params = params;\n      } else {\n        angular.extend(this.params, params);\n      }\n\n\n      this.loading = true;\n      this.showLoading();\n\n      var req = $http.get(this.url, {\n          params: this.params\n        })\n        .success(function(res) {\n          _this.items = _this.items.concat(_this.parse(res.data || res.datas));\n          // 判断是否还能加载更多\n          _this.hasMore = res.hasMore;\n        });\n\n      req.finally(function() {\n        _this.loading = false;\n        _this.hideLoading();\n      });\n\n      return req\n    },\n\n    get: function(id) {\n      var ret = null;\n      var idAttr = this.idAttr;\n\n      angular.forEach(this.items, function(item) {\n        if (item[idAttr] == id) {\n          ret = item;\n          return false;\n        }\n      });\n\n      return ret;\n    },\n\n    hasItems: function() {\n      return !!this.items.length;\n    },\n\n    getOffset: function() {\n      return this.items.length;\n      // return this.items.length ?\n      //   this.items[this.items.length - 1][this.idAttr] || '' :\n      //   '';\n    },\n\n    search: function(keyword) {\n      return this.fetch({\n        offset: 0,\n        search: keyword\n      }, true);\n    },\n\n    loadMore: function() {\n      return this.fetch({\n        offset: this.getOffset()\n      });\n    },\n\n    checkNoData: function() {\n      return !this.items.length && !this.hasMore;\n    },\n\n    remove: function(id) {\n      var _this = this;\n      var idAttr = this.idAttr;\n\n      if (!this.items.length) {\n        return;\n      }\n\n      angular.forEach(this.items, function(item, i) {\n        if (item[idAttr] == id) {\n          _this.items.splice(i, 1);\n          return false;\n        }\n      });\n    },\n\n    reset: function() {\n      this.items = [];\n      this.hasMore = true;\n      this.params = {};\n    },\n\n    refresh: function() {\n      return this.fetch({\n        offset: 0\n      }, true);\n    }\n  });\n\n  return IbList;\n})\n\n/**\n * @ngdoc service\n * @name  ibosApp.services.SearchModal\n * @description\n *   搜索 Modal 控件\n */\n.factory('SearchModal', function($q, $ionicModal) {\n  // 生成搜索功能 modal 实例\n  function SearchModal(options) {\n    var that = this;\n\n    this.key = this.lastKey = '';\n    this.result = [];\n\n    var scope = options.scope;\n    var search = angular.isFunction(options.searchFunc) ? options.searchFunc : angular.noop;\n\n    // 向服务器发送搜索请求\n    this.send = ionic.debounce(function(key) {\n      that.canceler && that.canceler.resolve();\n\n      if (!key) {\n        that.reset();\n        return;\n      }\n      // 再次查询的关键字一样时，不处理\n      if (key === that.lastKey) return;\n\n      that.canceler = $q.defer();\n      that.searching = true;\n\n      search(angular.extend({}, options.defaultParams, {\n          key: key\n        }), {\n          timeout: that.canceler.promise\n        }).success(function(res) {\n          if (res.isSuccess) {\n            that.lastKey = key;\n            that.result = res.data;\n          }\n        })\n        .finally(function() {\n          that.searching = false;\n        })\n    }, 200);\n\n    // 重置搜索状态\n    this.reset = function() {\n      this.searching = false;\n      this.lastKey = '';\n      this.key = '';\n      this.result = [];\n    };\n\n    // 打开搜索 modal\n    this.showModal = function() {\n      if (this.modal) {\n        this.modal.show();\n      } else {\n        // 创建搜索窗口\n        $ionicModal.fromTemplateUrl(options.templateUrl, {\n          scope: scope,\n          animation: 'none'\n        }).then(function(modal) {\n          modal.hideDelay = 10;\n          modal.show();\n\n          that.modal = modal;\n\n          // 关闭搜索窗口时，清空搜索相关数据\n          scope.$on('modal.hidden', function() {\n            that.reset();\n          });\n\n          scope.$on('$ionicView.leave', function() {\n            that.modal.hide();\n          });\n\n          scope.$on('$destroy', function() {\n            that.modal.remove();\n          });\n        });\n      }\n    };\n\n    this.hideModal = function() {\n      if (this.modal) this.modal.hide();\n    };\n\n    this.removeModal = function() {\n      if (this.modal) this.modal.remove();\n    };\n\n    scope.$watch(function() {\n      return that.key\n    }, function(key) {\n      if (key) that.searching = true;\n      that.send(key);\n    });\n  }\n\n  return SearchModal;\n})\n\n/**\n * @ngdoc service\n * @name  ibosApp.services.DefaultBack\n * @description\n *   默认返回行为控制\n */\n.factory('DefaultBack', function($ionicHistory, $window, $state, $stateParams, $ionicViewSwitcher) {\n\n    function getDefaultBack() {\n      return ($state.current || {}).defaultBack;\n    }\n\n    function goDefaultBack() {\n      $ionicViewSwitcher.nextDirection('back');\n      $ionicHistory.nextViewOptions({\n        disableBack: true,\n        historyRoot: true\n      });\n\n      var params = {};\n      var defaultBack = getDefaultBack() || {};\n\n      if (defaultBack.state) {\n        if (defaultBack.getStateParams) {\n          params = defaultBack.getStateParams($stateParams);\n        }\n        $state.go(defaultBack.state, params);\n      }\n    }\n\n    return {\n      get: getDefaultBack,\n      goBack: function() {\n        if ($ionicHistory.backView()) {\n          $window.history.back()\n            // $ionicHistory.goBack();\n        } else {\n          goDefaultBack();\n        }\n      }\n    }\n  })\n\n/**\n * @ngdoc service\n * @name  ibosApp.services.CommonApi\n * @description\n *   通用接口\n */\n.factory('CommonApi', function($http, Settings, Utils) {\n  return {\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.CommonApi#uploadAttach\n     * @methodOf  ibosApp.services.CommonApi\n     * @description\n     *   上传附件\n     * @returns {HttpPromise}  HttpPromise\n     */\n    uploadAttach: function(data, config) {\n      return Utils.postFormData(Settings.hostUrl + '?r=main/upload/upload', data, config)\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.CommonApi#uploadBase64Img\n     * @methodOf  ibosApp.services.CommonApi\n     * @description\n     *   上传base64图片数据\n     * @returns {HttpPromise}  HttpPromise\n     */\n    uploadBase64Img: function(base64) {\n      return $http.post(Settings.hostUrl + '?r=main/attach/uploadbase', {\n        img: base64\n      })\n    }\n  }\n})\n\n.service('UploadFile', function(Settings) {\n  var This = this;\n\n  this.encodeURI = function(obj) {\n    var str = [];\n    for (var p in obj) {\n      str.push(encodeURIComponent(p) + '=' + encodeURIComponent(obj[p]));\n    }\n    return str.join('&');\n  }\n\n  this.upload = function(opts) {\n    var url = opts.url || Settings.hostUrl + '?r=main/upload/upload';\n    if (!opts.url && opts.params) {\n      url = url + '&' + this.encodeURI(opts.params);\n    }\n    var xhr = new XMLHttpRequest();\n    if (xhr.upload) {\n      xhr.upload.addEventListener('progress', function(e) {\n        opts.onProgress && opts.onProgress(Math.ceil(e.loaded / e.total * 100));\n      }, false);\n      xhr.addEventListener('timeout', This.onTimeout, false);\n      xhr.onreadystatechange = function(e) {\n          if (xhr.readyState === 4) {\n            if (xhr.status === 200) {\n              opts.onSuccess && opts.onSuccess(xhr.responseText && angular.fromJson(xhr.responseText));\n            } else {\n              opts.onFail && opts.onFail(xhr.responseText && angular.fromJson(xhr.responseText));\n            }\n          }\n        }\n        // 开始上传\n      xhr.open('POST', url, true);\n      xhr.useXDomain = true;\n      xhr.withCredentials = true;\n      xhr.setRequestHeader('ISCORS', true);\n      xhr.send(opts.data);\n    }\n    return xhr;\n  }\n})","/**\n * @ngdoc overview\n * @name  wechat\n * @description\n *   微信对接模块\n */\nangular.module('wechat', ['co'])\n\n.constant('WECHAT_PUBLIC_APPID', 'wx4a2205ee65d28309')\n\n/**\n * @ngdoc service\n * @name  wechat.WechatApi\n * @description\n *   微信相关接口服务\n */\n.factory('WechatApi', function($http, $q, $window, Utils, API_APP_URL, WECHAT_PUBLIC_APPID) {\n\n  var WECHAT_API_URL = API_APP_URL + '/wechat';\n\n  var WechatApi = {\n    getData: function() {\n      if(this.data) {\n        return $q.when(this.data);\n      } else {\n        return this.getInfo(this.openid).then(function(_res) {\n          var res = _res.data;\n          if(res.code === 0) {\n            return $q.when(res.data);\n          } else {\n            return $q.reject();\n          }\n        });\n      }\n    },\n\n    // 清理微信授权用参数\n    cleanAuthParams: function(url) {\n      var ret = url.replace(/([?&])code=([^&]*)(&?)/, function($0, $1) {\n        return $1;\n      });\n\n      return ret.replace(/([?&])state=([^&]*)(&?)/, function($0, $1) {\n        return $1;\n      })\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApi#getJsSdkSign\n     * @methodOf wechat.WechatApi\n     * @description \n     *    获取JS-SDK 签名参数\n     *    res.data.noncestr\n     *    res.data.timestamp\n     *    res.data.signature\n     * @param   {String}    url  用于生成签名的地址\n     * @returns {Object}    $q.defer.promise\n     */\n    getJsSdkSign: function(url) {\n      url = encodeURIComponent((url || $window.location.href).split('#')[0]);\n      return $http.get(WECHAT_API_URL + '/getjssdksign?url=' + url);\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApi#getOAuthUrl\n     * @methodOf wechat.WechatApi\n     * @description \n     *    获取授权地址\n     *    res.data.url\n     * @param   {String}    redirectUri  授权完后要跳转的地址，跳转时，会自动加上 code 和 state 参数\n     * @param   {Boolean}   state         值等于 1 时原样返回 redirect_uri\n     * @returns {Object}    $q.defer.promise\n     */\n    getOAuthUrl: function(redirectUri, state) {\n      var url = WechatApi.cleanAuthParams(redirectUri);\n      return $http.get(WECHAT_API_URL + '/getoauthurl?redirect_uri=' + encodeURIComponent(redirectUri) + '&state=' + (state || ''));\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApi#getAuth\n     * @methodOf wechat.WechatApi\n     * @description \n     *    获取微信用户授权信息\n     *    res.data.openid\n     * @param   {String}    code          授权成功后返回的地址带过来的参数。\n     * @returns {Object}    $q.defer.promise\n     */\n    getAuth: function(code) {\n      return $http.get(WECHAT_API_URL + '/getauth?code=' + code);\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApi#getInfo\n     * @methodOf wechat.WechatApi\n     * @description \n     *    获取微信用户资料\n     *    res.data.openid\n     * @param   {String}    openid            授权成功后返回的地址带过来的参数。\n     * @returns {Object}    $q.defer.promise\n     */\n    getInfo: function(openid) {\n      return $http.get(WECHAT_API_URL + '/getinfo?openid=' + openid);\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApi#initJsSdk\n     * @methodOf wechat.WechatApi\n     * @description \n     *    初始化微信 JSSDK \n     * @param   {Object}    conf     配置\n     */\n    initJsSdk: function(conf) {\n    \treturn WechatApi.getJsSdkSign().success(function(res) {\n    \t  if(res.code === 0) {\n          if(typeof wx !== 'undefined') {\n      \t    wx.config(angular.extend({\n              // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。\n              debug: false,\n              // 必填，需要使用的JS接口列表，所有JS接口列表见附录2\n              jsApiList: [\n                'onMenuShareTimeline',\n                'onMenuShareAppMessage',\n                'onMenuShareQQ',\n                'onMenuShareWeibo',\n                // 'startRecord',\n                // 'stopRecord',\n                // 'onVoiceRecordEnd',\n                // 'playVoice',\n                // 'pauseVoice',\n                // 'stopVoice',\n                // 'onVoicePlayEnd',\n                // 'uploadVoice',\n                // 'downloadVoice',\n                'chooseImage',\n                'previewImage',\n                // 'uploadImage',\n                // 'downloadImage',\n                // 'translateVoice',\n                // 'getNetworkType',\n                'openLocation',\n                'getLocation',\n                // 'hideOptionMenu',\n                // 'showOptionMenu',\n                // 'hideMenuItems',\n                // 'showMenuItems',\n                // 'hideAllNonBaseMenuItem',\n                // 'showAllNonBaseMenuItem',\n                // 'closeWindow',\n                // 'scanQRCode',\n                // 'chooseWXPay',\n                // 'openProductSpecificView',\n                // 'addCard',\n                // 'chooseCard',\n                // 'openCard'\n              ] \n            }, conf, {\n      \t      appId: WECHAT_PUBLIC_APPID, // 必填，公众号的唯一标识\n      \t      timestamp: res.data.timestamp, // 必填，生成签名的时间戳\n      \t      nonceStr: res.data.noncestr, // 必填，生成签名的随机串\n      \t      signature: res.data.signature,// 必填，签名，见附录1\n      \t    }));\n          }\n    \t  }  \n    \t})\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApiinitShareConfig\n     * @methodOf wechat.WechatApi\n     * @description \n     *    初始化微信分享功能 \n     * @param   {Object}    config     配置\n     */\n    initShareConfig: function(config) {\n      wx.ready(function() {\n        wx.onMenuShareAppMessage(config);\n        wx.onMenuShareTimeline(config);\n        wx.onMenuShareQQ(config);\n        wx.onMenuShareWeibo(config);\n      });\n    }\n  };\n\n  return WechatApi;\n})\n","/**\n * @ngdoc overview\n * @name  activity\n * @description\n *   活动模块入口及配置\n */\nangular.module('activity', ['ionic', 'activity.controllers', 'activity.services'])\n\n.run(function(Apps) {\n  Apps.install({\n    name: 'activity',\n    title: '活动',\n    route: '#/activity',\n    state: 'activity.index',\n    icon: 'img/modicon/activity.png'\n  })\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/activity', '/activity/index');\n\n  $stateProvider\n  .state('activity', {\n    url: '/activity',\n    abstract: true,\n    template: '<ion-nav-view name=\"activity\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  // 全部活动\n  .state('activity.index', {\n    url: '/index',\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-index.html',\n        controller: 'ActivityIndexCtrl'\n      }\n    }\n  })\n\n  // 我参加的\n  .state('activity.join', {\n    url: '/join',\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-index.html',\n        controller: 'ActivityJoinCtrl'\n      }\n    }\n  })\n\n  // 活动创建页\n  .state('activity.create', {\n    url: '/create/:id?formdataid',\n    cache: false,\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-create.html',\n        controller: 'ActivityCreateCtrl'\n      }\n    }\n  })\n\n  // 活动详情页\n  .state('activity.view', {\n    url: '/view/:id',\n    cache: false,\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-view.html',\n        controller: 'ActivityViewCtrl'\n      }\n    }\n  })\n\n  //活动安排页\n  .state('activity.info', {\n    url: '/info/:id',\n    cache: false,\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-info.html',\n        controller: 'ActivityInfoCtrl'\n      }\n    }\n  })\n\n  //活动安排页\n  .state('activity.arrange', {\n    url: '/arrange/:id',\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-arrange.html',\n        controller: 'ActivityArrangeCtrl'\n      }\n    }\n  })\n\n})","/**\n * @ngdoc overview\n * @name  activity.controllers\n * @description\n *  活动模板控制器\n */\nangular.module('activity.controllers', [])\n\n// 全部活动\n.controller('ActivityIndexCtrl', function($scope, $state, $ionicScrollDelegate, ActivityList ) {\n  $scope.stateName = $state.$current.name;\n\n  $scope.activity = new ActivityList({\n    type: 'all'\n  });\n\n  $scope.load = function() {\n    $scope.activity.load()\n    .success(function() {\n      $ionicScrollDelegate.resize();\n    });\n  };\n\n  $scope.reload = function() {\n    $scope.activity.reload()\n    .finally(function() {\n      $scope.$broadcast('scroll.refreshComplete');\n    });\n  };\n\n  $scope.load();\n})\n\n// 我参加的\n.controller('ActivityJoinCtrl', function($scope, $state, $ionicScrollDelegate, ActivityList) {\n  $scope.stateName = $state.$current.name;\n\n  $scope.activity = new ActivityList({\n    type: 'me'\n  });\n\n  $scope.load = function() {\n    $scope.activity.load()\n    .success(function() {\n      $ionicScrollDelegate.resize();\n    });\n  };\n\n  $scope.reload = function() {\n    $scope.activity.reload()\n    .finally(function() {\n      $scope.$broadcast('scroll.refreshComplete');\n    });\n  };\n\n  $scope.load();\n})\n\n// 活动详情\n.controller('ActivityViewCtrl', function($scope, $timeout, $stateParams, $ionicScrollDelegate, $ionicLoading, Activity) {\n  $scope.activityId = $stateParams.id;\n\n  // 获取活动数据\n  $ionicLoading.show();\n  Activity.view($stateParams)\n  .success(function(res) {\n    if(res.isSuccess) {\n      $scope.item = res.data;\n    }\n  })\n  .finally($ionicLoading.hide);\n\n  $scope.toggleOpen = true;\n  $scope.toggleView = function() {\n    $scope.toggleOpen = !$scope.toggleOpen;\n    $timeout(function() {\n      $ionicScrollDelegate.resize();\n    }, 100)\n  };\n\n  // 打开地图\n  $scope.openMap = function() {\n    window.location.href = 'http://api.map.baidu.com/place/search?query=' + $scope.item.address + '&region=' + $scope.item.address + '&output=html';\n    // window.location.href = 'http://apis.map.qq.com/uri/v1/search?region=' + $scope.item.address + '&keyword=' + $scope.item.address;\n  };\n\n  // if($scope.card.address) {\n  //   $scope.location = {\n  //     latitude: 0, // 纬度，浮点数，范围为90 ~ -90\n  //     longitude: 0, // 经度，浮点数，范围为180 ~ -180。\n  //     name: $scope.card.corpname, // 位置名\n  //     address: $scope.card.address, // 地址详情说明\n  //     scale: 15, // 地图缩放级别,整形值,范围从1~28。默认为最大\n  //     infoUrl: '' // 在查看位置界面底部显示的超链接,可点击跳转\n  //   };\n\n  //   Namecard.getLocation($scope.card.address)\n  //   .success(function(res) {\n  //     if(res.status === 0) {\n  //       $scope.location.latitude = +res.result.location.lat;\n  //       $scope.location.longitude = +res.result.location.lng;\n  //     }\n  //   });\n\n  //   $scope.openLocation = function() {\n  //     External.openLocation($scope.location);\n  //   };\n  // }\n})\n\n// 活动报名/编辑报名数据\n.controller('ActivityCreateCtrl', function($scope, $state, $stateParams, $ionicLoading, IbPopup, User, Activity) {\n  $scope.fields = [];\n  $scope.form = {};\n  $scope.note = {};\n\n  // 获取报名字段\n  $ionicLoading.show();\n  Activity.formField($stateParams)\n  .success(function(res) {\n    if(res.isSuccess) {\n      $scope.fields = res.data.formdata;\n      \n      // 填充表单模型的默认值\n      // 如果是报名，设置当前用户的姓名和手机为默认\n      if(!$stateParams.formdataid) {\n        $scope.form[$scope.fields[0].fieldname] = User.user.realname;\n        $scope.form[$scope.fields[1].fieldname] = User.user.mobile;\n\n        // 因为PC默认是关闭状态，统一“是否” 类型默认值为 false\n        angular.forEach($scope.fields, function(field) {\n          if(field.fieldtype == '3') {\n            $scope.form[field.fieldname] = false;\n          }\n        });\n      } else {\n        // 如果是编辑报名数据，则先还原原始值\n        angular.forEach($scope.fields, function(field) {\n          // “是否” 类型要特殊处理一下\n          if(field.fieldtype == '3') {\n            if(field.value === '0.') {\n              $scope.form[field.fieldname] = false;\n            } else {\n              $scope.form[field.fieldname] = true;\n              $scope.note[field.fieldname] = field.value.slice(2);\n            }\n          } else {\n            $scope.form[field.fieldname] = field.value;\n          }\n        });\n      }\n    } else {\n      IbPopup.alert({ title: res.msg });\n    }\n  })\n  .finally($ionicLoading.hide);\n\n  // 保存\\更新报名数据\n  $scope.save = function() {\n    var data = angular.extend({}, $scope.form);\n    var method = 'createSignUp';\n\n    // 增加活动id，用户id等字段\n    data.moduleid = $stateParams.id;\n    if($stateParams.formdataid) {\n      method = 'updateSignUp';\n      data.formdataid = $stateParams.formdataid;\n    }\n\n    // 当开启“是否”开关时，将备注值作为该字段值保存下来\n    angular.forEach($scope.fields, function(field) {\n      // “是否”类型时\n      if(field.fieldtype == '3') {\n        if($scope.form[field.fieldname]) {\n          data[field.fieldname] = '1.' + ($scope.note[field.fieldname] || '');\n        } else {\n          data[field.fieldname] = '0.';\n        }\n      }\n    });\n\n    $ionicLoading.show();\n    Activity[method](data)\n    .success(function(res) {\n      if(res.isSuccess) {\n        $state.go('activity.info', $stateParams);\n      } else {\n        IbPopup.alert({ title: res.msg });\n      }\n    })\n    .finally($ionicLoading.hide);\n  };\n})\n\n// 查看报名详情\n.controller('ActivityInfoCtrl', function($scope, $stateParams, $ionicLoading, Utils, IbPopup, Activity) {\n  $scope.activityId = $stateParams.id;\n\n  $ionicLoading.show();\n  Activity.signUpList($stateParams)\n  .success(function(res) {\n    if(res.isSuccess) {\n      $scope.infos = res.data;\n    } else {\n      IbPopup.alert({ title: res.msg });\n    }\n  })\n  .finally($ionicLoading.hide);\n\n  // 删除报名数据\n  $scope.removeItem = function(info) {\n    IbPopup.confirm({ title: '确定要删除该报名信息？' })\n    .then(function(ok) {\n      if(ok) {\n        $ionicLoading.show();\n        Activity.deleteSignUp({\n          moduleid: $stateParams.id,\n          formdataid: info.formdataid\n        })\n        .success(function(res) {\n          if(res.isSuccess) {\n            Utils.eliminate($scope.infos, info);\n          } else {\n            IbPopup.alert({ title: res.msg });\n          }\n        })\n        .finally($ionicLoading.hide);\n      }\n    });\n  };\n})\n\n// 查看活动安排\n.controller('ActivityArrangeCtrl', function($scope, $stateParams, $ionicLoading, IbPopup, Activity) {\n\n  $ionicLoading.show();\n  Activity.arrangeList($stateParams)\n  .success(function(res) {\n    if(res.isSuccess) {\n      $scope.fields = res.data.formdata;\n      $scope.activity = res.data.activity;\n    } else {\n      IbPopup.alert({ title: res.msg });\n    }\n  })\n  .finally($ionicLoading.hide);\n\n});\n","/**\n * @ngdoc overview\n * @name  activity.services\n * @description\n *  活动模板服务\n */\nangular.module('activity.services', [])\n\n/**\n * @ngdoc service\n * @name  activity.services.Activity\n * @description\n *   任务模块接口服务\n */\n.factory('Activity', function($http, Utils, Settings) {\n  // 模块根目录\n  var moduleUrl = Settings.hostUrl + '?r=activity';\n\n  var Activity = {\n    /**\n     * @ngdoc service\n     * @name  activity.services.list\n     * @param    {object}       params\n     * @description\n     *    获取活动列表\n     *    - `params.type`  {string}  类型，all所有活动、me我参加的活动\n     *    - `params.page`  {number=} 页码，默认值为1\n     * \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    list: function(params) {\n      return $http.get(moduleUrl + '/activityapi/index', {\n        params: params\n      });\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.view\n     * @param    {object}    params\n     * @description\n     *    获取活动详情\n     *    - `params.id`  {string}  活动 id\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    view: function(params) {\n      return $http.get(moduleUrl + '/activityapi/detail', {\n        params: params\n      });\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.formField\n     * @param    {object}    params\n     * @description\n     *    获取报名表单字段\n     *    - `params.id`  {string}  活动 id\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    formField: function(params) {\n      return $http.get(moduleUrl + '/signupapi/create', {\n        params: params\n      });\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.createSignUp\n     * @param    {object}    params\n     * @description\n     *    保存报名数据\n     *    - `params.moduleid`  {string}  活动id\n     *    - `params.uid`       {string}  用户id\n     *    - `params.name`      {string}  用户名\n     *    - `params.phone`     {string}  手机\n     *    - `params.data1`     {string}  扩展字段\n     *    ...\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    createSignUp: function(params) {\n      return Utils.postJsonData(moduleUrl + '/signupapi/store', params);\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.updateSignUp\n     * @param    {object}    params\n     * @description\n     *    更新报名数据\n     *    - `params.moduleid`    {string}  活动id\n     *    - `params.formdataid`  {string}  报名数据id\n     *    - `params.name`        {string}  用户名\n     *    - `params.phone`       {string}  手机\n     *    - `params.data1`       {string}  扩展字段\n     *    ...\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    updateSignUp: function(params) {\n      return Utils.postJsonData(moduleUrl + '/signupapi/update', params);\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.deleteSignUp\n     * @param    {object}    params\n     * @description\n     *    删除报名数据\n     *    - `params.moduleid`    {string}  活动id\n     *    - `params.formdataid`  {string}  报名数据id\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    deleteSignUp: function(params) {\n      return $http.post(moduleUrl + '/signupapi/del', params);\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.signUpList\n     * @param    {object}    params\n     * @description\n     *    获取所有报名数据\n     *    - `params.id`  {string}  活动id\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    signUpList: function(params) {\n      return $http.get(moduleUrl + '/signupapi/detail', {\n        params: params\n      });\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.arrangeList\n     * @param    {object}    params\n     * @description\n     *    获取我的活动安排\n     *    - `params.id`  {string}  活动id\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    arrangeList: function(params) {\n      return $http.get(moduleUrl + '/arrangementapi/detail', {\n        params: params\n      });\n    }\n  };\n\n  return Activity;\n})\n\n.factory('ActivityList', function(Activity, Utils) {\n  return function(defaultParams) {\n    var that = this;\n    this.loading = false;\n    this.hasMore = true;\n    this.page = 1;\n    this.list = [];\n    // 加载更多\n    this.load = function() {\n      var promise;\n\n      this.loading = true;\n\n      promise = Activity.list(angular.extend({}, defaultParams, {\n        page: that.page\n      }))\n      .success(function(res) {\n        if(res.isSuccess) {\n          that.list = that.list.concat(res.data);\n          that.hasMore = res.hasmore;\n          that.page++;\n          console.log(res)\n        } else {\n          Utils.promptNoPermission();\n        }\n      });\n\n      promise.finally(function() {\n        that.loading = false;\n      });\n\n      return promise;\n    };\n    // 重载\n    this.reload = function() {\n      this.page = 1;\n      this.list.length = 0;\n      this.hasMore = true;\n      return this.load();\n      // .finally(function() {\n      //   $scope.$broadcast('scroll.refreshComplete');\n      // });\n    }\n  }\n})\n\n/**\n * @ngdoc filter\n * @name activity.services.filter:phoneCrawler\n * @function\n * @description\n *  手机号码嗅探\n *  \n * @param   {string}  content  内容\n * @returns {string}  替换手机号码为可点击的内容\n */\n.filter('phoneCrawler', function(REGEXP_ENUM) {\n  var reg = /\\b1\\d{10}\\b/g ; //使用/1\\d{10}/g将图片名称解析成电话号码，导致无法正常解析图片；\n  return function(content) {\n    content = content || '';\n    return content.replace(reg, function(phone) {\n      return '<a href=\"tel:' + phone + '\">' + phone + '</a>'\n    });\n  }\n})","/**\n * @ngdoc module\n * @name assignment\n * @description\n *   任务指派模块\n */\n\nangular.module('assignment', ['ionic', 'assignment.controllers', 'assignment.services'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'assignment', title: '任务指派', route: '#/assignment', state: 'assignment.index', icon: 'img/modicon/assignment.png' })\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/assignment', '/assignment/index');\n\n  $stateProvider\n  .state('assignment', {\n    url: '/assignment',\n    abstract: true,\n    template: '<ion-nav-view name=\"assignment\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  // 任务指派-首页\n  .state('assignment.index', {\n    url: '/index',\n    talkingDataLabel: '任务指派-首页',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-index.html',\n        controller: 'AssignmentIndexCtrl'\n      }\n    }\n  })\n\n  // 任务指派-未完成列表\n  .state('assignment.unfinished', {\n    url: '/unfinished?uid',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-unfinished.html',\n        controller: 'AssignmentUnfinishedCtrl'\n      }\n    }\n  })\n\n  // 任务指派-已完成列表\n  .state('assignment.finished', {\n    url: '/finished',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-finished.html',\n        controller: 'AssignmentFinishedCtrl'\n      }\n    }\n  })\n\n  // 任务指派-新建任务\n  .state('assignment.create', {\n    url: '/create',\n    talkingDataLabel: '任务指派-新建任务',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-create.html',\n        controller: 'AssignmentCreateCtrl'\n      }\n    }\n  })\n\n  // 任务指派-编辑任务\n  .state('assignment.edit', {\n    url: '/edit/:id',\n    talkingDataLabel: '任务指派-编辑任务',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-edit.html',\n        controller: 'AssignmentEditCtrl'\n      }\n    }\n  })\n\n  // 任务指派-查看任务\n  .state('assignment.detail', {\n    url: '/detail/:id',\n    talkingDataLabel: '任务指派-查看任务',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-detail.html',\n        controller: 'AssignmentDetailCtrl'\n      }\n    }\n  })\n});","/**\n * @ngdoc module\n * @name assignment.controllers\n * @description\n *   任务指派模块控制器\n *   (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻\n *      (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻\n */\nangular.module('assignment.controllers', [])\n\n  .controller('AssignmentIndexCtrl', function($scope, $ionicModal, $ionicLoading, User, Assignment, Utils) {\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n      if(res.isSuccess){\n        //检查用户是否有权限使用该模块\n        if(res.data.assignment){\n          Assignment.getSubordinates({ uid: User.uid })\n            .success(function(res) {\n            });\n\n          // 下属列表 modal\n          $ionicModal.fromTemplateUrl('templates/assignment/subordinate-modal.html', {\n            scope: $scope,\n            animation: 'slide-in-up'\n          }).then(function(modal) {\n            $scope.modal = modal;\n          });\n\n          $scope.subordinates = [];\n\n          // 打开下属列表 modal\n          $scope.openSubordinateModal = function($event, uid) {\n            $event.stopPropagation();\n            $event.preventDefault();\n            if(!uid) {\n              return false;\n            }\n            Assignment.getSubordinates({ uid: uid })\n              .success(function(res) {\n                $scope.subordinates.push(res.users);\n              });\n            $scope.modal.show();\n          };\n\n          $scope.backSubordinateModal = function() {\n            $scope.subordinates.pop();\n          };\n\n          $scope.closeSubordinateModal = function() {\n            $scope.subordinates = [];\n            $scope.modal.hide();\n          };\n\n          $scope.$on('$ionicView.leave', function() {\n            $scope.subordinates = [];\n            $scope.modal.hide();\n          });\n\n        } else {\n          Utils.promptNoPermission();\n        }\n      }\n    }).finally($ionicLoading.hide)\n  })\n\n/**\n * @ngdoc controller\n * @name AssignmentUnfinishedCtrl\n * @module assignment.controllers\n * @description\n *   任务指派-未完成列表页控制器\n */\n  .controller('AssignmentUnfinishedCtrl', function($scope, $state, $stateParams, $ionicActionSheet, $ionicLoading, $ionicModal, User, Utils, IbPopup, Assignment, AssignmentUnfinished) {\n    $ionicLoading.show();\n\n    if($stateParams.uid) {\n      $scope.userName = '（' + User.getUser($stateParams.uid).realname + '）'\n\n      AssignmentUnfinished.getSubList($stateParams)\n        .success(function(res) {\n          $scope.data = res;\n        })\n        .finally($ionicLoading.hide);\n    } else {\n      AssignmentUnfinished.get()\n        .success(function(res) {\n          $scope.data = res;\n        })\n        .finally($ionicLoading.hide);\n      $scope.myself = true;\n    }\n\n    $scope.isDateTimeLocalSupport = Utils.isDateTimeLocalSupport;\n\n    // 是否已过期\n    $scope.isOverdue = function(item) {\n      return item &&\n        item.endtime &&\n        Date.now() > item.endtime * 1000;\n    };\n\n    // 是否设置了提醒\n    $scope.haveRemind = function(item) {\n      return item &&\n          // 过期时不显示提醒\n        !$scope.isOverdue(item) &&\n        item.remindtime > 0;\n    };\n\n    // Modal: 延期申请\n    $ionicModal.fromTemplateUrl('templates/assignment/delay-apply-modal.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal) {\n      $scope.delayModal = modal;\n    });\n\n    // Modal: 取消申请\n    $ionicModal.fromTemplateUrl('templates/assignment/cancel-apply-modal.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal) {\n      $scope.cancelModal = modal;\n    });\n\n    // 打开任务延期申请 Modal\n    $scope.openDelayApplyModal = function(item) {\n      $scope.delayApplySubmitting = false;\n      $scope.delayData = {\n        id: item.assignmentid,\n        delayReason: '',\n        isDesignee: User.uid == item.designeeuid,\n        starttime: new Date(item.starttime * 1000),\n        endtime: new Date(item.endtime * 1000)\n      };\n\n      $scope.delayModal.show();\n      return true;\n    };\n\n    // 任务延期，负责人申请延期、指派人延期放在一起处理\n    $scope.applyDelay = function(isDesignee) {\n      // 是指派人时直接延期、负责人则需通过申请的方式\n      var func = isDesignee ? AssignmentUnfinished.delay : AssignmentUnfinished.applyDelay;\n      $scope.delayApplySubmitting = true;\n\n      func.call(AssignmentUnfinished, angular.extend({}, $scope.delayData, {\n        // 格式化日期\n        starttime: $scope.delayData.starttime ? Assignment.formatDatetime($scope.delayData.starttime) : '',\n        endtime: $scope.delayData.endtime ? Assignment.formatDatetime($scope.delayData.endtime) : ''\n      }))\n        .success(function(res) {\n          if(res.isSuccess) {\n            $scope.delayModal.hide();\n          }\n        })\n        .finally(function() {\n          $scope.delayApplySubmitting = false;\n        });\n    };\n\n    // 打开任务取消申请 Modal\n    $scope.openCancelApplyModal = function(item) {\n      $scope.cancelApplySubmitting = false;\n      $scope.cancelData = {\n        id: item.assignmentid,\n        cancelReason: ''\n      };\n\n      $scope.cancelModal.show();\n      return true;\n    };\n\n    // 负责人申请任务取消\n    $scope.applyCancel = function() {\n      $scope.cancelApplySubmitting = true;\n      AssignmentUnfinished.applyCancel($scope.cancelData)\n        .success(function(res) {\n          if(res.isSuccess) {\n            $scope.cancelModal.hide();\n          }\n        })\n        .finally(function() {\n          $scope.cancelApplySubmitting = false;\n        });\n    };\n\n    // 指派人取消任务\n    $scope.cancel = function(item) {\n      $ionicLoading.show();\n\n      AssignmentUnfinished.cancel({ id: item.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            item.status = 4;\n          }\n        })\n        .finally($ionicLoading.hide);\n\n      return true;\n    };\n\n    $scope.edit = function(item) {\n      $state.go('assignment.edit', { id: item.assignmentid });\n      return true;\n    };\n\n    // 删除任务\n    $scope.remove = function(item) {\n      IbPopup.confirm({ title: '确定要删除该任务？' })\n        .then(function(res) {\n          if(res) {\n            $ionicLoading.show();\n            Assignment.remove({ id: item.assignmentid })\n              .success(function(res) {\n                if(res.isSuccess) {\n                  item.isRemove = true;\n                }\n              })\n              .finally($ionicLoading.hide)\n          }\n        });\n      return true;\n    };\n\n    // 催办\n    $scope.urge = function(item){\n      $ionicLoading.show();\n\n      AssignmentUnfinished.urge({ id: item.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            IbPopup.tip(res.msg);\n          }\n        })\n        .finally($ionicLoading.hide);\n\n      return true;\n    };\n\n    // 重启任务\n    $scope.restart = function(item){\n      $ionicLoading.show();\n\n      AssignmentUnfinished.restart({ id: item.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            item.status = 1;\n          }\n        })\n        .finally($ionicLoading.hide);\n\n      return true;\n    };\n\n    // 完成任务\n    $scope.done = function(item){\n      $ionicLoading.show();\n\n      AssignmentUnfinished.done({ id: item.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            item.status = 2;\n          }\n        })\n        .finally($ionicLoading.hide);\n\n      return true;\n    };\n\n    // 设置提醒 Modal\n    $ionicModal.fromTemplateUrl('templates/assignment/remind-modal.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal) {\n      $scope.remindModal = modal;\n    });\n\n    // 打开设置提醒 Modal\n    $scope.openRemingModal = function(item) {\n      $scope.remindSubmitting = false;\n\n      $scope.remindData = {\n        id: item.assignmentid,\n        remindContent: ''\n      };\n\n      // 如果已设置提醒，将获取之前提醒的数据\n      if(item.remindtime > 0) {\n        AssignmentUnfinished.getRemindData({ id: item.assignmentid })\n          .success(function(res) {\n            if(res.isSuccess) {\n              $scope.remindData.remindContent = res.data.content;\n              $scope.remindData.remindTime = Assignment.convertDateTime(res.data.reminddate + ' ' + res.data.remindtime);\n            }\n          });\n      }\n\n      $scope.remindModal.show();\n      return true;\n    };\n\n    $scope.remind = function(item) {\n      $scope.remindSubmitting = true;\n      AssignmentUnfinished.remind($scope.remindData)\n        .success(function(res) {\n          if(res.isSuccess) {\n            $scope.remindModal.hide();\n          }\n        })\n        .finally(function() {\n          $scope.remindSubmitting = false;\n        });\n    }\n\n\n    var buttons = {\n      edit:        { text: '编辑', handler: $scope.edit },\n      remove:      { text: '删除', handler: $scope.remove },\n      cancel:      { text: '取消任务', handler: $scope.cancel },\n      applyCancel: { text: '申请取消', handler: $scope.openCancelApplyModal },\n      delay:       { text: '延期任务', handler: $scope.openDelayApplyModal },\n      applyDelay:  { text: '申请延期', handler: $scope.openDelayApplyModal },\n      remind:      { text: '设置提醒', handler: $scope.openRemingModal },\n      urge:        { text: '催办', handler: $scope.urge },\n      done:        { text: '完成', handler: $scope.done },\n      restart:     { text: '重启任务', handler: $scope.restart },\n      // stamp:       { text: '评价', handler: $scope.stamp }\n    };\n\n    function createMenuOptions(item) {\n      var roleText = Assignment.getRoleText(item);\n\n      var options = {\n        titleText: '任务操作' + (roleText ? '（' + roleText + '）' : ''),\n        buttons: [],\n        buttonClicked: function(index, opts) {\n          return opts.handler.call(null, item);\n        },\n        cancelText: '取消'\n      }\n\n      var ops = Assignment.getEnableOperation(item);\n      if(ops.length) {\n        angular.forEach(ops, function(op) {\n          // 删除按钮特殊处理\n          if(op == 'remove') {\n            options.destructiveText = buttons[op].text;\n            options.destructiveButtonClicked = function() {\n              return buttons[op].handler(item);\n            };\n          } else {\n            if(buttons[op]) {\n              options.buttons.push(buttons[op]);\n            }\n          }\n        });\n      }\n\n      return options;\n    }\n\n    $scope.showMenu = function(item) {\n      $scope.hideMenu = $ionicActionSheet.show(createMenuOptions(item));\n    };\n\n    $scope.$on('$ionicView.leave', function() {\n      $scope.delayModal.hide();\n      $scope.cancelModal.hide();\n      $scope.remindModal.hide();\n    });\n\n    $scope.$on('$destroy', function() {\n      $scope.delayModal.remove();\n      $scope.cancelModal.remove();\n      $scope.remindModal.remove();\n    });\n  })\n\n/**\n * @ngdoc controller\n * @name AssignmentFinishedCtrl\n * @module assignment.controllers\n * @description\n *   任务指派-已完成列表页控制器\n */\n  .controller('AssignmentFinishedCtrl', function($scope, $filter, $ionicLoading, $ionicActionSheet, User, AssignmentFinished, AssignmentUnfinished) {\n    $scope.prop = {};\n\n    // 初始化列表，首次进来时自动加载数据\n    $scope.init = function() {\n      // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n      if(!$scope.list.hasItems()) {\n        $scope.list.refresh();\n      }\n    };\n\n    // 刷新列表\n    $scope.refresh = function() {\n      $scope.prop.keyword = '';\n      $scope.list.refresh()\n        .finally(function() {\n          $scope.$broadcast('scroll.refreshComplete');\n        });\n    };\n\n    $scope.list = AssignmentFinished;\n    $scope.init();\n\n    // 判断是否指派人\n    $scope.isDesignee = function(item) {\n      return item.designeeuid == User.uid;\n    };\n\n    var dateFilter = $filter('date');\n    // 根据“完成时间”分组\n    $scope.groupByFinishTime = function(items) {\n      var ret = [];\n      angular.forEach(items, function(item, index) {\n        var finishDate = dateFilter(item.finishtime * 1000, 'yyyy-MM-dd EEEE');\n        // 判断完成日期是否与前一条相同，若是则放进同一个组\n        if(ret.length && finishDate == ret[ret.length - 1].finishDate) {\n          ret[ret.length - 1].items.push(item);\n          // 若不是，则新建一个分组\n        } else {\n          ret.push({ finishDate: finishDate, items: [item] });\n        }\n      });\n      return ret;\n    };\n\n    $scope.$watchCollection('list.items', function(items) {\n      $scope.groupedItems = $scope.groupByFinishTime(items);\n    });\n\n    // 重启任务\n    $scope.restart = function(item){\n      $ionicLoading.show();\n\n      AssignmentUnfinished.restart({ id: item.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            $scope.list.remove(item.assignmentid);\n          }\n        })\n        .finally($ionicLoading.hide);\n\n      return true;\n    };\n\n    $scope.showMenu = function(item) {\n      var conf = {\n        titleText: '任务操作',\n        buttons: [\n          { text: '重启任务', handler: $scope.restart }\n        ],\n        buttonClicked: function(index, opts) {\n          return opts.handler.call(null, item);\n        },\n        cancelText: '取消'\n      };\n      $scope.hideMenu = $ionicActionSheet.show(conf);\n    };\n\n    // 获取图章路径\n    $scope.getStampPath = function(value) {\n      return Assignment.getStampPath(value, $scope.stamps);\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name AssignmentCreateCtrl\n * @module assignment.controllers\n * @description\n *   任务指派-新建任务页控制器\n */\n  .controller('AssignmentCreateCtrl', function($scope, $timeout, $state, $filter, $ionicLoading, Settings, Utils, User, Assignment, IbPopup) {\n\n    $scope.isDateTimeLocalSupport = Utils.isDateTimeLocalSupport;\n\n    var submitting = false;\n\n    // 重置表单项\n    function resetForm (){\n      var date = new Date();\n      $scope.form = {\n        chargeuid: User.uid,\n        starttime: date,\n        // 结束时间默认为 3 天后\n        endtime: new Date(+date + 259200000)\n      };\n      submitting = false;\n    }\n\n    $scope.isDisabledSubmit = function() {\n      return submitting || !($scope.assignmentForm && $scope.assignmentForm.$valid);\n    };\n\n    $scope.save = function() {\n      var form = Assignment.correctFormData($scope.form);\n\n      $ionicLoading.show();\n      submitting = true;\n\n      Assignment.create(form)\n        .success(function() {\n          resetForm();\n          IbPopup.confirm({ title: '新建任务成功', okText:'去看看' })\n            .then(function(res) {\n              if(res) {\n                $state.go('assignment.unfinished');\n              }\n            })\n        })\n        .error(Settings.requestError)\n        .finally(function() {\n          $ionicLoading.hide();\n          submitting = false;\n        })\n    };\n\n    resetForm();\n  })\n\n/**\n * @ngdoc controller\n * @name AssignmentEditCtrl\n * @module assignment.controllers\n * @description\n *   任务指派-编辑任务页控制器\n */\n  .controller('AssignmentEditCtrl', function($scope, $stateParams, $timeout, $filter, $ionicLoading, $ionicHistory, Settings, Utils, User, IbPopup, Assignment) {\n\n    $scope.isDateTimeLocalSupport = Utils.isDateTimeLocalSupport;\n\n    var submitting = false;\n\n    $scope.isDisabledSubmit = function() {\n      return submitting || !($scope.assignmentForm && $scope.assignmentForm.$valid);\n    };\n\n    $scope.save = function() {\n      var form = Assignment.correctFormData($scope.form);\n\n      $ionicLoading.show();\n      submitting = true;\n\n      Assignment.update($stateParams.id, form)\n        .success(function() {\n          $ionicHistory.goBack();\n        })\n        .error(Settings.requestError)\n        .finally(function() {\n          $ionicLoading.hide();\n          submitting = false;\n        })\n    };\n\n    // 获取当前任务的相关信息\n    $ionicLoading.show();\n    Assignment.get($stateParams)\n      .success(function(res) {\n        // 获取成功后，添加数据到 form 对象上\n        if(res.isSuccess) {\n          $scope.form = {\n            subject: res.data.subject,\n            chargeuid: User.removePrefix(res.data.chargeuid),\n            participantuid: User.removePrefix(res.data.participantuid),\n            starttime: res.data.starttime ?\n              new Date(res.data.starttime) :\n              '',\n            endtime: new Date(res.data.endtime),\n            description: res.data.description\n          };\n          // 获取出错时，提示引导用户并返回上一页\n        } else {\n          IbPopup.alert({ title: res.msg })\n            .then(function() {\n              $ionicHistory.goBack();\n            });\n        }\n      })\n      .error(Settings.requestError)\n      .finally($ionicLoading.hide)\n  })\n\n/**\n * @ngdoc controller\n * @name AssignmentDetailCtrl\n * @module assignment.controllers\n * @description\n *   任务指派-查看任务页控制器\n */\n  .controller('AssignmentDetailCtrl', function($scope, $stateParams, $ionicLoading, $ionicHistory, $ionicModal, Settings, User, IbPopup, Assignment, AssignmentUnfinished) {\n    var assignment = {};\n    $scope.submitting = false;\n\n    // 是否已过期\n    $scope.isOverdue = function() {\n      return assignment &&\n        assignment.endtime &&\n        Date.now() > assignment.endtime * 1000;\n    };\n\n    // 是否设置了提醒\n    $scope.haveRemind = function() {\n      return assignment && assignment.remindtime > 0;\n    };\n\n    // 完成任务\n    $scope.done = function() {\n      $scope.submitting = true;\n\n      AssignmentUnfinished.done({ id: assignment.assignmentid })\n        .success(reloadInfo)\n        .finally(function() {\n          $scope.submitting = false;\n        });\n    };\n\n    // 重启任务\n    $scope.restart = function() {\n      $scope.submitting = true;\n\n      AssignmentUnfinished.restart({ id: assignment.assignmentid })\n        .success(reloadInfo)\n        .finally(function() {\n          $scope.submitting = false;\n        });\n    };\n\n    // 催办\n    $scope.urge = function() {\n      $scope.submitting = true;\n\n      AssignmentUnfinished.urge({ id: assignment.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            IbPopup.tip(res.msg);\n          }\n        })\n        .finally(function() {\n          $scope.submitting = false;\n        });\n    };\n\n    function _confirm(options, onresolve, onreject) {\n      options = angular.extend({\n        buttons: [\n          {\n            text: '拒绝',\n            onTap: onreject\n          },\n          {\n            text: '同意',\n            type: 'button-positive',\n            onTap: onresolve\n          }\n        ]\n      }, options);\n      return IbPopup.confirm(options)\n    }\n\n    function confirmDelayApply(data) {\n      return _confirm({\n        title: '任务延期申请',\n        templateUrl: 'templates/assignment/deal-delay-apply.html',\n        scope: $scope\n      }, function() {\n\n        AssignmentUnfinished.dealDelayApply({ id: assignment.assignmentid, agree: 1 })\n          .success(reloadInfo);\n\n      }, function() {\n        AssignmentUnfinished.dealDelayApply({ id: assignment.assignmentid, agree: 0 });\n      })\n    }\n\n    function confirmCancelApply(data){\n      return _confirm({\n        title: '任务取消申请',\n        templateUrl: 'templates/assignment/deal-cancel-apply.html',\n        scope: $scope\n      }, function() {\n\n        AssignmentUnfinished.dealCancelApply({ id: assignment.assignmentid, agree: 1 })\n          .success(reloadInfo);\n\n      }, function() {\n        AssignmentUnfinished.dealCancelApply({ id: assignment.assignmentid, agree: 0 });\n      });\n    }\n\n    // 获取当前任务的相关信息\n    function loadInfo() {\n      $ionicLoading.show();\n      Assignment.getFullInfo($stateParams)\n        .success(function(res) {\n          if(res.isSuccess) {\n            $scope.data = res.data;\n            $scope.assignment = assignment = res.data.assignment;\n            $scope.stamps = res.stamps;\n\n            $scope.isDesignee = (User.uid == assignment.designeeuid);\n            $scope.isCharge = (User.uid == assignment.chargeuid);\n\n            // 处理“延时申请”和“取消申请”\n            var applyData = res.data.applyData;\n            if($scope.isDesignee && applyData && applyData.id) {\n              // 有返回开始时间时，判断为“延时申请”\n              if(applyData.startTime) {\n                confirmDelayApply(applyData);\n                // 否则判断为“取消申请”\n              } else {\n                confirmCancelApply(applyData);\n              }\n            }\n            // 获取出错时，提示引导用户并返回上一页\n          } else {\n            IbPopup.alert({ title: res.msg })\n              .then(function() {\n                $ionicHistory.goBack();\n              });\n          }\n        })\n        .error(Settings.requestError)\n        .finally($ionicLoading.hide)\n    }\n\n    function reloadInfo(res) {\n      if(res.isSuccess) {\n        loadInfo();\n      }\n    }\n\n    loadInfo();\n\n    // 获取图章路径\n    $scope.getStampPath = function(value) {\n      return Assignment.getStampPath(value, $scope.stamps);\n    };\n\n    // 图章 Modal\n    $ionicModal.fromTemplateUrl('templates/assignment/stamp-modal.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal) {\n      $scope.stampModal = modal;\n    });\n\n    $scope.selectStamp = function(value) {\n      Assignment.stamp({ id: $scope.assignment.assignmentid, stamp: value })\n        .success(reloadInfo);\n      $scope.stampModal.hide();\n    };\n\n    $scope.$on('$ionicView.leave', function() {\n      $scope.stampModal.hide();\n    });\n\n    $scope.$on('$destroy', function() {\n      $scope.stampModal.remove();\n    });\n  })\n","/**\n * @ngdoc module\n * @name assignment.services\n * @description\n *   任务指派模块服务\n */\n\nangular.module('assignment.services', [])\n\n\n/**\n * @ngdoc service\n * @name Assignment\n * @module assignment.services\n * @description\n *   任务指派通用服务\n */\n\n.factory('Assignment', function($rootScope, $http, $state, $filter, $ionicLoading, Settings, Utils, User) {\n  var moduleUrl = Settings.rootUrl + '/assignment';\n\n  var DATETIME_FORMAT = 'yyyy-MM-dd HH:mm';\n\n  // 状态对应 0 未读，1 进行中，2 已完成，3 已评价，4 已取消\n  var operation = {\n    // 指派人可用操作\n    designee: {\n      '0': ['edit', 'remove', 'urge', 'cancel', 'delay', 'remind'],\n      '1': ['edit', 'remove', 'done', 'cancel', 'delay', 'remind'],\n      '2': ['edit', 'remove', 'stamp', 'restart'],\n      '3': ['edit', 'remove', 'restart'],\n      '4': ['edit', 'remove', 'restart']\n    },\n    // 负责人可用操作\n    charge: {\n      '0': ['done', 'remind'],\n      '1': ['done', 'applyDelay', 'applyCancel', 'remind'],\n      '2': ['restart'],\n      '3': ['restart'],\n      '4': ['restart']\n    }\n    // 参与人从头到尾都只能评论，就是个打酱油的\n  };\n\n  return {\n    getRole: function(task) {\n      if(User.uid == task.designeeuid) {\n        return 'designee';\n      } else if(User.uid == task.chargeuid) {\n        return 'charge';\n      } else if(task.participantuid.split(',').indexOf(User.uid) !== -1) {\n        return 'participant';\n      }\n      return '';\n    },\n\n    getRoleText: function(task) {\n      var text = {\n        'charge': '负责人',\n        'designee': '指派人',\n        'participant': '参与人'\n      };\n      return text[this.getRole(task)] || '';\n    },\n\n    getStampPath: function(value, stamps) {\n      var path = '';\n      \n      angular.forEach(stamps, function(stamp) {\n        if(value == stamp.value) {\n          path = stamp.stampPath;\n        }\n        return false;\n      });\n\n      return path;\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#getEnableOperation\n     * @description \n     *    获取某条任务数据允许的操作\n     * @param {Object} task\n     * @returns {Array} 允许操作数组\n     */\n    getEnableOperation: function(task) {\n      var op = User.uid == task.designeeuid ? \n      operation.designee:\n      User.uid == task.chargeuid ?\n      operation.charge:\n      {};\n\n      return op[task.status] || [];\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#convertDateTime\n     * @description \n     *   将日期转为字符串\n     *   根据表单控件支持情况，当支持datetime-local时，格式为 yyyy-MM-ddThh:ii\n     *   否则格式为 yyyy-MM-dd hh:ii\n     * @param {Date} date 日期\n     * @returns {String}  时间字符串\n     */\n    convertDateTime: function(date) {\n      date = angular.isDate(date) ? date : new Date(date);\n\n      if(Utils.isDateTimeLocalSupport) {\n        date = new Date(+date - (date.getTimezoneOffset() * 60000));\n        return date.toJSON().slice(0, 16);\n      } else {\n        return $filter('date')(date, DATETIME_FORMAT);\n      }\n    },\n\n    formatDatetime: function(date) {\n      return $filter('date')(date, DATETIME_FORMAT);\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#correctDateTime\n     * @description \n     *   将 datetime-local 的值转为需要的格式\n     * @param {String} dateStr\n     * @returns {String}\n     */\n    correctDateTime: function(dateStr) {\n      var date = new Date(dateStr);\n\n      if(Utils.isDateTimeLocalSupport) {\n        date = new Date(+date + (date.getTimezoneOffset() * 60000));\n      }\n\n      return this.formatDatetime(date);\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#correctFormData\n     * @description \n     *   校正将要提交的数据\n     * @param {Object} form 表单数据\n     * @returns {Object}    校正后的表单数据\n     */\n    correctFormData: function(form) {\n      form = angular.extend({}, form);\n\n      form.chargeuid = User.addPrefix(form.chargeuid);\n      form.participantuid = User.addPrefix(form.participantuid) || '';\n\n      // form.starttime = this.correctDateTime(form.starttime) || '';\n      // form.endtime = this.correctDateTime(form.endtime);\n      form.starttime = this.formatDatetime(form.starttime);\n      form.endtime = this.formatDatetime(form.endtime);\n\n      form.description = form.description || '';\n      // 目前手机端没做附件，但由于后端有检验这一参数，所以加上\n      form.attachmentid = '';\n\n      return form;\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#get\n     * @description \n     *    获取某一条任务\n     * @param {Object}   params     参数，正常情况下只需要任务 id\n     * @returns {Object} promise\n     */\n    get: function(params) {\n      return $http.get(moduleUrl + '/edit', {\n        params: params\n      })\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#get\n     * @description \n     *    获取某一条任务及任务相关的数据\n     * @param {Object}   params     参数，正常情况下只需要任务 id\n     * @returns {Object} promise\n     */\n    getFullInfo: function(params) {\n      params = params || {};\n      params.assignmentId = params.id;\n      return $http.get(moduleUrl + '/show', {\n        params: params\n      })\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#create\n     * @description \n     *    创建一条新的任务\n     * @param {Object} data\n     * @returns {Object} promise\n     */\n    create: function(data) {\n      data.formhash = User.formhash\n      return $http.post(moduleUrl + '/add&addsubmit=1', data)\n      .success(function(res) {\n        $rootScope.$broadcast('assignment.create', data, res);\n      });\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#update\n     * @description \n     *   修改某一条任务\n     * @param {String}     id     该任务 id\n     * @param {Object}     data   任务新数据\n     * @returns {Object}   promise\n     */\n    update: function(id, data) {\n      return $http.post(moduleUrl + '/edit&id=' + id, data)\n      .success(function(res) {\n        $rootScope.$broadcast('assignment.update', id, data, res);\n      });\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#remove\n     * @description \n     *   删除任务\n     * @param {Object}   params   参数\n     *   params.id  {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    remove: function(params) {\n      return $http.post(moduleUrl + '/del', params)\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#getSubordinates\n     * @description \n     *   获取指定用户的下属数据\n     * @param {Object}   params   参数\n     *   params.uid            {String} 用户id\n     * @returns {Object} promise\n     */\n    getSubordinates: function(params) {\n      return $http.get(Settings.rootUrl + '/assignmentunfinished/subList&op=getsubordinates', {\n        params: params\n      })\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#getSubordinates\n     * @description \n     *   评价任务\n     * @param {Object}   params   参数\n     *   params.id            {String} 任务id\n     *   params.stamp         {String} 图章值\n     * @returns {Object} promise\n     */\n    stamp: function(params) {\n      return $http.post(Settings.rootUrl + '/assignmentunfinished/ajaxEntrance&op=stamp', params)\n      .error(Settings.requestError);\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name AssignmentUnfinished\n * @module assignment.services\n * @description\n *   任务指派未完成列表数据\n */\n.factory('AssignmentUnfinished', function($rootScope, $http, Settings, IbPopup) {\n  var url = Settings.rootUrl + '/assignmentunfinished';\n\n  function serverError(res) {\n    if(!res.isSuccess) {\n      IbPopup.tip(res.msg);\n    }\n  }\n\n  var ret = {\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#get\n     * @description \n     *   获取未完成列表数据\n     * @returns {Object} promise\n     */\n    get: function() {\n      return $http.get(url).error(Settings.requestError);\n    },\n\n    getSubList: function(params) {\n      return $http.get(url + '/subList', {\n        params: params\n      })\n      .error(Settings.requestError);\n    },\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#urge\n     * @description \n     *   催办任务\n     * @param {Object}   params   参数\n     *   params.id  {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    urge: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=push', params)\n      .success(serverError)\n      .success(function(res) {\n        $rootScope.$broadcast('assignment.urge', params, res);\n      })\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#done\n     * @description \n     *   完成任务\n     * @param {Object}   params   参数\n     *   params.id  {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    done: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=toFinished', params)\n      .success(serverError)\n      .success(function(res) {\n        $rootScope.$broadcast('assignment.done', params, res);\n      })\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#restart\n     * @description \n     *   重启任务\n     * @param {Object}   params   参数\n     *   params.id  {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    restart: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=restart', params)\n      .success(serverError)\n      .success(function(res) {\n        $rootScope.$broadcast('assignment.restart', params, res);\n      })\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#applyDelay\n     * @description \n     *   申请任务延迟\n     * @param {Object}     params   参数\n     *   params.id            {String} 任务id，必须项\n     *   params.starttime     {String} 开始时间，格式为 yyyy-MM-dd HH:mm\n     *   params.endtime       {String} 结束时间，格式同上\n     *   params.delayReason   {String} 延迟原因\n     * @returns {Object} promise\n     */\n    applyDelay: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=applyDelay', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#applyCancel\n     * @description \n     *   申请任务取消\n     * @param {Object}     params   参数\n     *   params.id            {String} 任务id，必须项\n     *   params.cancelReason  {String} 取消原因\n     * @returns {Object} promise\n     */\n    applyCancel: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=applyCancel', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#dealDelayApply\n     * @description \n     *   延期申请处理\n     * @param {Object}   params   参数\n     *   params.id       {String} 任务id，必须项\n     *   params.agree    {Number} 是否同意，0 表拒绝，1表同意\n     * @returns {Object} promise\n     */\n    dealDelayApply: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=runApplyDelayResult', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#dealCancelApply\n     * @description \n     *   延期取消处理\n     * @param {Object}   params   参数\n     *   params.id       {String} 任务id，必须项\n     *   params.agree    {Number} 是否同意，0 表拒绝，1表同意\n     * @returns {Object} promise\n     */\n    dealCancelApply: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=runApplyCancelResult', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#delay\n     * @description \n     *   延期任务\n     * @param {Object}   params   参数\n     *   params.id       {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    delay: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=delay', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#cancel\n     * @description \n     *   取消任务\n     * @param {Object}   params   参数\n     *   params.id       {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    cancel: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=cancel', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#remind\n     * @description \n     *   设置提醒\n     * @param {Object}   params   参数\n     *   params.id            {String} 任务id，必须项\n     *   params.remindTime    {String} 提醒时间\n     *   params.remindContent {String} 提醒内容\n     * @returns {Object} promise\n     */\n    remind: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=remind&remindsubmit=1', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    getRemindData: function(params) {\n      return $http.get(url + '/ajaxEntrance&op=remind', { params: params })\n      .success(serverError)\n      .error(Settings.requestError);\n    }\n  };\n\n  return ret;\n})\n\n/**\n * @ngdoc service\n * @name AssignmentFinished\n * @module assignment.services\n * @description\n *   任务指派已完成列表数据\n */\n.factory('AssignmentFinished', function($rootScope, Settings, IbList) {\n  var assignmentFinished = new IbList(Settings.rootUrl + '/assignmentfinished', {\n    idAttr: 'assignmentid'\n  });\n  // 已完成列表搜索功能后端参数与其他模块不一样\n  // 需要重写 search 方法\n  // 后端泥垢了 (╯°Д°)╯︵ ┻━┻\n  assignmentFinished.search = function(keyword) {\n    if(keyword.trim() === '') {\n      return this.fetch({\n        offset: 0,\n      }, true);\n    } else {\n      return this.fetch({\n        offset: 0,\n        param: 'search',\n        keyword: keyword\n      }, true);\n    }\n\n  };\n\n  return assignmentFinished;\n})\n\n\n/**\n * @ngdoc filter\n * @name assignment.services.filter:asmStatusText\n * @function\n * @description\n *  将任务状态标识转化为文本\n *  \n * @param   {string}  status  任务状态标识\n * @returns {string}  任务状态文本\n */\n.filter('asmStatusText', function() {\n  var statusMap = {\n    0: '未读',\n    1: '进行中',\n    2: '已完成',\n    3: '已评价',\n    4: '已取消'\n  };\n\n  return function(status) {\n    return statusMap[+status] || '';\n  };\n})","/**\n * @ngdoc module\n * @name cabinet\n * @description\n *   文件柜模块入口\n */\n\nangular.module('cabinet', ['ionic', 'cabinet.controllers', 'cabinet.services', 'cabinet.filters'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'cabinet', title: '文件柜', route: '#/cabinet', state: 'cabinet.personal', icon: 'img/modicon/cabinet.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/cabinet', '/cabinet/personal');\n\n  $stateProvider\n  // setup an abstract state for the tabs directive\n  .state('cabinet', {\n    url: \"/cabinet\",\n    abstract: true,\n    templateUrl: \"templates/cabinet/cabinet.html\",\n    resolve: UserProvider.resolve\n  })\n\n  .state('cabinet.personal', {\n    url: '/personal?pid',\n    talkingDataLabel: '文件柜-我的网盘',\n    views: {\n      'cabinet-personal': {\n        templateUrl: 'templates/cabinet/cabinet-personal.html',\n        controller: 'CbPersionalCtrl'\n      }\n    }\n  })\n\n  .state('cabinet.company', {\n    url: '/company?pid',\n    talkingDataLabel: '文件柜-公司网盘',\n    views: {\n      'cabinet-company': {\n        templateUrl: 'templates/cabinet/cabinet-company.html',\n        controller: 'CbCompanyCtrl'\n      }\n    }\n  })\n\n  .state('cabinet.received', {\n    url: '/received',\n    talkingDataLabel: '文件柜-收到的共享',\n    views: {\n      'cabinet-received': {\n        templateUrl: 'templates/cabinet/cabinet-received.html',\n        controller: 'CbReceivedCtrl'\n      }\n    }\n  })\n\n  .state('cabinet.user', {\n    url: '/user?fromuid&pid',\n    views: {\n      'cabinet-received': {\n        templateUrl: 'templates/cabinet/cabinet-personal.html',\n        controller: 'CbReceiveUserCtrl'\n      }\n    }\n  })\n});","/**\n * @ngdoc module\n * @name cabinet.controllers\n * @description\n *   文件柜模块控制器\n */\nangular.module('cabinet.controllers', [])\n\n/**\n * @ngdoc controller\n * @name CbPersionalCtrl\n * @module cabinet.controllers\n * @description\n *   个人文件柜列表页控制器\n */\n.controller('CbPersionalCtrl', function($scope, $stateParams, $ionicLoading, Settings, Cabinet, User, Utils){\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n      if(res.isSuccess){\n        if(res.data.file){\n          $scope.cb = new Cabinet(Settings.rootUrl + '/file');\n          $scope.cb.fetch($stateParams)\n            .success(function(res) {\n              $scope.title = res.pDir.name;\n            });\n        } else {\n          Utils.promptNoPermission();\n        }\n      }\n    }).finally($ionicLoading.hide);\n\n})\n\n/**\n * @ngdoc controller\n * @name CbCompanyCtrl\n * @module cabinet.controllers\n * @description\n *   公司文件柜列表页控制器\n */\n.controller('CbCompanyCtrl', function($scope, $state, $stateParams, Settings, Cabinet, ACCESS){\n  $scope.cb = new Cabinet(Settings.rootUrl + '/companyfile');\n  $scope.cb.fetch($stateParams)\n  .success(function(res) {\n    $scope.title = res.pDir.name;\n  });\n\n  $scope.cb.openFolder = function(file){\n    $state.go('cabinet.company', { pid: file.fid });\n  }\n\n  var _showMenu = $scope.cb.showMenu;\n\n  $scope.cb.showMenu = function(file){\n    _showMenu.call($scope.cb, file, {\n      remove: !file.access || file.access == ACCESS.WRITABLE\n    });\n  }\n})\n\n\n/**\n * @ngdoc controller\n * @name CbReceiveCtrl\n * @module cabinet.controllers\n * @description\n *   收到的共享，人员列表控制器\n */\n.controller('CbReceivedCtrl', function($scope, CabinetReceived) {\n  \n  $scope.users = [];\n\n  CabinetReceived.fetch()\n  .success(function(res){\n    $scope.users = res.data;\n  });\n\n  $scope.search = function(keyword) {\n    CabinetReceived.fetch({\n      keyword: keyword,\n      normal_search: 1,\n      search: 1\n    })\n    .success(function(res){\n      $scope.users = res.data;\n    })\n  }\n})\n\n\n/**\n * @ngdoc controller\n * @name CbReceiveUserCtrl\n * @module cabinet.controllers\n * @description\n *   收到的共享，人员详细文件列表页控制器\n */\n.controller('CbReceiveUserCtrl', function($scope, $state, $stateParams, Settings, Cabinet){\n  $scope.cb = new Cabinet(Settings.hostUrl + '?r=file/fromshare');\n  $scope.cb.fetch($stateParams)\n  .success(function(res) {\n    if(res.breadCrumbs.length === 1) {\n      $scope.title = res.breadCrumbs[0].realname;\n    } else if(res.breadCrumbs.length > 1){\n      $scope.title = res.breadCrumbs[res.breadCrumbs.length - 1].name;\n    }\n  });\n\n  $scope.cb.openFolder = function(file){\n    $state.go('cabinet.user', { pid: file.fid });\n  }\n\n  var _showMenu = $scope.cb.showMenu;\n\n  $scope.cb.showMenu = function(file){\n    _showMenu.call($scope.cb, file, {\n      remove: false\n    });\n  }\n})\n\n","/**\n * @ngdoc module\n * @name cabinet.filters\n * @description\n *   文件柜模块过滤器\n */\n\nangular.module('cabinet.filters', [])\n","/**\n * @ngdoc module\n * @name cabinet.services\n * @description\n *   文件柜模块相关服务\n */\nangular.module('cabinet.services', [])\n\n.constant('ACCESS', {\n  WRITABLE: '2',\n  READABLE: '1'\n})\n\n.constant('FILETYPE', {\n  FOLDER: '1',\n  FILE: '0'\n})\n\n/**\n * @ngdoc service\n * @name Cabinet\n * @module cabinet.services\n * @description\n *   文件模块数据交互及处理\n */\n.factory('Cabinet', function($http, $state, $filter, $stateParams, $ionicLoading, $ionicPopup, $ionicActionSheet, fullUrlFilter, Settings, ImgViewer, Downloader, FILETYPE){\n\n  function Cabinet(moduleUrl){\n    this.moduleUrl = moduleUrl;\n    this.pid = 0;\n    this.files = [];\n  }\n\n  /**\n   *\n   * @ngdoc method\n   * @name Cabinet#fetch\n   * @description \n   *   获取文件列表数据\n   *   返回数据格式为\n   *   {\n   *     breadCrumbs: Array  // 面包屑\n   *     data: Array         // 文件列表\n   *     pDir: Object        // 父目录\n   *     page: Object        // 页码\n   *     pid: 0              // 父目录 id\n   *   }\n   * @param {Obejct} param 查询条件，可能包括 pid | keyword...\n   * @returns {Object} promise\n   */\n  Cabinet.prototype.fetch = function(param) {\n    var _this = this;\n\n    $ionicLoading.show();\n\n    param = param || {};\n\n    var httpPromise = $http.get(this.moduleUrl + '/getcate', {\n        params: angular.extend({\n          pid: this.pid,\n        }, param)\n      })\n      .success(function(res){\n        _this.files = res.data;\n        _this.pid = param.pid || _this.pid;\n      })\n      .error(Settings.requestError)\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n\n    return httpPromise;\n  };\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#search\n   * @description \n   *   通过关键字搜索文件\n   * \n   * @param {String} keyword  关键字\n   * @returns {Object} promise\n   */\n  Cabinet.prototype.search = function(keyword) {\n    return this.fetch(angular.extend({}, $stateParams, {\n      keyword: keyword,\n      normal_search: 1,\n      search: 1\n    }))\n  }\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#open\n   * @description \n   *   打开文件\\文件夹，根据文件类型进入对应打开方法\n   * \n   * @param {Object} file  文件对象\n   * @returns\n   */\n  Cabinet.prototype.open = function(file) {\n    if(file.type == FILETYPE.FOLDER) {\n      this.openFolder(file)\n    // thumb属性指向图像缩略图，目前可根据此属性判断是否图像\n    // fileurl 指向文件源地址\n    } else if(file.thumb) {\n      this.openImage(file);\n    } else {\n      this.download(file);\n      // FileViewer.view(file.filetype, $filter('attachUrl')(file.fileurl))\n    }\n  };\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#openFolder\n   * @description \n   *   打开文件夹，实际行为是跳转到该文件夹对应路由\n   * \n   * @param {Object} file  文件对象\n   * @returns\n   */\n  Cabinet.prototype.openFolder = function(file) {\n    $state.go('cabinet.personal', { pid: file.fid });\n  };\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#openImage\n   * @description \n   *   查看图片\n   * \n   * @param {Object} file  文件对象\n   * @returns\n   */\n  Cabinet.prototype.openImage = function(file) {\n    var srcs = [];\n    angular.forEach(this.files, function(f) {\n      if(f.thumb) {\n        srcs.push(fullUrlFilter(f.fileurl));\n      }\n    });\n\n    ImgViewer.view(fullUrlFilter(file.fileurl), srcs);\n  };\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#download\n   * @description \n   *   下载文件\\文件夹\n   * \n   * @param {Object} file  文件对象\n   * @returns\n   */\n  Cabinet.prototype.download = function(file) {\n    Downloader.down(fullUrlFilter(file.entireattachurl || file.officereadurl));\n  };\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#showMenu\n   * @description \n   *   显示操作菜单\n   * \n   * @param {Object} file  文件对象\n   * @param {Object} opt  菜单项配置\n   *   * 可配置项包括 remove(删除)、download(下载)、share(共享)\n   *   * 目前共享功能不可用\n   * @returns\n   */\n  Cabinet.prototype.showMenu = function(file, opt) {\n\n    var _this = this;\n    var buttons = [];\n    var handlers = [];\n\n    opt = angular.extend({\n      remove: true,\n      download: true,\n      share: false // 暂时屏蔽共享功能\n    }, opt)\n\n    // 下载按钮\n    if(opt.download) {\n      buttons.push({ text: '下载' });\n      handlers.push(function(file){\n        _this.download(file);\n      });\n    }\n\n    // 共享按钮\n    if(opt.share) {\n      buttons.push({ text: '共享' });\n      handlers.push(function(file){\n        _this.share(file);\n      })\n    }\n\n    var conf = {\n      titleText: '文件操作',\n      buttons: buttons,\n      buttonClicked: function(index) {\n        handlers[index](file);\n        return true;\n      },\n      cancelText: '取消'\n    }\n\n    // 删除按钮\n    if(opt.remove) {\n      conf.destructiveText = '删除';\n      conf.destructiveButtonClicked = function(){\n        _this.remove(file);\n      }\n    }\n\n    this.hideMenu = $ionicActionSheet.show(conf);\n  };\n\n  function removeFile(file, files) {\n    angular.forEach(files, function(f, i){\n      if(file.fid == f.fid) {\n        files.splice(i, 1);\n        return false;\n      }\n    });\n  }\n\n  /**\n   *\n   * @ngdoc method\n   * @name Cabinet#remove\n   * @description \n   *   删除指定 文件或文件夹至回收站\n   * @param {String} fid  文件标识符|索引\n   * @returns {Object} promise\n   */\n  Cabinet.prototype.remove = function(file) {\n    var _this = this;\n\n    $ionicPopup.confirm({\n      title: '提示',\n      template: '确定删除该文件/文件夹吗？',\n      okText: '确定',\n      cancelText: '取消'\n    })\n    .then(function(res) {\n      if(res) {\n        return $http.get(_this.moduleUrl + '/del&op=recycle', {\n          params: { fids: file.fid }\n        })\n        .error(Settings.requestError)\n        .success(function(res) {\n          if(res.isSuccess) {\n            removeFile(file, _this.files);\n            _this.hideMenu();\n          }\n        });\n      }\n    });\n    \n  };\n\n  return Cabinet;\n})\n\n.factory('CabinetReceived', function($http, $ionicLoading, Settings){\n\n  var url = Settings.hostUrl + '?r=file/fromshare/getcate';\n\n  function fetch(params) {\n    $ionicLoading.show();\n\n    return $http.get(url, {\n      params: params\n    })\n    .error(Settings.requestError)\n    .success($ionicLoading.hide)\n    .error($ionicLoading.hide)\n  }\n\n  return {\n    fetch: fetch\n  };\n})\n","/**\n * Calendar\n * 日程模块入口\n */\nangular.module('calendar', ['ionic', 'calendar.controllers', 'calendar.services', 'calendar.filters'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'calendar', title: '日程', route: '#/calendar', state: 'calendar', icon: 'img/modicon/calendar.png' });\n})\n\n.constant('DATE_FORMAT', 'yyyy-MM-dd')\n\n.constant('TIME_FORMAT', 'HH:mm')\n\n.constant('DAY_MILLISECOND', 86400000)\n\n.config(function($stateProvider, UserProvider) {\n\n  $stateProvider\n\n    .state('calendar', {\n      url: '/calendar',\n      templateUrl: 'templates/calendar/calendar.html',\n      talkingDataLabel: '日程-首页',\n      controller: 'CalendarCtrl',\n      resolve: UserProvider.resolve\n    })\n\n    .state('calendar-create', {\n      url: '/create',\n      templateUrl: 'templates/calendar/detail.html',\n      talkingDataLabel: '日程-创建',\n      controller: 'CalendarCreateCtrl',\n      resolve: UserProvider.resolve\n    })\n\n    .state('calendar-detail', {\n      url: '/calendar/:calendarId',\n      templateUrl: 'templates/calendar/detail.html',\n      talkingDataLabel: '日程-查看',\n      controller: 'CalendarDetailCtrl',\n      resolve: UserProvider.resolve\n    });\n\n});\n","/**\n * Calendar\n * calendar.controllers\n * 日程模块控制器\n * @P.s 日程模块用到的 cEvts 指代日程记录，跟 js 意义的事件没有任何关系\n */\n\nangular.module('calendar.controllers', [])\n\n/**\n * @ngdoc controller\n * @name CalendarCtrl\n * @module calendar.controllers\n * @description\n *   日程列表页页面控制器\n */\n  .controller('CalendarCtrl', function($scope, $ionicScrollDelegate, $ionicLoading, Calendar, CalendarUtil ,User, Utils) {\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n      if(res.isSuccess){\n        if(res.data.calendar){\n          $scope.title = '我的日程';\n\n          $scope.calendars = [];\n          $scope.calendars.loaded = false;\n\n          // 初始化控制器时，自动获取数据, 自动获取下月和本月的日程\n          Calendar.fetch(CalendarUtil.getDateRange())\n            .success(function(data){\n              $scope.calendars = CalendarUtil.groupEvents(data.events);\n              $scope.calendars.loaded = true;\n            });\n\n          $scope.$on('$ionicView.beforeLeave', function() {\n            $ionicScrollDelegate.scrollTop();\n          });\n        } else{\n          Utils.promptNoPermission();\n        }\n      }\n    }\n    ).finally($ionicLoading.hide)\n  })\n\n/**\n * @ngdoc controller\n * @name CalendarCreateCtrl\n * @module calendar.controllers\n * @description\n *   日程新建页页面控制器\n */\n  .controller('CalendarCreateCtrl', function($scope, $state, $ionicHistory, $ionicLoading, Calendar, CalendarUtil, DAY_MILLISECOND){\n\n    $scope.title = \"新建日程\";\n\n    var date = CalendarUtil.getCurrentDateTime();\n\n    // 日程默认数据\n    $scope.calendar = {\n      isalldayevent: false,\n      editable: true,\n      category: 0,\n\n      startDate: date,\n      endDate: new Date(+date + DAY_MILLISECOND),\n\n      startTime: date,\n      endTime: new Date(+date + DAY_MILLISECOND / 12)\n    };\n\n    //开启全天模式时，结束日期应比开始日期晚一天\n    $scope.$watch('calendar.startDate', function (newStartDate) {\n      if($scope.calendar.isalldayevent){\n        $scope.calendar.endDate = new Date( +newStartDate + DAY_MILLISECOND)\n      }\n    });\n\n    // 表示表单是否正处于提交状态\n    function resetSubmit(){\n      $scope.isSubmiting = false;\n      $ionicLoading.hide();\n    }\n\n    // 正在提交表单\n    function doSubmit() {\n      $scope.isSubmiting = true;\n      $ionicLoading.show({ delay: 300 });\n    }\n\n    $scope.submit = function(){\n      console.log($scope.calendar)\n      doSubmit();\n      Calendar.create(Calendar.formatSubmitData($scope.calendar))\n        .success(function(){\n          $ionicHistory.clearCache().then(function(){\n            $state.go('calendar');\n          });\n          // $state.go('calendar');\n        })\n        .finally(resetSubmit);\n    }\n  }\n)\n\n/**\n * @ngdoc controller\n * @name CalendarDetailCtrl\n * @module calendar.controllers\n * @description\n *   日程详情页, 日程模块详细页与编辑功能结合在一起\n */\n  .controller('CalendarDetailCtrl', function($scope, $state, $timeout, $stateParams, $ionicPopup, $ionicHistory, $ionicLoading, Calendar, CalendarUtil, IbPopup){\n\n    $scope.title = \"编辑日程\";\n\n    // 获取当前 id 对应的日程数据\n    Calendar.get($stateParams.calendarId)\n      .success(function(res){\n        if(res && res != 'null') {\n          // 所以目前要格式化为期望格式\n          $scope.calendar = CalendarUtil.parseTime(res);\n        } else {\n          $ionicPopup.alert({\n            title: '提示',\n            template: '找不到相关日程数据，将返回日程列表'\n          })\n            .then(function(){\n              $state.go('calendar')\n            })\n        }\n      });\n\n    // 表示表单是否正处于提交状态\n    function resetSubmit(){\n      $scope.isSubmiting = false;\n      $ionicLoading.hide();\n    }\n\n    // 正在提交表单\n    function doSubmit() {\n      $scope.isSubmiting = true;\n      $ionicLoading.show({ delay: 300 });\n    }\n\n    // 保存\n    $scope.submit = function(){\n      doSubmit();\n      Calendar.update(Calendar.formatSubmitData($scope.calendar))\n        .success(function(){\n          $ionicHistory.clearCache().then(function() {\n            $state.go('calendar');\n          });\n        })\n        .finally(resetSubmit);\n    }\n\n    // 删除\n    $scope.remove = function(){\n      doSubmit();\n      Calendar.removeOne($scope.calendar.calendarid)\n        .success(function(){\n          IbPopup.tip('删除成功!').then(function() {\n            $ionicHistory.clearCache().then(function() {\n              $state.go('calendar');\n            });\n          });\n        })\n        .finally(resetSubmit);\n    }\n\n    // 完成日程\n    $scope.finish = function(){\n      if($scope.calendar.status == '0') {\n        doSubmit();\n        var parsed = CalendarUtil.parseTime($scope.calendar);\n\n        Calendar.finish(Calendar.formatSubmitData(parsed))\n          .success(function(){\n            $ionicHistory.clearCache();\n            $scope.calendar.status = '1';\n          })\n          .finally(resetSubmit);\n      }\n\n    }\n\n    // 取消完成日程\n    $scope.unfinish = function(){\n      if($scope.calendar.status == '1') {\n        doSubmit();\n        var parsed = CalendarUtil.parseTime($scope.calendar);\n\n        Calendar.unfinish(Calendar.formatSubmitData(parsed))\n          .success(function(){\n            $ionicHistory.clearCache();\n            $scope.calendar.status = '0';\n          })\n          .finally(resetSubmit);\n      }\n    }\n  }\n)\n\n","/**\n * Calendar\n * 日程模块过滤器\n */\n\nangular.module('calendar.filters', [])\n\n.filter('calendarTheme', function(){\n  var themeSeries = ['#3497DB', '#A6C82F', '#F4C73B', '#EE8C0C', '#E76F6F', '#AD85CC', '#98B2D1', '#82939E']\n  return function(category){\n    // 由于在后台处理数据时，给予的默认值是 -1，对应的是主题数组中的第一个。\n    category = (category && category) != '-1' ? category : 0;\n    return themeSeries[category || 0];\n  };\n})\n\n.filter('dayFormToday', function(){\n\treturn function(day){\n\t\tswitch(day) {\n\t\t\tcase 0:\n\t\t\t\treturn '今天';\n\n\t\t\tcase 1:\n\t\t\t\treturn '明天';\n\n\t\t\tcase 2:\n\t\t\t\treturn '后天';\n\n\t\t\tcase -1:\n\t\t\t\treturn '昨天';\n\n\t\t\tcase -2:\n\t\t\t\treturn '前天';\n\n\t\t\tdefault:\n\t\t\t\treturn day > 0 ? day + '天后' : -day + '天前';\n\t\t}\n\t}\n})\n\n.filter('calendarDate', [\n\t'$filter',\n\t'DAY_MILLISECOND',\n\t'DATE_FORMAT',\n\n\tfunction($filter, DAY_MILLISECOND, DATE_FORMAT){\n\t\t/**\n\t\t * @ngdoc method\n\t\t * @name CalendarUtil#formatDate\n\t\t * @description\n\t\t *   使用 dateFilter 格式化日期为 yyyy-MM-dd 格式\n\t\t *   \n\t\t * @param {object|string|number} date  日期对象、合法的日期字符串、时间戳\n\t\t * @param {number} dayOffset  与传入日期的天数差\n\t\t * @returns {stirng}\n\t\t */\n\t\tfunction formatDate(date, dayOffset){\n\t\t  date = date || new Date();\n\n\t\t  if(dayOffset) {\n\t\t    date = +date + dayOffset * DAY_MILLISECOND;\n\t\t  }\n\n\t\t  return dateFilter(date, DATE_FORMAT);\n\t\t}\n\n\t\treturn formatDate;\n\t}\n])\n\n.filter('calendarTime', [\n\t'$filter',\n\t'DAY_MILLISECOND',\n\t'TIME_FORMAT',\n\n\tfunction($filter, DAY_MILLISECOND, TIME_FORMAT){\n\t\t/**\n\t\t * @ngdoc method\n\t\t * @name CalendarUtil#formatTime\n\t\t * @description\n\t\t *   使用 dateFilter 格式化日期为 HH:mm 格式\n\t\t *   \n\t\t * @param {object} date  日期对象\n\t\t * @param {number} minuteOffset  与传入日期的天数差\n\t\t * @returns {stirng}\n\t\t */\n\t\tfunction formatTime(date, minuteOffset){\n\t\t  date = date || new Date();\n\n\t\t  if(minuteOffset) {\n\t\t    date = +date + minuteOffset * DAY_MILLISECOND / 1440;\n\t\t  }\n\n\t\t  return dateFilter(date, TIME_FORMAT);\n\t\t}\n\t}\n])\n\n","/**\n * @!ngdoc module\n * @name calendar.services\n * @description\n *   Calendar\n *   日程模块相关服务\n */\nangular.module('calendar.services', [])\n\n/**\n * @ngdoc service\n * @name calendar.services.Calendar\n * @description\n * 日程模块的一些数据处理函数，数据持续化功能\n */\n.factory('Calendar', function($http, $filter, $ionicLoading, $cacheFactory, Settings, CalendarUtil){\n\n    var moduleUrl = Settings.rootUrl + \"/calendar\";\n    var cache = $cacheFactory('calendars');\n    var dateFilter = $filter('date');\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.Calendar#fetch\n     * @methodOf  calendar.services.Calendar\n     * @description\n     *   获取日程列表数据，目前 fetch 获取的是由本月和下月日程的数据\n     * @returns {object}\n     */\n    function fetch(params){\n\n      $ionicLoading.show();\n\n      var httpPromise = $http.get(moduleUrl, {\n          params: params,\n          transformResponse: function(){\n            var data =  $http.defaults.transformResponse[0].apply(null, arguments);\n            data.events = CalendarUtil.parseEvents(data.events);\n            return data;\n          }\n        })\n        .success(function(data){\n          // if(data.events){\n          //   cache.put('events', data.events);\n          // }\n        })\n        .error(Settings.requestError)\n        .success($ionicLoading.hide)\n        .error($ionicLoading.hide)\n\n      return httpPromise;\n    }\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.Calendar#get\n     * @methodOf  calendar.services.Calendar\n     * @description\n     *   获取指定 ID 的日程数据\n     * @param {String|Number} id         日程 ID\n     * @param  {Boolean} fromCache       是否优先从缓存集合中读取\n     * @returns {object}                 日程数据\n     */  \n    function get(id, fromCache){\n      var ret;\n      // if(fromCache){\n\n      //   return;\n      // } \n      \n      $ionicLoading.show();\n      return $http.get(moduleUrl + '/show', {\n        params: { id: id },\n        transformResponse: function(){\n          var data =  $http.defaults.transformResponse[0].apply(null, arguments);\n          return CalendarUtil.parseEvent(data);\n        }\n      })\n      .error(Settings.requestError)\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n    }\n    \n    /**\n     * @ngdoc method\n     * @name      calendar.services.Calendar#formatSubmitData\n     * @methodOf  calendar.services.Calendar\n     * @description\n     *   格式化表单数据为后端可用的数据格式\n     *   由于后端代码比较老旧，其命名规则及数据格式都不符合现在的规范\n     *   在重构之前需要使用此函数做转化\n     *\n     * @param {object} data 表单数据\n     * @returns {object}\n     */\n    function formatSubmitData(data){\n\n      // 全天日程时，不计算时分\n      if(data.isalldayevent == 1) {\n        data.startTime = data.endTime = \"00:00\";\n      // 非全天日程时，结束日期与开始日期相同\n      } else {\n        data.endDate = data.startDate;\n      }\n\n      var startDatetime = CalendarUtil.formatDate(data.startDate) + ' ' + CalendarUtil.formatTime(data.startTime);\n      var endDatetime =  CalendarUtil.formatDate(data.endDate) + ' ' + CalendarUtil.formatTime(data.endTime);\n\n      return {\n        calendarId:          data.calendarid,\n        CalendarTitle:       data.subject,\n        Subject:             data.subject,\n        Category:            data.category,\n        IsAllDayEvent:       +data.isalldayevent,\n        CalendarStartTime:   startDatetime,\n        CalendarStartTimeed: startDatetime,\n        CalendarEndTime:     endDatetime,\n        CalendarEndTimeed:   endDatetime\n      }\n    }\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.Calendar#create\n     * @methodOf  calendar.services.Calendar\n     * @description\n     *   创建一条日程并同步到持续层\n     * @param {object} data 日程相关数据，[必要字段包括CalendarTitle, Category, IsAllDayEvent, CalendarStartTime, CalendarEndTime]\n     * @returns {object} $http post 返回的 promise 对象\n     */\n    function create(data){\n      return $http.post(moduleUrl + '/add', data)\n      .error(Settings.requestError)\n    }\n\n    function update(data){\n      return $http.post(moduleUrl + '/edit', data)\n      .error(Settings.requestError)\n    }\n\n    function finish(calendar){\n      return $http.post(moduleUrl + '/edit&op=finish', calendar);\n    }\n\n    function unfinish(calendar){\n      return $http.post(moduleUrl + '/edit&op=nofinish', calendar);\n    }\n\n    function removeOne(id){\n      return $http.post(moduleUrl + '/del', {\n          calendarId: id,\n          doption: 'this'\n        }\n      )\n      .error(Settings.requestError)\n    }\n\n    return {\n      fetch: fetch,\n      get: get,\n      create: create,\n      update: update,\n      formatSubmitData: formatSubmitData,\n      finish: finish,\n      unfinish: unfinish,\n      removeOne: removeOne,\n      cache: cache\n    }\n})\n\n/**\n * @ngdoc service\n * @module calendar.services.CalendarUtil\n * @description\n *   日程相关工具函数\n */\n.factory('CalendarUtil', function($filter, DATE_FORMAT, TIME_FORMAT, DAY_MILLISECOND){\n    // 日程数据输入的时间格式形如/Date(1409803200000)/，需要匹配出正确的时间戳\n    var dateReg = /\\/Date\\((\\d+)\\)\\//;\n    var dateFilter = $filter('date');\n\n    function parseDateStr(dateStr){\n      var results = dateReg.exec(dateStr);\n      return results ? +results[1] : 0;\n    }\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.CalendarUtil#parseEvents\n     * @methodOf  calendar.services.CalendarUtil\n     * @description\n     *   格式化日程列表数据\n     *   目前后端返回日程数据时，列表的数据跟单条的数据格式差异太大\n     *   为避难混乱，以单条返回时的数据格式为准\n     *   {\n     *     calendarid:    \"9916\",\n     *     subject:       \"十六夜\"\n     *     isalldayevent: \"1\",\n     *     starttime:     \"1409500800000\",\n     *     endtime:       \"1409500800000\",\n     *     category:      \"4\",\n     *     status:        \"0\",\n     *     editable:      1\n     *   }\n     * @param {array} cEvts  原始日程数据\n     * @returns {array}\n     */\n    function parseEvents(cEvts){\n      var ret = [];\n      // 按日期分组，插入表示日期的数据\n      angular.forEach(cEvts, function(cEvt) {\n\n        // 由于周期性日程 id 具有特殊性，需要去除前11位字符\n        ret.push({\n          calendarid:     cEvt.type == '1' ? cEvt.id.substr(11) : cEvt.id,\n          // type == '1' 为周期性日程, '0' 为其他日程\n          instancetype:   cEvt.type,\n          subject:        cEvt.title,\n          isalldayevent:  cEvt.allDay,\n          starttime:      parseDateStr(cEvt.start),\n          endtime:        parseDateStr(cEvt.end),\n          category:       cEvt.category,\n          status:         cEvt.status,\n          editable:       cEvt.editable\n        })\n      });\n\n      return ret;\n    }\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.CalendarUtil#parseEvent\n     * @methodOf  calendar.services.CalendarUtil\n     * @description\n     *   格式化单条日程数据\n     *   主要处理时间戳不一致的问题\n     * @param {array} cEvt  原始日程数据\n     * @returns {array}\n     */\n    function parseEvent(cEvt){\n      return angular.extend(cEvt, {\n        starttime: cEvt.starttime ? +cEvt.starttime * 1000 : 0,\n        endtime: cEvt.endtime ? +cEvt.endtime * 1000: 0\n      });\n    }\n\n    function dayFormToday(date){\n      var now = new Date;\n        // 获取今天 0 时的 date 对象\n      var today = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);\n\n      var timeOffset = +date - +today;\n\n      return Math.floor(timeOffset / DAY_MILLISECOND);\n    }\n\n    // 将日程数据按日期排序并分组\n    function groupEvents(cEvts){\n      if(!cEvts || !cEvts.length) {\n        return cEvts;\n      }\n\n      var results = [];\n      var dateField = '';\n\n      // 排序，按开始时间倒序 \n      cEvts = cEvts.sort(function(a, b){\n        return b.starttime - a.starttime;\n      });\n\n      // 按日期分组，插入表示日期的数据\n      angular.forEach(cEvts, function(cEvt) {\n\n        var field = dateFilter(cEvt.starttime, DATE_FORMAT);\n\n        if(field !== dateField) {\n          results.push({\n            isDateField: true,\n            dateField: field,\n            startTime: cEvt.starttime,\n            dayFormToday: dayFormToday(cEvt.starttime)\n          });\n          dateField = field;\n        }\n\n        results.push(cEvt);\n      });\n\n      return results;\n    }\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.CalendarUtil#formatDate\n     * @methodOf  calendar.services.CalendarUtil\n     * @description\n     *   使用 dateFilter 格式化日期为 yyyy-MM-dd 格式\n     *   \n     * @param {object|string|number} date  日期对象、时间戳\n     * @param {number} dayOffset  与传入日期的天数差\n     * @returns {stirng}\n     */\n    function formatDate(date, dayOffset){\n      \n      if(!date) {\n        return '';\n      }\n\n      if(dayOffset) {\n        date = +date + dayOffset * DAY_MILLISECOND;\n      }\n\n      return dateFilter(date, DATE_FORMAT);\n    }\n\n    /**\n     * @ngdoc     method\n     * @name      calendar.services.CalendarUtil#formatTime\n     * @methodOf  calendar.services.CalendarUtil\n     * @description\n     *   使用 dateFilter 格式化日期为 HH:mm 格式\n     *   \n     * @param {object} date  日期对象\n     * @param {number} minuteOffset  与传入日期的天数差\n     * @returns {stirng}\n     */\n    function formatTime(date, minuteOffset){\n      if(!date) {\n        return '';\n      }\n\n      if(minuteOffset) {\n        date = +date + minuteOffset * DAY_MILLISECOND / 1440;\n      }\n\n      return dateFilter(date, TIME_FORMAT);\n    }\n\n    function parseTime(calendarData){\n      var startTime = new Date(calendarData.starttime),\n          endTime = new Date(calendarData.endtime);\n\n      return angular.extend({}, calendarData, {\n        startDate: startTime,\n        endDate: endTime,\n        startTime: startTime,\n        endTime: endTime\n      })\n    }\n\n    /**\n     * @ngdoc     method\n     * @name      calendar.services.CalendarUtil#getDateRange\n     * @methodOf  calendar.services.CalendarUtil\n     * \n     * @description\n     *   日程默认显示本月及下月的安排\n     *   此方法获取本月的开始日期和及下月的结束日期\n     *   \n     * @returns   {Object}   包含 startDate 和 endDate 两个属性 格式为 yyyy-MM-dd\n     */\n    function getDateRange() {\n      var now = new Date();\n      var year = now.getFullYear();\n      var month = now.getMonth();\n\n      // 计算下月 1 号\n      // 考虑跨年的情况\n      var startDate = new Date(year, month, 1, 0, 0, 0);\n      // 计算下两月 1 号再减一天\n      var endDate = new Date(new Date(\n        month == 10 ? year + 1: year,\n        month == 10 ? 0 : month + 2,\n        1, 0, 0, 0\n      ) - DAY_MILLISECOND)\n\n      return {\n        startDate: dateFilter(startDate, DATE_FORMAT),\n        endDate: dateFilter(endDate, DATE_FORMAT)\n      }\n    }\n\n    \n    /**\n     * @ngdoc     method\n     * @name      calendar.services.CalendarUtil#getCurrentDateTime\n     * @methodOf  calendar.services.CalendarUtil\n     * @description \n     *   获取当前日期和时分\n     * \n     * @returns   {Date}  日期对象\n     */\n    function getCurrentDateTime() {\n      var date = new Date();\n      date.setSeconds(0);\n      date.setMilliseconds(0);\n      return date;\n    }\n\n    return {\n      parseEvents: parseEvents,\n      groupEvents: groupEvents,\n      formatDate: formatDate,\n      formatTime: formatTime,\n      parseTime: parseTime,\n      parseEvent: parseEvent,\n      getDateRange: getDateRange,\n      getCurrentDateTime: getCurrentDateTime\n    };\n})\n\n/**\n * @ngdoc directive\n * @name calendar.services.directive:calenderColorpicker\n * @element ANY\n * @restrict E\n * @function\n * \n * @description\n *    日程颜色选择器\n *    日程的选色器没有通用性，所以这里为减少复杂度不提供对外接口\n */\n.directive('calenderColorpicker', function($ionicModal) {\n\n  var modalTemplate = '<ion-modal-view>' +\n    '<ion-header-bar>' +\n      '<button type=\"button\" class=\"button button-icon icon\" ng-click=\"hideColorPicker()\">取消</button>' +\n      '<h1 class=\"title\">选择日程颜色</h1>' +\n    '</ion-header-bar>' +\n    '<ion-content>' +\n      '<ion-list>' +\n        '<ion-item ng-repeat=\"color in colors\" ng-click=\"selectColor($index)\" style=\"background-color: {{color}}\">&nbsp;</ion-item>' +\n      '</ion-list>' +\n      '</ion-content>' +\n  '</ion-modal-view>';\n\n  return {\n    restrict: 'E',\n    replace: true,\n    require: '?ngModel',\n    scope: true,\n    // transclude: true,\n    \n    template:\n      '<div class=\"calendar-colorpicker-toggle\">' +\n          '<input type=\"hidden\">' +\n      '</div>',\n\n    compile: function(element, attr) {\n      // 过继各种有效属性到内部的 input\n      var input = element.find('input');\n\n      angular.forEach({\n        'name': attr.name,\n        'ng-value': attr.ngValue,\n        'ng-model': attr.ngModel,\n        'ng-disabled': attr.ngDisabled,\n        'ng-change': attr.ngChange\n      }, function(value, name) {\n        if (angular.isDefined(value)) {\n          input.attr(name, value);\n        }\n      });\n\n      // Link\n      return function($scope, elem, attrs){\n        var modal = $ionicModal.fromTemplate(modalTemplate, {\n          scope: $scope,\n          animation: 'slide-in-up'\n        });\n\n        var ngModelController = angular.element(input).controller('ngModel');\n\n        elem.on('click', function(){\n          modal.show();\n        });\n\n        $scope.colors = ['#3497DB', '#A6C82F', '#F4C73B', '#EE8C0C', '#E76F6F', '#AD85CC', '#98B2D1', '#82939E'];\n\n        $scope.colorpickerModal = modal;\n\n        $scope.showColorPicker = function() {\n          $scope.colorpickerModal.show();\n        };\n\n        $scope.hideColorPicker = function() {\n          $scope.colorpickerModal.hide();\n        };\n\n        $scope.$on('$destroy', function() {\n          $scope.colorpickerModal.remove();\n        });\n\n        $scope.selectColor = function(index) {\n          ngModelController.$setViewValue(index);\n          $scope.hideColorPicker();\n        }\n      }\n    }\n  };\n})\n\n/**\n * @ngdoc directive\n * @name calendar.services.directive:currentDate\n * @element ANY\n * @restrict A\n * @function\n * \n * @description\n *    滚动至当前日期\n */\n.directive('currentDate', function($ionicPosition, $ionicScrollDelegate){\n\n  return {\n    restrict: 'A',\n\n    compile: function(element, attr) {\n      // Link\n      return function($scope, elem, attrs){\n        $ionicScrollDelegate.scrollTo(0, $ionicPosition.position(elem).top || 0)\n      }\n    }\n  };\n})\n","/**\n * @ngdoc module\n * @name contacts\n * @description\n *   通讯录模块入口\n */\n\nangular.module('contacts', ['ionic', 'contacts.controllers','contact.services'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'contacts', title: '通讯录', route: '#/contacts', state: 'contacts.list', icon: 'img/modicon/contacts.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider) {\n\n  $urlRouterProvider.when('/contacts', '/contacts/list/')\n\n  $stateProvider\n\n  .state('contacts', {\n    url: \"/contacts\",\n    abstract: true,\n    template: '<ion-nav-view name=\"contacts\"></ion-nav-view>',\n    resolve: {\n      user: function(User) {\n        if(!User.isLogin) return User.login();\n      }\n    }\n  })\n\n  .state('contacts.list', {\n    url: '/list/:deptid',\n    talkingDataLabel: '通讯录-首页',\n    views: {\n      'contacts': {\n        templateUrl: 'templates/contacts/contacts.html',\n        controller: 'ContactsCtrl',\n      }\n    }\n\n  })\n\n  .state('contacts.detail', {\n    url: '/detail/:id',\n    talkingDataLabel: '通讯录-查看页',\n    views: {\n      'contacts': {\n        templateUrl: 'templates/contacts/contacts-detail.html',\n        controller: 'ContactsDetailCtrl',        \n      }\n    }\n  })\n    .state('contacts.group', {\n      url: '/group/:id',\n      talkingDataLabel: '通讯录-分组查看页',\n      views: {\n        'contacts': {\n          templateUrl: 'templates/contacts/contact-group-detail.html',\n          controller: 'ContactsGroupDetailCtrl',\n        }\n      }\n    })\n\n});","/**\n * @ngdoc module\n * @name contacts.controllers\n * @description\n *   通讯录模块控制器\n */\nangular.module('contacts.controllers', [])\n\n/**\n * @ngdoc controller\n * @name ContactsCtrl\n * @module contacts.controllers\n * @description\n *   列表页控制器\n */\n  .controller('ContactsCtrl', function($scope, $ionicLoading, $stateParams, $ionicHistory, $ionicScrollDelegate, $ionicModal, $state, $q, IbPopup, SearchModal, Contact){\n    var $ionContent = angular.element(document.querySelector('ion-content'));\n    var popupPromise;\n    function getDeptList(params) {\n      $ionicLoading.show();\n      Contact.getDeptList(params).success(function(res) {\n        if(res.isSuccess) {\n          $scope.deptInfo = res.data;\n          $scope.categories  = res.data.depts;\n          $scope.currentCategory = $scope.deptInfo;\n          var deptid = res.data.deptid;\n          if(deptid == '0'){\n            $scope.currentCategory.title = '通讯录';\n          } else {\n            $scope.categorys = $scope.deptInfo.crumb;\n          }\n\n        } else {\n          if(popupPromise && popupPromise.$$state.status === 0) return;\n          popupPromise = IbPopup.alert({ title: res.msg }).then(function(){\n            $ionicHistory.goBack();\n          });\n        }\n      })\n        .finally($ionicLoading.hide)\n    }\n\n    function getUserList(params) {\n      $ionicLoading.show();\n      Contact.getUserList(params).success(function(res) {\n        if(res.isSuccess) {\n          $scope.users = res.data;\n        } else {\n          if(popupPromise && popupPromise.$$state.status === 0) return;\n          popupPromise = IbPopup.alert({ title: res.msg });\n        }\n      })\n        .finally($ionicLoading.hide)\n    }\n\n    var deptid = $stateParams.deptid || 0;\n\n    getDeptList({ deptid: deptid });\n    getUserList({ deptid: deptid });\n\n    $scope.enterCategory = function(category) {\n      $state.go('contacts.list', category);\n    };\n\n    //去到某一个分类\n    $scope.toCategory = function(category){\n      var page = category - ($scope.categorys.length );\n      $ionicHistory.goBack(page);\n    };\n\n    $scope.search = new SearchModal({\n      scope: $scope,\n      searchFunc: function(params){\n        return Contact.search({\n          search: params.key,\n          deptid: $scope.deptInfo.deptid\n        });\n      }\n    });\n\n    //滚动固定面包屑\n    $scope.showsearchbar = true;\n\n    function onScroll(evt) {\n      var distance = evt.detail.scrollTop;\n      $scope.$applyAsync(function() {\n        $scope.showsearchbar = distance > 44 ? false : true;\n      });\n    }\n\n    $scope.$on('$ionicView.enter', function() {\n      $ionContent.on('scroll', onScroll);\n    });\n    $scope.$on('$ionicView.leave', function() {\n      $ionContent.off('scroll', onScroll);\n    });\n\n    // 监听路径历史，自动将面包屑滚动到末端\n    var breadcrumbScrollInstance = $ionicScrollDelegate.$getByHandle('contact-breadcrumb-scroll');\n    $scope.$watchCollection('histories', function() {\n      breadcrumbScrollInstance.scrollBottom(true);\n    });\n\n  })\n\n  .controller('ContactsDetailCtrl', function($scope, $stateParams, $ionicLoading, $state, IbPopup, Contact){\n    $ionicLoading.show();\n    $scope.user = [];\n    Contact.getUserInfo($stateParams.id).success(function(res) {\n      res.isSuccess ? $scope.user = res.data : IbPopup.alert({ title: res.msg });\n    })\n      .finally($ionicLoading.hide)\n  })\n\n  .controller('ContactsGroupDetailCtrl', function($scope, $stateParams, $ionicLoading, IbPopup, Contact){\n    var deptId = $stateParams.id;\n\n    //deptId 当前部门 id，如果为公司，该值为 0；\n    if(deptId !== '0'){\n      $ionicLoading.show();\n      $scope.dept = [];\n      Contact.getDeptInfo(deptId).success(function(res) {\n        res.isSuccess ? $scope.dept = res.data : IbPopup.alert({ title: res.msg });\n      })\n        .finally($ionicLoading.hide)\n    } else {\n      $ionicLoading.show();\n      $scope.corp = [];\n      Contact.getCorpInfo().success(function(res) {\n        res.isSuccess ? $scope.corp = res.data : IbPopup.alert({ title: res.msg });\n      })\n        .finally($ionicLoading.hide);\n    }\n\n  });","/**\n * @ngdoc service\n * @name contact.services.Contact\n * @description\n *   通讯录通用服务\n */\n\nangular.module('contact.services', [])\n\n  .factory('Contact', function($http,$ionicLoading, Settings) {\n    var moduleUrl = Settings.hostUrl + '?r=contact/api';\n\n    return {\n      /*\n       * @ngdoc    method\n       * @name     contact.services.Contact#getDeptList\n       * @methodOf contact.services.Contact\n       * @description\n       *    获取部门列表\n       *    `params.deptid`  {string}  部门 id\n       * @param   {object}         params  查询参数\n       * @returns {httppromise}    httppromise\n       */\n      getDeptList : function(params) {\n        return $http.get(moduleUrl + '/deptlist', { params: params })\n      },\n\n      /**\n       * @ngdoc    method\n       * @name     contact.services.Contact#getUserList\n       * @methodOf contact.services.Contact\n       * @description\n       *    获取用户列表\n       *    `params.deptid`  {string}  部门 id\n       * @param   {object}         params  查询参数\n       * @returns {httppromise}    httppromise\n       */\n      getUserList : function(params) {\n        return $http.get(moduleUrl + '/userlist', { params: params })\n      },\n\n      /**\n       * @ngdoc    method\n       * @name     contact.services.Contact#search\n       * @methodOf contact.services.Contact\n       * @description\n       *    搜索用户，包含子部门\n       *    `params.deptid`  {string}  部门 id\n       * @param   {object}         params  查询参数\n       * @returns {httppromise}    httppromise\n       */\n      search: function(params) {\n        return $http.get(moduleUrl + '/search', { params: params })\n      },\n\n      /**\n       * @ngdoc    method\n       * @name     contact.services.Contact#getUserInfo\n       * @methodOf contact.services.Contact\n       * @description\n       *    获取用户信息\n       * @param   {String}         userid  用户ID\n       * @returns {httppromise}    httppromise\n       */\n      getUserInfo : function(userid) {\n        return $http.get(moduleUrl + '/user', { params: { userid : userid }})\n      },\n\n      /**\n       * @ngdoc    method\n       * @name     contact.services.Contact#getCorpInfo\n       * @methodOf contact.services.Contact\n       * @description\n       *    获取公司信息\n       * @returns {httppromise}    httppromise\n       */\n      getCorpInfo : function() {\n        return $http.get(moduleUrl + '/corp')\n      },\n\n      /**\n       * @ngdoc    method\n       * @name     contact.services.Contact#getDeptInfo\n       * @methodOf contact.services.Contact\n       * @description\n       *    获取部门信息\n       * @param   {String}         deptid  部门ID\n       * @returns {httppromise}    httppromise\n       */\n      getDeptInfo : function(deptid) {\n        return $http.get(moduleUrl + '/dept',{ params: { deptid : deptid }})\n      }\n    }\n  })\n\n","/**\n * @ngdoc module\n * @name CRM.controllers\n * @description\n *  CRM模块控制器\n */\n\nangular.module('crm.controllers', [])\n\n//CRM首页\n.controller('CRMIndexCtrl', function($scope, $state, $ionicLoading, $ionicModal, User, Utils, IbPopup, CRM, CRM_REPORT_TIMETYPES) {\n  $scope.CRM_REPORT_TIMETYPES = CRM_REPORT_TIMETYPES\n\n  $scope.reload = function() {\n    $scope.now = new Date()\n\n    $ionicLoading.show()\n    // 检查是否有权限访问 CRM\n    return User.getAuthority().success(function(res) {\n      if (res.isSuccess) {\n        if (res.data.crm) {\n          $scope.target = {}\n          $scope.stage = {}\n          $scope.todayReport = {}\n          \n          $ionicModal.fromTemplateUrl('templates/crm/new-modal.html', {\n            scope: $scope,\n            animation: 'fade-in'\n          }).then(function(modal) {\n            modal.hideDelay = 1;\n            $scope.newModal = modal\n          })\n\n          var TIME_TODAY = 1\n\n          CRM.getReport({ time: TIME_TODAY }).success(function(res) {\n            if (res.isSuccess) {\n              $scope.todayReport = res.data\n            }\n          })\n\n          // 设置销售简报时间范围\n          $scope.setReportTimeType = function(timeType) {\n            $scope.reportTimeType = timeType;\n\n            CRM.getReport({ time: timeType }).success(function(res) {\n              if (res.isSuccess) {\n                $scope.report = res.data\n              }\n            })\n            .success(Utils.serverWarning)\n          };\n\n          $scope.setReportTimeType(CRM_REPORT_TIMETYPES[0].type);\n\n          var year = $scope.now.getFullYear()\n          var month = $scope.now.getMonth()\n\n          // 获取目标\n          // @Todo: 后端接口合并为一个\n          angular.forEach([\n            // 新增客户数\n            {\n              key: 'newClientCount',\n              type: 1\n            },\n            // 新增商机数\n            {\n              key: 'newOppCount',\n              type: 2\n            },\n            // 新增合同金额\n            {\n              key: 'newOppIncome',\n              type: 6\n            }\n          ], function(conf) {\n            CRM.getTarget({\n              uid: User.addPrefix(User.uid),\n              year: year,\n              type: conf.type\n            }).success(function(res) {\n              if(res.isSuccess && res.data && res.data.month && res.data.month.length) {\n                $scope.target[conf.key] = res.data.month[month]\n              }\n            })\n          })\n\n          // 获取商机详情\n          CRM.getOppSurvey().success(function(res) {\n            if(res.isSuccess) {\n              $scope.oppSurver = res.data\n              // $scope.stage.opportunity = res.data\n            }\n          })\n\n        } else {\n          Utils.promptNoPermission();\n        }\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally(function() {\n      $ionicLoading.hide()\n      $scope.$broadcast('scroll.refreshComplete')\n    })\n  }\n\n  // 业绩目标设置提示\n  $scope.showTargetSetupTip = function() {\n    IbPopup.alert({\n      title: '提示',\n      content: '<p class=\"text-center\" style=\"color:#666;\">业绩目标需在PC端进行设置<br>首页&gt;业绩目标&gt;设置业绩目标</p>'\n    })\n  }\n\n  $scope.reload()\n})\n\n//CRM联系人列表\n.controller('CRMContactCtrl', function($scope, dateFilter, groupByFilter, orderByFilter, Utils, SearchModal, CRMContact) {\n  $scope.tabs = [\n    {\n      text: '全部联系人',\n      value: 'all'\n    },\n    {\n      text: '我的联系人',\n      value: 'my'\n    },\n    {\n      text: '下属联系人',\n      value: 'sub'\n    },\n    {\n      text: '共享联系人',\n      value: 'share'\n    }\n  ];\n\n  $scope.onTab = function(tab) {\n    $scope.contactList.queryParams.range = tab.value\n    $scope.confirmFilters()\n  }\n\n  // 按名字、时间、公司排序\n  $scope.orderType = 'letter';\n  $scope.orderDesc = false;\n\n  function addOrderFieldToList(list) {\n    return list.map(function(item) {\n      // 增加用于分组的字段\n      item.letter = item.firstCase.charAt(0).toUpperCase();\n      item.formattedDate = dateFilter(item.createtime * 1000, 'yyyy-MM-dd');\n      item.company = item.company || '暂无';\n      return item;\n    });\n  }\n\n  // 获取联系人标签\n  CRMContact.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n    }\n  });\n\n  $scope.contactList = {\n    queryParams: {\n      limit: 10000,\n      order: {\n        'name': 1\n      }\n    },\n    load: function() {\n      var that = this;\n      this.loading = true;\n      CRMContact.list(that.queryParams).success(function(res) {\n          if (res.isSuccess) {\n            that.list = addOrderFieldToList(res.data.list)\n            that.total = res.data.total;\n          }\n        })\n        .success(Utils.serverWarning)\n        .finally(function() {\n          that.loading = false;\n          $scope.$broadcast('scroll.refreshComplete');\n        });\n    },\n    reset: function() {\n      this.list = [];\n      this.total = 0;\n      this.loading = false;\n      this.hasMore = true;\n    },\n    reload: function() {\n      this.reset();\n      this.load();\n    }\n  };\n\n  // 搜索联系人\n  $scope.search = new SearchModal({\n    scope: $scope,\n    templateUrl: 'templates/crm/contact-search-modal.html',\n    searchFunc: function(params) {\n      return CRMContact.list({\n        keyword: params.key\n      }).success(function(res) {\n        res.data.list = addOrderFieldToList(res.data.list)\n      });\n    }\n  });\n\n  //确定归属分类\n  $scope.confirmFilters = function() {\n    $scope.contactList.reload();\n  };\n})\n\n.controller('CRMContactFormCtrl', function($scope, $state, $window, $ionicLoading, $ionicHistory, $ionicScrollDelegate, $ionicModal, Utils, IbPopup, CRMContact, CRMUtils, DefaultBack) {\n  $scope.form = {};\n  $scope.stateName = $state.current.name;\n  $scope.isContactInfoShowed = false\n\n  // 获取联系人标签\n  CRMContact.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n      CRMUtils.initTagsToForm($scope.form, $scope.tagGroups);\n    }\n  });\n\n  $scope.selectClient = function() {\n    CRMUtils.openClientModal({\n      cid: $scope.form.client ? $scope.form.client.cid : '',\n      callback: function(client) {\n        $scope.form.client = client;\n      }\n    });\n  };\n\n  $scope.showContactInfo = function() {\n    $scope.isContactInfoShowed = true;\n    $ionicScrollDelegate.resize();\n  }; \n\n  $ionicModal.fromTemplateUrl('templates/crm/contact-way.html', {\n    scope: $scope\n  }).then(function(modal) {\n    $scope.contactWayModal = modal\n    modal.scope.contactWays = [\n      { type: 'mobile', text: '手机' },\n      { type: 'phone', text: '电话' },\n      { type: 'email', text: '邮箱' },\n      { type: 'qq', text: 'QQ' },\n      { type: 'weixin', text: '微信' },\n      { type: 'address', text: '地址' }\n    ]\n    modal.scope.select = function(item) {\n      console.log(item)\n    }\n  })\n\n  $scope.onSubmitSuccess = function(contactid) {\n    $ionicHistory.clearCache(['crm.contact'])\n    IbPopup.tip($scope.stateName === 'crm.addContact' ? '新增成功' : '编辑成功', 'success')\n    .then(function() {\n      $scope.contactForm.$setPristine()\n      $state.go('crm.contactView', { contactid: contactid }, { location: 'replace' })\n    });\n  };\n\n  $scope.relatedClient = function(contactid, cid) {\n    CRMContact.related({\n        type: 'client',\n        contactid: contactid,\n        cid: cid\n      })\n      .success(function(res) {\n        if (res.isSuccess) {\n          $scope.onSubmitSuccess(contactid);\n        } else {\n          IbPopup.alert({\n            title: '关联客户失败 ' + res.msg\n          });\n        }\n      });\n  };\n\n  $scope.submit = angular.noop;\n\n  Utils.checkFormDirtyBeforeLeave($scope, 'contactForm')\n})\n\n//CRM-添加联系人\n.controller('CRMAddContactCtrl', function($scope, $ionicHistory, $stateParams, $controller, $ionicLoading, Utils, CRMContact, CRMUtils) {\n\n  $controller('CRMContactFormCtrl', {\n    $scope: $scope\n  });\n\n  if ($stateParams.client) {\n    $scope.form.client = $stateParams.client;\n  }\n\n  $scope.form.gender = '0';\n\n  $scope.submit = function() {\n    $ionicLoading.show();\n    CRMContact.create(CRMUtils.buildContactFormData($scope.form))\n      .success(function(res) {\n        if (res.isSuccess) {\n          $scope.relatedClient(res.data.contactid, $scope.form.client.cid);\n        }\n      })\n      .success(CRMUtils.formValidateError)\n      .finally($ionicLoading.hide);\n  };\n})\n\n//CRM-编辑联系人\n.controller('CRMEditContactCtrl', function($scope, $controller, $stateParams, $ionicLoading, Utils, CRMContact, CRMUtils) {\n  $controller('CRMContactFormCtrl', {\n    $scope: $scope\n  });\n\n  var _oldClient;\n  // 获取联系人信息\n  $ionicLoading.show();\n  CRMContact.view($stateParams)\n    .success(function(res) {\n      if (res.isSuccess) {\n        $scope.form = res.data;\n        $scope.form.birthday = res.data.birthday == '0' ? '' : new Date(res.data.birthday * 1000);\n        CRMUtils.setTagsToForm($scope.form, res.data.tags);\n        _oldClient = $scope.form.client;\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  $scope.submit = function() {\n    $ionicLoading.show();\n\n    CRMContact.update(CRMUtils.buildContactFormData($scope.form))\n      .success(function(res) {\n        if (res.isSuccess) {\n          if ($scope.form.client && $scope.form.client !== _oldClient) {\n            $scope.relatedClient($stateParams.contactid, $scope.form.client.cid);\n          } else {\n            $scope.onSubmitSuccess($stateParams.contactid);\n          }\n        }\n      })\n      .success(CRMUtils.formValidateError)\n      .finally($ionicLoading.hide);\n  }\n\n  $scope.removeContact = function() {\n    CRMUtils.confirmRemoveContact($stateParams)\n  }\n})\n\n//CRM-联系人详情\n.controller('CRMContactViewCtrl', function($scope, $state, $stateParams, $ionicLoading, $ionicActionSheet, $ionicHistory, Utils, CRMContact, CRMUtils) {\n  $ionicLoading.show();\n  CRMContact.view($stateParams).success(function(res) {\n      if (res.isSuccess) {\n        $scope.contact = res.data;\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n})\n\n//CRM客户\n.controller('CRMClientCtrl', function($scope, $ionicScrollDelegate, $stateParams, $controller, SearchModal, Utils, CRMClient) {\n  $scope.filterGroups = [\n    {\n      groupName: '创建时间',\n      groupKey: 'clientList.queryParams.createtime',\n      items: [\n        {\n          text: '不限',\n          value: '0'\n        },\n        {\n          text: '今天',\n          value: '1'\n        },\n        {\n          text: '昨天',\n          value: '2'\n        },\n        {\n          text: '本周',\n          value: '3'\n        },\n        {\n          text: '上周',\n          value: '4'\n        },\n        {\n          text: '本月',\n          value: '5'\n        },\n        {\n          text: '上月',\n          value: '6'\n        }\n      ],\n      selected: 0\n    },\n    {\n      groupName: '跟进时间',\n      groupKey: 'clientList.queryParams.lasteventtime',\n      items: [\n        {\n          text: '不限',\n          value: '0'\n        },\n        {\n          text: '今天',\n          value: '1'\n        },\n        {\n          text: '昨天',\n          value: '2'\n        },\n        {\n          text: '本周',\n          value: '3'\n        },\n        {\n          text: '上周',\n          value: '4'\n        },\n        {\n          text: '本月',\n          value: '5'\n        },\n        {\n          text: '上月',\n          value: '6'\n        }\n      ],\n      selected: 0\n    }\n  ]\n  $scope.selectFilterItem = function(item, filterGroup) {\n    $scope.$eval(filterGroup.groupKey + '=\"' + item.value + '\"')\n    $scope.clientList.reload()\n  }\n\n  // 获取客户标签\n  // @Todo: 目前标签的过滤结果是合集，需要后端修改为交集\n  // CRMClient.tagList().success(function(res) {\n  //   if (res.isSuccess) {\n  //     angular.forEach(res.data, function(tagGroup, index) {\n  //       var groupKey = 'clientList.queryParams.tags[' + tagGroup.groupid + ']'\n  //       var items = tagGroup.taglist.map(function(tag) {\n  //         return {\n  //           text: tag.name,\n  //           value: tag.tagid\n  //         }\n  //       })\n  //       var filterGroup = {\n  //         groupName: tagGroup.name,\n  //         groupKey: groupKey,\n  //         items: items,\n  //         selected: 0\n  //       }\n\n  //       items.unshift({\n  //         text: '不限',\n  //         value: ''\n  //       })\n\n  //       $scope.filterGroups.splice(index, 0, filterGroup)\n  //     })\n  //   }\n  // });\n\n  $scope.clientList = {\n    list: [],\n    queryParams: {\n      range: 'all',\n      tags: {},\n      createtime: '0',\n      lasteventtime: '0'\n    },\n    hasMore: true,\n    load: function() {\n      var that = this;\n      that.loading = true;\n      that.queryParams.offset = that.list.length;\n\n      CRMClient.list(that.queryParams).success(function(res) {\n          if (res.isSuccess) {\n            Utils.concatTo(that.list, res.data.list);\n            that.total = res.data.total;\n            that.hasMore = that.total > that.list.length;\n            $ionicScrollDelegate.resize();\n          }\n        })\n        .success(Utils.serverWarning)\n        .finally(function() {\n          that.loading = false;\n          $scope.$broadcast('scroll.refreshComplete');\n        });\n    },\n    reset: function() {\n      this.list = [];\n      this.total = 0;\n      this.loading = false;\n      this.hasMore = true;\n    },\n    reload: function() {\n      this.reset();\n      this.load();\n    }\n  };\n\n  // 搜索客户\n  $scope.search = new SearchModal({\n    scope: $scope,\n    templateUrl: 'templates/crm/client-search-modal.html',\n    searchFunc: function(params) {\n      return CRMClient.list({\n        keyword: params.key\n      });\n    }\n  });\n\n  $scope.tabs = [\n    {\n      text: '全部客户',\n      value: 'all'\n    },\n    {\n      text: '我的客户',\n      value: 'my'\n    },\n    {\n      text: '下属客户',\n      value: 'sub'\n    },\n    {\n      text: '久未联系',\n      value: 'estranged'\n    },\n    {\n      text: '共享客户',\n      value: 'share'\n    }\n  ]\n\n  $scope.onTab = function(tab) {\n    $scope.clientList.queryParams.range = tab.value\n    $scope.confirmFilters()\n  }\n\n  //确定归属分类\n  $scope.confirmFilters = function() {\n    $scope.clientList.reload();\n  };\n})\n\n//CRM-客户表单基础控制器\n.controller('CRMClientFormCtrl', function($scope, $state, $window, $ionicLoading, $ionicHistory, mapFilter, Utils, IbPopup, CRMContact, CRMClient, CRMUtils, DefaultBack) {\n  $scope.form = {};\n  $scope.stateName = $state.current.name;\n\n  $scope.$on('$ionicView.enter', function() {\n    var contact = JSON.parse($window.sessionStorage.getItem('crm.addcontact'));\n    if (contact) {\n      $window.sessionStorage.removeItem('crm.addcontact')\n      $scope.form.contacts = $scope.form.contacts || [];\n      $scope.form.contacts.push(contact);\n    }\n  })\n\n  function getContactIds() {\n    return $scope.form.contacts && $scope.form.contacts.length ? mapFilter($scope.form.contacts, 'contactid') : [];\n  }\n\n  // 绑定联系人\n  $scope.attachContact = function() {\n    CRMUtils.openContactModal({\n      params: {\n        type: 'client'\n      },\n      selected: getContactIds(),\n      callback: function(selected) {\n        $scope.form.contacts = selected;\n      }\n    })\n  };\n\n  // 解绑联系人\n  $scope.detachContact = function(contact) {\n    Utils.eliminate($scope.form.contacts, contact);\n  };\n\n  $scope.submitAttachContact = function(cid) {\n    return CRMContact.related({\n      type: 'client',\n      cid: cid,\n      contactid: getContactIds()\n    });\n  };\n\n  $scope.submitPromise = function(promise) {\n    $ionicLoading.show();\n    return promise.success(function(res) {\n        if (res.isSuccess) {\n          $ionicHistory.clearCache(['crm.client'])\n          $scope.submitAttachContact(res.data.cid)\n          $scope.clientForm.$setPristine()\n        }\n      })\n      .success(CRMUtils.formValidateError)\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide);\n  };\n\n  // 获取客户标签\n  CRMClient.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n      CRMUtils.initTagsToForm($scope.form, $scope.tagGroups);\n    }\n  });\n\n  Utils.checkFormDirtyBeforeLeave($scope, 'clientForm')\n})\n\n//CRM-添加客户信息\n.controller('CRMAddClientCtrl', function($scope, $state, $stateParams, $controller, $ionicScrollDelegate, IbPopup, CRMClient) {\n  $controller('CRMClientFormCtrl', {\n    $scope: $scope\n  });\n  $scope.isClientInfoShowed = false;\n\n  $scope.addMoreInfo = function() {\n    $scope.isClientInfoShowed = true;\n    $ionicScrollDelegate.resize();\n  };\n\n  $scope.submit = function() {\n    $scope.submitPromise(CRMClient.create($scope.form))\n      .success(function(res) {\n        if (res.isSuccess) {\n          IbPopup.tip('新增成功', 'success').then(function() {\n            $state.go('crm.clientView', res.data, { location: 'replace' })\n          })\n        }\n      });\n  }\n})\n\n//CRM-编辑客户信息\n.controller('CRMEditClientCtrl', function($scope, $window, $controller, $ionicLoading, $stateParams, Utils, IbPopup, CRMClient, CRMUtils) {\n  $controller('CRMClientFormCtrl', {\n    $scope: $scope\n  });\n  $scope.isClientInfoShowed = true;\n\n  $ionicLoading.show();\n  CRMClient.view($stateParams)\n    .success(function(res) {\n      if (res.isSuccess) {\n        $scope.form = res.data;\n        CRMUtils.setTagsToForm($scope.form, res.data.tags);\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  $scope.removeClient = function() {\n    CRMUtils.confirmRemoveClient($stateParams);\n  }\n\n  $scope.submit = function() {\n    $scope.submitPromise(CRMClient.update($scope.form))\n      .success(function(res) {\n        if (res.isSuccess) {\n          IbPopup.tip('编辑成功', 'success').then(function() {\n            $window.history.back()\n          });\n        }\n      });\n  };\n})\n\n//CRM-客户详情页\n.controller('CRMClientViewCtrl', function($scope, $state, $stateParams, $ionicLoading, $ionicActionSheet, $ionicHistory, mapFilter, Utils, CRMClient, CRMEvent, CRMOpportunity, CRMUtils) {\n\n  $ionicLoading.show();\n  CRMClient.view($stateParams)\n    .success(function(res) {\n      if (res.isSuccess) {\n        $scope.client = res.data;\n        CRMUtils.setTagsToForm($scope.client, res.data.tags);\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  // 获取客户标签\n  CRMClient.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n    }\n  });\n\n  $scope.activeTab = 'survey';\n\n  function loadRelatedEvent() {\n    if ($scope.eventListLoaded) return;\n    $ionicLoading.show();\n    CRMEvent.list({\n        cid: $stateParams.cid,\n        limit: 10000\n      })\n      .success(function(res) {\n        if (res.isSuccess) {\n          $scope.eventList = res.data.list;\n          $scope.eventListLoaded = true;\n        }\n      })\n      .success(Utils.serverWarning)\n      .finally($ionicLoading.hide);\n  }\n\n  function loadRelatedOpportunity() {\n    if ($scope.oppListLoaded) return;\n    $ionicLoading.show();\n    CRMOpportunity.list({\n        cid: $stateParams.cid,\n        limit: 10000\n      })\n      .success(function(res) {\n        if (res.isSuccess) {\n          $scope.oppList = res.data.list;\n          $scope.oppListLoaded = true;\n        }\n      })\n      .success(Utils.serverWarning)\n      .finally($ionicLoading.hide);\n  }\n\n  $scope.setClientTab = function(type) {\n    $scope.activeTab = type || 'survey';\n    if (type == 'event') {\n      loadRelatedEvent();\n    } else if (type == 'opportunity') {\n      loadRelatedOpportunity();\n    }\n  };\n\n  // 打开新建关联数据窗口\n  $scope.openAttachModal = function() {\n    $scope.__attachOpts = {\n      params: {\n        client: $scope.client\n      }\n    };\n    CRMUtils.openAttachModal($scope);\n  };\n\n  // 关联联系人\n  $scope.selectContact = function() {\n    CRMUtils.selectContactToClient($stateParams.cid, $scope.client.contacts ? mapFilter($scope.client.contacts, 'contactid') : [], function(res) {\n      if (res.isSuccess) {\n        $ionicHistory.clearCache([$state.current.name]).then($state.reload);\n      }\n    });\n  };\n\n  // // 当选择标签时更新数据\n  // $scope.onTagChange = function() {\n  //   CRMClient.update($scope.client).success(function(res) {\n  //     if (res.isSuccess) {\n  //       $ionicHistory.clearCache(['crm.client']);\n  //     }\n  //   });\n  // };\n})\n\n//CRM-商机首页\n.controller('CRMOpportunityCtrl', function($scope, $ionicScrollDelegate, SearchModal, $stateParams, Utils, CRMOpportunity) {\n  $scope.filterGroups = [\n    {\n      groupName: '商机状态',\n      groupKey: 'oppList.queryParams.status',\n      items: [\n        {\n          text: '不限',\n          value: ''\n        },\n        {\n          text: '进行中',\n          value: '0'\n        },\n        {\n          text: '已成交',\n          value: '1'\n        },\n        {\n          text: '已失败',\n          value: '2'\n        }\n      ],\n      selected: 0\n    },\n    {\n      groupName: '创建时间',\n      groupKey: 'oppList.queryParams.createtime',\n      items: [\n        {\n          text: '不限',\n          value: '0'\n        },\n        {\n          text: '今天',\n          value: '1'\n        },\n        {\n          text: '昨天',\n          value: '2'\n        },\n        {\n          text: '本周',\n          value: '3'\n        },\n        {\n          text: '上周',\n          value: '4'\n        },\n        {\n          text: '本月',\n          value: '5'\n        },\n        {\n          text: '上月',\n          value: '6'\n        }\n      ],\n      selected: 0\n    },\n    {\n      groupName: '更新时间',\n      groupKey: 'oppList.queryParams.updatetime',\n      items: [\n        {\n          text: '不限',\n          value: '0'\n        },\n        {\n          text: '今天',\n          value: '1'\n        },\n        {\n          text: '昨天',\n          value: '2'\n        },\n        {\n          text: '本周',\n          value: '3'\n        },\n        {\n          text: '上周',\n          value: '4'\n        },\n        {\n          text: '本月',\n          value: '5'\n        },\n        {\n          text: '上月',\n          value: '6'\n        }\n      ],\n      selected: 0\n    }\n  ]\n  $scope.selectFilterItem = function(item, filterGroup) {\n    $scope.$eval(filterGroup.groupKey + '=\"' + item.value + '\"')\n    $scope.oppList.reload()\n  }\n\n  $scope.tabs = [\n  {\n    text: '全部商机',\n    value: 'all'\n  },\n  {\n    text: '我的商机',\n    value: 'my'\n  },\n  {\n    text: '下属商机',\n    value: 'sub'\n  },\n  {\n    text: '共享商机',\n    value: 'share'\n  }\n  ];\n\n  // 搜索客户\n  $scope.search = new SearchModal({\n    scope: $scope,\n    templateUrl: 'templates/crm/opportunity-search-modal.html',\n    searchFunc: function(params) {\n      return CRMOpportunity.list({\n        keyword: params.key\n      });\n    }\n  });\n\n  $scope.oppList = {\n    list: [],\n    queryParams: {\n      tags: {},\n      range: 'all',\n      createtime: '0',\n      updatetime: '0',\n      status: ''\n    },\n    hasMore: true,\n    load: function() {\n      var that = this;\n      that.loading = true;\n      that.queryParams.offset = that.list.length;\n\n      CRMOpportunity.list(that.queryParams).success(function(res) {\n          if (res.isSuccess) {\n            Utils.concatTo(that.list, res.data.list);\n\n            that.total = res.data.total;\n            that.hasMore = that.total > that.list.length;\n            \n            if ($stateParams.status) {\n              that.list = that.list.filter(function(item) {\n                return item.status === $stateParams.status\n              })\n            }\n            \n            $ionicScrollDelegate.resize();\n          }\n        })\n        .success(Utils.serverWarning)\n        .finally(function() {\n          that.loading = false;\n          $scope.$broadcast('scroll.refreshComplete');\n        });\n    },\n    reset: function() {\n      this.list = [];\n      this.total = 0;\n      this.loading = false;\n      this.hasMore = true;\n    },\n    reload: function() {\n      this.reset();\n      this.load();\n    }\n  };\n\n  if ($stateParams.tag) {\n    var tag = $stateParams.tag\n    var queryParams = $scope.oppList.queryParams\n    queryParams.range = 'my'\n    queryParams.tags[tag.groupid] = [tag.tagid];\n  }\n\n  $scope.onTab = function(tab) {\n    $scope.oppList.queryParams.range = tab.value\n    $scope.confirmFilters()\n  }\n\n  //确定归属分类\n  $scope.confirmFilters = function() {\n    $scope.oppList.reload();\n  };\n})\n\n//CRM-商机详情页\n.controller('CRMOpportunityViewCtrl', function($scope, $state, $stateParams, $ionicActionSheet, $ionicLoading, $ionicHistory, mapFilter, dateFilter, Utils, CRMOpportunity, CRMEvent, CRMUtils) {\n  $scope.activeTab = 'survey';\n\n  $ionicLoading.show();\n  CRMOpportunity.view($stateParams).success(function(res) {\n      if (res.isSuccess) {\n        $scope.opp = res.data;\n        $scope.opp.cid = res.data.client && res.data.client.cid ? res.data.client.cid : '';\n        $scope.opp.contactid = res.data.contacts ? mapFilter(res.data.contacts, 'contactid') : [];\n        CRMUtils.setTagsToForm($scope.opp, res.data.tags);\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  function clearOpportunityCache(res) {\n    if (res.isSuccess) $ionicHistory.clearCache(['crm.opportunity']);\n  }\n\n  // 打开新建关联数据窗口\n  $scope.openAttachModal = function() {\n    $scope.__attachOpts = {\n      newOpp: false,\n      newContact: false,\n      attachContact: $scope.opp.cid ? true : false,\n      params: {\n        client: $scope.opp.client,\n        opportunity: $scope.opp\n      }\n    };\n    CRMUtils.openAttachModal($scope);\n  };\n  // 关联联系人\n  $scope.selectContact = function() {\n    CRMUtils.openContactModal({\n      selected: $scope.opp.contactid,\n      params: {\n        type: 'opp',\n        cid: $scope.opp.cid || ''\n      },\n      callback: function(selected) {\n        $ionicLoading.show();\n        $scope.opp.contacts = selected;\n        $scope.opp.contactid = mapFilter(selected, 'contactid');\n        CRMOpportunity.update($scope.opp).finally($ionicLoading.hide);\n      }\n    });\n  };\n\n  function loadRelatedEvent() {\n    if ($scope.eventListLoaded) return;\n    $ionicLoading.show();\n    CRMEvent.list({\n        oid: $stateParams.oid,\n        limit: 10000\n      })\n      .success(function(res) {\n        if (res.isSuccess) {\n          $scope.eventList = res.data.list;\n          $scope.eventListLoaded = true;\n        }\n      })\n      .success(Utils.serverWarning)\n      .finally($ionicLoading.hide);\n  }\n\n  $scope.setActiveTab = function(tag) {\n    $scope.activeTab = tag;\n    if (tag === 'event') loadRelatedEvent();\n  };\n\n  // 获取商机标签\n  CRMOpportunity.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n    }\n  });\n})\n\n//CRM-商机表单\n.controller('CRMOpportunityFormCtrl', function($scope, $state, $ionicLoading, $ionicHistory, mapFilter, Utils, IbPopup, CRMOpportunity, CRMUtils, DefaultBack) {\n  $scope.form = {\n    dealchance: 0,\n    createtime: new Date()\n  };\n\n  $scope.isOppFormMoreShowed = false\n  $scope.showOppFormMore = function() {\n    $scope.isOppFormMoreShowed = true\n  }\n\n  $scope.stateName = $state.current.name;\n\n  // 关联联系人\n  $scope.attachContact = function() {\n    CRMUtils.openContactModal({\n      params: {\n        type: 'opp',\n        cid: $scope.form.cid\n      },\n      selected: $scope.form.contactid || [],\n      client: $scope.client,\n      callback: function(contacts) {\n        $scope.contacts = contacts;\n        $scope.form.contactid = mapFilter(contacts, 'contactid');\n      }\n    });\n  };\n\n  $scope.detachContact = function(contact) {\n    Utils.toggle($scope.contacts, contact)\n    $scope.form.contactid = mapFilter($scope.contacts, 'contactid');\n  }\n\n  // 关联客户\n  $scope.attachClient = function() {\n    CRMUtils.openClientModal({\n      cid: $scope.form.cid || '',\n      callback: function(client) {\n        $scope.client = client;\n        $scope.form.cid = client.cid;\n        $scope.contacts = [];\n        $scope.form.contactid = [];\n      }\n    });\n  };\n\n  $scope.submitPromise = function(promise) {\n    $ionicLoading.show();\n    return promise.success(function(res) {\n        if (res.isSuccess) {\n          $ionicHistory.clearCache(['crm.opportunity'])\n          $scope.oppForm.$setPristine()\n        }\n      })\n      .success(CRMUtils.formValidateError)\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide);\n  };\n\n  // 获取商机标签\n  CRMOpportunity.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n      CRMUtils.initTagsToForm($scope.form, $scope.tagGroups);\n    }\n  });\n\n  Utils.checkFormDirtyBeforeLeave($scope, 'oppForm')\n})\n\n//CRM-添加商机页\n.controller('CRMAddOpportunityCtrl', function($scope, $state, $stateParams, $controller, IbPopup, CRMOpportunity, CRMUtils) {\n  $controller('CRMOpportunityFormCtrl', {\n    $scope: $scope\n  });\n  if ($stateParams.client) {\n    $scope.client = $stateParams.client;\n    $scope.form.cid = $stateParams.client.cid;\n  }\n  $scope.submit = function() {\n    $scope.submitPromise(CRMOpportunity.create(CRMUtils.buildOpportunityFormData($scope.form)))\n    .success(function(res) {\n      if(res.isSuccess) {\n        IbPopup.tip('新增成功', 'success')\n        .then(function() {\n          $state.go('crm.opportunityView', res.data, { location: 'replace' })\n        })\n      }\n    })\n  };\n})\n\n//CRM-编辑商机页\n.controller('CRMEditOpportunityCtrl', function($scope, $window, $controller, $stateParams, $ionicLoading, Utils, mapFilter, currencyToNumberFilter, IbPopup, CRMOpportunity, CRMUtils) {\n  $controller('CRMOpportunityFormCtrl', {\n    $scope: $scope\n  });\n\n  $ionicLoading.show();\n  CRMOpportunity.view($stateParams).success(function(res) {\n      if (res.isSuccess) {\n        $scope.form = res.data;\n        $scope.form.createtime = new Date(res.data.createtime * 1000);\n        $scope.form.expectendtime = res.data.expectendtime && res.data.expectendtime != 0 ? new Date(res.data.expectendtime * 1000) : '';\n        // 格式化预计收入为数字\n        $scope.form.expectincome = $scope.form.expectincome ? currencyToNumberFilter($scope.form.expectincome) : ''\n        $scope.form.dealchance = +res.data.dealchance;\n        $scope.form.cid = res.data.client && res.data.client.cid ? res.data.client.cid : '';\n        $scope.form.contactid = res.data.contacts ? mapFilter(res.data.contacts, 'contactid') : [];\n        $scope.contacts = res.data.contacts;\n        $scope.client = res.data.client;\n        CRMUtils.setTagsToForm($scope.form, res.data.tags);\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  $scope.submit = function() {\n    $scope.submitPromise(CRMOpportunity.update(CRMUtils.buildOpportunityFormData($scope.form)))\n    .success(function(res) {\n      if(res.isSuccess) {\n        IbPopup.tip('编辑成功', 'success')\n        .then(function() {\n          $window.history.back()\n        });\n      }\n    })\n  };\n\n  $scope.removeOpp = function() {\n    CRMUtils.confirmRemoveOpportunity($stateParams);\n  }\n})\n\n// 事件首页\n.controller('CRMEventCtrl', function($scope, $ionicScrollDelegate, SearchModal, Utils, CRMEvent) {\n  $scope.filterGroups = [\n    {\n      groupName: '来源',\n      groupKey: 'eventList.queryParams.source',\n      items: [\n        {\n          text: '不限',\n          value: ''\n        },\n        {\n          text: '客户',\n          value: 'client'\n        },\n        {\n          text: '机会',\n          value: 'opportunity'\n        },\n        {\n          text: '合同',\n          value: 'contract'\n        }\n      ],\n      selected: 0\n    },\n    {\n      groupName: '跟进时间',\n      groupKey: 'eventList.queryParams.eventtime',\n      items: [\n        {\n          text: '不限',\n          value: '0'\n        },\n        {\n          text: '今天',\n          value: '1'\n        },\n        {\n          text: '昨天',\n          value: '2'\n        },\n        {\n          text: '本周',\n          value: '3'\n        },\n        {\n          text: '上周',\n          value: '4'\n        },\n        {\n          text: '本月',\n          value: '5'\n        },\n        {\n          text: '上月',\n          value: '6'\n        }\n      ],\n      selected: 0\n    }\n  ]\n  $scope.selectFilterItem = function(item, filterGroup) {\n    $scope.$eval(filterGroup.groupKey + '=\"' + item.value + '\"')\n    $scope.eventList.reload()\n  }\n\n  $scope.tabs = [{\n    text: '全部跟进',\n    value: 'all'\n  }, {\n    text: '我的跟进',\n    value: 'my'\n  }, {\n    text: '下属跟进',\n    value: 'sub'\n  }];\n\n  $scope.onTab = function(tab) {\n    $scope.eventList.queryParams.range = tab.value\n    $scope.confirmFilters()\n  }\n\n  $scope.eventList = {\n    list: [],\n    queryParams: {},\n    hasMore: true,\n    load: function() {\n      var that = this;\n      that.loading = true;\n      that.queryParams.offset = that.list.length;\n      CRMEvent.list(that.queryParams).success(function(res) {\n          if (res.isSuccess) {\n            Utils.concatTo(that.list, res.data.list);\n            that.total = res.data.total;\n            that.hasMore = that.total > that.list.length;\n            $ionicScrollDelegate.resize();\n          }\n        })\n        .success(Utils.serverWarning)\n        .finally(function() {\n          that.loading = false;\n          $scope.$broadcast('scroll.refreshComplete');\n        });\n    },\n    reset: function() {\n      this.list = [];\n      this.total = 0;\n      this.loading = false;\n      this.hasMore = true;\n    },\n    reload: function() {\n      this.reset();\n      this.load();\n    }\n  };\n\n  // 搜索客户\n  $scope.search = new SearchModal({\n    scope: $scope,\n    templateUrl: 'templates/crm/event-search-modal.html',\n    searchFunc: function(params) {\n      return CRMEvent.list({\n        keyword: params.key\n      });\n    }\n  });\n\n  //确定归属分类\n  $scope.confirmFilters = function() {\n    $scope.eventList.reload();\n  };\n\n  // 获取事件标签\n  CRMEvent.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n    }\n  });\n})\n\n// 事件表单\n.controller('CRMEventFormCtrl', function($scope, $state, $ionicLoading, $ionicHistory, mapFilter, IbPopup, Utils, CRMEvent, CRMUtils, DefaultBack) {\n  $scope.form = {};\n\n  $scope.stateName = $state.current.name;\n\n  // 关联客户\n  $scope.selectClient = function() {\n    CRMUtils.openClientModal({\n      cid: $scope.form.client ? $scope.form.client.cid : '',\n      // 清空\n      callback: function(client) {\n        if (client !== $scope.form.client) {\n          $scope.form.client = client;\n          $scope.form.cid = client.cid;\n          $scope.form.opportunity = null;\n          $scope.form.oid = '';\n          $scope.form.contacts = [];\n          $scope.form.contactid = [];\n        }\n      }\n    });\n  };\n\n  // 关联商机\n  $scope.selectOpportunity = function() {\n    CRMUtils.openOpportunityModal({\n      selected: $scope.form.oid || '',\n      params: {\n        cid: $scope.form.cid || ''\n      },\n      callback: function(selected) {\n        if (selected !== $scope.form.opportunity) {\n          $scope.form.opportunity = selected;\n          $scope.form.oid = selected.oid;\n          $scope.form.contacts = [];\n          $scope.form.contactid = [];\n        }\n      }\n    });\n  };\n\n  // 关联联系人\n  $scope.attachContact = function() {\n    CRMUtils.openContactModal({\n      selected: $scope.form.contactid,\n      params: {\n        type: 'event',\n        cid: $scope.form.cid || '',\n        oid: $scope.form.oid || ''\n      },\n      callback: function(selected) {\n        $scope.form.contacts = selected;\n        $scope.form.contactid = mapFilter(selected, 'contactid');\n      }\n    });\n  };\n\n  $scope.detachContact = function(contact) {\n    Utils.eliminate($scope.form.contacts, contact);\n    $scope.form.contactid = mapFilter($scope.form.contacts, 'contactid');\n  }\n\n  // 作为 promise 的包装函数\n  $scope.submitPromise = function(promise) {\n    $ionicLoading.show();\n    return promise.success(function(res) {\n        if (res.isSuccess) {\n          $ionicHistory.clearCache(['crm.event'])\n          $scope.eventForm.$setPristine()\n        }\n      })\n      .success(CRMUtils.formValidateError)\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n  };\n\n  // 获取事件标签\n  CRMEvent.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n      CRMUtils.initTagsToForm($scope.form, $scope.tagGroups);\n    }\n  });\n\n  Utils.checkFormDirtyBeforeLeave($scope, 'eventForm')\n})\n\n// 添加事件页\n.controller('CRMAddEventCtrl', function($scope, $state, $stateParams, $controller, IbPopup, CRMEvent) {\n  $controller('CRMEventFormCtrl', {\n    $scope: $scope\n  });\n\n  // 如果从客户或商机中新建事件，则从 $stateParams 中传递这些数据过来\n  if ($stateParams.client) {\n    $scope.form.client = $stateParams.client;\n    $scope.form.cid = $stateParams.client.cid;\n  }\n  if ($stateParams.opportunity) {\n    $scope.form.opportunity = $stateParams.opportunity;\n    $scope.form.oid = $stateParams.opportunity.oid;\n  }\n\n  $scope.submit = function() {\n    $scope.submitPromise(CRMEvent.create($scope.form))\n    .success(function(res) {\n      if(res.isSuccess) {\n        IbPopup.tip('新增成功', 'success')\n        .then(function(){\n          $state.go('crm.eventView', res.data, { location: 'replace' })\n        });\n      }\n    })\n  };\n})\n\n// 编辑事件页\n.controller('CRMEditEventCtrl', function($scope, $window, $controller, $stateParams, $ionicLoading, mapFilter, Utils, IbPopup, CRMEvent, CRMUtils) {\n  $controller('CRMEventFormCtrl', {\n    $scope: $scope\n  });\n\n  $ionicLoading.show();\n  CRMEvent.view($stateParams).success(function(res) {\n      if (res.isSuccess) {\n        $scope.form = res.data;\n        $scope.form.cid = res.data.client ? res.data.client.cid : '';\n        $scope.form.oid = res.data.opportunity ? res.data.opportunity.oid : '';\n        $scope.form.contactid = res.data.contacts ? mapFilter(res.data.contacts, 'contactid') : [];\n        CRMUtils.setTagsToForm($scope.form, res.data.tags);\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  $scope.submit = function() {\n    $scope.form.aid = [];\n    $scope.submitPromise(CRMEvent.update($scope.form))\n    .success(function(res) {\n      if(res.isSuccess) {\n        IbPopup.tip('编辑成功', 'success')\n        .then(function(){\n          $window.history.back()\n        });\n      }\n    })\n  };\n\n  $scope.removeEvent = function() {\n    CRMUtils.confirmRemoveEvent($stateParams);\n  }\n})\n\n// 事件详情页\n.controller('CRMEventViewCtrl', function($scope, $state, $stateParams, $ionicLoading, $ionicActionSheet, Utils, CRMEvent, CRMUtils) {\n  $ionicLoading.show();\n  CRMEvent.view($stateParams).success(function(res) {\n      if (res.isSuccess) {\n        $scope.ev = res.data;\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n})","/**\n * @ngdoc module\n * @name crm\n * @description\n *   CRM模块\n */\n\nangular.module('crm', ['ionic', 'crm.controllers', 'crm.services'])\n\n.run(function(Apps) {\n  Apps.install({\n    name: 'crm',\n    title: 'CRM',\n    route: '#/crm',\n    state: 'crm.index',\n    icon: 'img/modicon/crm.png'\n  })\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider, ResolversProvider) {\n\n  $urlRouterProvider.when('/crm', '/crm/index');\n\n  $stateProvider\n    .state('crm', {\n      url: '/crm',\n      abstract: true,\n      template: '<ion-nav-view name=\"crm\"></ion-nav-view>',\n      resolve: UserProvider.resolve\n    })\n\n  // CRM-门户\n  .state('crm.index', {\n    url: '/index',\n    talkingDataLabel: 'CRM-门户',\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/index.html',\n        controller: 'CRMIndexCtrl'\n      }\n    }\n  })\n\n  // CRM-联系人-首页\n  .state('crm.contact', {\n    url: '/contact',\n    talkingDataLabel: 'CRM-联系人-首页',\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/contact.html',\n        controller: 'CRMContactCtrl'\n      }\n    },\n    defaultBack: {\n      title: 'CRM',\n      state: 'crm.index'\n    }\n  })\n\n  // CRM-添加联系人\n  .state('crm.addContact', {\n    url: '/addcontact',\n    talkingDataLabel: 'CRM-联系人-添加',\n    params: { client: null },\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/contact-form.html',\n        controller: 'CRMAddContactCtrl'\n      }\n    },\n    resolve: ResolversProvider.get(['qqmap']),\n    defaultBack: {\n      title: '联系人',\n      state: 'crm.contact'\n    }\n  })\n\n  // CRM-编辑联系人\n  .state('crm.editContact', {\n    url: '/editcontact/:contactid',\n    talkingDataLabel: 'CRM-联系人-编辑',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/contact-form.html',\n        controller: 'CRMEditContactCtrl'\n      }\n    },\n    resolve: ResolversProvider.get(['qqmap']),\n    defaultBack: {\n      title: '联系人',\n      state: 'crm.contact'\n    }\n  })\n\n  // CRM-联系人详情页\n  .state('crm.contactView', {\n    url: '/contactview/:contactid',\n    talkingDataLabel: 'CRM-联系人-详情',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/contact-view.html',\n        controller: 'CRMContactViewCtrl'\n      }\n    }\n  })\n\n  // CRM-客户\n  .state('crm.client', {\n    url: '/client',\n    talkingDataLabel: 'CRM-客户-主页',\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/client.html',\n        controller: 'CRMClientCtrl'\n      }\n    },\n    defaultBack: {\n      title: 'CRM',\n      state: 'crm.index'\n    }\n  })\n\n  // CRM-添加客户\n  .state('crm.addClient', {\n    url: '/addclient',\n    talkingDataLabel: 'CRM-客户-添加',\n    params: { contact: null },\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/client-form.html',\n        controller: 'CRMAddClientCtrl'\n      }\n    },\n    resolve: ResolversProvider.get(['qqmap']),\n    defaultBack: {\n      title: '客户',\n      state: 'crm.client'\n    }\n  })\n\n  // CRM-编辑客户\n  .state('crm.editClient', {\n    url: '/editclient/:cid',\n    talkingDataLabel: 'CRM-客户-编辑',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/client-form.html',\n        controller: 'CRMEditClientCtrl'\n      }\n    },\n    resolve: ResolversProvider.get(['qqmap']),\n    defaultBack: {\n      title: '客户',\n      state: 'crm.client'\n    }\n  })\n\n  // CRM-查看客户\n  .state('crm.clientView', {\n    url: '/clientview/:cid',\n    talkingDataLabel: 'CRM-客户-查看',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/client-view.html',\n        controller: 'CRMClientViewCtrl'\n      }\n    }\n  })\n\n  // CRM-商机首页\n  .state('crm.opportunity', {\n    url: '/opportunity',\n    params: { tag: null , status: null },\n    talkingDataLabel: 'CRM-商机-首页',\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/opportunity.html',\n        controller: 'CRMOpportunityCtrl'\n      }\n    },\n    defaultBack: {\n      title: 'CRM',\n      state: 'crm.index'\n    }\n  })\n\n  // CRM-商机详情页\n  .state('crm.opportunityView', {\n    url: '/opportunityview/:oid',\n    talkingDataLabel: 'CRM-商机-详情页',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/opportunity-view.html',\n        controller: 'CRMOpportunityViewCtrl'\n      }\n    }\n  })\n\n  // CRM-添加商机\n  .state('crm.addOpportunity', {\n    url: '/addopportunity',\n    talkingDataLabel: 'CRM-商机-添加页',\n    params: { client: null },\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/opportunity-form.html',\n        controller: 'CRMAddOpportunityCtrl'\n      }\n    },\n    defaultBack: {\n      title: '商机',\n      state: 'crm.opportunity'\n    }\n  })\n\n  // CRM-编辑商机\n  .state('crm.editOpportunity', {\n    url: '/editopportunity/:oid',\n    talkingDataLabel: 'CRM-商机-编辑页',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/opportunity-form.html',\n        controller: 'CRMEditOpportunityCtrl'\n      }\n    },\n    defaultBack: {\n      title: '商机',\n      state: 'crm.opportunity'\n    }\n  })\n\n  // CRM-事件首页\n  .state('crm.event', {\n    url: '/event',\n    talkingDataLabel: 'CRM-事件首页',\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/event.html',\n        controller: 'CRMEventCtrl'\n      }\n    },\n    defaultBack: {\n      title: 'CRM',\n      state: 'crm.index'\n    }\n  })\n\n  // CRM-添加事件\n  .state('crm.addEvent', {\n    url: '/addevent',\n    talkingDataLabel: 'CRM-事件-添加页',\n    cache: false,\n    params: { client: null, opportunity: null, contact: null },\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/event-form.html',\n        controller: 'CRMAddEventCtrl'\n      }\n    },\n    defaultBack: {\n      title: '事件',\n      state: 'crm.event'\n    }\n  })\n\n  // CRM-编辑事件\n  .state('crm.editEvent', {\n    url: '/editevent/:eventid',\n    talkingDataLabel: 'CRM-事件-编辑页',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/event-form.html',\n        controller: 'CRMEditEventCtrl'\n      }\n    },\n    defaultBack: {\n      title: '事件',\n      state: 'crm.event'\n    }\n  })\n\n  // CRM-事件详情\n  .state('crm.eventView', {\n    url: '/eventview/:eventid',\n    talkingDataLabel: 'CRM-事件-详情页',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/event-view.html',\n        controller: 'CRMEventViewCtrl'\n      }\n    }\n  })\n\n});","/**\n * @ngdoc overview\n * @name crm.services\n * @description\n *   CRM模块服务\n */\n\nangular.module('crm.services', [])\n\n/**\n * @property\n * @type {Object}\n * @description\n *   销售简报时间取值\n */\n.constant('CRM_REPORT_TIMETYPES', [{\n  text: '本月',\n  type: 5\n}, {\n  text: '上月',\n  type: 6\n}, {\n  text: '本周',\n  type: 3\n}, {\n  text: '上周',\n  type: 4\n}])\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMContact\n * @description\n *   CRM 通用服务\n */\n.factory('CRM', function($http, Settings, Utils) {\n  return {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRM#tagList\n     * @methodOf  crm.services.CRM\n     * @description\n     *    获取标签设置\n     *    `params.module`  {string}  获取指定模块的标签，可选值有 client、contact、opportunity、event、contract、receipt\n     * @returns {HttpPromise}   HttpPromise\n     */\n    tagList: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/taglist', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRM#getReport\n     * @methodOf  crm.services.CRM\n     * @param     {object}  [params]  查询参数\n     * @description\n     *    获取销售简报\n     *    `time`  {number}  时间范围，3本周，4上周，5本月，6上月\n     * \n     *    [接口文档](http://doc.ibos.cn/index.php?s=/2&page_id=247)\n     * @returns {HttpPromise}   HttpPromise\n     */\n    getReport: function(params) {\n      return $http.post(Settings.hostUrl + '?r=crm/api/getsalereport', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRM#getTarget\n     * @methodOf  crm.services.CRM\n     * @param     {object}  [params]  查询参数\n     * @description\n     *    获取个人业绩目标\n     *    `uid`   {string}  用户uid，如u_1\n     *    `year`  {string}  年份\n     *    `type`  {number}  1新增客户数 2新增商机数 3新增合同数 4新增收款金额 5新增合同金额 6新增商机金额\n     * \n     *    [接口文档](http://doc.ibos.cn/index.php?s=/2&page_id=185)\n     * @returns {HttpPromise}   HttpPromise\n     */\n    getTarget: function(params) {\n      return $http.post(Settings.hostUrl + '?r=crm/target/gettarget', params);\n    },\n    \n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRM#getOppSurvey\n     * @methodOf  crm.services.CRM\n     * @param     {object}  [params]  查询参数\n     * @description\n     *    获取商机概况\n     * \n     *    [接口文档](http://doc.ibos.cn/index.php?s=/2&page_id=248)\n     * @returns {HttpPromise}   HttpPromise\n     */\n    getOppSurvey: function(params) {\n      return $http.post(Settings.hostUrl + '?r=crm/api/getoppsurvey', params);\n    }\n\n  }\n})\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMContact\n * @description\n *   CRM 联系人服务\n */\n.factory('CRMContact', function($http, Utils, Settings, CRM) {\n  var CRMContact = {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#avatar\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    上传联系人头像\n     *\n     * @param   {File}          file  文件对象\n     * @returns {HttpPromise}   HttpPromise\n     */\n    avatar: function(file) {\n      var formData = new FormData();\n      formData.append('Filedata', file);\n      return Utils.postFormData(Settings.hostUrl + '?r=crm/api/contactavatar', formData);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#list\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    获取联系人列表\n     *    \n     *    - params.range    {string}  筛选范围，my：我的|all：全部，默认all\n     *    - params.tags     {array}   标签条件，不填则没有限制\n     *    - params.keyword  {string}  联系人名字模糊搜索\n     *    - params.limit    {number}  每次获取条数\n     *    - params.offset   {number}  获取数据的起始点\n     *    - params.order    {object}  按公司company，姓名name，创建时间createtime排序，默认按名字正向排序，格式{'createtime':1}，1表示正向排序，0表示倒向排序，支持多个排序，放在前面的优先级高，不在说明里的字段会被忽略\n     *\n     * @param   {Object}        params  请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    list: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactlist', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#create\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    创建联系人\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    create: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactadd', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#create\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    更新联系人信息\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    update: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactedit', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#view\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    获取联系人详情\n     *    `params.contactid`  {string}  联系人 id\n     * @param   {Object}        params    请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    view: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactdetail', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#remove\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    删除联系人\n     *    `params.contactid`  {string}  联系人 id\n     * @param   {Object}        params    请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    remove: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactremove', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#tagList\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    获取联系人模块标签设置\n     * @returns {HttpPromise}   HttpPromise\n     */\n    tagList: function() {\n      return CRM.tagList({\n        module: 'contact'\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#tagList\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    获取联系人选择窗口数据\n     *    params.type  {string}  类型，可选 client、opp、event\n     *    params.cid\n     *    params.oid\n     *    params.eventid\n     * @param   {object}        params\n     * @returns {HttpPromise}   HttpPromise\n     */\n    select: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactselect', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#related\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    关联联系人到客户、商机、事件\n     *    `params.type`       {string}  关联类型\n     *    `params.contactid`  {array}   联系人id\n     *    `params.cid`        {string}  关联目标数据，多选一\n     *    `params.oid`        {string}  关联目标数据，多选一\n     * @param   {Object}        params    请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    related: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactrelated', params);\n    }\n  };\n\n  return CRMContact;\n})\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMClient\n * @description\n *   CRM 客户服务\n */\n.factory('CRMClient', function($http, Utils, Settings, CRM) {\n  var CRMClient = {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#tagList\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    获取客户模块标签设置\n     * @returns {HttpPromise}   HttpPromise\n     */\n    tagList: function() {\n      return CRM.tagList({\n        module: 'client'\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#list\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    获取客户列表\n     *    \n     *    - params.range    {string}  筛选范围，my：我的|all：全部，默认all\n     *    - params.tags     {array}   标签条件，不填则没有限制\n     *    - params.keyword  {string}  联系人名字模糊搜索\n     *    - params.limit    {number}  每次获取条数\n     *    - params.offset   {number}  获取数据的起始点\n     *\n     * @param   {Object}        params  请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    list: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientlist', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#create\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    创建客户\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    create: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientadd', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#create\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    更新客户信息\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    update: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientedit', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#view\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    获取客户详情\n     *    `params.cid`  {string}  客户 id\n     * @returns {HttpPromise}   HttpPromise\n     */\n    view: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientdetail', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#remove\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    删除客户\n     *    `params.cid`  {string}  客户 id\n     * @returns {HttpPromise}   HttpPromise\n     */\n    remove: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientremove', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#select\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    获取客户选择器数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    select: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientselect', params);\n    }\n  };\n\n  return CRMClient;\n})\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMOpportunity\n * @description\n *   CRM 商机服务\n */\n.factory('CRMOpportunity', function($http, Utils, Settings, CRM) {\n  var CRMOpportunity = {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#tagList\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    获取商机模块标签设置\n     * @returns {HttpPromise}   HttpPromise\n     */\n    tagList: function() {\n      return CRM.tagList({\n        module: 'opportunity'\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#list\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    获取商机列表\n     *    \n     *    - params.range    {string}  筛选范围，my：我的|all：全部，默认all\n     *    - params.tags     {array}   标签条件，不填则没有限制\n     *    - params.keyword  {string}  联系人名字模糊搜索\n     *    - params.limit    {number}  每次获取条数\n     *    - params.offset   {number}  获取数据的起始点\n     *\n     * @param   {Object}        params  请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    list: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/opplist', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#create\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    创建商机\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    create: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/oppadd', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#create\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    更新商机信息\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    update: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/oppedit', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#view\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    获取商机详情\n     *    `params.oid`  {string}  商机id\n     *    \n     * @returns {HttpPromise}   HttpPromise\n     */\n    view: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/oppdetail', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#remove\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    删除商机\n     *    `params.oid`  {string}  商机id\n     *    \n     * @returns {HttpPromise}   HttpPromise\n     */\n    remove: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/oppremove', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#select\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    获取商机选择数据\n     *    `params.cid`  {string}  客户id\n     *    \n     * @returns {HttpPromise}   HttpPromise\n     */\n    select: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/oppselect', params);\n    }\n  };\n\n  return CRMOpportunity;\n})\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMEvent\n * @description\n *   CRM 事件服务\n */\n.factory('CRMEvent', function($http, Utils, Settings, CRM) {\n  var CRMEvent = {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#tagList\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    获取事件模块标签设置\n     * @returns {HttpPromise}   HttpPromise\n     */\n    tagList: function() {\n      return CRM.tagList({\n        module: 'event'\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#list\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    获取事件列表\n     *    \n     *    - params.range    {string}  筛选范围，my：我的|all：全部，默认all\n     *    - params.tags     {array}   标签条件，不填则没有限制\n     *    - params.keyword  {string}  联系人名字模糊搜索\n     *    - params.limit    {number}  每次获取条数\n     *    - params.offset   {number}  获取数据的起始点\n     *\n     * @param   {Object}        params  请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    list: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/eventlist', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#create\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    创建事件\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    create: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/eventadd', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#create\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    更新事件信息\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    update: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/eventedit', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#view\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    获取事件详情\n     * @returns {HttpPromise}   HttpPromise\n     */\n    view: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/eventdetail', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#remove\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    删除事件\n     * @returns {HttpPromise}   HttpPromise\n     */\n    remove: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/eventremove', params);\n    }\n  };\n\n  return CRMEvent;\n})\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMUtils\n * @description\n *   CRM 工具函数\n */\n.factory('CRMUtils', function($rootScope, $window, $ionicHistory, $ionicLoading, $ionicModal, $ionicViewSwitcher, dateFilter, mapFilter, Utils, IbPopup, CRMContact, CRMClient, CRMOpportunity, CRMEvent) {\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#buildContactFormData\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    预处理联系人表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    buildContactFormData: function(data) {\n      return angular.extend({}, data, {\n        birthday: dateFilter(data.birthday, 'yyyy-MM-dd')\n      });\n    },\n\n    // 移除包装函数\n    wrapRemovePromise: function(promise, clearState) {\n      $ionicLoading.show();\n      promise.success(function(res) {\n          if (res.isSuccess) {\n            $ionicHistory.clearCache([clearState]).then(function() {\n              //@Note: 此处不使用 history.go(-2) 是由于动画方向不同\n              $ionicViewSwitcher.nextDirection('back')\n              $window.history.go(-2)\n              // $ionicHistory.goBack(-2)\n            });\n          } else {\n            IbPopup.alert({\n              title: res.msg\n            });\n          }\n        })\n        .finally($ionicLoading.hide);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#confirmRemoveContact\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    确认删除联系人\n     * @param   {object}  params  作为 CRMContact.remove 方法的参数直接调用\n     * @returns {HttpPromise}   HttpPromise\n     */\n    confirmRemoveContact: function(params) {\n      var that = this;\n      IbPopup.confirm({\n          title: '确定要删除当前联系人？'\n        })\n        .then(function(ok) {\n          if (ok) {\n            that.wrapRemovePromise(CRMContact.remove(params), 'crm.contact')\n          }\n        });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#confirmRemoveClient\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    确认删除客户\n     * @param   {object}  params  作为 CRMClient.remove 方法的参数直接调用\n     * @returns {HttpPromise}   HttpPromise\n     */\n    confirmRemoveClient: function(params) {\n      var that = this;\n      return IbPopup.confirm({\n          title: '确定要删除当前客户？'\n        })\n        .then(function(ok) {\n          if (ok) {\n            that.wrapRemovePromise(CRMClient.remove(params), 'crm.client')\n          }\n        });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#confirmRemoveClient\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    确认删除商机\n     * @param   {object}  params  作为 CRMOpportunity.remove 方法的参数直接调用\n     * @returns {HttpPromise}   HttpPromise\n     */\n    confirmRemoveOpportunity: function(params) {\n      var that = this;\n      return IbPopup.confirm({\n          title: '确定要删除当前商机？'\n        })\n        .then(function(ok) {\n          if (ok) {\n            that.wrapRemovePromise(CRMOpportunity.remove(params), 'crm.opportunity')\n          }\n        });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#confirmRemoveEvent\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    确认删除商机\n     * @param   {object}  params  作为 CRMEvent.remove 方法的参数直接调用\n     * @returns {HttpPromise}   HttpPromise\n     */\n    confirmRemoveEvent: function(params) {\n      var that = this;\n      return IbPopup.confirm({\n          title: '确定要删除当前事件？'\n        })\n        .then(function(ok) {\n          if (ok) {\n            that.wrapRemovePromise(CRMEvent.remove(params), 'crm.event')\n          }\n        });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#buildOpportunityFormData\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    预处理联系人表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    buildOpportunityFormData: function(data) {\n      return angular.extend({}, data, {\n        createtime: dateFilter(data.createtime, 'yyyy-MM-dd HH:mm:ss'),\n        expectendtime: dateFilter(data.expectendtime, 'yyyy-MM-dd HH:mm:ss')\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#openClientModal\n     * @methodOf  crm.services.CRMUtils\n     * @todo  openClientModal、openOpportunityModal、openContactModal 有大量重复逻辑，可以整理\n     * @description\n     *    打开客户选择窗口\n     *    opts.cid       {string}    当前选中的客户id\n     *    opts.callback  {function}  确认后回调\n     * @param   {object}  opts  参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    openClientModal: function(opts) {\n      var that = this;\n      var scope = this.clientScope;\n\n      opts = opts || {};\n\n      if (scope) {\n        scope.cid = opts.cid;\n        scope.opts = opts;\n        return this.clientScope.modal.show();\n      }\n\n      scope = this.clientScope = $rootScope.$new(true);\n      scope.opts = opts;\n\n      $ionicModal.fromTemplateUrl('templates/crm/select-client.html', {\n        scope: scope\n      }).then(function(modal) {\n        CRMClient.select().success(function(res) {\n          if (res.isSuccess) {\n            that.clientScope.clients = res.data;\n            that.clientScope.clients.forEach(function(client) {\n              client.firstLetter = client.firstCase.charAt(0).toUpperCase()\n            })\n          }\n        });\n        modal.show();\n        that.clientScope.cid = scope.opts.cid;\n        that.clientScope.select = function(client) {\n          scope.opts.callback && scope.opts.callback(client);\n          modal.hide();\n        };\n        that.clientScope.modal = modal;\n        that.clientScope.$on('$destroy', modal.remove.bind(modal));\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#openOpportunityModal\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    打开商机选择窗口\n     *    opts.selected   {string}    当前选中的商机id\n     *    opts.callback   {function}  确认后回调\n     * @param   {object}  opts  参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    openOpportunityModal: function(opts) {\n      var that = this;\n      var scope = this.oppScope;\n\n      opts = opts || {};\n\n      function fetch() {\n        CRMOpportunity.select(opts.params).success(function(res) {\n          if (res.isSuccess) {\n            scope.opps = res.data;\n          }\n        });\n      }\n\n      if (scope) {\n        scope.selected = opts.selected;\n        scope.opts = opts;\n        fetch();\n        return scope.modal.show();\n      }\n\n      scope = this.oppScope = $rootScope.$new(true);\n      scope.opts = opts;\n\n      $ionicModal.fromTemplateUrl('templates/crm/select-opportunity.html', {\n        scope: scope\n      }).then(function(modal) {\n        fetch()\n        modal.show();\n        scope.selected = scope.opts.selected;\n        scope.select = function(opp) {\n          scope.opts.callback && scope.opts.callback(opp);\n          modal.hide();\n        };\n        scope.modal = modal;\n        scope.$on('$destroy', modal.remove.bind(modal));\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#openClientModal\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    打开联系人选择窗口\n     *    opts.selected  {array}   当前选中的联系人数据\n     *    opts.callback  {function}  确认后回调\n     * @param   {object}  opts  参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    openContactModal: function(opts) {\n      var that = this;\n      var scope = this.contactScope;\n      opts = opts || {};\n\n      function fetch() {\n        CRMContact.select(scope.opts.params).success(function(res) {\n          if (res.isSuccess) {\n            scope.contacts = res.data.list;\n            scope.restoreSelected(scope.opts.selected);\n          }\n        });\n      }\n\n      if (scope) {\n        scope.opts = opts;\n        fetch();\n        return scope.modal.show();\n      }\n\n      scope = this.contactScope = $rootScope.$new(true);\n      scope.opts = opts;\n      // 获取选中值数组\n      scope.getSelected = function() {\n        if (this.contacts && this.contacts.length) {\n          return this.contacts.filter(function(contact) {\n            return contact.checked;\n          });\n        } else {\n          return [];\n        }\n      };\n      // 还原初始选中值\n      scope.restoreSelected = function(selectedIds) {\n        if (scope.contacts && scope.contacts.length) {\n          // 如果有传递初始值，则匹配还原\n          if (selectedIds && selectedIds.length) {\n            scope.contacts.forEach(function(contact) {\n              if (selectedIds.indexOf(contact.contactid) !== -1) {\n                contact.checked = true;\n              }\n            });\n            // 如果没有，则清空所有选中项\n          } else {\n            scope.contacts.forEach(function(contact) {\n              delete contact.checked;\n            });\n          }\n        }\n\n      };\n      scope.save = function() {\n        scope.opts.callback && scope.opts.callback(scope.getSelected());\n        scope.modal.hide();\n      };\n\n      $ionicModal.fromTemplateUrl('templates/crm/select-contact.html', {\n        scope: scope\n      }).then(function(modal) {\n        scope.modal = modal;\n        scope.$on('$destroy', modal.remove.bind(modal));\n        fetch();\n        modal.show();\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#openAttachModal\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    打开客户关联数据窗口\n     */\n    openAttachModal: function(scope) {\n      var that = this;\n      scope.__attachOpts = scope.__attachOpts || {};\n      scope.__attachOpts = angular.extend({\n        newEvent: true,\n        newOpp: true,\n        newContact: true,\n        attachContact: true\n      }, scope.__attachOpts);\n\n      if (scope.clientAttachModal) return scope.clientAttachModal.show();\n\n      $ionicModal.fromTemplateUrl('templates/crm/attach-modal.html', {\n        scope: scope,\n        animation: 'fade-in'\n      }).then(function(modal) {\n        modal.hideDelay = 1;\n        modal.show();\n        scope.clientAttachModal = modal;\n        scope.$on('$ionicView.leave', modal.hide.bind(modal));\n        scope.$on('$destroy', modal.remove.bind(modal));\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#selectContactToClient\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    选择联系人并关联到客户\n     *    \n     * @param   {string}    cid       客户id\n     * @param   {array}     selected  当前默认选中的 contactid 组\n     * @param   {function}  selected  成功回调\n     */\n    selectContactToClient: function(cid, selected, onSuccess) {\n      this.openContactModal({\n        selected: selected,\n        params: {\n          type: 'client'\n        },\n        callback: function(selected) {\n          $ionicLoading.show();\n          CRMContact.related({\n              type: 'client',\n              cid: cid,\n              contactid: mapFilter(selected, 'contactid')\n            })\n            .success(onSuccess)\n            .success(Utils.serverWarning)\n            .finally($ionicLoading.hide);\n        }\n      });\n    },\n\n    initTagsToForm: function(form, tagGroups) {\n      form.tags = form.tags || {};\n      angular.forEach(tagGroups, function(tagGroup) {\n        if (!form.tags[tagGroup.groupid]) {\n          form.tags[tagGroup.groupid] = tagGroup.taglist[0].tagid;\n        }\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#setTagsToForm\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    将后端返回的标签格式转化为表单可用格式\n     *    \n     * @param   {object}    form  表单模型\n     * @param   {object}    tags  标签信息\n     * @param   {function}  selected  成功回调\n     */\n    setTagsToForm: function(form, tags) {\n      if (form && tags && tags.length) {\n        form.tags = {};\n        angular.forEach(tags, function(tag) {\n          form.tags[tag.groupid] = tag.tag.tagid;\n        });\n      }\n      return form;\n    },\n\n    formValidateError: function(res) {\n      if (!res.isSuccess) {\n        if (res.data && res.data.error) {\n          IbPopup.alert({\n            title: mapFilter(res.data.error).join('<br>')\n          });\n        } else {\n          IbPopup.alert({\n            title: res.msg\n          });\n        }\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc filter\n * @name crm.services.filter:groupAndOrder\n * @function\n * @description\n *  分组并按分组索引排序，返回排序后的索引数组 arr，并在 arr.grouped 中引用分组数据\n *\n * @param   {array}             arr        需要分组排序的数组\n * @param   {string|function}   groupBy    分组依据字段\n * @param   {boolean}           orderDesc  是否倒序\n * @returns {array}   分组排序结果\n */\n.filter('groupAndOrder', function(groupByFilter) {\n  return function(arr, groupBy, orderDesc) {\n    var keys = []\n    if(arr && arr.length) {\n      var grouped = groupByFilter(arr, groupBy);\n      \n      keys = Object.keys(grouped);\n      keys.sort(function(a, b) {\n        return (orderDesc ? b > a : a > b) ? 1 : -1;\n      });\n      keys.grouped = grouped\n    }\n    return keys;\n  }\n})\n\n.filter('mapMultiply', function() {\n  return function(arr, multi) {\n    multi = multi || 10\n    return arr.map(function(num) {\n      return num * multi\n    })\n  }\n})\n\n/**\n * @ngdoc     directive\n * @name      crm.services.directive:crmContactItem\n * @restrict  E\n * @description\n *   CRM 联系人模板指令\n *   `mode`  {string}  支持 view|attach|edit 三种值，排版不一样，值为 edit 时支持 onRemove 回调\n * @param  {object}  contact  联系人数据\n */\n.directive('crmContactItem', function() {\n  return {\n    restrict: 'E',\n    scope: {\n      mode: '@',\n      onRemove: '&',\n      contact: '='\n    },\n    templateUrl: 'templates/crm/contact-item.html',\n    replace: true,\n    // transclude: true,\n    link: angular.noop\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      crm.services.directive:crmEventItem\n * @restrict  E\n * @description\n *   CRM 事件模板指令\n *  \n * @param  {object}  ev  事件\n */\n.directive('crmEventItem', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      ev: '='\n    },\n    templateUrl: 'templates/crm/event-item.html',\n    transclude: true,\n    link: angular.noop\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      crm.services.directive:crmOppItem\n * @restrict  E\n * @description\n *   CRM 商机模板指令\n *  \n * @param  {object}  opp  商机数据\n */\n.directive('crmOppItem', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      opp: '='\n    },\n    templateUrl: 'templates/crm/opportunity-item.html',\n    transclude: true,\n    link: angular.noop\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:clock\n * @element   ANY\n * @restrict  A\n * @description\n *  仪表盘进度\n *\n */\n.directive('clock', function($timeout) {\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $attrs) {\n      var ele = $element[0],\n        attr = $attrs.$attr,\n        angle;\n\n      $scope.$watch('percent', function(percent) {\n        if (percent) {\n          //此处按旋转角度180º计算\n          if (attr.plus === 'plus') {\n            //角度从0度开始计算\n            angle = percent !== 0 ? percent * 1.8 : 0;\n          } else {\n            //角度从-45度开始计算\n            angle = percent === 0 ? -45 : (percent * 1.8 - 45);\n          }\n          ['transform', 'OTransform', 'msTransform', 'MozTransform', 'webkitTransform'].forEach(function(key) {\n            ele.style[key] = 'rotate(' + angle + 'deg)';\n          });\n        }\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc    directive\n * @name     crm.services.directive:searchTabBar\n * @element  ionHeaderBar\n * @restrict A\n * @description\n *   tab 与 search 功能合并工具条\n *   @param tabs        `expression` tab 项数组\n *   @param searchModal `expression` SearchModal 实例\n *   @param onTab       `expression` tab 回调\n */\n.directive('searchTabBar', function(SearchModal) {\n  return {\n    templateUrl: 'templates/crm/search-tab-bar.html',\n    scope: {\n      tabs: '=searchTabBar',\n      searchModal: '=',\n      onTab: '&'\n    },\n    compile: function(element, attrs) {\n      element.addClass('search-tab-bar')\n\n      // link\n      return function($scope, $element, $attrs) {\n        $scope.tabTo = function($index) {\n          $scope.activeIndex = $index\n          $scope.onTab({\n            $tab: $scope.tabs[$index]\n          })\n        }\n        $scope.tabTo(0)\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     crm.services.directive:tagsSelector\n * @element  ANY\n * @restrict A\n * @description\n *   标签选择器\n */\n.directive('crmFilter', function($compile, $ionicTemplateLoader, Utils) {\n  return {\n    scope: {\n      filterGroups: '=',\n      onSelect: '='\n    },\n    replace: true,\n    templateUrl: 'templates/crm/crm-filter-menu.html',\n    compile: function(element) {\n      // @p.s 此处放置空 ng-click 是为了有点击效果\n      // element.attr('ng-click', '')\n\n      // link\n      return function($scope, $element, $attrs, $ngModelCtrl) {\n        $scope.filterShown = false\n        $scope.selectFilterItem = function(item, filterGroup) {\n          filterGroup.selected = filterGroup.items.indexOf(item)\n          $scope.onSelect(item, filterGroup)\n        }\n      }\n    }\n\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     crm.services.directive:crmUser\n * @element  ANY\n * @restrict ECMA\n * @description\n *   CRM 用户信息组\n */\n.directive('crmUser', function() {\n  return {\n    template: '<span class=\"crm-user\"> ' +\n      '<img avatar=\"{{ uid | avatar | defaultAvatar }}\"> ' +\n      '<span>{{ uid | userInfo:\\'realname\\' }}</span> ' +\n      '</span>',\n    replace: true,\n    scope: {\n      uid: '@'\n    },\n    link: angular.noop\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     crm.services.directive:crmTagsSection\n * @element  ANY\n * @restrict ECMA\n * @description\n *   CRM 标签组预览文本\n */\n.directive('crmTagsSection', function() {\n  return {\n    template: '<span class=\"crm-tags-section\"> ' +\n      '<i class=\"crm-icon-tag\"></i> ' +\n      '<span ng-repeat=\"tag in tags\">{{ tag.tag.name }}{{ $last ? \\'\\' : \\'；\\' }}</span> ' +\n      '</span>',\n    replace: true,\n    scope: {\n      tags: '='\n    },\n    link: angular.noop\n  }\n})\n\n.directive('crmEmptyTip', function() {\n  return {\n    template: '<div class=\"list-empty-tip\"> ' +\n      '<i class=\"news-icon-empty\"></i> ' +\n      '<p class=\"margin-top coyness\">{{ text }}</p> ' +\n      '</div>',\n    replace: true,\n    link: function($scope, $element, $attr) {\n      $scope.text = $attr.text || '这里空空如也'\n    }\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     crm.services.directive:processbar\n * @element  ANY\n * @restrict ECMA\n * @description\n *   进度条控件\n */\n.directive('processbar', function() {\n  return {\n    template: '<div class=\"processbar\"> ' +\n      '<div class=\"processbar-fill\" style=\"width: {{ value || 0 }}%; background-color: {{ color || \\'red\\' }}\"></div>' +\n      '</div>',\n    replace: true,\n    scope: {\n      value: '@',\n      color: '@'\n    }\n  }\n})\n\n/* @ngInject */\n.directive('ngCurrency', function($filter, $locale) {\n\n  return {\n    require: 'ngModel',\n    link: function(scope, element, attrs, controller) {\n      var hardCap, min, max, currencySymbol, ngRequired;\n      var active = true;\n      var fraction = 2;\n\n      attrs.$observe('ngCurrency', function(value) {\n        active = (value !== 'false');\n        if (active) {\n          reformat();\n        } else {\n          controller.$viewValue = controller.$$rawModelValue;\n          controller.$render();\n        }\n      });\n\n      attrs.$observe('hardCap', function(value) {\n        hardCap = (value === 'true');\n        revalidate();\n      });\n      attrs.$observe('min', function(value) {\n        min = value ? Number(value) : undefined;\n        revalidate();\n      });\n      attrs.$observe('max', function(value) {\n        max = value ? Number(value) : undefined;\n        revalidate();\n      });\n      attrs.$observe('currencySymbol', function(value) {\n        currencySymbol = value;\n        reformat();\n      });\n      attrs.$observe('ngRequired', function(value) {\n        ngRequired = value;\n        revalidate();\n      });\n      attrs.$observe('fraction', function(value) {\n        fraction = value || 2;\n        reformat();\n        revalidate();\n      });\n\n      controller.$parsers.push(function(value) {\n        if (active && [undefined, null, ''].indexOf(value) === -1) {\n          value = clearValue(value);\n          value = keepInRange(Number(value));\n          return value;\n        }\n        return value;\n      });\n\n      controller.$formatters.push(function(value) {\n        if (active && [undefined, null, ''].indexOf(value) === -1) {\n          return $filter('currency')(value, getCurrencySymbol(), fraction);\n        }\n        return value;\n      });\n\n      controller.$validators.min = function(value) {\n        if (!ngRequired && ([undefined, null, ''].indexOf(value) !== -1 || isNaN(value))) {\n          return true;\n        }\n        return !active ||\n          [undefined, null].indexOf(min) !== -1 || isNaN(min) ||\n          value >= min;\n      };\n\n      controller.$validators.max = function(value) {\n        if (!ngRequired && ([undefined, null, ''].indexOf(value) !== -1 || isNaN(value))) {\n          return true;\n        }\n        return !active ||\n          [undefined, null].indexOf(max) !== -1 || isNaN(max) ||\n          value <= max;\n      };\n\n      controller.$validators.fraction = function(value) {\n        return !active || !value || !isNaN(value);\n      };\n\n      function reformat() {\n        if (active) {\n          var value;\n          if (controller.$options && controller.$options.updateOn === 'blur') {\n            value = controller.$viewValue;\n            for (var i = controller.$parsers.length - 1; i >= 0; i--) {\n              value = controller.$parsers[i](value);\n            }\n          } else {\n            value = controller.$$rawModelValue;\n          }\n          for (var i = controller.$formatters.length - 1; i >= 0; i--) {\n            value = controller.$formatters[i](value);\n          }\n          controller.$viewValue = value;\n          controller.$render();\n        }\n      }\n\n      function revalidate() {\n        controller.$validate();\n        if (active) {\n          var value = keepInRange(controller.$$rawModelValue);\n          if (value !== controller.$$rawModelValue) {\n            controller.$setViewValue(value.toFixed(fraction));\n            controller.$commitViewValue();\n            reformat();\n          }\n        }\n      }\n\n      function keepInRange(value) {\n        if (hardCap) {\n          if (max !== undefined && value > max) {\n            value = max;\n          } else if (min !== undefined && value < min) {\n            value = min;\n          }\n        }\n        return value;\n      }\n\n      scope.$on('currencyRedraw', function() {\n        revalidate();\n        reformat();\n      });\n\n      element.bind('focus', function() {\n        if (active) {\n          var groupRegex = new RegExp('\\\\' + $locale.NUMBER_FORMATS.GROUP_SEP, 'g');\n          var value = [undefined, null, ''].indexOf(controller.$$rawModelValue) === -1 ? $filter('number')(controller.$$rawModelValue, fraction).replace(groupRegex, '') : controller.$$rawModelValue;\n          if (controller.$viewValue !== value) {\n            controller.$viewValue = value;\n            controller.$render();\n            element.triggerHandler('focus');\n          }\n        }\n      });\n\n      element.bind('blur', reformat);\n\n      // TODO: Rewrite this parsing logic to more readable.\n\n      function decimalRex(dChar) {\n        return RegExp('\\\\d|\\\\-|\\\\' + dChar, 'g');\n      }\n\n      function clearRex(dChar) {\n        return RegExp('\\\\-{0,1}((\\\\' + dChar + ')|([0-9]{1,}\\\\' + dChar + '?))&?[0-9]{0,' + fraction + '}', 'g');\n      }\n\n      function clearValue(value) {\n        value = String(value);\n        var dSeparator = $locale.NUMBER_FORMATS.DECIMAL_SEP;\n        var cleared = null;\n\n        if (value.indexOf($locale.NUMBER_FORMATS.DECIMAL_SEP) === -1 &&\n          value.indexOf('.') !== -1 &&\n          fraction > 0) {\n          dSeparator = '.';\n        }\n\n        // Replace negative pattern to minus sign (-)\n        var neg_dummy = $filter('currency')('-1', getCurrencySymbol(), fraction);\n        var neg_regexp = RegExp('[0-9.' + $locale.NUMBER_FORMATS.DECIMAL_SEP + $locale.NUMBER_FORMATS.GROUP_SEP + ']+');\n        var neg_dummy_txt = neg_dummy.replace(neg_regexp.exec(neg_dummy), '');\n        var value_dummy_txt = value.replace(neg_regexp.exec(value), '');\n\n        // If is negative\n        if (neg_dummy_txt === value_dummy_txt) {\n          value = '-' + neg_regexp.exec(value);\n        }\n\n        if (RegExp('^-[\\\\s]*$', 'g').test(value)) {\n          value = '-0';\n        }\n\n        if (decimalRex(dSeparator).test(value)) {\n          cleared = value.match(decimalRex(dSeparator))\n            .join('').match(clearRex(dSeparator));\n          cleared = cleared ? cleared[0].replace(dSeparator, '.') : null;\n        }\n\n        return cleared;\n      }\n\n      function getCurrencySymbol() {\n        return currencySymbol === undefined ? $locale.NUMBER_FORMATS.CURRENCY_SYM : currencySymbol;\n      }\n    }\n  };\n})\n\n.filter('crmFilterSelectedText', function() {\n  return function(filterGroups) {\n    var hasSelectedGroups = filterGroups.filter(function(g) {\n      return g.selected !== 0\n    })\n    return hasSelectedGroups.map(function(g) {\n      var text = g.items[g.selected].text\n      if(g.groupName === '创建时间') {\n        text += '创建'\n      } else if(g.groupName === '跟进时间') {\n        text += '跟进'\n      }\n      return text\n    }).join(' ● ')\n  }\n})","/**\n * @ngdoc module\n * @name diary.controllers\n * @description\n *   工作日志模块控制器\n */\nangular.module('diary.controllers', [])\n\n/**\n * @ngdoc controller\n * @name DiaryIndexCtrl\n * @module diary.controllers\n * @description\n *   日志主页控制器\n */\n  .controller('DiaryIndexCtrl', function($scope, $ionicModal, $ionicLoading, $state, User, Utils, Diary) {\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n        if(res.isSuccess){\n          if(res.data.diary){\n            $scope.openSettingModel = function() {\n              $ionicModal.fromTemplateUrl('templates/diary/diary-setting.html', {\n                scope: $scope,\n                animation: 'slide-in-up'\n              })\n                .then(function(modal) {\n                  $scope.settingModel = modal;\n                  $scope.settingModel.show();\n\n                  $scope.formData = {\n                    defaultShareList: '',\n                    direct: 0,\n                    attentionList: ''\n                  };\n\n                  Diary.setting().success(function(res) {\n                    if(res.isSuccess) {\n                      $scope.dashboardConfig = res.dashboardConfig;\n                      angular.extend($scope.formData, res.data, {\n                        direct: +res.data.direct\n                      });\n                    }\n                  });\n\n                  $scope.submit = function() {\n                    $ionicLoading.show();\n                    Diary.savesetting({\n                      defaultShareList: User.addPrefix($scope.formData.defaultShareList),\n                      direct: $scope.formData.direct,\n                      attentionList: User.addPrefix($scope.formData.attentionList),\n                    }).success(function(res) {\n                      if (res.isSuccess === true) {\n                        $scope.settingModel.hide();\n                      }\n                    })\n                      .finally($ionicLoading.hide);\n                  }\n                })\n            };\n          } else{\n            Utils.promptNoPermission();\n          }\n        }\n      }\n    ).finally($ionicLoading.hide);\n  })\n/**\n * @ngdoc controller\n * @name DiaryPersionalCtrl\n * @module diary.controllers\n * @description\n *   我的日志列表页控制器\n */\n  .controller('DiaryPersionalCtrl', function($scope, $ionicListDelegate, $ionicScrollDelegate, $ionicLoading, dateFilter, Utils, IbPopup, Diary) {\n\n    $scope.list = [];\n    $scope.loadMore = function() {\n      return Diary.mine({\n        page: $scope.pages ? $scope.pages.page + 2 : 1\n      }).success(function(res) {\n        if (res.isSuccess) {\n          $ionicScrollDelegate.resize();\n          $scope.list = $scope.list.concat(res.data);\n          $scope.pages = res.pages;\n        }\n      });\n    };\n    $scope.loadMore();\n\n    $scope.refresh = function() {\n      $scope.list.length = 0;\n      delete $scope.pages;\n      $scope.loadMore().finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    }\n\n    $scope.groupByYearMonth = function(item) {\n      return dateFilter(item.diarytime * 1000, 'yyyy年M月');\n    };\n\n    $scope.remove = function(item) {\n      IbPopup.confirm({title: '确认删除日志？'}).then(function(flag) {\n        if (flag) {\n          $ionicListDelegate.closeOptionButtons();\n          $ionicLoading.show();\n          Diary.remove(item.diaryid)\n            .success(function(res) {\n              if(res.isSuccess) {\n                Utils.eliminate($scope.list, item);\n              } else {\n                IbPopup.alert({ title: res.msg });\n              }\n            })\n            .finally($ionicLoading.hide);\n        }\n      });\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryReviewCtrl\n * @module diary.controllers\n * @description\n *   日志评阅列表页控制器\n */\n  .controller('DiaryReviewCtrl', function($scope, $state, $stateParams, $filter, $ionicHistory, $ionicScrollDelegate, User, dateFilter, Diary) {\n    $scope.list = [];\n    $scope.loadMore = function() {\n      return Diary.allsubs({\n        page: $scope.pages ? $scope.pages.page + 2 : 1\n      }).success(function(res) {\n        if (res.isSuccess) {\n          $ionicScrollDelegate.resize();\n\n          if(!res.diary || !res.diary.length) return;\n\n          angular.forEach(res.diary, function(item) {\n            item.isfavor = res.attentionList.indexOf(item.uid) !== -1;\n          });\n\n          $scope.list = $scope.list.concat(res.diary);\n          $scope.pages = res.pages;\n        }\n      });\n    };\n    $scope.loadMore();\n\n    $scope.refresh = function() {\n      $scope.list.length = 0;\n      delete $scope.pages;\n      $scope.loadMore().finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    }\n\n    $scope.groupByTime = function(item) {\n      return dateFilter(item.diarytime * 1000, 'EEEE MM-dd');\n    };\n\n    $scope.isToday = function(key) {\n      return key == dateFilter(new Date(), 'EEEE MM-dd');\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryFollowCtrl\n * @module diary.controllers\n * @description\n *   日志关注列表页控制器\n */\n  .controller('DiaryFollowCtrl', function($scope, $state, $stateParams, $filter, $ionicHistory, $ionicScrollDelegate, User, dateFilter, Diary ) {\n    $scope.list = [];\n    $scope.loadMore = function() {\n      return Diary.other({\n        page: $scope.pages ? $scope.pages.page + 2 : 1\n      }).success(function(res) {\n        if (res.isSuccess) {\n          $ionicScrollDelegate.resize();\n          $scope.list = $scope.list.concat(res.data);\n          $scope.pages = res.pages;\n        }\n      });\n    };\n    $scope.loadMore();\n\n    $scope.refresh = function() {\n      $scope.list.length = 0;\n      delete $scope.pages;\n      $scope.loadMore().finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    }\n\n    $scope.groupByTime = function(item) {\n      return dateFilter(item.diarytime * 1000, 'EEEE MM-dd');\n    };\n\n    $scope.isToday = function(key) {\n      return key == dateFilter(new Date(), 'EEEE MM-dd');\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryDetailCtrl\n * @module diary.controllers\n * @description\n *   日志详细页控制器\n */\n  .controller('DiaryDetailCtrl', function($scope, $rootScope, $state, $stateParams, $ionicLoading, $ionicActionSheet, $ionicModal, $ionicScrollDelegate, Utils, User, IbPopup, Diary, Settings, userInfoFilter) {\n\n    // 上一篇、下一篇日志\n    // @Todo:\n    // 此处应该做路由跳转到新视图，但在目前 ionic 框架中，路由跳转会破坏历史视图导致无法直接返回列表页\n    // 所以现在暂时做成了在当前视图加载其他日志的数据\n    $scope.toDiary = function(id) {\n      loadDiary(id);\n      $ionicScrollDelegate.scrollTop();\n    };\n\n    $scope.showMore = function() {\n\n      $scope.hideMore = $ionicActionSheet.show({\n        buttons: [{\n          text: '编辑'\n        }],\n        buttonClicked: function() {\n          $state.go('diary.edit', {\n            id: $scope.diary.diaryid\n          })\n          return true;\n        },\n        destructiveText: '删除',\n        cancelText: '取消',\n        destructiveButtonClicked: function() {\n          IbPopup.confirm({title: '确认删除日志？'}).then(function(flag){\n            if(flag){\n              $ionicLoading.show();\n              Diary.remove($scope.diary.diaryid)\n                .success(function(res) {\n                  if(res.isSuccess) {\n                    Utils.clearStateCacheAndGo('diary.personal');\n                  } else {\n                    IbPopup.alert({ title: res.msg });\n                  }\n                })\n                .finally($ionicLoading.hide);\n            }\n          });\n          return true;\n        }\n      })\n    };\n\n    $scope.showCommentModal = function(type, cm) {\n      $ionicModal.fromTemplateUrl('templates/diary/diary-comment.html', {\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal) {\n          $scope.commentModel = modal;\n          $scope.commentModel.show();\n\n          if (type === 'reply') {\n            $scope.comment.content = cm.touid ? '回复 @' + userInfoFilter(cm.uid, 'realname') + ' : ' : ''\n          }\n\n          modal.scope.commentType = type;\n        });\n\n      $scope.comment.submitting = false;\n      $scope.comment.submit = function() {\n        var that = this;\n        var params = {\n          content: this.content,\n          type: type\n        };\n\n        if (that.stamp) {\n          params.stamp = that.stamp.id;\n        }\n\n        if (type === 'comment') {\n          params.rowid = $scope.diary.diaryid;\n        } else if (type === 'reply') {\n          params.tocid = cm.cid;\n          // 如果直接回复评论，则\n          // 否则，如果回复评论下的回复，则\n          params.rowid = cm.tocid === '0' ? cm.cid : cm.rowid;\n        }\n        that.submitting = true;\n\n        return Diary.addComment(params)\n          .success(function(res) {\n            // 发送评论成功后，更新本地列表中的数据\n            that.content = '';\n            if (that.stamp) {\n              $scope.stampUrl = that.stamp.stamp;\n            }\n            $scope.commentModel.hide();\n\n            $ionicLoading.show();\n            Diary.get($scope.diary.diaryid).success(function(res) {\n              $scope.commentList = res.list.map(function(cm) {\n                return angular.extend({}, cm, {\n                  realname: cm.user_info.realname,\n                  avatar: cm.user_info.avatar_middle\n                });\n              });\n            })\n              .finally($ionicLoading.hide);\n          })\n          .finally(function() {\n            that.submitting = false;\n          });\n      }\n    };\n\n    function loadDiary(id) {\n      $ionicLoading.show();\n      Diary.show(id)\n        .success(function(res) {\n          $scope.diary = res.diary;\n          var imgReg = /<img[^>]+src=['\"](\\/data\\/ueditor\\/image[^'\"]+)['\"]+/g;\n\n          res.diary.content = res.diary.content.replace(imgReg, function(a, b) {\n            return a.replace(b, Settings.hostUrl + b);\n          });\n\n          $scope.today = $scope.diary.diarytime;\n          $scope.nextDay = $scope.diary.nextDiarytime;\n\n          $scope.planned = res.data.originalPlanList;\n          $scope.unplanned = res.data.outsidePlanList;\n          $scope.plans = res.data.tomorrowPlanList;\n          $scope.originalPlan = res.data.originalPlanList;\n\n          $scope.next = res.prevAndNextPK.nextPK;\n          $scope.prev = res.prevAndNextPK.prevPK;\n\n          $scope.attach = res.attach;\n          $scope.readers = $scope.diary.readeruid ? $scope.diary.readeruid.split(',') : [];\n          $scope.editable = $scope.diary.uid == User.uid;\n\n          $scope.isShare = res.isShare;\n          $scope.isSup = res.isSup;\n          $scope.dashboardConfig = res.dashboardConfig;\n\n          //图章\n          $scope.comment = {};\n          $scope.comment.stamps = res.allStamps;\n\n          // 过滤出需要使用的数据\n          $scope.commentList = res.list.map(function(cm) {\n            return angular.extend({}, cm, {\n              realname: cm.user_info.realname,\n              avatar: cm.user_info.avatar_middle\n            });\n          });\n          $scope.stampUrl = res.stampUrl;\n        })\n        .finally($ionicLoading.hide);\n    }\n\n    loadDiary($stateParams.id);\n  })\n\n  .controller('DiaryFormCtrl', function($scope, $ionicLoading, $ionicModal, IbPopup, Diary, DiaryUtils, SCHEDULE) {\n    $scope.formData = {\n      originalPlan: [],\n      planOutside: [],\n      plan: [],\n      uploadImagesPreviews: [],\n      attachmentid: '',\n      diaryContent: '',\n      todayDate: '',\n      plantime: ''\n    };\n\n    //获取默认分享人员\n    Diary.setting().success(function(res) {\n      if (res.isSuccess) {\n        $scope.formData.shareuid = res.data.defaultShareList\n      }\n    });\n\n    // 是否处于提交中的状态\n    $scope.isSubmitting = false;\n    $scope.SCHEDULE = SCHEDULE;\n\n    $scope.addUnplanned = function() {\n      $scope.formData.planOutside.push({\n        content: '',\n        schedule: '0'\n      });\n    };\n\n    // 移除一条计划外\n    $scope.removeUnplanned = function(index) {\n      $scope.formData.planOutside.splice(index, 1);\n    };\n\n    // 增加一条计划\n    $scope.addPlan = function() {\n      $scope.formData.plan.push({\n        content: ''\n      });\n    };\n\n    // 移除一条计划\n    $scope.removePlan = function(index) {\n      $scope.formData.plan.splice(index, 1)\n    };\n\n    $scope.allowSubmit = function() {\n      var fd = $scope.formData;\n      return ((fd.planOutside[0] && fd.planOutside[0].content) || ($scope.originalPlanList && $scope.originalPlanList.length)) &&\n        (fd.plan[0] && fd.plan[0].content) &&\n        fd.diaryContent;\n    };\n\n    $scope.planfromschedule = function(todayDate) {\n      $ionicLoading.show();\n      Diary.planfromschedule(todayDate).success(function(res) {\n        if (res.data.length > 0) {\n          $scope.formData.planOutside = $scope.formData.planOutside.concat(res.data.map(function(c) {\n            return {\n              content: c.subject,\n              schedule: '0'\n            }\n          }));\n        } else {\n          IbPopup.alert({\n            title: '抱歉，你今天没有日程计划！'\n          })\n        }\n      })\n        .finally($ionicLoading.hide)\n    };\n\n    $scope.selectedStartDate = function() {\n      DiaryUtils.selectedStartDate($scope)\n    }\n\n    $scope.selectedEndDate = function() {\n      DiaryUtils.selectedEndDate($scope)\n    };\n\n    $scope.setRemind = function(plan) {\n      DiaryUtils.setRemind($scope, plan)\n    };\n\n    $scope.delRemind = function(plan) {\n      DiaryUtils.delRemind(plan)\n    };\n\n    $scope.openSharingModel = function() {\n      $ionicModal.fromTemplateUrl('templates/diary/diary-sharing.html', {\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal) {\n          $scope.sharingModel = modal;\n          $scope.sharingModel.show();\n\n        })\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryCreateCtrl\n * @module diary.controllers\n * @description\n *   日志新建页控制器\n */\n  .controller('DiaryCreateCtrl', function($scope, $controller, $state, $ionicLoading, $ionicHistory, dateFilter, IbPopup, Utils, Diary, DiaryUtils, SCHEDULE) {\n    $controller('DiaryFormCtrl', {\n      $scope: $scope\n    });\n\n    $scope.submit = function() {\n      $scope.isSubmitting = true;\n\n      Diary.create(DiaryUtils.handleFormData($scope.formData))\n        .success(function() {\n          Utils.clearStateCacheAndGo('diary.personal');\n        })\n        .finally(function() {\n          $scope.isSubmitting = false;\n        });\n    }\n\n    // 获取原计划等数据\n    $scope.$watch('formData.todayDate', function(date, oldDate) {\n      if (date) {\n        $scope.formData.plantime = dateFilter(+new Date(date) + 86400000, 'yyyy-MM-dd');\n\n        $ionicLoading.show();\n        Diary.add(date).success(function(res) {\n          if (res.isSuccess) {\n            // 是否安装了日程模块，用于判断是否支持提醒功能\n            $scope.isInstallCalendar = res.isInstallCalendar;\n            // 工作时间段\n            $scope.workStart = res.workStart;\n            // 后台配置项\n            $scope.dashboardConfig = res.dashboardConfig;\n            $scope.originalPlanList = res.data.originalPlanList;\n\n            // 组合 formData 数据\n            $scope.formData.originalPlan = {};\n            angular.forEach(res.data.originalPlanList, function(item) {\n              $scope.formData.originalPlan[item.recordid] = item.schedule;\n            });\n            $scope.formData.plan = [{}];\n            $scope.formData.planOutside = [{ schedule: '10' }];\n          } else {\n            IbPopup.alert({title: res.msg }).then(function(){\n              $state.go('diary.index');\n            });\n            // $scope.formData.todayDate = oldDate;\n          }\n        })\n          .finally($ionicLoading.hide);\n      }\n    });\n\n    $scope.formData.todayDate = dateFilter(new Date(), 'yyyy-MM-dd');\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryEditCtrl\n * @module diary.controllers\n * @description\n *   日志编辑页控制器\n */\n  .controller('DiaryEditCtrl', function($scope, $controller, $state, $stateParams, $ionicLoading, $ionicHistory, Utils, User, IbPopup, Diary, DiaryUtils, SCHEDULE) {\n    $controller('DiaryFormCtrl', {\n      $scope: $scope\n    });\n\n    $scope.selectedStartDate = $scope.selectedEndDate = angular.noop;\n\n    $scope.submit = function() {\n      $scope.isSubmitting = true;\n\n      Diary.update(DiaryUtils.handleFormData($scope.formData))\n        .success(function() {\n          Utils.clearStateCacheAndGo('diary.personal');\n        })\n        .finally(function() {\n          $scope.isSubmitting = false;\n        });\n    };\n\n    $ionicLoading.show();\n\n    Diary.edit($stateParams.id)\n      .success(function(res) {\n        if(!res.isSuccess) {\n          IbPopup.alert({ title: res.msg }).then(function() {\n            $ionicHistory.goBack();\n          });\n        } else {\n          // 是否安装了日程模块，用于判断是否支持提醒功能\n          $scope.isInstallCalendar = res.isInstallCalendar;\n          // 工作时间段\n          $scope.workStart = res.workStart;\n          // 后台配置项\n          $scope.dashboardConfig = res.dashboardConfig;\n          $scope.originalPlanList = res.data.originalPlanList;\n\n          $scope.formData.originalPlan = {};\n          angular.forEach(res.data.originalPlanList, function(item) {\n            $scope.formData.originalPlan[item.recordid] = item.schedule;\n          });\n          $scope.formData.planOutside = res.data.outsidePlanList;\n          $scope.formData.plan = res.data.tomorrowPlanList;\n          $scope.formData.id = res.diary.diaryid;\n          $scope.formData.diaryContent = res.diary.content;\n          $scope.formData.shareuid = User.removePrefix(res.diary.shareuid);\n\n          var today = res.diary.diarytime,\n            nextDay = res.diary.nextDiarytime;\n\n          $scope.formData.todayDate = today.year + '-' + today.month + '-' + today.day;\n          $scope.todayWeekday = today.weekday;\n          $scope.formData.plantime = nextDay.year + '-' + nextDay.month + '-' + nextDay.day;\n          $scope.tomorrowWeekday = nextDay.weekday;\n        }\n      })\n      .finally($ionicLoading.hide);\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryUnderingCtrl\n * @module diary.controllers\n * @description\n *   日志下属日志控制器\n */\n  .controller('DiaryUnderingCtrl',function($scope, $stateParams, $ionicHistory, $ionicScrollDelegate, $state, userInfoFilter, dateFilter, Diary){\n    $scope.list = [];\n    $scope.title = userInfoFilter($stateParams.id, 'realname');\n\n    $scope.loadMore = function() {\n      return Diary.personal({\n        uid: $stateParams.id,\n        page: $scope.pages ? $scope.pages.page + 2 : 1\n      }).success(function(res) {\n        if (res.isSuccess) {\n          $ionicScrollDelegate.resize();\n          $scope.list = $scope.list.concat(res.diary);\n          $scope.pages = res.pages;\n          $scope.isattention = res.isattention;\n          $scope.dashboardConfig = res.dashboardConfig;\n        }\n      });\n    };\n    $scope.loadMore();\n\n    $scope.refresh = function() {\n      $scope.list.length = 0;\n      delete $scope.pages;\n      $scope.loadMore().finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    };\n\n    $scope.groupByMonth = function(item) {\n      return dateFilter(item.diarytime * 1000, 'M月');\n    };\n\n    $scope.attention = function() {\n      Diary.attention($stateParams.id).success(function() {\n        $scope.isattention = 1;\n      })\n    };\n\n    $scope.unattention = function() {\n      Diary.unattention($stateParams.id).success(function() {\n        $scope.isattention = 0;\n      })\n    };\n  });","/**\n * @ngdoc module\n * @name diary\n * @description\n *   工作日志模块\n */\n\nangular.module('diary', ['ionic', 'diary.controllers', 'diary.services', 'diary.filters'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'diary', title: '工作日志', route: '#/diary', state: 'diary.index', icon: 'img/modicon/diary.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/diary', '/diary/index');\n\n\n  $stateProvider\n    // setup an abstract state for the tabs directive\n    .state('diary', {\n      url: \"/diary\",\n      abstract: true,\n      template: '<ion-nav-view name=\"diary\"></ion-nav-view>',\n      resolve: UserProvider.resolve\n    })\n\n    .state('diary.index', {\n      url: '/index',\n      talkingDataLabel: '工作日志-主页',\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-index.html',\n          controller: 'DiaryIndexCtrl'\n        }\n      }\n    })\n\n    .state('diary.personal', {\n      url: '/personal',\n      talkingDataLabel: '工作日志-我的日志',\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-personal.html',\n          controller: 'DiaryPersionalCtrl'\n        }\n      }\n    })\n\n    .state('diary.create', {\n      url: '/create',\n      talkingDataLabel: '工作日志-写日志',\n      cache: false,\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-create.html',\n          controller: 'DiaryCreateCtrl'\n        }\n      }\n    })\n\n    .state('diary.edit', {\n      url: '/edit/:id',\n      talkingDataLabel: '工作日志-编辑日志',\n      cache: false,\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-edit.html',\n          controller: 'DiaryEditCtrl'\n        }\n      }\n    })\n\n    .state('diary.detail', {\n      url: '/detail/:id',\n      talkingDataLabel: '工作日志-查看日志',\n      cache: false,\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-detail.html',\n          controller: 'DiaryDetailCtrl'\n        }\n      }\n    })\n\n    .state('diary.review', {\n      url: '/review?date',\n      talkingDataLabel: '工作日志-点评下属',\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-review.html',\n          controller: 'DiaryReviewCtrl'\n        }\n      }\n    })\n\n    .state('diary.follow', {\n      url: '/follow?date',\n      talkingDataLabel: '工作日志-交流日志',\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-follow.html',\n          controller: 'DiaryFollowCtrl'\n        }\n      }\n    })\n\n    .state('diary.underling',{\n     url:'/underling/:id',\n     talkingDataLabel:'工作日志-下属日志',\n      views: {\n        'diary':{\n          templateUrl:'templates/diary/diary-underling.html',\n          controller:'DiaryUnderingCtrl'\n        }\n      }\n    })\n\n});","/**\n * @ngdoc module\n * @name diary.filters\n * @description\n *   工作日志模块过滤器\n */\n\nangular.module('diary.filters', [])\n\n/**\n * @ngdoc filter\n * @module diary.filters\n * @name diaryPercentage\n * @description\n *   将日志计划进度转化为百分比值\n */\n.filter('diaryPercentage', function() {\n\treturn function(val) {\n\t\treturn val * 10 + '%';\n\t}\n})\n\n/**\n * @ngdoc filter\n * @module diary.filters\n * @name numToHHmm\n * @description\n *   将数字转化为00:00格式的时间\n */\n.filter('numToHHmm', function() {\n\n\tfunction fillZero(num) {\n\t\treturn num >= 10 ? '' + num : '0' + num;\n\t}\n\n\tfunction formatTime(num) {\n\t\tvar hour = Math.floor(+num),\n\t\t\tminute = Math.floor((+num % 1) * 60);\n\t\treturn fillZero(hour) + ':' + fillZero(minute);\n\t}\n\n\treturn formatTime;\n})\n\n/**\n * @ngdoc filter\n * @module diary.filters\n * @name diaryTimeRemind\n * @description\n *   将数字段转化为00:00格式的时间段\n */\n.filter('diaryTimeRemind', function(numToHHmmFilter) {\n\t// input => '15.5,16'\n\t// output => '15:30-16:00'\n\treturn function(timeremind) {\n\t\tif(timeremind === '') return;\n\t\t\tvar timeArr = timeremind.split(','); // ['15.5', '16']\n\t\t\treturn numToHHmmFilter(timeArr[0]) + '-' + numToHHmmFilter(timeArr[1]);\n\t};\n})\n\n","/**\n * @ngdoc overview\n * @name diary.services\n * @description\n *   工作日志模块服务\n */\n\nangular.module('diary.services', [])\n\n.constant('SCHEDULE', [\n  { value: '0', percent: '0%' },\n  { value: '1', percent: '10%' },\n  { value: '2', percent: '20%' },\n  { value: '3', percent: '30%' },\n  { value: '4', percent: '40%' },\n  { value: '5', percent: '50%' },\n  { value: '6', percent: '60%' },\n  { value: '7', percent: '70%' },\n  { value: '8', percent: '80%' },\n  { value: '9', percent: '90%' },\n  { value: '10', percent: '100%' }\n])\n\n/**\n * @ngdoc service\n * @name diary.services.Diary\n * @description\n *   日志通用服务\n */\n.factory('Diary', function($http, Settings) {\n  var moduleUrl = Settings.rootUrl + '/diary';\n\n  function create(data) {\n    return $http.post(moduleUrl + '/save', data)\n  }\n\n  function remove(id) {\n    return $http.post(moduleUrl + '/del', {\n      diaryids: id\n    });\n  }\n\n  function get(id) {\n    return $http.get(moduleUrl + '/show', {\n      params: { id: id }\n    })\n  }\n\n  function update(data) {\n    return $http.post(moduleUrl + '/update', data)\n  }\n\n  return {\n    create: create,\n    get: get,\n    update: update,\n    remove: remove,\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#addComment\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   data    表单数据\n     *\n     * @description\n     *   新增一条日志评论\n     *\n     * - `diaryid` ：     日志ID\n     * - `content` ：     内容，可带html标签\n     * - `uid` ：         评论者UID\n     * - `tocid` ：       被回复的评论的ID\n     * - `touid` ：       被回复的评论的作者的UID\n     * - `from` ：        客户端类型，0：网站；1：手机网页版；2：android；3：iphone\n     * - `commentcount` ：该评论回复数，默认0\n     *\n     * @returns   {Object}  $q.defer.promise\n     */\n    addComment: function(data) {\n      data = angular.extend({\n        from: 1\n      }, data);\n\n      return $http.post(moduleUrl + '/addComment', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#index\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   params    请求参数\n     * @description\n     *   获取我的日志列表\n     *\n     * @returns   {HttpPromise}   HttpPromise\n     */\n    mine: function(params){\n      return $http.get(moduleUrl, { params: params });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#allsubs\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   params    请求参数\n     * @description\n     *   获取下属日志列表\n     *   \n     * @returns   {HttpPromise}   HttpPromise\n     */\n    allsubs: function(params){\n      return $http.get(moduleUrl + '/allsubs', { params: params });\n    },\n\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#other\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   params    请求参数\n     * @description\n     *   获取其他日志列表\n     *   \n     * @returns   {HttpPromise}   HttpPromise\n     */\n    other: function(params){\n      return $http.get(moduleUrl + '/other', { params: params });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#show\n     * @methodOf  diary.services.Diary\n     * @param     {String}   id    日志id\n     * @description\n     *   获取单条日志数据\n     *   \n     * @returns   {HttpPromise}   HttpPromise\n     */\n    show: function(id){\n      return $http.get(moduleUrl + '/show', { params: { id : id } })\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#add\n     * @methodOf  diary.services.Diary\n     * @param     {String}   diaryDate    格式为'yyyy-MM-dd'的日期\n     *\n     * @description\n     *   获取指定日期的原计划数据\n     */\n    add: function(diaryDate){\n      return $http.get(moduleUrl + '/add' + (diaryDate ? '&diaryDate=' + diaryDate: ''));\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#edit\n     * @methodOf  diary.services.Diary\n     * @param     {String}   id    日志 id\n     *\n     * @description\n     *   获取指定日志的编辑数据\n     */\n    edit: function(id) {\n      return $http.get(moduleUrl + '/edit&diaryid=' + id);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#personal\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   params    请求参数\n     *\n     * @description\n     *  查看某人日志\n     */\n    personal: function(params){\n      return $http.get(moduleUrl + '/personal',{ params: params });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#attention\n     * @methodOf  diary.services.Diary\n     * @param     {String}   auid    用户 id\n     *\n     * @description\n     *  关注用户\n     */\n    attention: function(auid){\n      return $http.get(moduleUrl + '/attention',{params: { auid : auid}})\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#unattention\n     * @methodOf  diary.services.Diary\n     * @param     {String}   auid    用户 id\n     *\n     * @description\n     *  取消关注用户\n     */\n    unattention: function(auid){\n      return $http.get(moduleUrl + '/unattention',{ params: { auid : auid}})\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#planfromschedule\n     * @methodOf  diary.services.Diary\n     * @param     {String}   todayDate    格式为'yyyy-MM-dd'的日期\n     *\n     * @description\n     *   获取指定日期的日程事件列表\n     */\n    planfromschedule: function(todayDate){\n      return $http.get(moduleUrl + '/planfromschedule',{ params: { todayDate : todayDate }})\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#setting\n     * @methodOf  diary.services.Diary\n     *\n     * @description\n     *   获取个人设置数据\n     */\n    setting: function(){\n      return $http.get(moduleUrl + '/setting')\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#savesetting\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   data    表单数据\n     *\n     * @description\n     *   保存个人设置\n     */\n    savesetting: function(data){\n      return $http.post(moduleUrl + '/savesetting', data)\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name diary.services.DiaryUtils\n * @description\n *   日志模块工具函数集\n */\n.factory('DiaryUtils', function($filter, $ionicPopup, $timeout, $state, dateFilter, IbPopup, User) {\n\n  return {\n    // 处理提交的表单\n    handleFormData: function(data) {\n      return angular.extend({}, data, {\n        plantime: $filter('date')(data.plantime, 'yyyy-MM-dd'),\n        shareuid: User.addPrefix(data.shareuid)\n      })\n    },\n\n    //设置时间提醒\n    setRemind: function($scope, plan){\n      $scope.remindConf = {\n        start: $scope.workStart.start,\n        continueTime: 0.5,\n        getStartHours: function() {\n          var ret = [];\n          for(var i = $scope.workStart.start; i < $scope.workStart.end; i += 0.5) {\n            ret.push(i);\n          }\n          return ret;\n        },\n        getContinueTimes: function() {\n          var ret = [];\n          for(var i = 0.5; i <= $scope.workStart.end - this.start; i += 0.5) {\n            ret.push(i);\n          }\n          return ret;\n        }\n      };\n\n      function popupContinueTime(plan){\n        $ionicPopup.show({\n          template: '<select class=\"col\" ng-model=\"remindConf.continueTime\" ng-options=\"(\\'持续 \\' + item + \\' 小时\\') for item in remindConf.getContinueTimes() track by item\"></select>',\n          title: '持续时间',\n          scope: $scope,\n          buttons: [{\n            text: '取消'\n          }, {\n            text: '确认',\n            type: 'button-positive',\n            onTap: function(ok) {\n              if(ok) {\n                plan.timeremind = $scope.remindConf.start + ',' + ($scope.remindConf.start + +$scope.remindConf.continueTime);\n              }\n            }\n          }]\n        })\n      }\n\n      $ionicPopup.show({\n        template: '<select class=\"col\" ng-model=\"remindConf.start\" ng-options=\"(item|numToHHmm) for item in remindConf.getStartHours() track by item\"></select>',\n        title: '开始时间',\n        scope: $scope,\n        buttons: [{\n          text: '取消'\n        }, {\n          text: '确认',\n          type: 'button-positive',\n          onTap: function(ok) {\n            if(ok) {\n              $timeout(function(){\n                popupContinueTime(plan);\n              }, 0);\n            }\n          }\n        }]\n      });\n    },\n\n    //取消时间提醒\n    delRemind: function(plan){\n      plan.timeremind = '';\n    },\n\n    //选择开始日期\n    selectedStartDate: function($scope){\n      $ionicPopup.show({\n        template: '<div class=\"diary-select\">' +\n          '<input type=\"date\" class=\"diary-item\" ng-model=\"formData.startDate\"  data-tap-disabled =\"true\" required >' +\n          '</div>',\n        title: '选择日期',\n        scope: $scope,\n        buttons: [{\n          text: '取消'\n        }, {\n          text: '确认',\n          type: 'button-positive',\n          onTap: function(e) {\n            var startDate = $scope.formData.startDate,\n              today = new Date;\n\n            if (!startDate) return;\n\n            $timeout(function() {\n              if (startDate > today) {\n                IbPopup.alert({\n                  title: '抱歉，选中的日期没有日志且没有新建权限！'\n                })\n              } else {\n                $scope.formData.originalPlan = '';\n                $scope.formData.todayDate = dateFilter(startDate, 'yyyy-MM-dd');\n                $scope.todayWeekday = dateFilter(startDate, 'EEEE')\n              }\n            }, 0);\n            return true;\n          }\n        }]\n      })\n    },\n\n    //选择结束日期\n    selectedEndDate: function($scope){\n      $ionicPopup.show({\n        template: '<div class=\"diary-select\">' +\n          '<input type=\"date\" class=\"diary-item\" ng-model=\"formData.endDate\"  data-tap-disabled =\"true\" required >' +\n          '</div>' +\n          '<div>' + '{{date}}' + '<div>',\n        title: '选择日期',\n        scope: $scope,\n        buttons: [{\n          text: '取消'\n        }, {\n          text: '确认',\n          type: 'button-positive',\n          onTap: function(e) {\n            var endDate = Date.parse(new Date($scope.formData.endDate));\n            if (!endDate) return;\n            $scope.formData.plantime = dateFilter(endDate, 'yyyy-MM-dd');\n            $scope.tomorrowWeekday = dateFilter(endDate, 'EEEE')\n          }\n        }]\n      })\n    }\n\n  }\n\n})\n\n\n\n","/**\n * @ngdoc module\n * @name docs.controllers\n * @description\n *   公文模块控制器\n */\nangular.module('docs.controllers', [])\n\n/**\n * @ngdoc controller\n * @name DocsPublishedCtrl\n * @module docs.controllers\n * @description\n *   已发布列表页控制器\n */\n.controller('DocsPublishedCtrl', function($scope, $state, Settings, DocsPublished){\n  $scope.list = DocsPublished;\n  $scope.title = '已发布';\n  $scope.$root.hideTabs = false;\n\n  $scope.checkNoData = function() {\n    return !$scope.list.docs.length && !$scope.list.hasMore;\n  }\n\n  $scope.open = function(n) {\n    $state.go('docs.detail', { id: n.docid });\n  }\n\n  // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n  // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n  if(!$scope.list.hasDocs() || $scope.list.params.search) {\n    $scope.list.fetch({\n      catid: 0,\n      page: 1,\n      search: ''\n    }, true)\n  }\n\n})\n\n/**\n * @ngdoc controller\n * @name DocsUnsignedCtrl\n * @module docs.controllers\n * @description\n *   未签收列表页控制器\n */\n.controller('DocsUnsignedCtrl', function($scope, $state, Settings, DocsUnsigned){\n  $scope.list = DocsUnsigned;\n  $scope.title = '未签收';\n  $scope.$root.hideTabs = false;\n\n  $scope.checkNoData = function() {\n    return !$scope.list.docs.length && !$scope.list.hasMore;\n  }\n\n  $scope.open = function(n) {\n    $state.go('docs.unsignedDetail', { id: n.docid });\n  }\n\n  // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n  // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n  if(!$scope.list.hasDocs() || $scope.list.params.search) {\n    $scope.list.fetch({\n      catid: 0,\n      page: 1,\n      search: ''\n    }, true)\n  }\n\n})\n\n\n/**\n * @ngdoc controller\n * @name DocsSignedCtrl\n * @module docs.controllers\n * @description\n *   已签收列表页控制器\n */\n.controller('DocsSignedCtrl', function($scope, $state, Settings, DocsSigned){\n  $scope.list = DocsSigned;\n  $scope.title = '已签收';\n  $scope.$root.hideTabs = false;\n\n  $scope.checkNoData = function() {\n    return !$scope.list.docs.length && !$scope.list.hasMore;\n  }\n\n  $scope.open = function(n) {\n    $state.go('docs.signedDetail', { id: n.docid });\n  }\n\n  // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n  // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n  if(!$scope.list.hasDocs() || $scope.list.params.search) {\n    $scope.list.fetch({\n      catid: 0,\n      page: 1,\n      search: ''\n    }, true)\n  }\n\n})\n\n/**\n * @ngdoc controller\n * @name DocsCategoryCtrl\n * @module docs.controllers\n * @description\n *   分类控制器\n */\n.controller('DocsCategoryCtrl', function($scope, $state, $stateParams, DocsPublished){\n  $scope.list = DocsPublished;\n  $scope.categorys = [];\n  $scope.title = '按分类';\n  $scope.rootDir = !($stateParams.cid && $stateParams.cid != 0);\n\n  $scope.checkNoData = function() {\n    return !$scope.list.news.length && !$scope.list.hasMore;\n  };\n\n  // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n  // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n  $scope.list.fetch({\n    catid: $stateParams.cid,\n    page: 1\n  }, true)\n  .success(function(res) {\n    $scope.categorys = res.category;\n  });\n\n})\n\n/**\n * @ngdoc controller\n * @name DocsPublishedCtrl\n * @module docs.controllers\n * @description\n *   新闻详细页控制器\n */\n.controller('DocsDetailCtrl', function($scope, $sce, $filter, $stateParams, Docs) {\n  $scope.docs = {};\n  $scope.signing = false;\n\n  $scope.sign = function(docid) {\n    $scope.signing = true;\n    Docs.sign(docid)\n    .success(function(){ \n      $scope.signing = false;\n      $scope.docs.issign = '1';\n    })\n    .error(function(){ $scope.signing = false; })\n  }\n\n  Docs.get($stateParams.id)\n  .success(function(res) {\n    $scope.docs = res.data;\n    $scope.attach = res.attach;\n    if($scope.docs.content) {\n      $scope.docs.content = $sce.trustAsHtml( $filter('editorContent')($scope.docs.content) );\n    }\n  }); \n})","/**\n * @ngdoc module\n * @name docs\n * @description\n *   公文模块入口\n */\n\nangular.module('docs', ['ionic', 'docs.controllers', 'docs.services'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'docs', title: '公文', route: '#/docs', state: 'docs.published', icon: 'img/modicon/docs.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/docs', '/docs/published');\n\n  $stateProvider\n  // setup an abstract state for the tabs directive\n  .state('docs', {\n    url: \"/docs\",\n    abstract: true,\n    templateUrl: \"templates/docs/docs.html\",\n    resolve: UserProvider.resolve\n  })\n\n  .state('docs.published', {\n    url: '/published',\n    talkingDataLabel: '公文-已发布',\n    views: {\n      'docs-published': {\n        templateUrl: 'templates/docs/docs-list.html',\n        controller: 'DocsPublishedCtrl'\n      }\n    }\n  })\n\n  .state('docs.unsigned', {\n    url: '/unsigned',\n    talkingDataLabel: '公文-未签收',\n    views: {\n      'docs-unsigned': {\n        templateUrl: 'templates/docs/docs-list.html',\n        controller: 'DocsUnsignedCtrl'\n      }\n    }\n  })\n\n  .state('docs.signed', {\n    url: '/signed',\n    talkingDataLabel: '公文-已签收',\n    views: {\n      'docs-signed': {\n        templateUrl: 'templates/docs/docs-list.html',\n        controller: 'DocsSignedCtrl'\n      }\n    }\n  })\n\n  .state('docs.category', {\n    url: '/category?cid',\n    talkingDataLabel: '公文-按分类',\n    views: {\n      'docs-category': {\n        templateUrl: 'templates/docs/docs-category.html',\n        controller: 'DocsCategoryCtrl'\n      }\n    }\n  })\n\n  .state('docs.detail', {\n    url: '/detail/:id',\n    talkingDataLabel: '公文-查看公文',\n    views: {\n      'docs-published': {\n        templateUrl: 'templates/docs/docs-detail.html',\n        controller: 'DocsDetailCtrl'\n      }\n    }\n  })\n\n  .state('docs.unsignedDetail', {\n    url: '/unsignedDetail/:id',\n    talkingDataLabel: '公文-查看公文',\n    views: {\n      'docs-unsigned': {\n        templateUrl: 'templates/docs/docs-detail.html',\n        controller: 'DocsDetailCtrl'\n      }\n    }\n  })\n\n  .state('docs.signedDetail', {\n    url: '/signedDetail/:id',\n    talkingDataLabel: '公文-查看公文',\n    views: {\n      'docs-signed': {\n        templateUrl: 'templates/docs/docs-detail.html',\n        controller: 'DocsDetailCtrl'\n      }\n    }\n  })\n\n  .state('docs.categoryDetail', {\n    url: '/categoryDetail/:id',\n    talkingDataLabel: '公文-查看公文',\n    views: {\n      'docs-category': {\n        templateUrl: 'templates/docs/docs-detail.html',\n        controller: 'DocsDetailCtrl'\n      }\n    }\n  })\n\n});","/**\n * @ngdoc module\n * @name news.filters\n * @description\n *   新闻模块过滤器\n */\n\nangular.module('news.filters', [])\n","/**\n * @ngdoc module\n * @name docs.services\n * @description\n *   公文模块相关服务\n */\nangular.module('docs.services', [])\n\n/**\n * @ngdoc service\n * @name Docs\n * @module docs.services\n * @description\n *   公文模块数据交互及处理\n */\n.factory('Docs', function($http, $ionicLoading, Settings){\n\n  var moduleUrl = Settings.rootUrl + '/docs';\n\n  return {\n\n    get: function(id) {\n      $ionicLoading.show();\n\n      return $http.get(moduleUrl + '/show', {\n        params: { id: id }\n      })\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n    },\n\n    sign: function(id) {\n      return $http.get(moduleUrl + '/sign', {\n        params: { docid: id }\n      })\n    }\n\n  }\n\n})\n\n.factory('DocsList', function($http, $ionicLoading, Settings, Utils ) {\n\n  var moduleUrl = Settings.rootUrl + '/docs';\n\n  function DocsList(url, options){\n    this.url = url;\n    this.options = options;\n\n    this.hasMore = true;\n    this.docs = [];\n\n    this.params = {};\n  }\n\n  angular.extend(DocsList.prototype, {\n    /**\n     * @ngdoc method\n     * @name Docs#fetch\n     * @description \n     *   获取文件列表数据\n     *   返回数据格式为\n     *   {\n     *     datas: [\n     *       { addtime, author, uid, subject, content, uptime, readstatus... }\n     *       ...\n     *     ],\n     *     pages: { page, pageCount, pageSize }\n     *   }\n     *   addtime: \"1409381646\"\n     * @param {Obejct} param 查询条件 catid | page | keyword...\n     * @returns {Object} promise\n     */\n\n    fetch: function(params, reset, extend) {\n      var _this = this;\n      if(reset) {\n        this.docs = [];\n        this.hasMore = true;\n      }\n\n      if(extend === false) {\n        this.params = params;\n      } else {\n        angular.extend(this.params, params);\n      }\n\n      $ionicLoading.show();\n\n      return $http.get(this.url, {\n        params: this.params\n      })\n\n      .success(function(res){\n        if(res.pages.page < res.pages.pageCount) {\n          _this.docs = _this.docs.concat(res.datas);\n          // _this.params.page += 1;\n        }\n\n        // 判断是否还能加载更多\n        _this.hasMore = res.pages.page < res.pages.pageCount - 1\n      })\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n    },\n\n    search: function(keyword) {\n      return this.fetch({\n        page: 1,\n        search: keyword\n      }, true);\n    },\n\n    loadMore: function() {\n      return this.fetch({\n        page: this.params.page + 1\n      });\n    },\n\n    hasDocs: function() {\n      return !!this.docs.length;\n    }\n  });\n\n  return DocsList;\n})\n\n.factory('DocsPublished', function(DocsList, Settings) {\n  var list = new DocsList(Settings.rootUrl + '/docs');\n\n  return list;\n})\n\n.factory('DocsUnsigned', function(DocsList, Settings) {\n  var list = new DocsList(Settings.rootUrl + '/docs&type=nosign');\n\n  return list;\n})\n\n.factory('DocsSigned', function(DocsList, Settings) {\n  var list = new DocsList(Settings.rootUrl + '/docs&type=sign');\n\n  return list;\n})\n\n\n","/**\n * @ngdoc module\n * @name news.controllers\n * @description\n *   新闻模块控制器\n */\nangular.module('news.controllers', [])\n\n/**\n * @ngdoc controller\n * @name NewsIndexCtrl\n * @module news.controllers\n * @description\n *   已发布列表页控制器\n */\n  .controller('NewsIndexCtrl', function($scope, NewsIndex, News){\n    $scope.list = NewsIndex;\n    $scope.title = '已发布';\n\n    $scope.refresh = function() {\n      $scope.list.fetch({\n        catid: 0,\n        page: 0,\n        search: ''\n      }, true).finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    };\n\n\n    $scope.open = function(n) {\n      News.open(n, 'news.detail');\n    };\n\n    // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n    // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n    if(!$scope.list.hasNews() || $scope.list.params.search) {\n      $scope.list.fetch({\n        catid: 0,\n        page: 0,\n        search: ''\n      }, true)\n    }\n\n  })\n\n/**\n * @ngdoc controller\n * @name NewsUnreadCtrl\n * @module news.controllers\n * @description\n *   未读列表页控制器\n */\n  .controller('NewsUnreadCtrl', function($scope, $ionicHistory, $state, IbPopup, NewsUnread, News){\n    $scope.list = NewsUnread;\n    $scope.title = '未读';\n\n    $scope.refresh = function() {\n      $scope.list.fetch({\n        catid: 0,\n        page: 0,\n        search: ''\n      }, true).finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    };\n\n    $scope.open = function(n) {\n      News.open(n, 'news.detail');\n    };\n\n    $scope.markRead = function(){\n      IbPopup.confirm({\n        title:'确定要将此分类新闻全部标记成已读？',\n      }).then(function(flag){\n        if(flag){\n          News.readall().success($scope.refresh);\n        }\n      });\n    };\n\n    // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n    // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n    if(!$scope.list.hasNews() || $scope.list.params.search) {\n      $scope.refresh();\n    }\n  })\n\n/**\n * @ngdoc controller\n * @name NewsUnapprovalCtrl\n * @module news.controllers\n * @description\n *   未审核列表页控制器\n */\n  .controller('NewsUnapprovalCtrl', function($scope, News){\n    function load(num) {\n      return  News.list({ type: 'notallow', page: num }).success(function(res){\n        $scope.news = res.data;\n        $scope.pages = res.pages;\n      });\n    }\n\n    load();\n\n    $scope.loadMore = function(){\n      load($scope.pages.page + 1);\n    };\n\n    $scope.refresh = function() {\n      load().finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    };\n\n    $scope.open = function(n) {\n      News.open(n, 'news.approval');\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name NewsCategoryCtrl\n * @module news.controllers\n * @description\n *   分组页控制器\n */\n  .controller('NewsCategoryCtrl', function($scope, $ionicScrollDelegate, News){\n    News.category().success(function(res){\n      var categoryList = res.data;\n      $scope.histories = [];\n\n      //加载新的列表；\n      function loadNewsList(catid) {\n        return News.list({ catid: catid }).success(function(res) {\n          $scope.list = res.data;\n        });\n      }\n\n      $scope.open = function(n) {\n        News.open(n, 'news.detail');\n      };\n\n      function getCategories(category){\n        var ret = [];\n        angular.forEach(categoryList, function(_category) {\n          if(_category.pid === category.catid) {\n            ret.push(_category);\n          }\n        });\n        return ret;\n      }\n\n      $scope.enterCategory = function(category){\n        // 把当前目录放入历史里\n        $scope.list = [];\n        if($scope.currentCategory) {\n          $scope.histories.push($scope.currentCategory);\n        }\n\n        if(category.catid !== '0'){\n          loadNewsList(category.catid)\n        }\n        $scope.currentCategory = category;\n        $scope.categories = getCategories(category);\n      };\n\n      //返回上一个\n      $scope.back = function(){\n        $scope.currentCategory = $scope.histories.pop();\n        loadNewsList($scope.currentCategory.catid);\n        $scope.categories = getCategories($scope.currentCategory);\n      };\n\n      $scope.toCategory = function(category){\n        $scope.currentCategory = category;\n        $scope.histories.splice($scope.histories.indexOf(category));\n        loadNewsList($scope.currentCategory.catid);\n        $scope.categories = getCategories($scope.currentCategory);\n      };\n\n      $scope.enterCategory({\n        catid: '0',\n        name: ' '\n      });\n\n      // 监听路径历史，自动将面包屑滚动到末端\n      var breadcrumbScrollInstance = $ionicScrollDelegate.$getByHandle('news-breadcrumb-scroll');\n      $scope.$watchCollection('histories', function() {\n        breadcrumbScrollInstance.scrollBottom(true);\n      });\n    });\n\n    // news-breadcrumb-scroll\n  })\n\n/**\n * @ngdoc controller\n * @name NewsDetailCtrl\n * @module news.controllers\n * @description\n *   新闻详细页控制器\n */\n  .controller('NewsDetailCtrl', function($scope, $sce, $filter, $stateParams, $ionicActionSheet, $ionicModal, $ionicLoading, $ionicHistory, $ionicPopup, $state, dateFilter, userInfoFilter, IbPopup, Utils, News, NewsIndex) {\n    $scope.news = {};\n\n    News.get($stateParams.id)\n      .success(function(res) {\n        $scope.news = res.data;\n      });\n\n    function getCommentParams(articleid){\n      return{\n        articleid: articleid,\n        isDesc: 1,\n        limit: 9999\n      }\n    }\n\n    News.getComments(getCommentParams($stateParams.id)).success(function(res){\n      $scope.commentList = res.data;\n    });\n\n    $scope.showMore = function(){\n      $scope.form = {};\n      $ionicActionSheet.show({\n        buttons:[\n          { text: $scope.news.istop == '0' ?  '置顶' : '取消置顶' },\n          { text: '移动' }\n        ],\n        buttonClicked:function(index){\n          if(index === 0 ){\n            var params ={\n              articleids: $stateParams.id,\n              topEndTime:  ''\n            };\n            if($scope.news.istop == '0'){\n              $ionicPopup.show({\n                template: ' <input type=\"date\" data-tap-disabled=\"true\" ng-model=\"form.topEndTime\">',\n                title: '过期时间',\n                scope: $scope,\n                buttons: [\n                  { text: '取消' },\n                  {\n                    text: '确认',\n                    type: 'button-positive',\n                    onTap: function(e) {\n                      if($scope.form.topEndTime){\n                        params.topEndTime = dateFilter($scope.form.topEndTime, 'yyyy-MM-dd');\n                        $ionicLoading.show();\n                        News.top(params)\n                          .success(function(res){\n                            $scope.news.istop = '1';\n                            NewsIndex.reset();\n                            $ionicHistory.clearCache(['news.published']);\n                          })\n                          .finally($ionicLoading.hide);\n                      }\n                    }\n                  }\n                ]\n              });\n            } else{\n              $ionicLoading.show();\n              News.top(params)\n                .success(function() {\n                  $scope.news.istop = '0';\n                })\n                .finally($ionicLoading.hide);\n            }\n          }\n\n          if(index === 1 ){\n            $ionicModal.fromTemplateUrl('templates/news/news-move.html',{\n              scope: $scope,\n              animation:'slide-in-up'\n            })\n              .then(function(modal) {\n                $scope.moveModel = modal;\n                $scope.moveModel.show();\n                $scope.catid = '';\n\n                News.category().success(function(res){\n                  $scope.categoryList = res.data;\n                  var currentPid = 0;\n\n                  //将分组整理成树结构\n                  function categoryTree(categoryList, pid) {\n                    var result = [], temp;\n                    for (var i = 0; i < categoryList.length; i++) {\n                      categoryList[i].checked = false;\n                      categoryList[i].showChildrenList = true;\n\n                      //首先找到pid 等于0的文件夹；\n                      if (categoryList[i].pid == pid) {\n                        temp = categoryTree(categoryList, categoryList[i].catid);\n                        if (temp.length > 0) {\n                          categoryList[i].childrenList = temp;\n                        }\n                        result.push(categoryList[i]);\n                      }\n                    }\n                    return result;\n                  }\n\n                  $scope.categorys = categoryTree($scope.categoryList, currentPid);\n\n                  $scope.selectCategory = function(item){\n                    if(item.checked === true){\n                      $scope.catid = item.catid\n                      angular.forEach($scope.categoryList, function(category){\n                        category.checked = false;\n                      });\n                      item.checked = true;\n                    } else {\n                      $scope.catid = '';\n                    }\n                  };\n\n                  $scope.submit = function(){\n                    var params = {\n                      articleids: $scope.news.articleid,\n                      catid: $scope.catid\n                    };\n                    $ionicLoading.show();\n                    News.move(params).success(function(res){\n                      $scope.moveModel.hide();\n                      $ionicLoading.hide();\n\n                      Utils.clearStateCacheAndGo('news.published');\n                    });\n                  }\n                })\n              })\n          }\n          return true;\n        },\n        destructiveText: '删除',\n        cancelText: '取消',\n        destructiveButtonClicked: function() {\n          var params = {\n            articleids:$scope.news.articleid\n          };\n          News.delete(params).success(function(res){\n            Utils.clearStateCacheAndGo('news.published');\n          })\n        }\n      })\n    };\n\n    $scope.openComment = function(type, cm){\n      $ionicModal.fromTemplateUrl('templates/news/news-comment.html',{\n        scope: $scope,\n        animation:'slide-in-up'\n      })\n        .then(function(modal){\n          $scope.comment = {};\n          $scope.commentModal = modal;\n          $scope.commentModal.show();\n          if (type === 'reply'){\n            $scope.comment.content = cm.touid ? '回复 @' + userInfoFilter(cm.uid,'realname') + ' : ': ''\n          }\n\n          $scope.submit = function(){\n            var params = {\n              type:type ,\n              content: $scope.comment.content,\n            };\n\n            if(type === 'comment'){\n              params.rowid = $scope.news.articleid;\n            } else {\n              params.tocid = cm.cid;\n              // 如果直接回复评论，则\n              if(cm.tocid === '0') {\n                params.rowid = cm.cid;\n                // 否则，如果回复评论下的回复，则\n              } else {\n                params.rowid = cm.rowid;\n              }\n            }\n\n\n            News.addComment(params).success(function(res){\n              $scope.commentModal.hide();\n              $ionicLoading.show();\n              News.getComments(getCommentParams($scope.news.articleid)).success(function(res){\n                $ionicLoading.hide();\n                $scope.commentList = res.data;\n              });\n            })\n          };\n        })\n    };\n\n\n    $scope.openCommentDetail = function(){\n      $ionicModal.fromTemplateUrl('templates/news/news-comment-detail.html',{\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal) {\n          $scope.commentTetailModal = modal;\n          $scope.commentTetailModal.show();\n\n            News.getComments(getCommentParams($scope.news.articleid)).success(function(res){\n              $ionicLoading.show();\n              if(res.isSuccess){\n                $scope.commentList = res.data\n              }\n            }).finally($ionicLoading.hide)\n        })\n    };\n\n    $scope.openReaderDetail = function(){\n      $ionicModal.fromTemplateUrl('templates/news/news-reader-detail.html',{\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal) {\n          $scope.readerTetailModal = modal;\n          $scope.readerTetailModal.show();\n          var params = {\n            articleid :$scope.news.articleid\n          };\n          News.getReaders(params).success(function(res){\n            $scope.readers = res.data;\n          })\n        })\n    };\n  })\n\n  .controller('NewsApprovalCtrl',function($scope, $stateParams, $sce, $filter, $ionicActionSheet, $ionicHistory, $ionicLoading, $ionicPopup, $state, IbPopup, News){\n    News.get($stateParams.id)\n      .success(function(res) {\n        $scope.news = res.data;\n      });\n\n    $scope.checkNews = function(){\n      $scope.form = {};\n      $ionicActionSheet.show({\n        buttons:[\n          { text: '通过'}\n        ],\n        buttonClicked:function(index){\n          if(index === 0 ){\n            $ionicLoading.show();\n            News.verify({ articleids: $scope.news.articleid })\n              .success(function(res){\n                $ionicLoading.hide();\n                if(res.isSuccess === false) {\n                  alert(res.msg);\n                } else {\n                  IbPopup.alert({ title : '审核通过'})\n                  $ionicHistory.clearCache([$ionicHistory.currentView().stateId]).then(function() {\n                    $state.reload();\n                  });\n                }\n              });\n\n            return true;\n          }\n        },\n        destructiveText: '退回',\n        cancelText: '取消',\n        destructiveButtonClicked: function() {\n          $ionicPopup.show({\n            template: '<input ng-model=\"form.reason\">',\n            title: '退回',\n            scope: $scope,\n            buttons: [\n              { text: '取消' },\n              {text: '确认',\n                type: 'button-positive',\n                onTap: function(e) {\n                  var params ={\n                    articleids: $scope.news.articleid,\n                    reason: $scope.form.reason\n                  };\n                  News.back(params).success(function(res){\n                    //判断当前的步骤是不是最后一步，如不是，剩下所有步骤的状态都设置成未审核；\n                    $ionicHistory.clearCache([$ionicHistory.currentView().stateId]).then(function() {\n                      $state.reload();\n                    })\n                  })\n                }\n              }\n            ]\n          });\n          return true;\n        }\n      })\n    }\n  });","/**\n * @ngdoc module\n * @name news.filters\n * @description\n *   新闻模块过滤器\n */\n\nangular.module('news.filters', [])\n","/**\n * @ngdoc module\n * @name news\n * @description\n *   信息中心模块入口\n */\n\nangular.module('news', ['ionic', 'news.controllers', 'news.services'/*, 'news.filters'*/])\n\n.run(function(Apps) {\n  Apps.install({ name: 'news', title: '新闻', route: '#/news', state: 'news.published', icon: 'img/modicon/news.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/news', '/news/published');\n\n  $stateProvider\n  // setup an abstract state for the tabs directive\n  .state('news', {\n    url: \"/news\",\n    abstract: true,\n    template:'<ion-nav-view name=\"news\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  .state('news.published', {\n    url: '/published',\n    talkingDataLabel: '新闻-已发布',\n    cache: false,\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-index.html',\n        controller: 'NewsIndexCtrl'\n      }\n    }\n  })\n\n  .state('news.unread', {\n    url: '/unread',\n    talkingDataLabel: '新闻-未读',\n    cache: false,\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-unread.html',\n        controller: 'NewsUnreadCtrl'\n      }\n    }\n  })\n\n    .state('news.unapproval', {\n      url: '/unapproval',\n      talkingDataLabel: '新闻-未审核',\n      cache: false,\n      views: {\n        'news': {\n          templateUrl: 'templates/news/news-unapproval.html',\n          controller: 'NewsUnapprovalCtrl'\n        }\n      }\n    })\n\n\n  .state('news.category', {\n    url: '/category?cid',\n    talkingDataLabel: '新闻-按分类',\n    cache: false,\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-category.html',\n        controller: 'NewsCategoryCtrl'\n      }\n    }\n  })\n\n  .state('news.detail', {\n    url: '/detail/:id',\n    talkingDataLabel: '新闻-查看新闻',\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-detail.html',\n        controller: 'NewsDetailCtrl'\n      }\n    }\n  })\n\n  .state('news.unreadDetail', {\n    url: '/unreadDetail/:id',\n    talkingDataLabel: '新闻-查看新闻',\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-detail.html',\n        controller: 'NewsDetailCtrl'\n      }\n    }\n  })\n\n  .state('news.readDetail', {\n    url: '/readDetail/:id',\n    talkingDataLabel: '新闻-查看新闻',\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-detail.html',\n        controller: 'NewsDetailCtrl'\n      }\n    }\n  })\n\n  .state('news.categoryDetail', {\n    url: '/categoryDetail/:id',\n    talkingDataLabel: '新闻-查看新闻',\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-detail.html',\n        controller: 'NewsDetailCtrl'\n      }\n    }\n  })\n\n    .state('news.approval', {\n      url: '/approval/:id',\n      talkingDataLabel: '新闻-审核新闻',\n      views: {\n        'news': {\n          templateUrl: 'templates/news/news-approval.html',\n          controller: 'NewsApprovalCtrl'\n        }\n      }\n    })\n\n\n});","/**\n * @ngdoc overview\n * @name  news.services\n * @description\n *   新闻模块相关服务\n */\nangular.module('news.services', [])\n\n/**\n * @ngdoc service\n * @name  news.services.News\n * @description\n *   新闻模块数据交互及处理\n */\n.factory('News', function($http, $state, $ionicLoading, Settings){\n\n  var moduleUrl = Settings.rootUrl + '/news';\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#get\n     * @methodOf  news.services.News\n     * @description \n     *   获取单条新闻的数据\n     * @param   {String}       id       新闻 id\n     * @returns {HttpPromise}  HttpPromise\n     */\n    get: function(id) {\n      $ionicLoading.show();\n\n      return $http.get(moduleUrl + '/show', { params: { articleid: id } })\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#list\n     * @methodOf  news.services.News\n     * @description \n     *   获取新闻列表\n     *   - `catid`：（可选）新闻分类\n     *   - `search`：（可选）搜索\n     *   - `type`：（可选）内容类型。new：未读、old：已读、待审核：notallow、草稿：draft\n     *   - `page`：（可选）第几页，从0开始计算。默认值为0\n     *   - `pagesize`：（可选）每页文章个数，默认值为10\n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    list: function(params) {\n      return $http.get(moduleUrl + '/index', { params: params })\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News##read\n     * @methodOf  news.services.News\n     * @description \n     *   改变新闻的状态为已读\n     *   \n     * @param   {String}       id     新闻 id\n     * @returns {HttpPromise}  HttpPromise\n     */\n    read: function(id) {\n      return $http.get(moduleUrl + '/read', { params: { articleid: id } })\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#open\n     * @methodOf  news.services.News\n     * @description \n     *   查看新闻详细\n     * @param   {Object}       news         新闻数据\n     * @param   {String}       detailState  详细页对应的 state\n     * @returns {HttpPromise}  HttpPromise\n     */\n    open: function(news, detailState) {\n      // 超链接类型\n      if(news.type == '2') {\n        window.open(news.url, '_blank', 'location=yes');\n      // 文章、图片类型\n      } else {\n        $state.go(detailState, { id: news.articleid });\n      }\n\n      if(!news.readstatus) {\n        this.read(news.articleid)\n        .success(function(res) {\n          if(res.isSuccess) news.readstatus = true;\n        });\n      }\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#category\n     * @methodOf  news.services.News\n     * @description\n     *   获取新闻分类\n     *   \n     * @returns {HttpPromise}  HttpPromise\n     */\n    category: function(){\n       return $http.get(moduleUrl+ '/category')\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#readall\n     * @methodOf  news.services.News\n     * @description\n     *    标识所有未读新闻为已读\n     *    \n     * @returns {HttpPromise}  HttpPromise\n     */\n    readall: function(){\n      return $http.post(moduleUrl+'/readall')\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#top\n     * @methodOf  news.services.News\n     * @description\n     *    置顶新闻/取消置顶新闻\n     *    请求参数说明：\n     *    - `articleids`：新闻id。如果有多个，使用逗号分开。如：1,2,3\n     *    - `topEndTime`：（可选）置顶过期时间。如果该值为空，则会取消置顶。\n     *    \n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    top: function(params){\n      return $http.post(moduleUrl+'/top', params)\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#del\n     * @methodOf  news.services.News\n     * @description\n     *    删除新闻\n     *    请求参数说明：\n     *    - `articleids`：新闻id。如果有多个，使用逗号分开。如：1,2,3\n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    delete: function(params){\n      return $http.post(moduleUrl+'/del', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#getReaders\n     * @methodOf  news.services.News\n     * @description\n     *    获取阅读人员列表\n     *    请求参数说明：\n     *    - `articleid`：新闻id\n     *    \n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    getReaders: function(params){\n      return $http.post(moduleUrl+ '/getReaders', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#verify\n     * @methodOf  news.services.News\n     * @description\n     *    审批通过\n     *    请求参数说明：\n     *    - `articleids`：新闻id。如果有多个，使用逗号分开。如：1,2,3\n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    verify: function(params){\n      return $http.post(moduleUrl+ '/verify', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#back\n     * @methodOf  news.services.News\n     * @description\n     *    审批退回\n     *    请求参数说明：\n     *    - `articleids`：新闻id。如果有多个，使用逗号分开。如：1,2,3\n     *    - `reason`：审批退回理由`\n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    back: function(params){\n      return $http.post(moduleUrl+ '/back',params)\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#addComment\n     * @methodOf  news.services.News\n     * @description\n     *    添加评论\n     *    请求参数说明：\n     *    - `type`：评论类型。comment：评论、reply：回复。\n     *    - `rowid`：如果是评论，则为新闻id；如果是回复评论，则为评论主体id。\n     *    - `content`：评论内容\n     *    - `tocid`：（可选）具体某条回复的id\n     *    - `url`：（可选）链接地址\n     *    - `detail`：（可选）详细来源信息描述\n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    addComment: function(params){\n      return $http.post(moduleUrl+ '/addComment', params)\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#getComments\n     * @methodOf  news.services.News\n     * @description\n     *    获取评论列表\n     *    \n     * @param   {String}       articleid    新闻id\n     * @returns {HttpPromise}  HttpPromise\n     */\n    getComments: function(params){\n      return $http.get(moduleUrl+ '/getComments', { params : params } )\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#move\n     * @methodOf  news.services.News\n     * @description\n     *    移动新闻\n     *    请求参数说明：\n     *    - `articleids`：新闻id列表。如果有多个，使用逗号分开。如：1,2,3\n     *    - `catid`：分类id\n     * @param   {String}       articleid    新闻id\n     * @returns {HttpPromise}  HttpPromise\n     */\n    move: function(params){\n      return $http.post(moduleUrl+ '/move', params)\n    }\n  }\n})\n\n.factory('NewsList', function($http, $ionicLoading, Settings, Utils) {\n\n  var moduleUrl = Settings.rootUrl + '/news';\n\n  function NewsList(url, options){\n    this.url = url;\n    this.options = options;\n\n    this.hasMore = true;\n    this.news = [];\n\n    this.params = {};\n  }\n\n  angular.extend(NewsList.prototype, {\n    /**\n     * @ngdoc method\n     * @name NewsList#fetch\n     * @description\n     *   获取文件列表数据\n     *   返回数据格式为\n     *   {\n     *     datas: [\n     *       { addtime, author, uid, subject, content, uptime, readstatus... }\n     *       ...\n     *     ],\n     *     pages: { page, pageCount, pageSize }\n     *   }\n     *   addtime: \"1409381646\"\n     *\n     * @param {Obejct} param 查询条件\n     *    catid      {String}         分类 id\n     *    page       {Number}         页码\n     *    keyword    {String}         搜索关键词\n     * @returns {Object} promise\n     */\n\n    fetch: function(params, reset, extend) {\n      var _this = this;\n      if(reset) {\n        this.news = [];\n        this.hasMore = true;\n      }\n\n      if(extend === false) {\n        this.params = params;\n      } else {\n        angular.extend(this.params, params);\n      }\n\n      return $http.get(this.url, {\n        params: this.params\n      })\n\n      .success(function(res){\n          if(res.isSuccess){\n            if(res.pages.page < res.pages.pageCount) {\n              _this.news = _this.news.concat(res.data);\n              // _this.params.page += 1;\n            }\n            // 判断是否还能加载更多\n            _this.hasMore = res.pages.page < res.pages.pageCount - 1\n          } else {\n            Utils.promptNoPermission();\n          }\n      })\n    },\n\n    search: function(keyword) {\n      return this.fetch({\n        page: 1,\n        search: keyword\n      }, true);\n    },\n\n    loadMore: function() {\n      return this.fetch({\n        page: this.params.page + 1\n      });\n    },\n\n    hasNews: function() {\n      return !!this.news.length;\n    },\n\n    reset: function() {\n      this.news.length = 0;\n      this.hasMore = true;\n    }\n  });\n\n  return NewsList;\n})\n\n.factory('NewsIndex',function(NewsList,Settings){\n  var NEWS_APT_URL =　Settings.rootUrl + '/news';\n  var list = new NewsList(NEWS_APT_URL + '/index');\n\n  return list;\n})\n\n.factory('NewsUnread', function(NewsList, Settings) {\n  var list = new NewsList(Settings.rootUrl + '/news&type=new');\n\n  return list;\n})\n\n\n","/**\n * @ngdoc module\n * @name report.controllers\n * @description\n *  汇报模块控制器\n */\n\nangular.module('report.controllers', [])\n\n/**\n * @ngdoc controller\n * @name ReportIndexCtrl\n * @module report.controllers\n * @description\n *   汇报首页控制器\n */\n  .controller('ReportIndexCtrl', function($scope, $ionicModal, $ionicLoading, $localstorage, $state, $timeout, uniqueFilter, mapFilter, Utils, IbPopup, Report){\n    var LOCAL_SETTINGS_KEY = 'report.settings';\n    var localReportSettings = $localstorage.getObject(LOCAL_SETTINGS_KEY);\n\n    $scope.order = false;\n    $scope.loading = true;\n\n    //从远程数据筛选出本地所不包含的所有子项。\n    function filterItem(originTempArr, localTempArr) {\n       var localTids = mapFilter(localTempArr, 'tid');\n      return originTempArr\n        .filter(function (item) {\n          return localTids.indexOf(item.tid) === -1;\n        });\n    }\n\n    //模板排序\n    function orderTpl(originTemp, localTemp) {\n      //拿到新添加的数据\n      var diffArr = filterItem(originTemp, localTemp);\n      // 如果远程数据有本地数据没有的项目则返回本地数据和新数据合集\n      return diffArr.length ? localTemp.concat(diffArr) : localTemp;\n    };\n\n    // 获取未读数\n    function updateUnreadCount() {\n      Report.getUnreadCount().success(function(res){\n        if(res.isSuccess){\n          $scope.unreadCount = res.data.unread\n        }\n      })\n    }\n\n    //获取可用模板\n    function updateUserTemplate() {\n      $ionicLoading.show();\n      Report.getUserTemplate().success(function(res){\n        if(res.isSuccess){\n          $scope.loading = false;\n          if(localReportSettings){\n            $scope.templates = orderTpl(res.data, localReportSettings);\n          } else {\n            $scope.templates = res.data;\n          }\n\n          $scope.isSet = res.isSet\n        } else {\n          Utils.promptNoPermission();\n        }\n      }).finally($ionicLoading.hide)\n    }\n\n    //离开的时候关闭模板\n    function closeMode(scope, modal){\n      scope.$on('$ionicView.leave', modal.hide.bind(modal));\n      scope.$on('$destroy', modal.remove.bind(modal))\n    }\n\n    //打开管理模板\n    $scope.openManageModel = function(){\n      $ionicModal.fromTemplateUrl('templates/report/report-manage-modal.html',{\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal){\n          $scope.manageModel = modal;\n          $scope.manageModel.show();\n\n          //设置模板的数据\n          $scope.settingTpls = $scope.templates;\n\n          $scope.openOrderList = function(){\n            $scope.settingTpls = $scope.templates;\n            //模板排序\n            $scope.moveTpl = function(tpl, fromIndex, toIndex) {\n              //把该项移动到数组中\n              $scope.settingTpls.splice(fromIndex, 1);\n              $scope.settingTpls.splice(toIndex, 0, tpl);\n              $localstorage.setObject(LOCAL_SETTINGS_KEY, $scope.settingTpls)\n            };\n\n            $scope.orderFinish = function() {\n              $scope.manageModel.hide();\n              $scope.templates = $scope.settingTpls;\n            }\n          };\n\n          closeMode($scope, modal);\n        })\n    };\n\n    //打开设置模板\n    $scope.openSettingModel = function(tid){\n      $ionicModal.fromTemplateUrl('templates/report/report-setting-modal.html',{\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal){\n          $scope.settingModel = modal;\n          $scope.settingModel.show();\n          $scope.collection = [];\n          $scope.manageTypes  = [];\n          $scope.uptype = {};\n          $scope.formData = {};\n          var updateList = [];\n\n          //获取主管类型\n          Report.getcharge().success(function(res){\n            if(res.isSuccess){\n              $scope.managers = res.data;\n            }\n          });\n\n          //取消删除主管类型\n          $scope.outRemoveTypeMode = function(){\n            $scope.removeTypeMode = false;\n          };\n\n          $scope.removeTypeMode = false;\n          //删除主管类型\n          $scope.toRemoveTypeMode = function($event){\n            $scope.removeTypeMode = true;\n            $event.stopPropagation();\n          };\n\n\n          //打开选择主管列表\n          $scope.openSelectManagerModal = function(){\n            $ionicModal.fromTemplateUrl('templates/report/report-select-manager-modal.html',{\n              scope: $scope,\n              animation: 'slide-in-up'\n            })\n              .then(function(modal){\n                $scope.chargeModel = modal;\n                $scope.chargeModel.show();\n                var manageTypes;\n\n                // 判断是否已有选中的类型，如果是则自动选中；\n                if($scope.manageTypes.length > 0){\n                  manageTypes = ([].concat($scope.manageTypes.map(function(item){\n                    return item.uptype\n                  })));\n\n                  angular.forEach($scope.managers, function(type){\n                    for(var i = 0; i < manageTypes.length; i++){\n                      if(type.uptype == manageTypes[i]){\n                        $scope.uptype[type.uptype] = true;\n                      }\n                    }\n                  })\n                };\n\n                $scope.addManager = function(){\n                  $scope.chargeModel.hide();\n                  $scope.manageTypes = [];\n\n                  angular.forEach($scope.managers, function(type) {\n                    // 判断管理人员是否被选中\n                      if($scope.uptype[type.uptype]) {\n                        $scope.manageTypes.push(type);\n                        $scope.manageTypeids = ([].concat($scope.manageTypes.map(function(item){\n                          return item.uptype\n                        }))).join(',');\n                      }\n                  });\n                };\n\n                closeMode($scope, modal);\n              })\n          };\n\n          function alert(prompt){\n            IbPopup.alert({ title: prompt })\n              .then(function(flag){\n                if(flag){\n                  $scope.settingModel.hide();\n                  $state.go('report.index');\n                }\n              })\n          }\n\n          $scope.removeType = function($event, type) {\n            var index = $scope.manageTypes.indexOf(type);\n            $scope.manageTypes.splice(index, 1);\n            $scope.manageTypeids = ([].concat($scope.manageTypes.map(function(item){\n              return item.uptype\n            }))).join(',');\n\n            if(!$scope.manageTypes.length) $scope.removeTypeMode = false;\n            $event.stopPropagation();\n          };\n\n\n          //获取模板设置值\n          $ionicLoading.show();\n          Report.settemplate({ tid : tid } ).success(function(res){\n            if(res.isSuccess) {\n              $scope.formData.defaultShareList = res.data.uid;\n              $scope.manageTypes = res.data.uptype;\n              $scope.formData.defaultReceiveList = res.data.upuid;\n            }\n          }).finally($ionicLoading.hide);\n\n          //设置模板\n          $scope.setTemplate = function(){\n            var params = {\n              tid: tid,\n              uid: $scope.formData.defaultShareList || '',\n              uptype: $scope.manageTypeids || '',\n              upuid: $scope.formData.defaultReceiveList || ''\n            };\n\n            $ionicLoading.show();\n            Report.settemplate(params).success(function(res){\n              if(res.isSuccess){\n                IbPopup.alert({ title: '设置成功'}).then(function(){\n                  $scope.openManageModel();\n                })\n              } else {\n                alert('设置失败')\n              }\n            }).finally($ionicLoading.hide)\n          };\n\n          closeMode($scope, modal);\n        });\n    };\n\n    //添加模板\n    $scope.openAddModal = function() {\n      $ionicModal.fromTemplateUrl('templates/report/report-add-modal.html',{\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal){\n          $scope.addModel = modal;\n          $scope.addModel.show();\n          $ionicLoading.show();\n          Report.getShopList().success(function(res){\n            if(res.isSuccess){\n              $scope.templateData = res.data;\n              $scope.isAdd = res.isAdd;\n\n              $scope.addTemplate = function(tid){\n                $ionicLoading.show();\n                Report.addTemplate(tid).success(function(res){\n                  if(res.isSuccess){\n                    $scope.addModel.hide();\n                    $timeout(updateUserTemplate);\n                    $state.go('report.index');\n                  }\n                }).finally($ionicLoading.hide)\n              };\n            }\n          }).finally($ionicLoading.hide)\n\n          closeMode($scope, modal);\n        });\n    };\n\n    $scope.$on('$ionicView.enter', function() {\n      updateUnreadCount();\n      updateUserTemplate()\n    });\n  })\n\n/**\n * @ngdoc controller\n * @name ReportFormCtrl\n * @module report.controllers\n * @description\n *   汇报-表单（创建/编辑） 的控制器\n */\n  .controller('ReportFormCtrl', function($scope, $q, $stateParams, $ionicLoading, $ionicHistory, $state, Utils, External, CommonApi, IbPopup, mapFilter, fileSizeFilter, dateFilter, ReportUtils, Report){\n    var tid = $stateParams.tid,\n      repid = $stateParams.repid;\n    //如果有tid 是新建汇报，否则是编辑汇报；\n    var data =  tid ? { tid: tid } : { repid: repid };\n    $ionicLoading.show();\n    Report.getTemplateData(data).success(function(res){\n      $ionicLoading.show();\n      if(res.isSuccess){\n        $scope.formData = {\n          subject: '',\n          toid: '',\n          attachmentid: '',\n          remark: '',\n          place: '',\n          status: 1,\n          fields: []\n        };\n        var tpl = res.data.template;\n        $scope.subject = res.data.template.subject;\n        $scope.formData.tid = tpl.tid || '';\n        $scope.formData.fields = res.data.templateField || '';\n        $scope.formData.toid = tpl.defaultuid || '';\n        $scope.formData.remark = tpl.remark || '';\n        $scope.accessories = tpl.attach || [];\n        //编辑汇报时\n        if(repid){\n          $scope.formData.repid = tpl.repid || '';\n          angular.forEach($scope.formData.fields, function(item){\n            if(item.fieldtype == '4'|| item.fieldtype == '6'){\n              item.content = new Date(item.content);\n            } else if(item.fieldtype == '5'){\n              //因为只取时分的数据，new Date需要传入完整的格式；\n              item.content = new Date( \"1970-01-01 \" + item.content )\n            } else if(item.fieldtype == '3'){\n              if (!isNaN(Number(+item.content))){\n                item.content = +item.content\n              } else{\n                item.content = 0;\n              }\n            }\n          });\n        }\n\n        // 提交汇报\n        $scope.submit = function(){\n          // 图片id\n          $scope.formData.attachmentid = $scope.accessories\n            .map(function(annex) {\n              return annex.aid;\n            })\n            .join(',');\n          var formData = changeDataType($scope.formData);\n          $ionicLoading.show();\n          Report.saveReport(formData).success(function(res){\n            if(res.isSuccess){\n              tid ? $state.go('report.send'): $state.go('report.view',{ repid: repid });\n            } else {\n              alert(res.msg)\n            }\n          }).finally($ionicLoading.hide)\n        };\n\n        $scope.saveDraft = function(){\n          if($scope.reportForm.$dirty){\n            IbPopup.confirm({ title: '你还未发布汇报，是否保存' }).then(function(flag) {\n              if(flag){\n                $scope.formData.status = 0;\n                var formData = changeDataType($scope.formData);\n                $ionicLoading.show();\n                Report.saveReport(formData).success(function(res){\n                  if(res.isSuccess){\n                    $ionicHistory.goBack();\n                  }\n                }).finally($ionicLoading.hide)\n              } else{\n                $ionicHistory.goBack();\n              }\n            })\n          } else {\n            $ionicHistory.goBack();\n          }\n        }\n      }\n    }).finally($ionicLoading.hide);\n\n    function changeDataType (formData){\n      formData = angular.merge({}, formData);\n\n      //按后端要求提交前转数据格式\n      angular.forEach(formData.fields, function(item){\n        if(!item.content){\n          item.content = '';\n        }\n       //字段类型，1表示长文本，2表示短文本，3表示数字，4表示日期与时间，5表示时间，6表示日期，7表示下拉, 8表示富文本(目前用长文本替代)\n        if(item.fieldtype == 3){\n          item.content = '' + item.content;\n        } else if(item.fieldtype == 4){\n          item.content = dateFilter(item.content, 'yyyy-MM-dd HH:mm') || '';\n        } else if(item.fieldtype == 5){\n          item.content = dateFilter(item.content, 'HH:mm') || '';\n        } else if(item.fieldtype == 6){\n          item.content = dateFilter(item.content, 'yyyy-MM-dd') || '';\n        } else if(item.fieldtype == 7){\n          item.fieldvalue = item.fieldvalue.join(',');\n        }\n      });\n\n      return formData;\n    };\n\n    //添加图片\n    $scope.addImage = function(evt){\n      $scope.uploading = true;\n      angular.forEach(evt.target.files, function(file) {\n        var temp = {\n          name: file.name,\n          size: fileSizeFilter(file.size),\n          type: file.type.split('/')[1],\n          uploading: true,\n          cancel: null\n        };\n        temp.cancel = $q.defer();\n        temp.index = $scope.accessories.length;\n        $scope.accessories.push(temp);\n        $scope.$applyAsync();\n        var formData = new FormData();\n        formData.append('Filedata[]', file);\n        CommonApi.uploadAttach(formData, { timeout: temp.cancel.promise })\n          .then(function(res){\n            var data = res.data;\n            if(data.isSuccess){\n              // 上传成功补上aid信息\n              var uploadedImage = data.data[0];\n              temp.aid = uploadedImage.aid;\n            } else {\n              // 上传不成功删除\n              $scope.accessories.splice(temp.index, 1);\n            }\n          })\n          .catch(function(err) {\n            // 上传失败删除\n            $scope.accessories.splice(temp.index, 1);\n          })\n          .finally(function() {\n            temp.uploading = false;\n            // 正在上传的图片\n            var uploadingAccessories = $scope.accessories\n              .filter(function(annex) {\n                return annex.uploading;\n              });\n            // 没有了正在上传的图片关闭总loading\n            if (!uploadingAccessories.length) {\n              $scope.uploading = false;\n            }\n          });\n      });\n    };\n\n    // 移除图片\n    $scope.removeImage = function(index) {\n      IbPopup.confirm({ title: '确定要删除该图片吗？' }).then(function(flag) {\n        if(flag) {\n          $scope.accessories.splice(index, 1);\n        }\n      });\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name ReportReceiveCtrl\n * @module report.controllers\n * @description\n *   汇报列表-我收到的控制器\n */\n  .controller('ReportReceiveCtrl', function($scope, $rootScope, $ionicScrollDelegate, $ionicLoading, dateFilter, IbPopup, SearchModal, ReportUtils, Report){\n    $scope.activeTab = 'unread';\n    $scope.loading = true;\n    var params = {\n      limit: 10 ,\n      offset: 0 ,\n      type:'unread'\n    };\n\n    $scope.groupByTime = function(item) {\n      return dateFilter(item.addtime * 1000, 'EEEE');\n    };\n\n    $scope.readReport = function(report){\n      report.isreview = '1';\n    };\n\n    $scope.setTab = function(type) {\n      $ionicScrollDelegate.$getByHandle('reportReceiveListScroll').scrollTop();\n      $scope.list = [];\n      $scope.loading = true;\n      $scope.activeTab = type || 'unread';\n      params.offset = 0;\n      params.type = type === 'unread' ? 'unread':'receive';\n      ReportUtils.getList($scope, params);\n    };\n\n    $scope.addRead = function(){\n      $ionicLoading.show();\n      Report.allRead().success(function(res){\n        if(res.isSuccess){\n          params.type = 'receive';\n          $scope.activeTab = 'all';\n          ReportUtils.getList($scope, params);\n          IbPopup.alert({ title: '全部标记已读' });\n        }\n      }).finally($ionicLoading.hide);\n    };\n\n    $scope.loadMore = function(){\n      var type =  $scope.activeTab;\n      params.offset = $scope.list.length;\n      params.type = type === 'unread' ? 'unread':'receive';\n      $ionicLoading.show();\n      Report.getList(params).success(function(res){\n        if(res.isSuccess){\n          $scope.list = $scope.list.concat(res.data.list);\n        }\n      }).finally($ionicLoading.hide)\n    };\n\n    $scope.search = new SearchModal({\n      scope: $scope,\n      searchFunc: function(params){\n        return Report.getList({\n          type: 'receive',\n          limit: 99,\n          offset: 0,\n          keyword:{\n            subject: params.key\n          }\n        });\n      }\n    });\n\n    $scope.refresh = function(){\n      params.offset = 0;\n      ReportUtils.getList($scope, params);\n    };\n\n    ReportUtils.getList($scope, params);\n  })\n\n/**\n * @ngdoc controller\n * @name ReportSendCtrl\n * @module report.controllers\n * @description\n *   汇报列表-我发出的控制器\n */\n  .controller('ReportSendCtrl', function($scope, $rootScope, $ionicLoading, dateFilter, SearchModal, ReportUtils, Report){\n    $scope.loading = true;\n    var params = {\n      limit: 10 ,\n      offset: 0 ,\n      type:'send'\n    };\n\n    $scope.groupByTime = function(item) {\n      return dateFilter(item.addtime * 1000, 'EEEE');\n    };\n\n    $scope.loadMore = function(){\n      params.offset = $scope.list.length;\n      $ionicLoading.show();\n      Report.getList(params).success(function(res){\n        if(res.isSuccess){\n          $scope.list = $scope.list.concat(res.data.list);\n        }\n      }).finally($ionicLoading.hide)\n    };\n\n    $scope.search = new SearchModal({\n      scope: $scope,\n      searchFunc: function(params){\n        return Report.getList({\n          type: 'send',\n          limit: 99,\n          offset: 0,\n          keyword:{\n            subject: params.key\n          }\n        });\n      }\n    });\n\n    $scope.refresh = function(){\n      params.offset = 0;\n      ReportUtils.getList($scope, params);\n    };\n\n    ReportUtils.getList($scope, params);\n  })\n\n/**\n * @ngdoc controller\n * @name ReportViewCtrl\n * @module report.controllers\n * @description\n *   汇报详情页控制器\n */\n  .controller('ReportViewCtrl', function($scope, $rootScope, $stateParams, $ionicModal, $ionicLoading, $ionicActionSheet, $state, $ionicHistory, IbPopup, uniqueFilter, userInfoFilter, Report){\n    $scope.currentUserUid = $rootScope.user.uid;\n    $ionicLoading.show();\n    Report.showReport($stateParams.repid).success(function(res){\n      if(res.isSuccess){\n        $scope.report = res.data;\n        $scope.report.readers = res.data.reader;\n\n        //评论参数\n        var commentData = {\n          type: 'comment',\n          rowid: $scope.report.repid,\n          offset: 0,\n          limit: 999\n        };\n\n        //获取评论列表\n        function getCommentList(){\n          $ionicLoading.show();\n          Report.getComments(commentData).success(function(res){\n            $ionicLoading.hide();\n            $scope.commentList = res.data.lists;\n          });\n        }\n\n        $scope.openComment = function(type, cm){\n          $ionicModal.fromTemplateUrl('templates/report/report-comment.html',{\n            scope: $scope,\n            animation:'slide-in-up'\n          })\n            .then(function(modal){\n              $scope.comment = {};\n              $scope.commentModal = modal;\n              $scope.comment.isStampsBoxShow = false;\n              $scope.commentModal.show();\n\n              Report.getStamp().success(function(res){\n                if(res.isSuccess){\n                  $scope.report.stamps = res.data;\n                }\n              });\n\n              if (type === 'reply'){\n                $scope.comment.content = cm.touid ? '回复 @' + userInfoFilter(cm.uid,'realname') + ' : ': ''\n              }\n\n              $scope.submit = function(){\n                var params = {\n                  type:type ,\n                  content: $scope.comment.content,\n                  moduleuid: $scope.user.uid\n                };\n\n                if(type === 'comment'){\n                  params.rowid = $scope.report.repid;\n                } else {\n                  params.tocid = cm.cid;\n                  // 如果直接回复评论，则\n                  if(cm.tocid === '0') {\n                    params.rowid = cm.cid;\n                    // 否则，如果回复评论下的回复，则\n                  } else {\n                    params.rowid = cm.rowid;\n                  }\n                }\n\n                Report.addComment(params).success(function(res){\n                  if($scope.comment.stamp){\n                    var params = {\n                      repid: $stateParams.repid,\n                      stampid: $scope.comment.stamp.stampid\n                    };\n                    Report.setStamp(params)\n                  }\n                  Report.showReport($stateParams.repid).success(function(res) {\n                    if (res.isSuccess) {\n                      $scope.report.stamp = res.data.stamp;\n                    }\n                  });\n                  $scope.commentModal.hide();\n                  $ionicLoading.show();\n                  getCommentList()\n                })\n              };\n            })\n        };\n\n        $scope.openCommentDetail = function(){\n          $ionicModal.fromTemplateUrl('templates/report/report-comment-detail.html',{\n            scope: $scope,\n            animation: 'slide-in-up'\n          })\n            .then(function(modal) {\n              $scope.commentTetailModal = modal;\n              $scope.commentTetailModal.show();\n              getCommentList()\n            })\n        };\n\n        $scope.openReaderDetail = function(){\n          $ionicModal.fromTemplateUrl('templates/report/report-reader-detail.html',{\n            scope: $scope,\n            animation: 'slide-in-up'\n          })\n            .then(function(modal) {\n              $scope.readerTetailModal = modal;\n              $scope.readerTetailModal.show();\n            })\n        };\n\n        $scope.operateMore = function(){\n          var hideSheet = $ionicActionSheet.show({\n            buttons: [\n              { text: '编辑' }\n            ],\n            destructiveText: '删除',\n            cancelText: '取消',\n            buttonClicked: function(index) {\n              if(index === 0){\n                $state.go('report.form',{ repid: $scope.report.repid })\n              }\n            },\n            destructiveButtonClicked: function(){\n              IbPopup.confirm({ title: '确认删除汇报？'}).then(function(flag){\n                if(flag){\n                  $ionicLoading.show();\n                  Report.delReport($scope.report.repid).success(function(res){\n                    if(res.isSuccess){\n                      $ionicHistory.goBack();\n                    }\n                  }).finally($ionicLoading.hide);\n                }\n              });\n            }\n          });\n        };\n\n        getCommentList();\n      }\n    }).finally($ionicLoading.hide)\n  });\n","/**\n * @ngdoc module\n * @name report\n * @description\n *   汇报模块入口\n */\n\nangular.module('report', ['ionic', 'report.controllers', 'report.services'/*, 'report.filters'*/])\n\n  .run(function(Apps) {\n    Apps.install({ name: 'report', title: '汇报', route: '#/report', state: 'report.index', icon: 'img/modicon/report.png' });\n  })\n\n  .config(function($stateProvider, $urlRouterProvider, UserProvider, ResolversProvider) {\n\n    $urlRouterProvider.when('/report', '/report/index');\n\n    $stateProvider\n      // setup an abstract state for the tabs directive\n      .state('report', {\n        url: \"/report\",\n        abstract: true,\n        template: '<ion-nav-view name=\"report\"></ion-nav-view>',\n        resolve: UserProvider.resolve\n      })\n\n      .state('report.index', {\n        url: '/index',\n        talkingDataLabel: '汇报-首页',\n        views: {\n          'report': {\n            templateUrl: 'templates/report/report-index.html',\n            controller: 'ReportIndexCtrl'\n          }\n        }\n      })\n\n      .state('report.form', {\n        url: '/form/:repid?tid',\n        talkingDataLabel: '汇报-表单（创建、编辑）',\n        resolve: ResolversProvider.get(['qqmap']),\n        views: {\n          'report': {\n            templateUrl: 'templates/report/report-form.html',\n            controller: 'ReportFormCtrl'\n          }\n        }\n      })\n\n      .state('report.receive', {\n        url: '/receive',\n        cache: false,\n        talkingDataLabel: '汇报列表-我收到的',\n        views: {\n          'report': {\n            templateUrl: 'templates/report/report-receive.html',\n            controller: 'ReportReceiveCtrl'\n          }\n        }\n      })\n\n      .state('report.send', {\n        url: '/send',\n        cache: false,\n        talkingDataLabel: '汇报列表-我发出的',\n        views: {\n          'report': {\n            templateUrl: 'templates/report/report-send.html',\n            controller: 'ReportSendCtrl'\n          }\n        }\n      })\n\n      .state('report.view', {\n        url: '/view/:repid',\n        cache: false,\n        talkingDataLabel: '汇报-详情',\n        views: {\n          'report': {\n            templateUrl: 'templates/report/report-view.html',\n            controller: 'ReportViewCtrl'\n          }\n        }\n      })\n\n  })","/**\n * @ngdoc overview\n * @name  report.services\n * @description\n *   汇报模块相关服务\n */\nangular.module('report.services', [])\n\n/**\n * @ngdoc service\n * @name report.services.Report\n * @description\n *   汇报通用服务\n */\n  .factory('Report', function($http, Settings, Utils) {\n    var moduleUrl = Settings.hostUrl + '?r=report/api';\n    return {\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#usertemplate\n       * @methodOf  report.services\n       * @description\n       *   获取用户可用模板\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getUserTemplate: function() {\n        return $http.get(moduleUrl + '/usertemplate')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#shoplist\n       * @methodOf  report.services\n       * @description\n       *   获取商城列表\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getShopList: function() {\n        return Utils.postJsonData(moduleUrl + '/shoplist')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#sorttemplate\n       * @methodOf  report.services\n       * @description\n       *   获取排序模板列表\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getSortTemplate: function() {\n        return Utils.postJsonData(moduleUrl + '/sorttemplate')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#addtemplate\n       * @methodOf  report.services\n       * @description\n       *   添加系统模板\n       * @returns {HttpPromise}  HttpPromise\n       */\n      addTemplate: function(tid){\n        return Utils.postJsonData(moduleUrl + '/addTemplate',{ tid: tid })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getManagerTemplate\n       * @methodOf  report.services\n       * @description\n       *   获取管理模板列表\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getManagerTemplate: function(){\n        return Utils.postJsonData(moduleUrl + '/managertemplate')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getcharge\n       * @methodOf  report.services\n       * @description\n       *   获取主管列表\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getcharge: function(){\n        return Utils.postJsonData(moduleUrl + '/getcharge')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getList\n       * @methodOf  report.services\n       * @description\n       *   获取汇报列表\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getList: function(params){\n        return Utils.postJsonData(moduleUrl + '/getlist',params)\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getTemplateData\n       * @methodOf  report.services\n       * @description\n       *   设置/获取模板设置值\n       * @returns {HttpPromise}  HttpPromise\n       */\n      settemplate: function(params){\n        return Utils.postJsonData(moduleUrl + '/settemplate',params)\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getTemplateData\n       * @methodOf  report.services\n       * @description\n       *   获取汇报模板信息（汇报添加页面信息）\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getTemplateData: function(data){\n        return $http.get(moduleUrl + '/formreport',{ params: data })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#savereport\n       * @methodOf  report.services\n       * @description\n       *   保存汇报信息\n       * @returns {HttpPromise}  HttpPromise\n       */\n      saveReport: function(params){\n        return Utils.postJsonData(moduleUrl + '/savereport', params)\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#showReport\n       * @methodOf  report.services\n       * @description\n       *   汇报详情\n       * @returns {HttpPromise}  HttpPromise\n       */\n      showReport:function(repid){\n        return $http.get(moduleUrl + '/showreport', { params:  { repid: repid } })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#delReport\n       * @methodOf  report.services\n       * @description\n       *   汇报详情\n       * @returns {HttpPromise}  HttpPromise\n       */\n      delReport:function(repid){\n        return Utils.postJsonData(moduleUrl + '/delreport', { repids: repid })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#allRead\n       * @methodOf  report.services\n       * @description\n       *   汇报详情\n       * @returns {HttpPromise}  HttpPromise\n       */\n      allRead:function(repid){\n        return Utils.postJsonData(moduleUrl + '/allread', { repids: 0 })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#addComment\n       * @methodOf  report.services\n       * @description\n       *   添加/回复评论\n       * @returns {HttpPromise}  HttpPromise\n       */\n      addComment: function(params){\n        return Utils.postJsonData(moduleUrl + '/addcomment', params )\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getCommentList\n       * @methodOf  report.services\n       * @description\n       *   获取评论\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getComments: function(params){\n        return Utils.postJsonData(moduleUrl + '/getcommentlist', params)\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getReaders\n       * @methodOf  report.services\n       * @description\n       *   获取已读成员\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getReaders: function(repid){\n        return Utils.postJsonData(moduleUrl + '/getreader', { repid : repid })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getStamp\n       * @methodOf  report.services\n       * @description\n       *   获取图章\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getStamp:function(repid){\n        return $http.get(moduleUrl + '/getstamp')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#setStamp\n       * @methodOf  report.services\n       * @description\n       *   获取图章\n       * @returns {HttpPromise}  HttpPromise\n       */\n      setStamp: function(params){\n        return Utils.postJsonData(moduleUrl + '/setstamp', params)\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getUnreadCount\n       * @methodOf  report.services\n       * @description\n       *   获取列表未读数\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getUnreadCount: function(){\n        return $http.get(moduleUrl + '/getcount')\n      }\n    }\n  })\n\n/**\n * @ngdoc service\n * @name report.services.ReportUtils\n * @description\n *   汇报通用工具函数集\n */\n  .factory('ReportUtils',function($state, External, IbPopup, dateFilter, CommonApi, Report){\n    return{\n      /**\n       * @ngdoc     method\n       * @name      report.services.getList#获取列表\n       * @methodOf  report.services.ReportUtils\n       * @param\n       * @description\n       * getList\n       */\n      getList: function(scope,params){\n        Report.getList(params).success(function(res){\n          if(res.isSuccess){\n            scope.loading = false;\n            scope.list = res.data.list;\n            scope.list.hasMore= res.data.hasMore;\n          }\n        }).finally(function(){\n          scope.$broadcast('scroll.refreshComplete');\n        });\n      }\n    }\n  })\n","/**\n * @ngdoc module\n * @name email.controllers\n * @description\n *   邮件中心模块控制器\n */\nangular.module('email.controllers', [])\n\n  .controller('EmailIndexCtrl',function($ionicLoading, User, Utils){\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n      if(res.isSuccess){\n        if(!res.data.email){\n          Utils.promptNoPermission();\n        }\n      }\n    }).finally($ionicLoading.hide)\n  })\n\n  .controller('EmailListCtrl', function($scope, $rootScope, $state, $ionicLoading, $ionicActionSheet, Email) {\n    $scope.prop = {};\n\n    // 初始化列表，首次进来时自动加载数据\n    $scope.init = function() {\n      // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n      if(!$scope.list.hasMails()) {\n        $scope.list.refresh();\n      }\n    };\n\n    // 刷新列表\n    $scope.refresh = function() {\n      $scope.prop.keyword = '';\n      $scope.list.refresh()\n        .finally(function() {\n          $scope.$broadcast('scroll.refreshComplete');\n        })\n    };\n\n    // 移动邮件至回收站\n    $scope.remove = function(mail) {\n      Email.remove(mail.emailid);\n    };\n\n    $scope.reply = function(mail) {\n      $state.go('email.create', { id: mail.emailid, type: 'reply' });\n      return true;\n    };\n\n    $scope.forward = function(mail) {\n      $state.go('email.create', { id: mail.emailid, type: 'forward' });\n      return true;\n    };\n\n    $scope.actionButtons = [\n      {\n        text: '转发',\n        handler: function(mail) {\n          return $scope.forward(mail);\n        }\n      },\n      {\n        text: '回复',\n        handler: function(mail) {\n          return $scope.reply(mail);\n        }\n      }\n    ];\n\n    $scope.showMenu = function(mail) {\n      $scope.hideMenu = $ionicActionSheet.show({\n        titleText: '邮件操作',\n        buttons: $scope.actionButtons,\n        buttonClicked: function(index, opts) {\n          return opts.handler.call(null, mail);\n        },\n        destructiveText: '删除',\n        destructiveButtonClicked: function() {\n          $scope.remove(mail);\n          return true;\n        },\n        cancelText: '取消'\n      });\n    };\n\n    $scope.sref = 'email.detail({ id: mail.emailid })';\n\n  })\n\n/**\n * @ngdoc controller\n * @name EmailInboxCtrl\n * @module email.controllers\n * @description\n *   收件箱页控制器\n */\n  .controller('EmailInboxCtrl', function($scope, $controller, Settings, EmailList, EmailInbox) {\n\n    $controller('EmailListCtrl', { $scope: $scope });\n    $scope.list = EmailInbox;\n    $scope.title = '收件箱';\n    $scope.init();\n\n  })\n\n/**\n * @ngdoc controller\n * @name EmailTodoCtrl\n * @module email.controllers\n * @description\n *   待办邮件列表页控制器\n */\n  .controller('EmailTodoCtrl', function($scope, $controller, EmailTodo) {\n\n    $controller('EmailListCtrl', { $scope: $scope });\n    $scope.list = EmailTodo;\n    $scope.title = '待办邮件';\n    $scope.init();\n\n  })\n\n/**\n * @ngdoc controller\n * @name EmailOutboxCtrl\n * @module email.controllers\n * @description\n *   已发送列表页控制器\n */\n  .controller('EmailOutboxCtrl', function($scope, $rootScope, $controller, EmailOutbox, Email) {\n\n    $controller('EmailListCtrl', { $scope: $scope });\n    $scope.list = EmailOutbox;\n    $scope.title = '已发送';\n    $scope.init();\n\n    $scope.sref = 'email.outboxDetail({ id: mail.emailid })';\n\n    // 重写列表删除邮件方法，已发送删除邮件为彻底删除，不移到回收站\n    $scope.remove = function(mail) {\n      Email.removeCompletelyConfirm(function() {\n        Email.removeOutbox(mail.emailid)\n      });\n    }\n\n  })\n\n/**\n * @ngdoc controller\n * @name EmailTrashCtrl\n * @module email.controllers\n * @description\n *   已删除列表页控制器\n */\n  .controller('EmailTrashCtrl', function($scope, $rootScope, $state, $controller, $ionicHistory, EmailTrash, Email) {\n\n    $controller('EmailListCtrl', { $scope: $scope });\n    $scope.list = EmailTrash;\n    $scope.title = '已删除';\n    $scope.init();\n\n    $scope.sref = 'email.trashDetail({ id: mail.emailid })';\n\n    // 替换 ActionSheet 菜单项\n    $scope.actionButtons[1] = {\n      text: '还原',\n      handler: function(mail) {\n        return $scope.recovery(mail);\n      }\n    };\n\n    // 重写列表删除邮件方法，回收站删除将彻底删除邮件\n    $scope.remove = function(mail) {\n      Email.removeCompletelyConfirm(function() {\n        Email.removeCompletely(mail.emailid)\n      });\n    }\n\n    $scope.recovery = function(mail) {\n      Email.recovery(mail.emailid);\n      $ionicHistory.clearCache(['email.inbox', 'email.todo', 'email.trash'])\n      return true;\n    }\n  })\n\n/**\n * @ngdoc controller\n * @name EmailDetailCtrl\n * @module email.controllers\n * @description\n *   查看邮件页控制器\n */\n  .controller('EmailDetailCtrl', function($scope, $rootScope, $state, $stateParams, $sce, $filter, $ionicHistory, $ionicLoading, Email, EmailUtils) {\n    $ionicLoading.show();\n\n    Email.get($stateParams.id)\n      .success(function(res) {\n        $scope.mail = res;\n\n        // 判断返回的内容为可信 html 以保留样式\n        if($scope.mail.content) {\n          $scope.mail.content = $sce.trustAsHtml( $filter('editorContent')($scope.mail.content) );\n        }\n      })\n      .finally($ionicLoading.hide);\n\n    // 删除邮件\n    $scope.remove = function() {\n      Email.remove($scope.mail.emailid)\n        .success(function(res) {\n          if(res.isSuccess) {\n            EmailUtils.goBackOrHome();\n          }\n        });\n    };\n\n    // 待办、取消待办\n    $scope.toggleMark = function() {\n      var mark = $scope.mail.ismark != '1';\n\n      Email.mark($scope.mail.emailid, mark)\n        .success(function(res) {\n          $scope.mail.ismark = +mark + '';\n          $ionicHistory.clearCache(['email.inbox', 'email.outbox', 'email.todo', 'email.trash'])\n        })\n    };\n\n    $scope.reply = function() {\n      $state.go('email.create', { id: $scope.mail.emailid, type: 'reply' });\n    };\n\n    $scope.replyAll = function() {\n      $state.go('email.create', { id: $scope.mail.emailid, type: 'replyAll' });\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name EmailTrashDetailCtrl\n * @module email.controllers\n * @description\n *   已删除-查看邮件详细页控制器\n */\n  .controller('EmailTrashDetailCtrl', function($scope, $controller, Email, EmailUtils) {\n    $controller('EmailDetailCtrl', { $scope: $scope });\n\n    $scope.remove = function() {\n      Email.removeCompletelyConfirm(function() {\n        $ionicLoading.show();\n        Email.removeCompletely($scope.mail.emailid)\n          .success(function(res) {\n            if(res.isSuccess) {\n              EmailUtils.goBackOrHome();\n            }\n          })\n          .finally($ionicLoading.hide);\n      });\n    }\n  })\n\n/**\n * @ngdoc controller\n * @name EmailOutboxDetailCtrl\n * @module email.controllers\n * @description\n *   已发送-查看邮件详细页控制器\n */\n  .controller('EmailOutboxDetailCtrl', function($scope, $ionicLoading, $rootScope, $controller, $state, Email, EmailUtils) {\n    $controller('EmailDetailCtrl', { $scope: $scope });\n\n    $scope.remove = function() {\n      Email.removeCompletelyConfirm(function() {\n        $ionicLoading.show();\n        Email.removeOutbox($scope.mail.emailid)\n          .success(function(res) {\n            if(res.isSuccess) {\n              EmailUtils.goBackOrHome();\n            }\n          })\n          .finally($ionicLoading.hide);\n      });\n    }\n  })\n\n/**\n * @ngdoc controller\n * @name EmailCreateCtrl\n * @module email.controllers\n * @description\n *   写邮件页控制器\n */\n  .controller('EmailCreateCtrl', function($scope, $rootScope, $sce, $filter, $timeout, $state, $stateParams, $ionicLoading, $ionicHistory, Email, EmailUtils) {\n\n    $scope.form = {\n      toids: '',\n      ccids: '',\n      mcids: '',\n      subject: '',\n      content: ''\n    };\n\n    $scope.isSubmitting = false;\n\n    // 设置源邮件信息\n    function setSource(res) {\n      $scope.source = res;\n\n      // 回复\n      if($stateParams.type == 'reply') {\n        $scope.form.toids = res.fromid;\n        $scope.form.subject = '回复：' + res.subject;\n\n        // 回复全部（发件人、所以收件人及抄送人）\n      } else if($stateParams.type == 'replyAll') {\n        $scope.form.toids = EmailUtils.concatToids(res.fromid, res.toids, res.copytoids);\n        $scope.form.subject = '回复：' + res.subject;\n\n        // 转发\n      } else if($stateParams.type == 'forward') {\n        $scope.form.subject = '转发：' + res.subject;\n        $scope.form.attachmentid = res.attachmentid;\n      }\n\n      if(res.content) {\n        $scope.source.content = $sce.trustAsHtml( $filter('editorContent')(res.content) );\n      }\n    }\n\n    // 如果有 url 参数 id 和 type，判断此时为回复或转发邮件\n    if($stateParams.id && $stateParams.type) {\n      $ionicLoading.show();\n      Email.get($stateParams.id)\n        .success(setSource)\n        .finally($ionicLoading.hide)\n    }\n\n    $scope.showOther = function() {\n      $scope.isShowOther = true;\n    }\n\n    // 表单提交中或表单未通过验证时，禁止提交\n    $scope.isDisabledSubmit = function() {\n      return $scope.isSubmitting || !$scope.emailForm.$valid;\n    };\n\n    $scope.submit = function() {\n      $scope.isSubmitting = true;\n      $ionicLoading.show();\n\n      // 如果有原邮件（回复、转发的情况），则组合内容\n      var formData = angular.extend({}, $scope.form, {\n        content: $scope.source ?\n        $scope.form.content + document.getElementById('email_info').innerHTML + $scope.source.content :\n          $scope.form.content\n      })\n\n      Email.create(formData)\n        .success(function() {\n          $ionicHistory.clearCache(['email.inbox', 'email.outbox']);\n          EmailUtils.showSendedPopup($scope);\n        })\n        .finally($ionicLoading.hide);\n    }\n\n  })\n","/**\n * @ngdoc module\n * @name email\n * @description\n *   邮件中心模块\n */\n\nangular.module('email', ['ionic', 'email.controllers', 'email.services', /*'email.filters'*/])\n\n.run(function(Apps) {\n  Apps.install({ name: 'email', title: '邮件中心', route: '#/email', state: 'email.index', icon: 'img/modicon/email.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/email', '/email/index');\n\n  $stateProvider\n  .state('email', {\n    url: '/email',\n    abstract: true,\n    template: '<ion-nav-view name=\"email\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  $stateProvider\n  // 邮件中心-首页\n  .state('email.index', {\n    url: '/index',\n    talkingDataLabel: '邮件-首页',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-index.html',\n        controller: 'EmailIndexCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-收件箱\n  .state('email.inbox', {\n    url: '/inbox',\n    talkingDataLabel: '邮件-收件箱',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-inbox.html',\n        controller: 'EmailInboxCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-待办邮件\n  .state('email.todo', {\n    url: '/todo',\n    talkingDataLabel: '邮件-待办',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-inbox.html',\n        controller: 'EmailTodoCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-发件箱（已发送）\n  .state('email.outbox', {\n    url: '/outbox',\n    talkingDataLabel: '邮件-已发送',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-outbox.html',\n        controller: 'EmailOutboxCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-回收站（已删除）\n  .state('email.trash', {\n    url: '/trash',\n    talkingDataLabel: '邮件-已删除',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-inbox.html',\n        controller: 'EmailTrashCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-查看邮件\n  .state('email.detail', {\n    url: '/detail/:id',\n    talkingDataLabel: '邮件-查看邮件',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-detail.html',\n        controller: 'EmailDetailCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-查看已发送邮件\n  .state('email.outboxDetail', {\n    url: '/outboxDetail/:id',\n    talkingDataLabel: '邮件-查看邮件',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-detail.html',\n        controller: 'EmailOutboxDetailCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-查看回收站邮件\n  .state('email.trashDetail', {\n    url: '/trashDetail/:id',\n    talkingDataLabel: '邮件-查看邮件',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-detail.html',\n        controller: 'EmailTrashDetailCtrl'\n      }\n    }\n  })\n\n  // 邮件-写邮件\n  .state('email.create', {\n    url: '/create?id&type',\n    talkingDataLabel: '邮件-写邮件',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-create.html',\n        controller: 'EmailCreateCtrl'\n      }\n    }\n  })\n});","/**\n * @!ngdoc module\n * @name email.services\n * @description\n *   邮件中心模块服务\n */\n\nangular.module('email.services', [])\n\n/**\n * @ngdoc service\n * @name email.services.EmailUtils\n * @description\n *   邮件中心工具函数集\n */\n.factory('EmailUtils', function($state, $ionicPopup, $ionicHistory) {\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      email.services.EmailUtils#showSendedPopup\n     * @methodOf  email.services.EmailUtils\n     * @param     {Object}   $scope         angular scope 对象\n     * \n     * @description \n     *   显示邮件发送成功后的弹窗提醒\n     * @returns   {Object}\n     */\n    showSendedPopup: function($scope) {\n      return $ionicPopup.show({\n        title: '邮件发送成功',\n        scope: $scope,\n        buttons: [\n          {\n            text: '返回主页',\n            onTap: function(){\n              $ionicHistory.nextViewOptions({\n                disableBack: true\n              });\n              $state.go('email.index');\n            }\n          },\n          {\n            text: '再写一封',\n            type: 'button-positive',\n            onTap: function(e) {\n              $state.reload();\n            }\n          },\n        ]\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      email.services.Email#concatToids\n     * @methodOf  email.services.Email\n     * @param     {String}   uid      用户 id\n     * @description \n     *   合并多个 uid 字符串，并去除相同的 uid\n     *   \n     * @returns   {String}   合并后的 uid 字符串\n     */\n    concatToids: function(){\n      var argu = arguments;\n      var ret = [];\n\n      angular.forEach(arguments, function(argu) {\n        var arr = angular.isArray(argu) ?\n          argu :\n          angular.isString(argu) && argu ?\n          argu.split(',') :\n          [];\n\n        if(!arr.length) {\n          return true;\n        }\n\n        angular.forEach(arr, function(a) {\n          if(ret.indexOf(a) == -1) {\n            ret.push(a);\n          }\n        })\n      });\n\n      return ret.length ? ret.join(',') : '';\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      email.services.Email#goBackOrHome\n     * @methodOf  email.services.Email\n     * @description \n     *   如果有后退页，则后退，没有则回邮件中心首页\n     *   \n     * @returns   {Undefined}\n     */\n    goBackOrHome: function() {\n      if($ionicHistory.backView()) {\n        $ionicHistory.goBack();\n      } else {\n        $state.go('email.index');\n      }\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name email.services.Email\n * @description\n *   邮件中心通用服务\n */\n.factory('Email', function($rootScope, $http, $state, $ionicLoading, IbPopup, Settings) {\n  var moduleUrl = Settings.rootUrl + '/mail';\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#create\n   * @methodOf  email.services.Email\n   * @param     {Object}   data           邮件数据\n   * @description \n   *    新建邮件\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function create(data) {\n    return $http.post(moduleUrl + '/edit', data)\n    .success(function(res) {\n      $rootScope.$broadcast('email.create', res);\n    })\n    .error(Settings.requestError)\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#remove\n   * @methodOf  email.services.Email\n   * @param     {String}   emailid           邮件id\n   * @description \n   *   删除邮件，移动邮件至回收站\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function remove(emailid) {\n    $ionicLoading.show();\n\n    return $http.post(moduleUrl + '/del', {\n      emailid: emailid\n    })\n    .success(function(res) {\n      if(res.isSuccess) {\n        $rootScope.$broadcast('email.remove', emailid);\n      } else {\n        IbPopup.alert({ template: res.errorMsg });\n      }\n    })\n    .error(Settings.requestError)\n    .success($ionicLoading.hide)\n    .error($ionicLoading.hide)\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#removeCompletely\n   * @methodOf  email.services.Email\n   * @param     {String}   emailid           邮件id\n   * @description \n   *   彻底删除邮件\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function removeCompletely(emailid) {\n    return $http.post(moduleUrl + '/delete', {\n      emailid: emailid\n    })\n    .success(function(res) {\n      if(res.isSuccess) {\n        $rootScope.$broadcast('email.removeTrash', emailid);\n      } else {\n        IbPopup.alert({ template: res.errorMsg });\n      }\n    })\n    .error(Settings.requestError)\n  }\n\n  function removeOutbox(emailid) {\n    return $http.post(moduleUrl + '/delete', {\n      emailid: emailid\n    })\n    .success(function(res) {\n      if(res.isSuccess) {\n        $rootScope.$broadcast('email.removeOutbox', emailid);\n      } else {\n        IbPopup.alert({ template: res.errorMsg });\n      }\n    })\n    .error(Settings.requestError)\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#removeCompletelyConfirm\n   * @methodOf  email.services.Email\n   * @param     {Function}   callback           回调函数\n   * @description \n   *   显示彻底删除邮件确认弹窗\n   *   \n   * @returns   {}\n   */\n  function removeCompletelyConfirm(callback) {\n    return IbPopup.confirm({\n      title: '确定彻底删除该邮件吗？'\n    })\n    .then(function(ok) {\n      if(ok && angular.isFunction(callback)) {\n        callback();\n      }\n    });\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#get\n   * @methodOf  email.services.Email\n   * @param     {String}   emailid           邮件id\n   * @description \n   *   获取指定邮件的数据\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function get(emailid) {\n    return $http.get(moduleUrl + '/show', {\n      params: { id: emailid }\n    })\n    .error(Settings.requestError)\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#mark\n   * @methodOf  email.services.Email\n   * @param     {String}   emailid           邮件id\n   * @param     {Boolean=} tomark              加星标还是取消星标\n   * @description \n   *   星标邮件或取消邮件星标\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function mark(emailid, tomark) {\n    return $http.get(moduleUrl + '/mark', {\n      params: { emailid: emailid, ismark: !!tomark }\n    })\n    .success(function() {\n      $rootScope.$broadcast('email.mark', emailid, !!tomark);\n    })\n    .error(Settings.requestError)\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#recovery\n   * @methodOf  email.services.Email\n   * @param     {String}   emailid           邮件id\n   * @description \n   *   还原回收站中的邮件\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function recovery(emailid) {\n    return $http.get(moduleUrl + '/recovery', {\n      params: { emailid: emailid }\n    })\n    .success(function(res) {\n      if(res.isSuccess) {\n        $rootScope.$broadcast('email.recovery', emailid);\n      }\n    })\n    .error(Settings.requestError)\n  }\n\n  return {\n    create: create,\n    get: get,\n    remove: remove,\n    removeCompletely: removeCompletely,\n    removeOutbox: removeOutbox,\n    removeCompletelyConfirm: removeCompletelyConfirm,\n    mark: mark,\n    recovery: recovery\n  };\n})\n\n/**\n * @ngdoc service\n * @name email.services.EmailList\n * @description\n *   邮件中心列表类\n */\n\n.factory('EmailList', function($http, $ionicLoading, Settings) {\n\n  var moduleUrl = Settings.rootUrl + '/mail';\n\n  function EmailList(url, options){\n    this.url = url;\n    this.options = options;\n\n    this.hasMore = true;\n    this.mails = [];\n\n    this.params = {};\n  }\n\n  angular.extend(EmailList.prototype, {\n    /**\n     * @ngdoc method\n     * @name EmailList#fetch\n     * @description \n     *   获取文件列表数据\n     *   返回数据格式为\n     *   {\n     *     datas: [\n     *       { addtime, author, uid, subject, content, uptime, readstatus... }\n     *       ...\n     *     ],\n     *     lastid: ''\n     *   }\n     *   addtime: \"1409381646\"\n     *   \n     * @param {Obejct} param 查询条件\n     *    catid      {String}         分类 id\n     *    lastid     {String}         最后查询到的数据的 id\n     *    keyword    {String}         搜索关键词\n     * @returns {Object} promise\n     */\n    fetch: function(params, reset, extend) {\n      var _this = this;\n      if(reset) {\n        this.reset();\n      }\n\n      if(extend === false) {\n        this.params = params;\n      } else {\n        angular.extend(this.params, params);\n      }\n\n      $ionicLoading.show();\n\n      return $http.get(this.url, {\n        params: this.params\n      })\n\n      .success(function(res){\n        _this.mails = _this.mails.concat(res.data);\n        // 判断是否还能加载更多\n        _this.hasMore = !!res.lastid;\n      })\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n    },\n\n    get: function(emailid) {\n      var ret = null;\n      \n      angular.forEach(this.mails, function(mail) {\n        if(mail.emailid == emailid) {\n          ret = mail;\n          return false;\n        }\n      });\n\n      return ret;\n    },\n\n    getLastId: function() {\n      return this.mails.length ? \n        this.mails[this.mails.length - 1].emailid || '' :\n        '';\n    },\n\n    view: function(emailid) {\n      var mail = this.get(emailid);\n      if(mail) {\n        mail.isread = '1';\n      }\n    },\n\n    search: function(keyword) {\n      return this.fetch({\n        lastid: '',\n        search: keyword\n      }, true);\n    },\n\n    loadMore: function() {\n      return this.fetch({\n        lastid: this.getLastId()\n      });\n    },\n\n    hasMails: function() {\n      return !!this.mails.length;\n    },\n\n    checkNoData: function() {\n      return !this.mails.length && !this.hasMore;\n    },\n\n    remove: function(id) {\n      var _this = this;\n\n      if(!this.mails.length) {\n        return;\n      }\n\n      angular.forEach(this.mails, function(mail, i) {\n        if(mail.emailid == id) {\n          _this.mails.splice(i, 1);\n          return false;\n        }\n      });\n    },\n\n    reset: function() {\n      this.mails = [];\n      this.hasMore = true;\n      this.params = {};\n    },\n\n    refresh: function() {\n      return this.fetch({}, true);\n    },\n\n    mark: function(emailid, ismark) {\n      var mail = this.get(emailid);\n      if(mail) {\n        mail.ismark = ismark ? '1' : '0';\n      }\n    }\n  });\n\n  return EmailList;\n})\n\n/**\n * @ngdoc service\n * @name email.services.EmailInbox\n * @description\n *   收件箱列表数据\n */\n.factory('EmailInbox', function($rootScope, Settings, EmailList) {\n\n  var inbox = new EmailList(Settings.rootUrl + '/mail&type=inbox');\n\n  $rootScope.$on('email.create', function(evt) {\n    inbox.reset();\n  });\n\n  $rootScope.$on('email.recovery', function() {\n    inbox.reset();\n  });\n\n  $rootScope.$on('email.remove', function(evt, emailid) {\n    inbox.remove(emailid);\n  });\n\n  $rootScope.$on('email.mark', function(evt, emailid, ismark) {\n    inbox.mark(emailid, ismark);\n  });\n\n  return inbox;\n})\n\n/**\n * @ngdoc service\n * @name email.services.EmailTodo\n * @description\n *   待办邮件列表数据\n */\n.factory('EmailTodo', function($rootScope, Settings, EmailList) {\n\n  var todo = new EmailList(Settings.rootUrl + '/mail&type=todo');\n\n  $rootScope.$on('email.recovery', function() {\n    todo.reset();\n  });\n\n  $rootScope.$on('email.remove', function(evt, emailid) {\n    todo.remove(emailid);\n  });\n\n  $rootScope.$on('email.mark', function(evt, emailid, ismark) {\n    todo.mark(emailid, ismark);\n  });\n\n  return todo;\n})\n\n/**\n * @ngdoc service\n * @name email.services.EmailOutbox\n * @description\n *   发件箱列表数据\n */\n.factory('EmailOutbox', function($rootScope, Settings, EmailList) {\n\n  var outbox = new EmailList(Settings.rootUrl + '/mail&type=send');\n\n  $rootScope.$on('email.create', function(evt) {\n    outbox.reset();\n  });\n\n  $rootScope.$on('email.removeOutbox', function(evt, emailid) {\n    outbox.remove(emailid);\n  });\n\n  $rootScope.$on('email.mark', function(evt, emailid, ismark) {\n    outbox.mark(emailid, ismark);\n  });\n\n  return outbox;\n})\n\n/**\n * @ngdoc service\n * @name email.services.EmailTrash\n * @description\n *   回收站数据\n */\n.factory('EmailTrash', function($rootScope, Settings, EmailList) {\n\n  var trash = new EmailList(Settings.rootUrl + '/mail&type=del');\n\n  $rootScope.$on('email.removeTrash', function(evt, emailid) {\n    trash.remove(emailid);\n  });\n\n  $rootScope.$on('email.recovery', function(evt, emailid) {\n    trash.remove(emailid);\n  });\n\n  $rootScope.$on('email.mark', function(evt, emailid, ismark) {\n    trash.mark(emailid, ismark);\n  });\n\n  $rootScope.$on('email.remove', function(){\n    trash.reset();\n  })\n\n  return trash;\n})\n\n","/**\n * @ngdoc overview\n * @name thread.controllers\n * @description\n *   主线模块控制器\n */\nangular.module('thread.controllers', [])\n\n.controller('ThreadIndexCtrl', function($scope, $ionicLoading, User, Thread, ThreadUtils, ThreadProgress, User, Utils) {\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n        if(res.isSuccess){\n          if(res.data.thread){\n\n            // 过滤出已关注的主线\n            $scope.isAttention = function(th) {\n              return th.isAttention;\n            };\n\n            // 获取剩余天数\n            // 返回 0 时，表示未设置结束日期\n            // 返回 -1 时，表示已过期\n            $scope.getDayLeft = ThreadUtils.getDayLeft;\n\n            // 判断负责人是否自己\n            $scope.isInCharge = function(th) {\n              return th.chargeuid == User.uid;\n            };\n\n            // 初始化列表，首次进来时自动加载数据\n            $scope.init = function() {\n              // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n              if(!$scope.list.hasItems()) {\n                $scope.list.refresh();\n              }\n            };\n\n            // 刷新列表\n            $scope.refresh = function() {\n              $scope.refreshing = true;\n              $scope.list.refresh()\n                .finally(function() {\n                  $scope.$broadcast('scroll.refreshComplete');\n                  $scope.refreshing = false;\n                });\n            };\n\n            $scope.list = ThreadProgress;\n            $scope.init();\n          } else{\n            Utils.promptNoPermission();\n          }\n        }\n      }\n    ).finally($ionicLoading.hide);\n})\n\n// 主线已结束列表\n.controller('ThreadFinishedCtrl', function($scope, User, Thread, ThreadFinished) {\n  // 初始化列表，首次进来时自动加载数据\n  $scope.init = function() {\n    // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n    if(!$scope.list.hasItems()) {\n      $scope.list.refresh();\n    }\n  };\n\n  // 刷新列表\n  $scope.refresh = function() {\n    $scope.refreshing = true;\n    // $scope.prop.keyword = '';\n    $scope.list.refresh()\n    .finally(function() {\n      $scope.$broadcast('scroll.refreshComplete');\n      $scope.refreshing = false;\n    });\n  };\n\n  $scope.list = ThreadFinished;\n  $scope.init();\n\n  // 判断负责人是否自己\n  $scope.isInCharge = function(th) {\n    return th.chargeuid == User.uid;\n  };\n})\n\n// 主线详情页\n.controller('ThreadViewCtrl', function($scope, $stateParams, $ionicSlideBoxDelegate, Thread, ThreadUtils) {\n  $scope.thread = {\n    starttime: 0,\n    endtime: 0\n  };\n\n  // 获取主线本身数据\n  Thread.view($stateParams)\n  .success(function(res) {\n    $scope.thread = res.datas.thread;\n    $scope.dayLeft = ThreadUtils.getDayLeft($scope.thread.endtime);\n  });\n\n  // 幻灯切换\n  $scope.slideChanged= function(index){\n    $ionicSlideBoxDelegate.update();\n  }\n  $scope.$watch('thread.description', $scope.slideChanged.bind($scope));\n\n  // 获取团队成员数据\n  $scope.members = [];\n  Thread.view({ id: $stateParams.id, tab: 'team' })\n  .success(function(res) {\n    $scope.members = setChargeFirstInMembers(res.datas.members);\n  });\n\n  // 找出负责人，并插入到数组首位\n  function setChargeFirstInMembers(members) {\n    for(var i = 0; i < members.length; i++) {\n      if(members[i].isCharge) {\n        members.unshift(members.splice(i, 1)[0]);\n        break;\n      }\n    }\n    return members;\n  }\n\n  $scope.tab = 'assignment';\n\n  function ThreadRalatedList() {\n    this.loaded = false;\n    this.loading = false;\n    this.more = true;\n    this.list = [];\n\n    this.load = function(params) {\n      var that = this;\n      if(this.loaded) return;\n\n      this.loading = true;\n      Thread.view(params)\n      .success(function(res) {\n        that.list = res.datas;\n        that.loaded = true;\n      })\n      .finally(function() {\n        that.loading = false;\n      });\n    }\n  }\n\n  // 任务列表\n  $scope.assignment = new ThreadRalatedList();\n\n  // 动态列表\n  $scope.feed = new ThreadRalatedList();\n\n  // 邮件列表\n  $scope.email = new ThreadRalatedList();\n\n  // 审批列表\n  $scope.flow = new ThreadRalatedList();\n\n  // 文件列表\n  $scope.file = new ThreadRalatedList();\n\n  $scope.$watch('tab', function(val) {\n    $scope[val].load({ id: $stateParams.id, tab: val });\n  })\n\n  $scope.setTab = function(tab) {\n    $scope.tab = tab;\n  }\n\n});","/**\n * @ngdoc module\n * @name thread.services\n * @description\n *   主线模块服务\n */\n\nangular.module('thread.services', [])\n\n.factory('ThreadUtils', function() {\n  return {\n    // P.s. 此处的 time 是以秒为单位的时间戳\n    getDayLeft: function(time) { \n      time = +time;\n      if(!time) return 0;\n      return Math.ceil((time - Date.now() / 1000) / 86400);\n    }\n  };\n})\n\n\n/**\n * @ngdoc service\n * @name Thread\n * @module thread.services\n * @description\n *   主线数据服务\n */\n.factory('Thread', function($http, Settings) {\n  return {\n    list: function(params) {\n      return $http.get(Settings.rootUrl + '/thread/index', {\n        params: params\n      });\n    },\n\n    view: function(params) {\n      return $http.get(Settings.rootUrl + '/threaddetail/detail', {\n        params: params\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name AssignmentFinished\n * @module assignment.services\n * @description\n *   主线已完成列表数据\n */\n.factory('ThreadProgress', function(Settings, IbList) {\n  var list = new IbList(Settings.rootUrl + '/thread/index&status=0', {\n    idAttr: 'threadid'\n  });\n\n  list.showLoading = list.hideLoading = angular.noop;\n\n  return list;\n})\n\n\n/**\n * @ngdoc service\n * @name AssignmentFinished\n * @module assignment.services\n * @description\n *   主线已完成列表数据\n */\n.factory('ThreadFinished', function(Settings, IbList) {\n  var list = new IbList(Settings.rootUrl + '/thread/index&status=1', {\n    idAttr: 'threadid'\n  });\n  list.showLoading = list.hideLoading = angular.noop;\n\n  // assignmentFinished.search = function(keyword) {\n  //   if(keyword.trim() === '') {\n  //     return this.fetch({\n  //       offset: 0,\n  //     }, true);\n  //   } else {\n  //     return this.fetch({\n  //       offset: 0,\n  //       param: 'search',\n  //       keyword: keyword\n  //     }, true);\n  //   }\n\n  // };\n\n  return list;\n})\n","/**\n * @ngdoc module\n * @name thread\n * @description\n *   主线模块\n */\n\nangular.module('thread', ['ionic', 'thread.services', 'thread.controllers'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'thread', title: '主线', route: '#/thread/index', state: 'thread.index', icon: 'img/modicon/thread.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/thread', '/thread/index');\n\n  $stateProvider\n  .state('thread', {\n    url: '/thread',\n    abstract: true,\n    template: '<ion-nav-view name=\"thread\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  $stateProvider\n  // 主线首页\n  .state('thread.index', {\n    url: '/index',\n    talkingDataLabel: '主线-首页',\n    views: {\n      'thread': {\n        templateUrl: 'templates/thread/index.html',\n        controller: 'ThreadIndexCtrl'\n      }\n    }\n  })\n\n  // 主线 -已结束的主线\n  .state('thread.finished', {\n    url: '/finished',\n    talkingDataLabel: '主线-已结束',\n    views: {\n      'thread': {\n        templateUrl: 'templates/thread/finished.html',\n        controller: 'ThreadFinishedCtrl'\n      }\n    }\n  })\n\n  // 主线-详细页\n  .state('thread.view', {\n    url: '/view/:id',\n    talkingDataLabel: '主线-查看主线',\n    views: {\n      'thread': {\n        templateUrl: 'templates/thread/view.html',\n        controller: 'ThreadViewCtrl'\n      }\n    }\n  })\n});","/**\n * @ngdoc module\n * @name vote.controllers\n * @description\n *   投票模块控制器\n */\nangular.module('vote.controllers', [])\n\n/**\n * @ngdoc controller\n * @name VoteIndexCtrl\n * @module vote.controllers\n * @description\n *   投票主页控制器\n */\n.controller('VoteIndexCtrl', function($scope, $state, VoteUtils, Vote) {\n  $scope.statusTab = 'underway';\n  $scope.activeTab = 'nonparticipator';\n  $scope.stateName = $state.current.name;\n  $scope.loading = true;\n\n  var params = {};\n\n  $scope.setParticipationTab = function(type) {\n    $scope.list = [];\n    $scope.loading = true;\n    $scope.activeTab = type || 'nonparticipator';\n    params.type = $scope.activeTab === 'nonparticipator' ? 1 : 2;\n    VoteUtils.voteList($scope, params)\n  };\n\n  $scope.setStatusTab = function(type) {\n    $scope.statusTab = type || 'underway';\n    params.type = $scope.statusTab !== 'underway' ? 5 : 4;\n    VoteUtils.voteList($scope, params);\n  };\n\n\n  if($scope.stateName === 'vote.mine') {\n    $scope.statusTab = 'underway';\n    params.type = 4;\n  } else {\n    $scope.activeTab = 'nonparticipator';\n    params.type = 1;\n  }\n\n  $scope.refresh = function() {\n    if($scope.stateName === 'vote.index'){\n     params.type = $scope.activeTab === 'nonparticipator' ? 1 : 2;\n    } else {\n     params.type = $scope.statusTab === 'underway' ? 4 : 5;\n    }\n    VoteUtils.voteList($scope, params);\n  };\n\n  VoteUtils.voteList($scope, params);\n})\n\n/**\n * @ngdoc controller\n * @name VoteViewCtrl\n * @module vote.controllers\n * @description\n *   投票详情页控制器\n */\n.controller('VoteViewCtrl', function($scope, $timeout, $ionicModal, $ionicLoading, $stateParams, IbPopup, VoteUtils, Vote) {\n  $scope.isOpenMore = false;\n  $scope.openMore = function() {\n    $scope.isOpenMore = true;\n  };\n\n  $scope.openCrewModal = function() {\n    $ionicModal.fromTemplateUrl('templates/vote/vote-crew-modal.html', {\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n      .then(function(modal) {\n        $scope.crewModal = modal;\n        $scope.crewModal.show();\n        Vote.showvoteusers($stateParams.id).success(function(res) {\n            $ionicLoading.show()\n            if (res.isSuccess) {\n              $scope.voteUsers = res.data.users.joined;\n            }\n          })\n          .finally($ionicLoading.hide);\n      })\n  };\n\n  VoteUtils.showVote($scope, $stateParams.id);\n\n  var lastSelected = {};\n  $scope.checkMaxSelected = function(topicid, max, currentItemid) {\n    var topic = $scope.form.topics[topicid];\n    var checkedNum = 0;\n\n    // 获取当前选中的数目\n    angular.forEach(topic, function(isChecked, itemid) {\n      if (isChecked) checkedNum++;\n    });\n\n    if (checkedNum > max) {\n      var lastItemid = lastSelected[topicid];\n      topic[lastItemid] = false;\n    }\n    lastSelected[topicid] = currentItemid;\n  };\n\n  $scope.form = {\n    voteid: ''\n  };\n\n  // 检查表单是否可以提交\n  $scope.validForm = function() {\n    var topics = VoteUtils.mainConvert($scope.form.topics);\n    return topics.length === $scope.topics.length;\n  };\n\n  $scope.submit = function() {\n    Vote.vote({\n      vote: {\n        voteid: $stateParams.id,\n        topics: VoteUtils.arrayToObject(VoteUtils.mainConvert($scope.form.topics))\n      }\n    }).success(function(res) {\n      if (res.isSuccess) {\n        VoteUtils.showVote($scope, $stateParams.id);\n      } else {\n        IbPopup.alert({ title: res.msg });\n      }\n    })\n  };\n\n});","/**\n * @ngdoc overview\n * @name vote.services\n * @description\n *   投票模块服务\n */\n\nangular.module('vote.services', [])\n\n\n/**\n * @ngdoc service\n * @name vote.services.Diary\n * @description\n *   投票通用服务\n */\n\n  .factory('Vote', function($http, Settings) {\n    var moduleUrl = Settings.hostUrl + '?r=vote';\n\n    return {\n      /**\n       * @ngdoc     method\n       * @name      diary.services.Vote#VoteList\n       * @methodOf  diary.services.Vote\n       * @param     {Object}   params  type 1未参与，2已参与，3全部，4我发起的-进行中，5我发起的-已结束，6我发起的-全部。默认值3（全部）\n       *\n       * @description\n       *   获取投票列表\n       *\n       * @returns   {HttpPromise}   HttpPromise\n       */\n      voteList: function (params) {\n        return $http.get(moduleUrl + '/default/fetchindexlist', { params : params})\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      diary.services.Vote#showVote\n       * @methodOf  diary.services.Vote\n       * @param     {Object}   params\n       *             voteid  投票id\n       *\n       * @description\n       *   查看投票\n       * @returns   {HttpPromise}   HttpPromise\n       */\n      showVote: function (id) {\n        return $http.get(moduleUrl + '/default/showvote', { params : { voteid : id }} )\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      diary.services.Vote#vote\n       * @methodOf  diary.services.Vote\n       * @param     {Object}   params\n       *             voteid  投票id\n       *             topicid    投票话题id\n       *             itemid    \t投票选项id\n       *\n       * @description\n       *   查看投票\n       * @returns   {HttpPromise}   HttpPromise\n       */\n      vote: function (params) {\n        return $http.post(moduleUrl + '/default/vote', params )\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      diary.services.Vote#showvoteusers\n       * @methodOf  diary.services.showvoteusers\n       * @param     {Object}   params\n       *             voteid  投票id\n       *\n       *\n       * @description\n       *   查看投票用户\n       * @returns   {HttpPromise}   HttpPromise\n       */\n      showvoteusers: function (voteid) {\n        return $http.get(moduleUrl + '/default/showvoteusers', { params: { voteid : voteid }} )\n      },\n\n    }\n  })\n\n  .factory('VoteUtils', function($ionicLoading, Utils, Vote) {\n\n    return{\n      voteList: function(scope, params) {\n        $ionicLoading.show();\n        Vote.voteList(params).success(function(res) {\n          if(res.isSuccess){\n            scope.loading = false;\n            scope.list = res.data;\n          } else {\n            Utils.promptNoPermission();\n          }\n        }).finally(function(){\n          $ionicLoading.hide();\n          scope.$broadcast('scroll.refreshComplete');\n        })\n      },\n\n     showVote: function(scope,voteid) {\n       $ionicLoading.show();\n       Vote.showVote(voteid).success(function(res) {\n         if(res.isSuccess) {\n           scope.vote = res.data.vote;\n           scope.topics = res.data.topics;\n           //scope.voteUsers = res.data.users.joined;\n         }\n       })\n         .finally($ionicLoading.hide);\n     },\n      //子对象\n      convertSubItem: function(value) { // { 22: true, 23: false, 24: true } => [22, 24]\n        var result = [];\n        for (var key in value){\n          if(value[key]) {\n            result.push(key);\n          }\n        }\n        return result;\n      },\n\n      //转成数组\n      mainConvert: function(topicsObj) {\n        var result = [];\n        var that = this;\n        angular.forEach(topicsObj, function(value, topicid) {\n          var itemIds = typeof value === 'number' ? [value] : typeof value === 'object' ? that.convertSubItem(value) : [];\n          if(itemIds.length) {\n            result.push({\n              topicid: topicid,\n              itemids: itemIds\n            });\n          }\n        });\n        return result;\n      },\n\n      arrayToObject: function(arr) {\n        var ret = {};\n        angular.forEach(arr, function(value, key) {\n          ret[key] = value;\n        });\n        return ret;\n      }\n    }\n  })\n","\n/**\n * @ngdoc module\n * @name vote\n * @description\n *   投票\n */\n\nangular.module('vote', ['ionic', 'vote.controllers', 'vote.services'])\n\n  .run(function(Apps) {\n    Apps.install({ name: 'vote', title: '投票', route: '#/vote', state: 'vote.index', icon: 'img/modicon/vote.png' });\n  })\n\n  .config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n    $urlRouterProvider.when('/vote', '/vote/index');\n\n\n    $stateProvider\n      .state('vote', {\n        url: \"/vote\",\n        abstract: true,\n        template: '<ion-nav-view name=\"vote\"></ion-nav-view>',\n        resolve: UserProvider.resolve\n      })\n\n      .state('vote.index', {\n        url: '/index',\n        cache: false,\n        talkingDataLabel: '投票-主页',\n        views: {\n          'vote': {\n            templateUrl: 'templates/vote/vote-index.html',\n            controller: 'VoteIndexCtrl'\n          }\n        }\n      })\n\n      .state('vote.mine', {\n        url: '/mine',\n        cache: false,\n        talkingDataLabel: '投票-我的',\n        views: {\n          'vote': {\n            templateUrl: 'templates/vote/vote-index.html',\n            controller: 'VoteIndexCtrl'\n          }\n        }\n      })\n\n      //投票详情页\n      .state('vote.view', {\n        url: '/view/:id',\n        talkingDataLabel: '投票-详情页',\n        cache: false,\n        views: {\n          'vote': {\n            templateUrl: 'templates/vote/vote-view.html',\n            controller: 'VoteViewCtrl'\n          }\n        }\n      })\n\n  });","/**\n * @ngdoc module\n * @name workflow.controllers\n * @description\n *   工作流模块控制器\n */\nangular.module('workflow.controllers', [])\n\n.controller('FlowIndexCtrl', function($scope,$ionicLoading, User, Utils) {\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n        if(res.isSuccess){\n          if(!res.data.workflow) {\n            Utils.promptNoPermission();\n          }\n        }\n      }\n    ).finally($ionicLoading.hide);\n  })\n\n.controller('FlowListCtrl', function($scope, $state, $ionicScrollDelegate, $ionicActionSheet) {\n  $scope.prop = {};\n  \n  // 初始化列表，首次进来时自动加载数据\n  $scope.init = function() {\n    // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n    if(!$scope.list.hasItems()) {\n      $scope.list.refresh();\n    }\n  }\n\n  // 刷新列表\n  $scope.refresh = function() {\n    $scope.prop.keyword = '';\n    $scope.list.refresh()\n    .finally(function() {\n      $scope.$broadcast('scroll.refreshComplete');\n    })\n  }\n\n  $scope.sref = 'workflow.detail({ key: flow.key })';\n\n  $scope.actionButtons = [];\n  $scope.showMenu = function(flow) {\n    var conf = {\n      titleText: '工作流操作',\n      buttons: $scope.actionButtons,\n      buttonClicked: function(index, opts) {\n        return opts.handler.call(null, flow);\n      },\n      cancelText: '取消'\n    };\n\n    if(angular.isFunction($scope.remove)) {\n      conf.destructiveText = '删除';\n      conf.destructiveButtonClicked = function() {\n        return $scope.remove(flow);\n      }\n    }\n\n    $scope.hideMenu = $ionicActionSheet.show(conf);\n  }\n})\n\n/**\n * @ngdoc controller\n * @name FlowTodoCtrl\n * @module workflow.controllers\n * @description\n *   待办工作列表页控制器\n */\n.controller('FlowTodoCtrl', function($scope, $controller, $state, $ionicActionSheet, IbPopup, Flow, FlowTodo) {\n\n  $controller('FlowListCtrl', { $scope: $scope });\n  $scope.list = FlowTodo;\n  $scope.title = '待办工作';\n  $scope.init();\n\n  $scope.sref = 'workflow.handle({ key: flow.key })';\n\n  var _showMenu = $scope.showMenu;\n\n  $scope.showMenu = function(flow) {\n    $scope.actionButtons = [];\n\n    $scope.remove = flow.del ? function(flow) {\n      Flow.confirmRemove(flow);\n      return true;\n    } : false;\n\n    _showMenu(flow);\n  }\n})\n\n/**\n * @ngdoc controller\n * @name FlowTransCtrl\n * @module workflow.controllers\n * @description\n *   已办结列表页控制器\n */\n.controller('FlowTransCtrl', function($scope, $controller, Flow, FlowTrans) {\n\n  $controller('FlowListCtrl', { $scope: $scope });\n  $scope.list = FlowTrans;\n  $scope.title = '已办结';\n  $scope.init();\n\n  $scope.takeback = function(flow) {\n    Flow.confirmTakeback(flow);\n    return true;\n  };\n\n  var _showMenu = $scope.showMenu;\n  $scope.showMenu = function(flow) {\n    $scope.actionButtons = [];\n\n    // 若允许收回\n    if(flow.rollback) {\n      $scope.actionButtons.push({ \n        text: '收回',\n        handler: function(flow) {\n          return $scope.takeback(flow);\n        } \n      })\n    }\n    \n    _showMenu(flow);\n  }\n})\n\n/**\n * @ngdoc controller\n * @name FlowDoneCtrl\n * @module workflow.controllers\n * @description\n *   已完成列表页控制器\n */\n.controller('FlowDoneCtrl', function($scope, $controller, Flow, FlowDone) {\n\n  $controller('FlowListCtrl', { $scope: $scope });\n  $scope.list = FlowDone;\n  $scope.title = '已完成';\n  $scope.init();\n\n  var _showMenu = $scope.showMenu;\n\n  $scope.showMenu = function(flow) {\n    $scope.actionButtons = [];\n\n    $scope.remove = flow.del ? function(flow) {\n      Flow.confirmRemove(flow);\n      return true;\n    } : false;\n\n    _showMenu(flow);\n  }\n})\n\n/**\n * @ngdoc controller\n * @name FlowFollowCtrl\n * @module workflow.controllers\n * @description\n *   我的关注列表页控制器\n */\n.controller('FlowFollowCtrl', function($scope, $controller, FlowFollow) {\n\n  $controller('FlowListCtrl', { $scope: $scope });\n  $scope.list = FlowFollow;\n  $scope.title = '我的关注';\n  $scope.init();\n\n  $scope.showMenu = angular.noop;\n})\n\n/**\n * @ngdoc controller\n * @name FlowCreateCtrl\n * @module workflow.controllers\n * @description\n *   发起工作页控制器\n */\n.controller('FlowCreateCtrl', function($scope, $rootScope, $state, $ionicModal, $ionicLoading, $ionicHistory, IbPopup, Flow) {\n\n  $scope.processes = [];\n  $scope.categories = [];\n\n  $scope.create = function(flow) {\n    $ionicLoading.show();\n    return Flow.create(flow.flowid)\n    .success(function(res) {\n      if(res.isSuccess) {\n        $ionicHistory.clearCache(['workflow.todo']).then(function() {\n          $state.go('workflow.handle', { key: res.key });\n        });\n      } else {\n        IbPopup.alert({ title: res.msg });\n      }\n    })\n    .finally($ionicLoading.hide);\n  }\n\n  // 查看分类下的流程\n  var cateModal;\n  // 为 Modal 新建一个 scope\n  var cateModalScope = $rootScope.$new(true);\n  cateModalScope.processes = [];\n  cateModalScope.close = function() {\n    cateModal && cateModal.hide();\n  }\n  cateModalScope.create = $scope.create;\n\n  // 创建分类详细 Modal\n  $ionicModal.fromTemplateUrl('./templates/workflow/workflow-cate-modal.html', {\n    scope: cateModalScope,\n    animation: 'slide-in-up',\n  })\n  .then(function(modal) {\n    cateModal = modal;\n  })\n\n  // 查看分类下的流程\n  $scope.openCate = function(cate) {\n    cateModalScope.category = cate;\n    cateModal.show();\n  };\n\n  $scope.$on('$ionicView.leave', function() {\n    cateModal && cateModal.hide();\n  });\n  $scope.$on('$destroy', function() {\n    cateModal && cateModal.remove();\n  });\n\n  // 获取可用的流程列表\n  $scope.loading = true;\n  Flow.getProcess()\n  .success(function(res) {\n    $scope.processes = res.common;\n    $scope.categories = res.cate;\n  })\n  .finally(function() {\n    $scope.loading = false;\n  });\n})\n\n/**\n * @ngdoc controller\n * @name FlowHandleCtrl\n * @module workflow.controllers\n * @description\n *   办理工作页控制器\n */\n.controller('FlowHandleCtrl', function($scope, $state, $stateParams, $timeout, $window, $ionicLoading, $ionicPopup, $ionicHistory, $ionicModal, $q, $filter, IbPopup, Settings, User, Flow, FlowUtils, icFactory, FlowUpload, FileUtils, IbPopup) {\n\n  var flow = $scope.flow = {};\n  var form = $scope.form = {};\n  \n  $scope.key = $stateParams.key;\n  $scope.formhash = User.formhash;\n\n  // 判断是否只读字段\n  $scope.isReadonly = function(item) {\n    if(flow.readonly) {\n      return flow.readonly.split(',').indexOf(item['data-id']) !== -1;\n    }\n    return false;\n  }\n\n  // 查看原表\n  $scope.viewSource = function() {\n    $window.open(Settings.hostUrl + '?r=workflow/form/index&key=' + $scope.key, '_blank', 'location=yes');\n  }\n\n  function save() {\n    form.attachmentid = $scope.imageAttach.concat($scope.fileAttach)\n      .map(function(item) {\n        return item.aid;\n      })\n      .join(',');\n    var formData = icFactory.serialize(angular.extend({}, form), flow.enableArr);\n    $ionicLoading.show();\n    return Flow.saveFlow(formData)\n    .success($ionicLoading.hide)\n    .error($ionicLoading.hide);\n  }\n\n  // 保存表单数据\n  $scope.save = function() {\n    save()\n    .success(function() {\n      IbPopup.tip('保存成功');\n    });\n  };\n\n  // 转交下一步\n  $scope.handover = function() {\n    save()\n    .success(function() {\n      // 自由流程的转交与固定流程转交不一样\n      var state = $scope.flow.flow.type == '2' ? 'workflow.handoverFree' : 'workflow.handover';\n      $state.go(state, { key: $scope.key, topflag: $scope.flow.rp.topflag });\n    });\n  };\n\n  $scope.rollbackData = {};\n\n  function saveRollback(params) {\n    $ionicLoading.show();\n    Flow.rollback($scope.key, params)\n    .success(function(res) {\n      if(res.isSuccess) {\n        IbPopup.alert({ title: '成功退回' }).then(function(){\n          $ionicHistory.clearCache(['workflow.todo', 'workflow.trans']).then(function() {\n            $ionicHistory.goBack();\n          });\n        });\n      }\n    })\n    .finally($ionicLoading.hide);\n  }\n\n  function showRollBackModel() {\n    if($scope.flow.backlist && $scope.flow.backlist.length) {\n\n      $scope.rollbackData.stepId = $scope.flow.backlist[0].id;\n\n      if($scope.rollbackModal) {\n        $scope.rollbackModal.show();\n      } else {\n        $ionicModal.fromTemplateUrl('templates/workflow/backstep-modal.html', {\n          scope: $scope,\n          animation: 'slide-in-up'\n        }).then(function(modal) {\n          modal.show();\n\n          $scope.rollbackModal = modal;\n          // 确定回退\n          $scope.rollbackModal.save = function () {\n            saveRollback({ id: $scope.rollbackData.stepId, formhash: User.formhash });\n            modal.hide();\n          }\n          \n          $scope.$on('$destroy', function() {\n            modal.remove();\n            delete $scope.rollbackModal;\n          });\n\n          $scope.$on('$ionicView.leave', function() {\n            modal.hide();\n          });\n\n        });\n      }\n    } else {\n      // 没有可选回退步骤\n    }\n  }\n\n  // 回退，按后端设置可分为直接回退到上一步，跟回退到可选步骤两种\n  $scope.rollback = function() {\n    // 回退到上一步\n    if($scope.flow.process.allowback == '1') {\n      $ionicPopup.show({\n        template: '<input type=\"text\" ng-model=\"rollbackData.remind\">',\n        title: '请输入回退原因',\n        scope: $scope,\n        buttons: [\n          { text: '取消' },\n          {\n            text: '确定',\n            type: 'button-positive',\n            onTap: function(e) {\n              if (!$scope.rollbackData.remind) {\n                e.preventDefault();\n              } else {\n                return $scope.rollbackData.remind;\n              }\n            }\n          },\n        ]\n      })\n      .then(function(res) {\n        if(res) {\n          saveRollback({ remind: res, formhash: User.formhash });\n        }\n      });  \n    // 回退到可选步骤\n    } else if($scope.flow.process.allowback == '2') {\n      showRollBackModel();\n    }\n  }\n\n  // 经办人会签（办理完毕）\n  $scope.sign = function() {\n    IbPopup.confirm({ title: '确定该工作已经办结吗？'})\n    .then(function(res) {\n      if(res) {\n        $ionicLoading.show();\n        Flow.signFlow($scope.key, {\n          topflag: flow.rp.topflag,\n          opflag: flow.rp.opflag\n        })\n        .success(function() {\n          $ionicHistory.clearCache(['workflow.todo', 'workflow.trans']).then(function() {\n            FlowUtils.goBackOrHome();\n          });\n        })\n        .finally($ionicLoading.hide);\n      }\n    })\n  }\n\n  // 结束流程（自由流程）\n  $scope.end = function() {\n    IbPopup.confirm({ title: '确认要结束该工作流程吗？'})\n    .then(function(res) {\n      if(res) {\n        $ionicLoading.show();\n        Flow.signFlow($scope.key, {\n          topflag: flow.rp.topflag,\n          opflag: flow.rp.opflag\n        })\n        .success(function() {\n          $ionicHistory.clearCache(['workflow.todo', 'workflow.trans']).then(function() {\n            FlowUtils.goBackOrHome();\n          });\n        })\n        .finally($ionicLoading.hide);\n      }\n    })\n  }\n\n  $scope.imageAttach = [];\n  $scope.fileAttach = [];\n\n  // 添加图片\n  $scope.addImage = function(e) {\n    var safeSize = 20;\n    var files = e.target.files;\n    if (FlowUpload.isSafeFile(FlowUpload.safeImgTypes, files) && FlowUpload.isSafeSize(safeSize, files)) {\n      FlowUpload.upload($scope, files, $scope.imageAttach, $scope.flow.process.processid);\n    } else {\n      IbPopup.alert({\n        title: '仅支持不超过'+safeSize+'M的以下类型文件：' + FlowUpload.safeImgTypes.join(',')\n      });\n    }\n  }\n\n  // 删除图片\n  $scope.removeImage = function(index) {\n    $scope.imageAttach.splice(index, 1);\n  }\n\n  // 添加文件\n  $scope.isIos = ionic.Platform.isIOS();\n  $scope.checkIos = function() {\n    if ($scope.isIos) {\n      return IbPopup.alert({\n        title: '抱歉，暂不支持苹果系统及部分安卓系统上传附件'\n      });\n    }\n  }\n\n  $scope.addFile = function(e) {\n    var files = e.target.files;\n    var safeSize = 20;\n    if (FlowUpload.hasEmptyFile(files)) {\n      return IbPopup.alert({\n        title: '上传的文件中不能包含空文件'\n      });\n    }\n    if (FlowUpload.isSafeFile(FlowUpload.safeFileTypes, files) && FlowUpload.isSafeSize(safeSize, files)) {\n      FlowUpload.upload($scope, files, $scope.fileAttach, $scope.flow.process.processid);\n    } else {\n      IbPopup.alert({\n        title: '仅支持不超过'+safeSize+'M的以下类型文件：' + FlowUpload.safeFileTypes.join(',')\n      });\n    }\n  }\n\n  // 删除文件\n  $scope.removeFile = function(index) {\n    $scope.fileAttach.splice(index, 1);\n  }\n\n  // 下载文件\n  $scope.downloadFile = function(item) {\n    if (item.entireattachurl) {\n      return FileUtils.download($filter('fullUrl')(item.entireattachurl));\n    }\n    if (item.url) {\n      FileUtils.workflowDownload(item.url);\n    }\n  }\n\n  // 将附件分成图片和文件\n  function classifyAttach(attachData) {\n    angular.forEach(attachData, function(attach) {\n      var type = attach.filename.split('.').pop().toLowerCase();\n      if (FlowUpload.safeImgTypes.indexOf(type) !== -1) {\n        attach.url = $filter('fullUrl')(attach.officereadurl);\n        $scope.imageAttach.push(attach);\n      } else {\n        $scope.fileAttach.push(attach);\n      }\n    });\n  }\n\n  // 对象转数组 \n  function obj2Arr(obj) {\n    var arr = [];\n    angular.forEach(obj, function(value) {\n      arr.push(value);\n    });\n    return arr;\n  }\n\n  $ionicLoading.show();\n\n  Flow.getFlow($stateParams.key)\n  .success(function(res) {\n    if(typeof res.isSuccess !== 'undefined' && !res.isSuccess) {\n\n      IbPopup.alert({ title: res.msg })\n      .then(function() {\n        $ionicHistory.goBack();\n      });\n\n    } else {\n      flow = $scope.flow = res;\n      // feedback没有数据的时候后端会返回空数组，有数据的时候会返回obj\n      if ($scope.flow.feedback && !($scope.flow.feedback instanceof Array)) {\n        $scope.flow.feedback = obj2Arr($scope.flow.feedback);\n      }\n      form.key = $scope.key;\n      form.hidden = flow.hidden;\n      form.readonly = flow.readonly;\n      form.attachmentid = flow.run.attachmentid;\n      form.fbattachmentid = ''; // ?\n      form.topflag = flow.rp.topflag;\n      form.saveflag = '';\n      form.formhash = $scope.formhash;\n      form.enablefiled = flow.enablefiled + '';\n      $scope.ics = [].concat(flow.enableArr, flow.valueArr);\n      // 分类附件(分成图片和文件)\n      res.attachData && classifyAttach(res.attachData);\n    }\n  })\n  .finally($ionicLoading.hide);\n})\n\n/**\n * @ngdoc controller\n * @name FlowHandoverCtrl\n * @module workflow.controllers\n * @description\n *   转交工作页控制器\n */\n.controller('FlowHandoverCtrl', function($scope, $state, $stateParams, $timeout, $ionicLoading, IbPopup, Flow, FlowUtils) {\n  var data = $scope.data = {};\n  var form = $scope.form = {\n    'prcs_user_op': [],\n    'prcs_user': [],\n    'topflag': [],\n    'prcs_choose': {},\n    'remind': {\n      '1': true,\n      '2': false,\n      '3': false\n    }\n  };\n\n  $scope.save = function() {\n\n    // 转交前有未经办人员时确认\n    if(data.notAllFinished) {\n      var msg = '经办人 ' + data.notAllFinished + ' 未办理完毕';\n\n      // \n      // 没要所有经办人会签时, 提示确认。\n      if(data.process.turnpriv == '1') {\n        if(!window.confirm(msg + ', 是否确认转交？')) {\n          return false;\n        }\n      // 要求所有经办人会签时，给出消息提示，但不允许转交\n      } else if(data.process.turnpriv == '0') {\n        alert(msg);\n        return false;\n      }\n    }\n    \n    var formData = {\n      'runid': data.runid,\n      'flowid': data.flowid,\n      'processid': data.processid,\n      'flowprocess': data.flowprocess,\n      'processto': data.process.processto,\n      'prcsback': data.prcsback,\n\n      'message': form.message,\n      'remind': {},\n      'prcs_choose': []\n    };\n\n    // 格式化 scope 的数据以提交给服务器\n    angular.forEach(form.prcs_choose, function(v, i) {\n      if(v.checked) {\n        formData['prcs_user_op' + i] = form.prcs_user_op[i] || '';\n        formData['prcs_user' + i] = form.prcs_user[i] || '';\n        formData['topflag' + i] = form.topflag[i] || '0';\n\n        // 若非最后一步骤时，需要通过 prcs_choose 储存选中步骤信息\n        // 最后一步则保持 prcs_choose 为空保持后端判断的标准\n        // 给这逻辑跪下了...\n        if(!v.isover) {\n          formData.prcs_choose.push(v.value);\n        }\n      }\n    });\n\n    // 由于后端使用 isset 判断 remind，所有要清理 remind 值为 false 的 key\n    // 不然就算值为 false 后端也会判断为 true\n    angular.forEach(form.remind, function(v, i){\n      if(v) {\n        formData.remind[i] = v;\n      }\n    });\n\n    // 如果是最后一步，则需要用特殊的参数名...\n    // @ps. 在流程本身为子流程的情况下，就算是最后一步，也会有主办人和经办人选项\n    if(!formData.prcs_choose.length) {\n      formData.prcs_user_op = formData.prcs_user_op0;\n      formData.prcs_user = formData.prcs_user0;\n      formData.topflag = $stateParams.topflag;\n      delete formData.prcs_user_op0;\n      delete formData.prcs_user0;\n      delete formData.topflag0;\n    }\n\n    $ionicLoading.show();\n    Flow.handover(formData)\n    .success(FlowUtils.onHandoverSuccess)\n    .finally($ionicLoading.hide);\n  }\n\n  // 初始化步骤信息\n  $scope.initStep = function(index, step) {\n    form.prcs_choose[index] = {\n      checked: step.checked,\n      value: index,\n      isover: step.isover\n    }\n  };\n\n  // 点击其他步骤时，判断是否允许并发\n  // 允许时，判定为多选\n  // 不允许时，判定为切换步骤（仿单选功能）\n  $scope.selectStep = function(index, step) {\n    if($scope.data.process.syncdeal != 0) {\n      return false;\n    }\n    if(form.prcs_choose[index].checked) {\n      angular.forEach(form.prcs_choose, function(s) {\n        s.checked = false;\n      });\n    }\n    form.prcs_choose[index].checked = true;\n  };\n\n  // 判断指定步骤是否子流程\n  $scope.notChildFlow = function(step) {\n    return step.process && \n      step.process.childflow &&\n      step.process.childflow == '0'\n  };\n\n  // 验证转交表单\n  $scope.validate = function() {\n    var ret = false;\n\n    angular.forEach(form.prcs_choose, function(v, i) {\n      // 确保最少一项选中\n      if(v.checked) {\n        // 非结束步骤时，即转交时\n        if(!v.isover) {\n          // 当主办人选项为 ‘主办’时，要求主办人必填\n          if(form.topflag[i] == '0') {\n            ret = !!form.prcs_user_op[i];\n          // 否则主办人选项为其他时，要求经办人必填\n          } else {\n            ret = !!form.prcs_user[i];\n          }\n\n        // 结束步骤仅流程为子流程时要求填写主办人\n        } else {\n          ret = true;\n          // 为子流程的情况\n          if(data.prcsback) {\n            ret = !!form.prcs_user_op[i];\n          }\n        }\n      }\n    });\n\n    return ret;\n  };\n\n  $ionicLoading.show();\n\n  Flow.getNext($stateParams)\n  .success(function(res) {\n    if(typeof res == 'string') {\n      IbPopup.alert({ title: res})\n    } else {\n      data = $scope.data = res;\n      $scope.form.message = '请您及时办理工作【' + $scope.data.run.name + '】，谢谢';\n    }\n  })\n  .finally($ionicLoading.hide);\n})\n\n/**\n * @ngdoc controller\n * @name FlowHandoverFreeCtrl\n * @module workflow.controllers\n * @description\n *   转交自由流程页控制器\n */\n.controller('FlowHandoverFreeCtrl', function($scope, $state, $stateParams, $timeout, $ionicLoading, $ionicModal, $ionicScrollDelegate, IbPopup, User, Flow, FlowUtils) {\n  var run = $scope.run = {};\n  var form = $scope.form = {\n    'next': {\n      'topflag': '0'\n    },\n    'preset': [],\n    'field': []\n  };\n\n  // 增加预设步骤\n  $scope.addPreset = function() {\n    form.preset.push({\n      'topflag': '0',\n      'prcsUserOp': '',\n      'prcsUser': ''\n    })\n\n    $timeout(function() {\n      $ionicScrollDelegate.resize()\n    })\n  };\n\n  // 创建分类详细 Modal\n  $ionicModal.fromTemplateUrl('./templates/workflow/workflow-field-modal.html', {\n    scope: $scope,\n    animation: 'slide-in-up',\n  })\n  .then(function(modal) {\n    $scope.modal = modal;\n  })\n\n  // 移除预设步骤\n  $scope.removePreset = function($index) {\n    form.preset.splice($index, 1);\n  };\n\n  $scope.getPresetIndex = function($index, processid) {\n    return $index + 1 + +run.processid;\n  }\n\n  $scope.save = function() {\n    // 如果还有经办人未处理，则弹出提示\n    if(run.notAllFinished) {\n      var msg = '经办人 ' + run.notAllFinished + ' 未办理完毕';\n      if(!window.confirm(msg + ', 是否确认转交？')) {\n        return false;\n      }\n    }\n    \n    var formData = {\n      'op': run.op,\n      'key': run.key,\n      'topflagOld': run.topflag,\n      'freeItemOld': '',\n      'tmpCount': '',\n      'lineCount': form.preset.length,\n      'message': form.message,\n      'formhash': User.formhash\n    };\n\n    // 若下一步骤为预设步骤\n    if(run.preset != '') {\n      formData.preset = '1';\n      formData.prcsUserOp = '1';\n      formData.prcsUser = '1';\n      formData.topflag = '1';\n    // 否则手动指定下一步骤\n    } else {\n\n      // 拿到下一步骤的数据\n      formData.topflag = form.next.topflag;\n      formData.prcsUserOp = User.addPrefix(form.next.prcsUserOp);\n      formData.prcsUser = User.addPrefix(form.next.prcsUser);\n\n      // 拿到预设步骤的数据\n      angular.forEach(form.preset, function(preset, index) {\n        var flag = index + 1;\n        formData['topflag' + flag] = preset.topflag;\n        formData['prcsUserOp' + flag] = User.addPrefix(preset.prcsUserOp);\n        formData['prcsUser' + flag] = User.addPrefix(preset.prcsUser);\n      });\n  \n      // 拿到可写字段数据\n      angular.forEach(form.field, function(f) {\n        formData.freeItemOld += (formData.freeItemOld ?  ',' + f : f);\n      });\n    }\n\n    $ionicLoading.show();\n    Flow.handoverFree(formData)\n    .success(FlowUtils.onHandoverSuccess)\n    .finally($ionicLoading.hide);\n  }\n  \n  function valiStep (step) {\n    // 下一步骤主办人选项为“主办”，则要求主办人非空\n    if(step.topflag == '0' && !step.prcsUserOp) {\n      return false;\n    }\n\n    // 否则要求经办人非空\n    if(step.topflag != '0' && !step.prcsUser) {\n      return false;\n    }\n\n    return true;\n  }\n\n  // 验证转交表单\n  $scope.validate = function() {\n    // 如果是预设步骤可直接提交\n    if(run.preset != '') {\n      return true;\n    }\n\n    // 下一步骤主办人选项为“主办”，则要求主办人非空\n    if(!valiStep(form.next)) {\n      return false;\n    }\n\n    // 有预设步骤时，判断预设步骤数据是否合理，逻辑同上\n    var i = 0, len;\n    if(len = form.preset.length) {\n      for(; i < len; i++) {\n        if(!valiStep(form.preset[i])) {\n          return false;\n        }\n      }\n    }\n\n    return true;\n  };\n\n  $ionicLoading.show();\n  Flow.getFreeNext($stateParams.key)\n  .success(function(res) {\n    if(typeof res == 'string') {\n      IbPopup.alert({ title: res})\n    } else {\n      run = $scope.run = res;\n      $scope.form.message = '请您及时办理工作【' + run.runName + '】，谢谢';\n    }\n  })\n  .finally($ionicLoading.hide);\n\n  $scope.$on('$ionicView.leave', function() {\n    $scope.modal.hide();\n  });\n  $scope.$on('$destroy', function() {\n    $scope.modal.remove();\n  });\n})\n\n/**\n * @ngdoc controller\n * @name FlowDetailCtrl\n * @module workflow.controllers\n * @description\n *   查看工作页控制器\n */\n.controller('FlowDetailCtrl', function($scope, $state, $stateParams, $timeout, $window, $ionicLoading, $ionicPopup, $filter, IbPopup, Settings, User, Flow, FlowUtils, FileUtils, FlowUpload) {\n\n  $scope.flow = {};\n  $scope.key = $stateParams.key;\n  $scope.formhash = User.formhash;\n\n  // 查看原表\n  $scope.viewSource = function() {\n    $window.open(Settings.hostUrl + '?r=workflow/preview/print&key=' + $scope.key, '_blank', 'location=yes');\n  }\n\n  $ionicLoading.show();\n\n  $scope.imageAttach = [];\n  $scope.fileAttach = [];\n\n  // 将附件分成图片和文件\n  function classifyAttach(attachData) {\n    angular.forEach(attachData, function(attach) {\n      var type = attach.filename.split('.').pop().toLowerCase();\n      if (FlowUpload.safeImgTypes.indexOf(type) !== -1) {\n        attach.url = $filter('fullUrl')(attach.officereadurl);\n        $scope.imageAttach.push(attach);\n      } else {\n        $scope.fileAttach.push(attach);\n      }\n    });\n  }\n\n  // 对象转数组 \n  function obj2Arr(obj) {\n    var arr = [];\n    angular.forEach(obj, function(value) {\n      arr.push(value);\n    });\n    return arr;\n  }\n\n  $scope.downloadFile = function(item) {\n    if (item.entireattachurl) {\n      return FileUtils.download($filter('fullUrl')(item.entireattachurl));\n    }\n    if (item.url) {\n      FileUtils.workflowDownload(item.url);\n    }\n  }\n\n  Flow.getFlow($stateParams.key, { type: 'view' })\n  .success(function(res) {\n    if(typeof res.isSuccess !== 'undefined' && !res.isSuccess) {\n      IbPopup.alert({ title: '提示', template: res.msg })\n      .then(FlowUtils.goBackOrHome)\n    } else {\n      $scope.flow = res;\n      // feedback没有数据的时候后端会返回空数组，有数据的时候会返回obj\n      if ($scope.flow.feedback && !($scope.flow.feedback instanceof Array)) {\n        $scope.flow.feedback = obj2Arr($scope.flow.feedback);\n      }\n      res.attachData && classifyAttach(res.attachData);\n    }\n  })\n  .finally($ionicLoading.hide);\n})\n\n","// ------------ directive\n/**\n * @ngdoc overview\n * @name workflow.directives\n * @description\n *   工作流指令集\n */\nangular.module('workflow.directives', [])\n\n.directive('icErrorTip', function() {\n  return {\n    restrict: 'E',\n    template: \n      '<div ng-if=\"error.notempty\" class=\"assertive fss\">“{{ title }}”不能为空</div>' +\n      '<div ng-if=\"error.chinese\" class=\"assertive fss\">“{{ title }}”只能为中文</div>' +\n      '<div ng-if=\"error.letter\" class=\"assertive fss\">“{{ title }}”只能为英文</div>' +\n      '<div ng-if=\"error.num\" class=\"assertive fss\">“{{ title }}”只能为数字</div>' +\n      '<div ng-if=\"error.idcard\" class=\"assertive fss\">“{{ title }}”只能为身份证</div>' +\n      '<div ng-if=\"error.mobile\" class=\"assertive fss\">“{{ title }}”只能为手机号码</div>' +\n      '<div ng-if=\"error.money\" class=\"assertive fss\">“{{ title }}”只能为金额</div>' +\n      '<div ng-if=\"error.tel\" class=\"assertive fss\">“{{ title }}”只能为电话号码</div>' +\n      '<div ng-if=\"error.zipcode\" class=\"assertive fss\">“{{ title }}”只能为邮政编码</div>' +\n      '<div ng-if=\"error.email\" class=\"assertive fss\">“{{ title }}”只能为Email</div>',\n    scope: {\n      error: '=',\n      title: '='\n    }\n  }\n})\n\n.controller('icCtrl', function($scope, icPatternByTypeFilter) {\n\n  $scope.addPattern = function($ngModelCtrl, patternType) {\n    function icPatternValidator(value) {\n      var reg;\n      var validaty = true;\n\n      // 如果设置了验证规则\n      if (patternType) {\n        if (!value) {\n          validaty = false;\n        } else {\n          reg = new RegExp(icPatternByTypeFilter(patternType));\n          validaty = reg.test(value);\n        }\n      }\n\n      $ngModelCtrl.$setValidity(patternType, validaty);\n      return validaty ? value : undefined;\n    }\n\n    if($ngModelCtrl) {\n      //For DOM -> model validation\n      $ngModelCtrl.$parsers.unshift(icPatternValidator);\n      //For model -> DOM validation\n      $ngModelCtrl.$formatters.unshift(icPatternValidator);\n\n      $scope.$error = $ngModelCtrl.$error;\n    }\n  }\n\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:ic\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单控件指令\n *  目前 OA 支持工作流控件有以下类型：（目前移动端不支持列表控件、签章控件、进度条控件、图片上传控件、二维码控件）\n *  - 标签文本     label  \n *  - 单行输入框   text   \n *  - 多行输入框   textarea   \n *  - 下拉菜单     select   \n *  - 单选框       radio \n *  - 复选框       checkbox \n *  - 部门人员控件 user \n *  - 日历控件     data \n *  - 宏控件       auto \n *  - 计算控件     calc \n *  - 列表控件     listview\n *  - 签章控件     sign\n *  - 进度条控件   progressbar\n *  - 图片上传控件 imgupload\n *  - 二维码控件   qrcode\n *\n *  控件通用字段说明：\n *  data-id:      控件 ID\n *  data-type:    控件类型\n *  data-title:   控件名（除标签外）\n *  data-value:   控件默认值\n *  origin-value: 控件保存的值\n *  各控件字段会有差别，具体看控件相关说明\n */\n.directive('ic', function($parse, $compile, icPatternByTypeFilter, icFactory) {\n  var icModelCtrls = {};\n\n  return {\n    restrict: 'E',\n\n    require: '?ngModel',\n\n    controller: 'icCtrl',\n\n    template: '<ic-error-tip error=\"$error\" title=\"ic[\\'data-title\\']\"></ic-error-tip>',\n\n    compile: function(element, attr) {\n\n      return function($scope, $element, $attrs, $ngModelCtrl) {\n        var ic = $scope.ic = $parse(attr.data)($scope) || {};\n        var ics = $parse(attr.ics)($scope) || [];\n\n        $scope.getIc = function(icId) {\n          return ics.filter(function(_ic) {\n            return _ic['data-id'] == icId;\n          })[0];\n        };\n\n        $scope.setValue = function(icId, value) {\n          if (icModelCtrls[icId]) {\n            icModelCtrls[icId].$setViewValue(value);\n          }\n        }\n\n        $scope.getValue = function(icId) {\n          // 如果是可写字段，则直接返回 model 的值\n          if (icModelCtrls[icId]) {\n            return icModelCtrls[icId].$viewValue;\n          } else {\n            var _ic = $scope.getIc(icId);\n            return _ic ? _ic['origin-value'] : '';\n          }\n          return '';\n        };\n\n        if($ngModelCtrl) {\n          icModelCtrls[ic['data-id']] = $ngModelCtrl;\n          if (ic['data-type'] !== 'date') {\n            $ngModelCtrl.$setViewValue(ic['origin-value'] || ic['data-value']);\n          }            \n\n          $scope.addPattern($ngModelCtrl, $attrs.patternType)\n        }\n\n        var template = icFactory.parse(ic, $attrs.ngModel, $scope);\n        var $content = $compile(template)($scope);\n\n        $element.addClass('wfic wfic-' + ic['data-type']);\n        $element.prepend($content);\n      };\n    }\n  };\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icLabel\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单标签控件\n * \n * @param  {expression}  data  控件数据\n */\n.directive('icLabel', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      data: '='\n    },\n    template: '<span ng-style=\"getStyle()\">{{ data[\"data-text\"]  }}</span>',\n    link: function($scope) {\n      $scope.getStyle = function() {\n        var ic = $scope.data\n        return {\n          'text-align': ic['data-align'],\n          'font-weight': ic['data-bold'] == 1 ? '700' : '400',\n          'font-size': ic['data-font-size'],\n          'font-style': ic['data-italic'] == 1 ? 'italic' : 'normal',\n          'text-decoration': ic['data-underline'] == 1 ? 'underline' : 'normal',\n          'color': ic['data-color']\n        }\n      }\n    }\n  }\n})\n\n.controller('icListViewCtrl', function($scope, $timeout, $ionicScrollDelegate) {\n  var ROW_SPLITTER = /\\n/g\n  var COL_SPLITTER = '`'\n  var VAL_SPLITTER = ','\n\n  var split = $scope.split = function(raw, splitter) {\n    if(angular.isString(raw)) {\n      return raw.split(splitter)\n    }\n    return []\n  }\n\n  // 以换行符分隔行，以`分隔列\n  var splitRaws = $scope.splitRaws = function(raw) {\n    var ret = []\n\n    if(angular.isString(raw)) {\n      var rawRows = $scope.split(raw, ROW_SPLITTER)\n      angular.forEach(rawRows, function(rawRow) {\n        if(rawRow) {\n          ret.push($scope.split(rawRow, COL_SPLITTER))\n        }\n      })\n    }\n\n    return ret\n  }\n\n  $scope.rows = []\n\n  // 拆分列配置\n  $scope.lvTitles = split($scope.data['data-lv-title'], COL_SPLITTER)\n  $scope.lvColtypes = split($scope.data['data-lv-coltype'], COL_SPLITTER)\n  $scope.lvColvalues = split($scope.data['data-lv-colvalue'], COL_SPLITTER)\n  $scope.lvSums = split($scope.data['data-lv-sum'], COL_SPLITTER)\n\n  Array.prototype.push.apply($scope.rows, splitRaws($scope.data['origin-value']))\n\n  // 将多行的数据组合为字符串返回\n  $scope.joinRows = function(rows) {\n    return rows.map(function(row) {\n      return row.join(COL_SPLITTER)\n    }).join('\\n')\n  }\n\n  // 获取下拉选框类型的选项\n  $scope.getOptions = function(colIndex) {\n    var optionsRaw = $scope.lvColvalues[colIndex]\n    return split(optionsRaw, VAL_SPLITTER)\n  }\n\n  // 获取单选框选项\n  $scope.getRadios = function(colIndex) {\n    var radioColValue = $scope.lvColvalues[colIndex]\n    return split(radioColValue, VAL_SPLITTER)\n  }\n\n  // 获取复选框选项\n  $scope.getCheckbox = function(colIndex) {\n    var ckbColValue = $scope.lvColvalues[colIndex]\n    return split(ckbColValue, VAL_SPLITTER) \n  }\n\n  $scope.scrollDeletage = $ionicScrollDelegate.$getByHandle('ic-listview-' + $scope.data['data-title'])\n\n\n  $timeout(function() {\n    var sv = $scope.scrollDeletage.getScrollView();\n    var container = sv.__container;\n\n    container.removeEventListener('touchstart', sv.touchStart);\n    container.removeEventListener('mousedown', sv.mouseDown);\n    document.removeEventListener('touchmove', sv.touchMove);\n    document.removeEventListener('mousemove', sv.mouseMove);\n\n    angular.forEach(\n      [\n        'touchStart',\n        'mouseDown',\n        'touchMove',\n        'mouseMove'\n      ],\n      function(eventName) {\n        var originalHandler = sv[eventName]\n        sv[eventName] = function(e) {\n          e.preventDefault = angular.noop\n          originalHandler && originalHandler.call(sv, e)\n        }\n      }\n    )\n\n    container.addEventListener(\"touchstart\", sv.touchStart, false);\n    container.addEventListener(\"mousedown\", sv.mouseDown, false);\n    document.addEventListener(\"touchmove\", sv.touchMove, false);\n    document.addEventListener(\"mousemove\", sv.mouseMove, false);\n  });\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icListview\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单列表控件\n *  `data-lv-coltype`    列控件类型，多列间以 ` 分隔\n *  `data-lv-colvalue`   列值，多列间以 ` 分隔\n *  `data-lv-sum`        是否合计，1 为是，0为否，多列间以 ` 分隔\n *  `data-lv-title`      列标题，多列间以 ` 分隔\n * @param  {expression}  data  控件数据\n */\n.directive('icListview', function() {\n\n  return {\n    restrict: 'E',\n    replace: true,\n    require: 'ngModel',\n    controller: 'icListViewCtrl',\n    scope: {\n      data: '='\n    },\n    templateUrl: 'templates/workflow/ic-listview.html',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n\n      // 添加一行\n      $scope.addRow = function() {\n        $scope.rows.push(getRowDefalutValue())\n      }\n\n      // 移除一行\n      $scope.removeRow = function(index) {\n        $scope.rows.splice(index, 1)\n        // 没有行时重置回最左边\n        if(!$scope.rows.length) {\n          $scope.scrollDeletage.scrollTop(true)\n        }\n      }\n\n      function getDefaultValue(colIndex) {\n        var colType = $scope.lvColtypes[colIndex]\n        var colValue = $scope.lvColvalues[colIndex]\n\n        // 下拉选框、单选框转默认第一个\n        if(['select', 'radio'].indexOf(colType) !== -1) {\n          return colValue.split(',')[0] || ''\n        } else if(['text', 'textarea', 'date'].indexOf(colType) !== -1) {\n          return colValue\n        } \n        return ''\n      }\n\n      function getRowDefalutValue() {\n        return $scope.lvColvalues.map(function(colValue, colIndex) {\n          return getDefaultValue(colIndex)\n        })\n      }\n\n      function updateViewValue(rows) {\n        var viewValue = ''\n\n        if(angular.isArray(rows) && rows.length) {\n          viewValue = $scope.joinRows(rows)\n        }\n\n        $ngModelCtrl.$setViewValue(viewValue)\n        $ngModelCtrl.$render()\n      }\n\n      $scope.$watch('rows', updateViewValue, true)\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icListviewView\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单列表控件查看\n\n * @param  {expression}  data  控件数据\n */\n.directive('icListviewView', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    controller: 'icListViewCtrl',\n    scope: {\n      data: '='\n    },\n    templateUrl: 'templates/workflow/ic-listview-view.html',\n    link: angular.noop\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icListviewCalc\n * @element  ANY\n * @restrict A\n * @description\n *  工作流表单列表控件 - 计算类型\n *  \n * @param  {expression}  exp             计算公式\n * @param  {expression}  rowData         行数据\n */\n.directive('icListviewCalc', function() {\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    replace: true,\n    template: '<input type=\"hidden\" />',\n    scope: {\n      exp: '=',\n      rowData: '='\n    },\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      var reg = /[\\d+]/g\n\n      $scope.__parseInt = function(str) {\n        return parseInt(str, 10)\n      }\n\n      if(angular.isString($scope.exp)) {\n        var watchExp = $scope.exp.replace(/\\[(\\d+)\\]/g, function(match, num) {\n          // 下标=序号-1\n          return '__parseInt(rowData[' + (num - 1) + '])'\n        })\n\n        $scope.$watch(watchExp, function(val) {\n          if(angular.isUndefined(val)) {\n            val = watchExp\n          } else if(isNaN(val)) {\n            val = 0\n          }\n\n          $ngModelCtrl.$setViewValue(val)\n          $ngModelCtrl.$render()\n        })\n      } else {\n        throw new Error('列表控件计算公式出错')\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icListviewCalc\n * @element  ANY\n * @restrict A\n * @description\n *  工作流表单列表控件 - 复选框组\n *  \n * @param  {expression}  list            可选值列表  \n */\n.directive('icListviewCheckbox', function() {\n  var SPLITTER = ','\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    template: \n      '<label ng-repeat=\"ckb in list\"> ' +\n        '<input type=\"checkbox\" ng-model=\"checkboxs[ckb]\"> ' +\n        '<span>{{ ckb }}</span>' +\n      '</label>',\n    scope: {\n      list: '='\n    },\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      $scope.checkboxs = {}\n      $scope.$watchCollection('list', function(list) {\n        if(angular.isArray(list)) {\n          var viewValue = $ngModelCtrl.$viewValue\n          var checkedArr = angular.isString(viewValue) ? viewValue.split(SPLITTER) : []\n\n          angular.forEach(list, function(item) {\n            var isChecked = checkedArr.indexOf(item) !== -1\n            $scope.checkboxs[item] = isChecked\n          })\n        }\n      })\n\n      function updateViewValue(checkboxs) {\n        var newValue = $scope.list.filter(function(item) {\n          return $scope.checkboxs[item]\n        }).join(SPLITTER)\n        $ngModelCtrl.$setViewValue(newValue)\n      }\n\n      $scope.$watch('checkboxs', updateViewValue, true)\n    }\n  }\n})\n\n\n/**\n * @ngdoc controller\n * @name  workflow.directives.controller:IcImguploadCtrl\n * @description\n *   图片上传控件相关控制器\n */\n.controller('IcImguploadCtrl', function($scope, $window, attrFromTemplateFilter) {\n  // 图片最大宽适配节点宽度\n  $scope.setSizeAdjustWidth = function(parentElem) {\n    var dataWidth = $scope.data['data-width']\n    var dataHeight = $scope.data['data-height']\n    var clientWidth = parentElem.clientWidth\n\n    if(dataWidth && dataHeight) {\n      if(dataWidth > clientWidth) {\n        $scope.width = clientWidth\n        $scope.height = dataHeight / dataWidth * clientWidth\n      } else {\n        $scope.width = dataWidth\n        $scope.height = dataHeight\n      }\n    }\n  }\n\n  $scope.initAutoSizeAdjust = function(parentElem) {\n    $scope.setSizeAdjustWidth(parentElem)\n    $window.addEventListener('resize', function() {\n      $scope.setSizeAdjustWidth(parentElem)\n      $scope.$applyAsync()\n    }, false)\n  }\n\n  $scope.hasSrc = function() {\n    return $scope.localSrc || $scope.originSrc\n  }\n\n  try {\n    $scope.originSrc = attrFromTemplateFilter($scope.data.value, 'data-src')\n  } catch(e) {\n    $scope.originSrc = ''\n    console.error('ic-imgupload: 获取原始图片地址失败')\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icImgupload\n * @element  ANY\n * @restrict E\n * @todo 验证规则未实现\n * @description\n *  工作流表单图片上传控件\n *  \n * @param  {expression}  data            控件数据\n */\n.directive('icImgupload', function(Utils) {\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    scope: {\n      data: '='\n    },\n    controller: 'IcImguploadCtrl',\n    replace: true,\n    templateUrl: 'templates/workflow/ic-imgupload.html',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      // 初始值设置为空文件对象\n      // 此处由于后端在做判断时，如果没有拿到文件对象会将字段清空，而导致没有编辑图片直接保存时\n      // 图片会被删除\n      // @Todo: 讨论现在这种处理方式是否不妥\n      $ngModelCtrl.$setViewValue(new File([], ''))\n\n      $scope.updateFile = function(e) {\n        var file = e.target.files[0]\n        if(file) {\n          $ngModelCtrl.$setViewValue(file)\n          Utils.getImagePreviewUrl(file, function(src) {\n            $scope.localSrc = src\n            $scope.$applyAsync()\n          })\n        }\n      }\n\n      $scope.initAutoSizeAdjust($element[0])\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icImguploadView\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单图片上传控件预览\n *  \n * @param  {expression}  data            控件数据\n */\n.directive('icImguploadView', function() {\n  return {\n    restrict: 'E',\n    scope: {\n      data: '='\n    },\n    controller: 'IcImguploadCtrl',\n    replace: true,\n    templateUrl: 'templates/workflow/ic-imgupload-view.html',\n    link: function($scope, $element, $attr) {\n      $scope.initAutoSizeAdjust($element[0])\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icFileupload\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单图片上传控件\n *  \n * @param  {expression}  data            控件数据\n */\n.directive('icFileupload', function($window, FileUtils, fullUrlFilter) {\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    scope: {\n      data: '='\n    },\n    replace: true,\n    templateUrl: 'templates/workflow/ic-fileupload.html',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      \n      if($scope.data['origin-value'] && $scope.data.value) {\n        var dataset = angular.element($scope.data.value)[0].dataset\n        $scope.file = angular.extend({}, dataset)\n      }\n\n      $scope.selectFile = function(e) {\n        var file = e.target.files[0]\n        if(file) {\n          $ngModelCtrl.$setViewValue(file)\n          $scope.file = {\n            iseditable: '1',\n            read: '1',\n            name: file.name,\n            type: FileUtils.getExtname(file.name),\n            src: '',\n            value: ''\n          }\n          $scope.$applyAsync()\n        }\n      }\n\n      $scope.removeFile = function() {\n        delete $scope.file\n        $ngModelCtrl.$setViewValue(null)\n      }\n\n      $scope.download = function() {\n        $window.location.href = fullUrlFilter($scope.file.src)\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icFileuploadView\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单图片上传控件\n *  \n * @param  {expression}  data            控件数据\n */\n.directive('icFileuploadView', function($window, FileUtils, fullUrlFilter) {\n  return {\n    restrict: 'E',\n    scope: {\n      data: '='\n    },\n    replace: true,\n    templateUrl: 'templates/workflow/ic-fileupload-view.html',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      \n      if($scope.data['origin-value'] && $scope.data.value) {\n        var dataset = angular.element($scope.data.value)[0].dataset\n        $scope.file = angular.extend({}, dataset)\n      }\n\n      $scope.download = function() {\n        $window.location.href = fullUrlFilter($scope.file.src)\n      }\n    }\n  }\n})\n\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icSign\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单签章手写控件\n *  \n * @param  {expression}  data            控件数据\n */\n.directive('icSign', function($q, $window, $ionicModal, $ionicLoading, IbPopup, CommonApi) {\n  var cid = 0\n\n  // 获取图片有效区域\n  function getDrawImageRect(cvs, rgba/* rgba a=a*255 */) { \n    var rgba = rgba || [0, 0, 0, 0]\n    var data = cvs.getContext('2d').getImageData(0, 0, cvs.width, cvs.height).data\n\n    var offsetLeft\n    var offsetRight\n    var offsetTop\n    var offsetBottom\n\n    for(var x = 0; x < cvs.width; x++) {\n      for(var y = 0; y < cvs.height; y++) {\n        var index = (cvs.width * y + x) * 4,\n            cr = data[index],\n            cg = data[index + 1]\n            cb = data[index + 2]\n            ca = data[index + 3]\n\n        if(rgba[0] !== cr || rgba[1] !== cg || rgba[2] !== cb || rgba[3] !== ca) {\n          if(typeof offsetLeft === 'undefined') {\n            offsetLeft = offsetRight = x\n            offsetTop = offsetBottom = y\n          } else {\n            offsetLeft = Math.min(x, offsetLeft)\n            offsetRight = Math.max(x, offsetRight)\n            offsetTop = Math.min(y, offsetTop)\n            offsetBottom = Math.max(y, offsetBottom)\n          }\n        }\n      }\n    }\n\n    return {\n      offsetLeft: offsetLeft,\n      offsetRight: offsetRight,\n      offsetTop: offsetTop,\n      offsetBottom: offsetBottom,\n      // 由于 offset 是下标，实现计算像素数时要 +1\n      width: offsetRight - offsetLeft + 1,\n      height: offsetBottom - offsetTop + 1\n    }\n  }\n\n  function getDataURI(id) {\n    var cvs = document.getElementById(id)\n    var PADDING = 10\n    var dataURL = ''\n\n    if(cvs) {\n      var rect = getDrawImageRect(cvs, [255, 255, 255, 255])\n      var tempCvs = document.createElement('canvas')\n      var tempCtx = tempCvs.getContext('2d')\n\n      tempCvs.width = rect.width + PADDING * 2\n      tempCvs.height = rect.height + PADDING * 2\n      tempCtx.drawImage(cvs, rect.offsetLeft, rect.offsetTop, rect.width, rect.height, PADDING, PADDING, rect.width, rect.height)\n      \n      dataURL = tempCvs.toDataURL()\n      tempCvs = tempCtx = null\n    }\n    return dataURL\n  }\n\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    controller: 'icCtrl',\n    scope: {\n      data: '=',\n      src: '=ngModel',\n      patternType: '@'\n    },\n    replace: true,\n    templateUrl: 'templates/workflow/ic-sign.html',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      var customCanvasId = 'icSignCanvas' + cid++\n\n      // 全屏显示，所以用 window.innerWidth 及 innerHeight\n\n      $scope.pwCanvas = {\n        options: {\n          undo: true,\n          width: $window.innerWidth,\n          height: $window.innerHeight,\n          lineWidth: 5,\n          color: $scope.data['data-sign-color'] || '#000',\n          customCanvasId: customCanvasId\n        },\n        version: 0\n      }\n\n      $ionicModal.fromTemplateUrl('templates/workflow/ic-sign-modal.html', {\n        scope: $scope\n      })\n      .then(function(modal) {\n        $scope.modal = modal\n        $scope.modal.hideDelay = true\n      })\n\n      // 重置\n      $scope.reset = function() {\n        // 当版本为 0 时，此方法相当于取消功能，直接关闭窗口\n        if($scope.pwCanvas.version === 0) {\n          $scope.modal.hide()\n        } else {\n          $scope.pwCanvas.version = 0\n        }\n      }\n\n      // 完成\n      $scope.done = function() {\n        if($scope.pwCanvas.version !== 0) {\n          var dataURI = getDataURI(customCanvasId)\n          $ionicLoading.show()\n          CommonApi.uploadBase64Img(dataURI)\n          .success(function(res) {\n            if(res.isSuccess) {\n              $ngModelCtrl.$setViewValue(res.data)\n              $ngModelCtrl.$render()\n              $scope.modal.hide()\n            } else {\n              IbPopup.tip('手写签名保存失败，请重试')\n            }\n          })\n          .error(function() {\n            IbPopup.tip('手写签名保存失败，请重试')\n          })\n          .finally(function() {\n            $ionicLoading.hide()\n            $scope.reset()\n          })\n        } else {\n          $scope.modal.hide()\n        }\n      }\n\n      $scope.remove = function() {\n        $ngModelCtrl.$setViewValue('')\n        $ngModelCtrl.$render()\n      }\n\n      $scope.addPattern($ngModelCtrl, $attr.patternType)\n\n      if($scope.data['origin-value']) {\n        $ngModelCtrl.$setViewValue($scope.data['origin-value'])\n      }\n\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icScript\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单自定义脚本执行\n *  \n * @param  {expression}  data            自定义脚本\n */\n.directive('icScript', function($document, IbPopup) {\n  return {\n    restrict: 'E',\n    scope: {\n      data: '='\n    },\n    link: function($scope) {\n      var document = $document[0]\n      var hasExec = false\n\n      $scope.$watch('data', function(data) {\n        if(data && !hasExec) {\n          try {\n            var script = document.createElement('script')\n            script.innerHTML = $scope.data\n            document.body.appendChild(script)\n          } catch(e) {\n            IbPopup.tip('自定义脚本执行出错')\n          }\n          hasExec = true\n        }\n      })\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:wfProcess\n * @element  ANY\n * @restrict E\n * @description\n *  工作流步骤列表\n *  \n * @param  {expression}  process         步骤数据\n */\n.directive('wfProcess', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      process: '='\n    },\n    templateUrl: 'templates/workflow/wf-process.html'\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:wfIcValueFields\n * @element  ANY\n * @restrict E\n * @description\n *  工作流有值字段显示\n *  \n * @param  {expression}  fields         工作流表单控件组\n * @param  {expression}  hidden         保密字段\n */\n.directive('wfIcValueFields', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      fields: '=',\n      hiddenField: '='\n    },\n    templateUrl: 'templates/workflow/wf-ic-value-fields.html',\n    link: function($scope) {\n      // 判断是否保密字段\n      $scope.isHidden = function(item) {\n        if(angular.isString($scope.hiddenField) && $scope.hiddenField) {\n          return $scope.hiddenField.split(',').indexOf(item['data-id']) !== -1;\n        }\n        return false;\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:wfIcEmptyFields\n * @element  ANY\n * @restrict E\n * @description\n *  工作流空值字段显示\n *  \n * @param  {expression}  fields         工作流表单控件组\n * @param  {expression}  hidden         保密字段\n */\n.directive('wfIcEmptyFields', function($ionicScrollDelegate) {\n  return {\n    restrict: 'E',\n    // replace: true,\n    scope: {\n      fields: '='\n    },\n    templateUrl: 'templates/workflow/wf-ic-empty-fields.html',\n    link: function($scope) {\n      $scope.emptyFieldShown = false\n      $scope.toggleFieldShown = function() {\n        $scope.emptyFieldShown = !$scope.emptyFieldShown\n        $ionicScrollDelegate.resize()\n      }\n    }\n  }\n});\n\n//@Note:\n// issue: https://forum.ionicframework.com/t/when-using-horizontal-scroll-ion-scroll-page-cant-be-scrolled-down-in-y-direction/3833/22?u=andmar8\n// from: https://codepen.io/rajeshwarpatlolla/pen/xGWBja\n// -> https://github.com/ionic-team/ionic/pull/2606\n(function() {\n  var HorizontalScrollFix = (function() {\n    function HorizontalScrollFix($timeout, $ionicScrollDelegate) {\n      return {\n        restrict: 'A',\n        link: function(scope, element, attrs) {\n          var mainScrollID = attrs.horizontalScrollFix,\n              scrollID = attrs.delegateHandle;\n          \n          var getEventTouches = function(e) {\n            return e.touches && (e.touches.length ? e.touches : [\n              {\n                pageX: e.pageX,\n                pageY: e.pageY\n              }\n            ]);\n          };\n          \n          var fixHorizontalAndVerticalScroll = function() {\n            var mainScroll, scroll;\n            mainScroll = $ionicScrollDelegate.$getByHandle(mainScrollID).getScrollView();\n            scroll = $ionicScrollDelegate.$getByHandle(scrollID).getScrollView();\n            \n            // patch touchstart\n            scroll.__container.removeEventListener('touchstart', scroll.touchStart);\n            scroll.touchStart = function(e) {\n              var startY;\n              scroll.startCoordinates = ionic.tap.pointerCoord(e);\n              if (ionic.tap.ignoreScrollStart(e)) {\n                return;\n              }\n              scroll.__isDown = true;\n              if (ionic.tap.containsOrIsTextInput(e.target) || e.target.tagName === 'SELECT') {\n                scroll.__hasStarted = false;\n                return;\n              }\n              scroll.__isSelectable = true;\n              scroll.__enableScrollY = true;\n              scroll.__hasStarted = true;\n              scroll.doTouchStart(getEventTouches(e), e.timeStamp);\n              startY = mainScroll.__scrollTop;\n              \n              // below is our changes to this method\n              // e.preventDefault();\n             \n              // lock main scroll if scrolling horizontal\n              $timeout((function() {\n                var animate, yMovement;\n                yMovement = startY - mainScroll.__scrollTop;\n                if (scroll.__isDragging && yMovement < 2.0 && yMovement > -2.0) {\n                  mainScroll.__isTracking = false;\n                  mainScroll.doTouchEnd();\n                  animate = false;\n                  return mainScroll.scrollTo(0, startY, animate);\n                } else {\n                  return scroll.doTouchEnd();\n                }\n              }), 100);\n            };\n            scroll.__container.addEventListener('touchstart', scroll.touchStart);\n          };\n          $timeout(function() { fixHorizontalAndVerticalScroll(); });          \n        }\n      };\n    }\n\n    return HorizontalScrollFix;\n\n  })();\n\n  angular.module('workflow.directives')\n  .directive('horizontalScrollFix', ['$timeout', '$ionicScrollDelegate', HorizontalScrollFix]);\n\n}).call(this);\n","/**\n * @ngdoc overview\n * @name  workflow.filters\n * @description\n *   工作流模块过滤器\n */\n\nangular.module('workflow.filters', [])\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:wfStatus\n * @function\n * @description\n *  将工作流进行状态标识转化为对应中文\n *\n * @param   {string}  val   控件原始值\n * @param   {object}  item  控件源数据\n * @returns {string}  修正后的控件值\n */\n\n.filter('wfStatus', function() {\n  var flagMap = {\n    1: '未接收',\n    2: '办理中',\n    3: '转交下一步，下一步经办人无人接收',\n    5: '自由流程预设步骤',\n    4: '已办结',\n    6: '已挂起'\n  };\n\n  return function(flag) {\n    return flagMap[+flag] || '';\n  };\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:wfic\n * @function\n * @description\n *  修正表单控件的显示值\n *\n * @param   {string}  val   控件原始值\n * @param   {object}  item  控件源数据\n * @returns {string}  修正后的控件值\n */\n.filter('wfic', function(userInfoFilter, departmentInfoFilter, positionInfoFilter, User) {\n\n  var filters = {\n    'user': function(item) {\n      var val = item['origin-value']\n      switch(item['data-select-type']) {\n        case 'department':\n          return departmentInfoFilter(User.removeDepartmentPrefix(val), 'deptname');\n\n        case 'position':\n          return positionInfoFilter(User.removePositionPrefix(val), 'posname');\n\n        default:\n          return userInfoFilter(User.removePrefix(val), 'realname');\n      }\n    }\n  };\n\n  return function(item) {\n    var dataType = item['data-type']\n    return filters[dataType] ? \n      filters[dataType].call(null, item) :\n      item['origin-value'];\n  }\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:attrFromTemplate\n * @function\n * @description\n *  从 html 元素模板中获取属性值\n *\n * @param   {object}  flowItem     控件源数据\n * @param   {string}  checkItem   原始验证规则\n * @returns {string}  转换后的验证规则\n */\n.filter('attrFromTemplate', function() {\n\n  return function(template, attr) {\n    var $elem;\n    if(template) {\n      $elem = angular.element(template);\n      if($elem.length && attr) {\n        return $elem.attr(attr) || '';\n      }\n    }\n    return '';\n  }\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:icPattern\n * @function\n * @description\n *  返回表单控件的规则类型\n *\n * @param   {string}  icTitle     控件名称\n * @param   {string}  checkItem   原始验证规则\n * @returns {string}  规则类型\n */\n.filter('icPatternType', function() {\n  // 验证字段为如“字段1=type1,字段2=type2”这种格式的字符串\n  // 此方法用于将字符串解析成 key-value 的结构\n  function getCheckItemMap(str) {\n    var ret = {};\n\n    str.split(',').forEach(function(exp) {\n      var parts = exp.split('=');\n      ret[parts[0]] = parts[1];\n    });\n\n    return ret;\n  }\n\n  return function(icTitle, checkItem) {\n    var type = '';\n    var checkItemMap;\n\n    if(icTitle && checkItem) {\n      checkItemMap = getCheckItemMap(checkItem);\n      type = checkItemMap[icTitle] || ''\n    }\n\n    return type;\n  }\n})\n\n.filter('icPatternByType', function(icPatternTypeFilter, REGEXP_ENUM) {\n\n  return function(type) {\n    return REGEXP_ENUM[type] || '';\n  };\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:icPattern\n * @function\n * @description\n *  返回表单控件的具体验证规则\n *\n * @param   {object}  icTitle     控件名称\n * @param   {string}  checkItem   原始验证规则\n * @returns {string}  验证规则，Regex 字符串\n */\n.filter('icPattern', function(icPatternTypeFilter, REGEXP_ENUM) {\n\n  return function(icTitle, checkItem) {\n    return REGEXP_ENUM[icPatternTypeFilter(icTitle, checkItem)] || '';\n  };\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:wfFilenameFormat\n * @function\n * @description\n *  上传文件文件名显示格式为 【前14个字】...【后4个字】.【后缀名】\n * @param  {string}  str  文件名\n * @return {string}  处理后的文件名\n */\n.filter('wfFilenameFormat', function() {\n  // 解析html实体编号\n  var htmlDecode = function(str) {\n    return str.replace(/&#(x)?([^&]{1,5});?/g,function($,$1,$2) {\n      return String.fromCharCode(parseInt($2 , $1 ? 16:10));\n    });\n  }\n  return function(str) {\n    // 文件名后缀\n    var strArr = htmlDecode(str).split('.');\n    var ext = '.' + strArr.pop();\n    var filenameWithoutExt = strArr.join('.');\n    if (filenameWithoutExt.length > 18) {\n      return filenameWithoutExt.slice(0, 14) + '...' + filenameWithoutExt.slice(-4) + ext;\n    }\n    return str;\n  }\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:wfIsSponsor\n * @function\n * @description\n *  当前用户是否为流程主办人\n * @param  {object}  flow  流程数据\n * @return {boolean} 是否\n */\n.filter('wfIsSponsor', function() {\n  return function(flow) {\n    return flow && flow.rp && flow.rp.opflag == '1'\n  }\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:sumArrayBy\n * @function\n * @description\n *   合计多个数组里指定 index 的值\n *\n * @example\n *   {{ [[1, 2], [2, 3]] | sumArrayBy }} => 3\n *   {{ [[1, 2], [2, 3]] | sumArrayBy:1 }} => 5\n * @param  {array}   arrs       数组\n * @param  {number}  [index=0]  下标\n */\n.filter('sumArrayBy', function() {\n  return function(arrs, index) {\n    index = angular.isDefined(index) ? index : 0\n\n    var indexArr = arrs.map(function(arr) {\n      if(angular.isArray(arr) && angular.isDefined(arr)) {\n        return arr[index]\n      } else {\n        return 0\n      }\n    })\n\n    return indexArr.reduce(function(a, b) {\n      a = isNaN(+a) ? 0 : +a\n      b = isNaN(+b) ? 0 : +b\n      return a + b\n    }, 0)\n  }\n})","/**\n * @ngdoc overview\n * @name workflow.services\n * @description\n *   工作流模块服务\n */\nangular.module('workflow.services', [])\n\n/**\n * @ngdoc service\n * @name workflow.services.Flow\n * @description\n *   工作流通用服务\n */\n.factory('Flow', function($rootScope, $http, $ionicLoading, Utils, Settings, User, IbPopup) {\n  var moduleUrl = Settings.rootUrl + '/work';\n\n  var ret = {\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#create\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   新建工作流\n     *   res.isSuccess  {Boolean}\n     *   res.key        {String}\n     *\n     * @param       {String}   flowid    工作流程类型 id\n     * @returns     {Promise}\n     */\n    create: function(flowid) {\n      return $http.get(moduleUrl + '/add', {\n          params: {\n            flowid: flowid\n          }\n        })\n        .success(function(res) {\n          $rootScope.$broadcast('workflow.create', flowid, res);\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#getFlow\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   获取工作流数据，包括表单数据、附件、会签、进度等信息\n     *\n     * @param       {String}   key     工作流 key\n     * @param       {Object}   param   额外参数\n     * @returns     {Promise}\n     */\n    getFlow: function(key, params) {\n      params = params || {};\n      params.key = key;\n      return $http.get(moduleUrl + '/form', {\n          params: params\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#getProcess\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   获取流程列表及分类数据\n     *\n     * @returns     {Promise}\n     */\n    getProcess: function() {\n      return $http.get(moduleUrl + '/new')\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#saveFlow\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   保存工作流表单数据\n     *\n     * @param       {Object}   data   表单数据\n     * @returns     {Promise}\n     */\n    saveFlow: function(data) {\n      var formData = new FormData()\n      angular.forEach(data, function(value, key) {\n        formData.append(key, value)\n      })\n\n      return Utils.postFormData(moduleUrl + '/form', formData)\n        .success(function(res) {\n          $rootScope.$broadcast('workflow.saveFlow', data, res);\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#getNext\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   获取转交所需的数据\n     *   params.key  {string}  流程 key\n     *   params.topflag  {string}  标识\n     * @param       {object}   params   参数\n     * @returns     {Promise}\n     */\n    getNext: function(params) {\n      return $http.get(moduleUrl + '/shownext', {\n          params: params\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#getFreeNext\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   获取自由流程转交所需的数据\n     *\n     * @param       {String}   key   流程 key\n     * @returns     {Promise}\n     */\n    getFreeNext: function(key) {\n      return $http.get(moduleUrl + '/freenext', {\n          params: {\n            key: key\n          }\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#rollback\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   回退工作流至上一步骤\n     *\n     * @param       {String}   key    流程 key\n     * @param       {Object}   data   参数\n     * @returns     {Promise}\n     */\n    rollback: function(key, data) {\n      return $http.post(moduleUrl + '/fallback&key=' + key, data)\n        .success(function(res) {\n          if (res.isSuccess) {\n            $rootScope.$broadcast('workflow.rollback', key, data, res);\n          }\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#takeback\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   在下一步骤被接收前，收回工作流\n     *\n     * @param       {String}   key    流程 key\n     * @returns     {Promise}\n     */\n    takeback: function(key) {\n      return $http.post(moduleUrl + '/takeback&key=' + key)\n        .success(function(res) {\n          if (res.isSuccess) {\n            $rootScope.$broadcast('workflow.takeback', key, res);\n          }\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#confirmTakeback\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   确认提示后收回工作流\n     *\n     * @param       {Object}   flow    流程数据\n     */\n    confirmTakeback: function(flow) {\n      var _this = this;\n\n      IbPopup.confirm({\n          title: '下一步骤尚未接收时可收回至本步骤重新办理，确认要收回吗？'\n        })\n        .then(function(res) {\n          if (res) {\n            $ionicLoading.show();\n            _this.takeback(flow.key)\n              .finally($ionicLoading.hide);\n          }\n        });\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#handover\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   转交工作流至下一步骤\n     *\n     * @param       {Object}   data    转交参数\n     * @returns     {Promise}\n     */\n    handover: function(data) {\n      return $http.post(moduleUrl + '/turnNextPost', data)\n        .success(function(res) {\n          if (res.isSuccess) {\n            $rootScope.$broadcast('workflow.handover', data, res);\n          }\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#handoverFree\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   转交自由流程至下一步骤\n     *\n     * @param       {Object}   data    转交参数\n     * @returns     {Promise}\n     */\n    handoverFree: function(data) {\n      return $http.post(moduleUrl + '/freenext', data)\n        .success(function(res) {\n          $rootScope.$broadcast('workflow.handoverFree', data, res);\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#signFlow\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   经办人会签（办理完毕）\n     *\n     * @param       {String}   key    流程 key\n     * @param       {Object}   data    会签参数\n     * @returns     {Promise}\n     */\n    signFlow: function(key, params) {\n      params = params || {};\n      params.key = key;\n      return $http.get(moduleUrl + '/complete', {\n          params: params\n        })\n        .success(function(res) {\n          $rootScope.$broadcast('workflow.signFlow', params, res);\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#remove\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   删除流程\n     *\n     * @param       {String}   id      工作流 id\n     * @returns     {Promise}\n     */\n    remove: function(id) {\n      return $http.post(moduleUrl + '/del', {\n          id: id\n        })\n        .success(function(res) {\n          if (res.isSuccess) {\n            $rootScope.$broadcast('workflow.remove', id, res);\n          }\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#confirmRemove\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   确认后删除流程\n     *\n     * @param       {String}   flow      工作流数据\n     * @returns     {Promise}\n     */\n    confirmRemove: function(flow) {\n      var _this = this;\n\n      IbPopup.confirm({\n          title: '确定要删除该工作吗？'\n        })\n        .then(function(res) {\n          if (res) {\n            // $ionicLoading.show();\n            _this.remove(flow.runid);\n            // .finally($ionicLoading.hide);\n          }\n        });\n    },\n\n  };\n\n  return ret;\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.FlowUtils\n * @description\n *   工作流通用工具函数\n */\n.factory('FlowUtils', function($timeout, $state, $ionicHistory, IbPopup) {\n  return {\n    /**\n     * @ngdoc     method\n     * @name      workflow.services.FlowUtils#goBackOrHome\n     * @methodOf  workflow.services.FlowUtils\n     * @description\n     *   如果有后退页，则后退，没有则回工作流首页\n     */\n    goBackOrHome: function() {\n      if ($ionicHistory.backView()) {\n        $ionicHistory.goBack();\n      } else {\n        $ionicHistory.nextViewOptions({\n          disableBack: true\n        });\n        $state.go('workflow.index');\n      }\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#onHandoverSuccess\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   转交成功后的回调\n     *\n     * @param       {Object}   res   转交成功后返回的数据\n     * @returns     {Promise}\n     */\n    onHandoverSuccess: function(res) {\n      if (res.isSuccess) {\n\n        var popup = IbPopup.alert({\n          title: '转交成功'\n        })\n\n        popup.then(function() {\n          $ionicHistory.clearCache(['workflow.todo', 'workflow.trans', 'workflow.done'])\n          $ionicHistory.nextViewOptions({\n            disableBack: true\n          });\n          var backViewStateId = $ionicHistory.backView().stateId\n          var currentViewStateId = $ionicHistory.currentView().stateId\n          $state.go('workflow.index').then(function() {\n            $ionicHistory.clearCache([backViewStateId, currentViewStateId])\n          })\n\n          // 成功后清缓存\n\n        });\n\n        $timeout(popup.close.bind(popup), 2000);\n\n      } else {\n        IbPopup.alert({\n          title: res.msg\n        });\n      }\n    }\n  }\n})\n\n.factory('FlowListUtil', function() {\n  return {\n\n    // 根据工作流 key 删除列表中对应的项\n    removeByKey: function(key) {\n      var _this = this;\n\n      if (!this.items.length) {\n        return;\n      }\n\n      angular.forEach(this.items, function(item, i) {\n        if (item.key == key) {\n          _this.items.splice(i, 1);\n          return false;\n        }\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.FlowTodo\n * @description\n *   待办工作列表数据\n */\n.factory('FlowTodo', function($rootScope, Settings, IbList) {\n  var flowTodo = new IbList(Settings.rootUrl + '/work&type=todo', {\n    idAttr: 'runid'\n  });\n\n  var reset = angular.bind(flowTodo, flowTodo.reset);\n\n  $rootScope.$on('workflow.handover', reset);\n  $rootScope.$on('workflow.handoverFree', reset);\n  $rootScope.$on('workflow.signFlow', reset);\n  $rootScope.$on('workflow.create', reset);\n  $rootScope.$on('workflow.rollback', reset);\n  $rootScope.$on('workflow.takeback', reset);\n  $rootScope.$on('workflow.remove', function(evt, runid) {\n    flowTodo.remove(runid);\n  });\n\n  return flowTodo;\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.FlowTrans\n * @description\n *   已办结列表数据\n */\n.factory('FlowTrans', function($rootScope, Settings, IbList, FlowListUtil) {\n  var flowTrans = new IbList(Settings.rootUrl + '/work&type=trans', {\n    idAttr: 'runid'\n  });\n\n  angular.extend(flowTrans, FlowListUtil);\n\n  var reset = angular.bind(flowTrans, flowTrans.reset);\n\n  $rootScope.$on('workflow.handover', reset);\n  $rootScope.$on('workflow.handoverFree', reset);\n  $rootScope.$on('workflow.signFlow', reset);\n  $rootScope.$on('workflow.rollback', reset);\n\n  $rootScope.$on('workflow.remove', function(evt, runid) {\n    flowTrans.remove(runid);\n  });\n\n  $rootScope.$on('workflow.takeback', function(evt, key, res) {\n    flowTrans.removeByKey(key);\n  });\n\n  return flowTrans;\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.FlowDone\n * @description\n *   已完成列表数据\n */\n.factory('FlowDone', function($rootScope, Settings, IbList) {\n  var flowDone = new IbList(Settings.rootUrl + '/work&type=done', {\n    idAttr: 'runid'\n  });\n\n  var reset = angular.bind(flowDone, flowDone.reset);\n\n  $rootScope.$on('workflow.handover', reset);\n  $rootScope.$on('workflow.handoverFree', reset);\n  $rootScope.$on('workflow.signFlow', reset);\n  $rootScope.$on('workflow.rollback', reset);\n\n  $rootScope.$on('workflow.remove', function(evt, runid) {\n    flowDone.remove(runid);\n  });\n\n  return flowDone;\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.FlowFollow\n * @description\n *   我的关注列表数据\n */\n.factory('FlowFollow', function($rootScope, Settings, IbList) {\n  var flowFollow = new IbList(Settings.rootUrl + '/work/follow', {\n    idAttr: 'runid'\n  });\n\n  $rootScope.$on('workflow.remove', function(evt, runid) {\n    flowFollow.remove(runid);\n  });\n\n  return flowFollow;\n})\n\n/**\n * @ngdoc service\n * @name workflow.service.FlowUpload\n * @description\n *  工作流上传处理\n */\n.service('FlowUpload', function(Settings, FileUtils, IbPopup, UploadFile, fileSizeFilter, Utils) {\n  var This = this;\n  this.safeImgTypes = ['gif', 'jpg', 'jpeg', 'png'];\n  this.safeFileTypes = ['chm', 'pdf', 'zip', 'rar', 'tar', 'gz', 'bzip2', 'txt', 'doc', 'xls', 'ppt', 'docx', 'xlsx', 'pptx'];\n\n  // 检查是否是支持的文件类型\n  this.isSafeFile = function(types, files) {\n    for (var i = 0; i < files.length; i++) {\n      var file = files[i];\n      var type = FileUtils.getExtname(file.name).toLowerCase();\n      if (types.indexOf(type) === -1) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  // 检查空文件\n  this.hasEmptyFile = function(files) {\n    for (var i = 0; i < files.length; i++) {\n      var file = files[i];\n      if (file.size === 0) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  // 检查文件大小\n  this.isSafeSize = function(maxSize, files) {\n    for (var i = 0; i < files.length; i++) {\n      var file = files[i];\n      if (file.size > maxSize * 1024 * 1024) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  this.closeLoading = function($scope, tmp) {\n    $scope.$apply(function() {\n      tmp.uploading = false;\n      tmp.uploaded = true;\n    });\n  }\n\n  this.upload = function($scope, files, container, processid) {\n    angular.forEach(files, function(file) {\n      var tmp = {\n        filename: file.name,\n        filesize: fileSizeFilter(file.size),\n        filetype: file.type.split('/')[1],\n        delete: true,\n        xhr: null,\n        uploading: true,\n        uploaded: false\n      }\n      Utils.getImagePreviewUrl(file, function(url) {\n        tmp.url = url;\n      });\n      tmp.index = container.length;\n      $scope.$apply(function() {\n        container.push(tmp);\n      });\n      var formData = new FormData();\n      formData.append('Filedata[]', file);\n      tmp.xhr = UploadFile.upload({\n        data: formData,\n        params: {\n          type: 'workflow',\n          flowprocess: processid\n        },\n        onSuccess: function(res) {\n          This.closeLoading($scope, tmp);\n          if (res.isSuccess) {\n            tmp.aid = res.data[0].aid;\n          } else {\n            // 删除没上传成功的\n            container.splice(tmp.index, 1);\n            IbPopup.alert({\n              title: res.msg\n            });\n          }\n        },\n        onProgress: function(progress) {\n          // 进度\n          // console.log(progress)\n        },\n        onFail: function(err) {\n          // 删除没上传成功的\n          container.splice(tmp.index, 1);\n          if (err) {\n            var errMsg = err.msg || '上传失败';\n            IbPopup.alert({\n              title: errMsg\n            });\n          } else {\n            // 上传被取消\n          }\n        }\n      });\n    });\n  }\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.icFactory\n * @description\n *   工作流表单控件处理\n *\n */\n.factory('icFactory', function($filter, attrFromTemplateFilter, Utils, UserSelector, User) {\n  function removeStyle(str) {\n    return str ? str.replace(/\\s+style=['\"].*?['\"]/g, '') : '';\n  }\n\n  function getIc(id, scope) {\n    for (var i in scope.flow.enableArr) {\n      var ic = scope.flow.enableArr[i];\n      if (ic['data-id'] == id) {\n        return ic;\n      }\n    }\n    return null;\n  }\n\n  var ics = {\n    // 单行文本框\n    'text': function(ic, modelName) {\n      // 设置了隐藏\n      if (ic['data-hide'] == '1') {\n        return '<input type=\"hidden\" ng-model=\"' + modelName + '\" name=\"data_' + ic['data-id'] + '\">隐藏字段';\n      } else {\n        return '<input type=\"text\" ng-model=\"' + modelName + '\" name=\"data_' + ic['data-id'] + '\">';\n      }\n    },\n\n    // 多行文本框\n    'textarea': function(ic, modelName) {\n      // 富文本编辑框在手机端上显示为也普通 textarea\n      return '<textarea ng-model=\"' + modelName + ' \" name=\"data_' + ic['data-id'] + '\" rows=\"' + ic['data-rows'] + '\" style=\"width: 100%;\"></textarea>';\n    },\n\n    // 下拉菜单\n    'select': function(ic, modelName, scope) {\n      scope.options = ic['data-select-field'].split('`');\n\n      // 如果没有保存值，设置默认选中值\n      if (!ic['origin-value']) {\n        scope.setValue(ic['data-id'], ic['data-select-check']);\n      }\n\n      return '<select ng-model=\"' + modelName + '\" ng-init=\"' + modelName + '= options[0]\"  name=\"data_' + ic['data-id'] + '\" size=\"' + ic['data-size'] + '\">' +\n        '<option ng-selected=\"op==' + modelName + '\"  value=\"{{op}}\" ng-repeat=\"op in options\">{{op}}</option>' +\n        '</select>';\n    },\n\n    // 单选\n    'radio': function(ic, modelName, scope) {\n      scope.radios = ic['data-radio-field'].split('`');\n\n      if (!ic['origin-value']) {\n        scope.setValue(ic['data-id'], ic['data-radio-check']);\n      }\n\n      // 添加手机端样式\n      return '<label class=\"checkbox\" ng-repeat=\"r in radios\">' +\n        '<input type=\"radio\" ng-model=\"' + modelName + '\" name=\"data_' + ic['data-id'] + '\" value=\"{{r}}\">' +\n        '{{r}}' +\n        '</label>';\n    },\n\n    // 复选\n    'checkbox': function(ic, modelName) {\n      return '<label class=\"checkbox\">' +\n        '<input type=\"checkbox\" ng-model=\"' + modelName + '\" ng-true-value=\"\\'on\\'\" ng-false-value=\"\" name=\"data_' + ic['data-id'] + '\">' +\n        ic['data-title'] +\n        '</label>';\n    },\n\n    // 日期选择器\n    'date': function(ic, modelName, scope) {\n      var dateFilter = $filter('date');\n      var isFormTypeSupported = Utils.isFormTypeSupported;\n      // 由于 pc 端日期格式为 yyyy-mm-dd hh:ii:ss\n      // 此处需要作格式转换\n      var dateFormat = ic['data-date-format'].replace('mm', 'MM')\n        .replace('hh', 'HH')\n        .replace('ii', 'mm'),\n        value = ic['origin-value'],\n        placeholder = '',\n        date,\n        type;\n\n      if (value) {\n        // 将初始值转换为日期对象\n        var dateArr = value.split(/[\\-\\s\\:]/);\n        date = new Date(\n          dateArr[0],\n          dateArr[1] ? +dateArr[1] - 1 : 0,\n          dateArr[2] ? +dateArr[2] : 1,\n          dateArr[3] ? +dateArr[3] : 0,\n          dateArr[4] ? +dateArr[4] : 0,\n          dateArr[5] ? +dateArr[5] : 0);\n      }\n\n      var isDateType = (dateFormat == 'yyyy-MM-dd' ||\n        dateFormat == 'yyyy-MM' ||\n        dateFormat == 'yyyy');\n\n      var isDatetimeType = (dateFormat == 'yyyy-MM-dd HH:mm:ss' ||\n        dateFormat == 'yyyy-MM-dd HH:mm' ||\n        dateFormat == 'yyyy-MM-dd HH');\n\n      // 如果是分类为日期类型且支持日期控件时\n      // 使用日期控件并将数据格式化为可用数据\n      if (isDateType && isFormTypeSupported('date')) {\n        type = 'date';\n        if (date) {\n          value = date;\n        }\n        // 如果是分类为日期时间类型且支持日期控件时\n      } else if (isDatetimeType && isFormTypeSupported('datetime-local')) {\n        type = 'datetime-local';\n        if (date) {\n          // 时区调整\n          value = date;\n        }\n      } else {\n        type = 'text';\n        placeholder = '格式为 ' + dateFilter(new Date(), dateFormat);\n      }\n\n      // 由于 html5 type 兼容性各种不同，只使用日期和日期时间类型控件来表现各种格式\n      // 其他直接使用 text 加 placeholder 提示\n      // @todo: 是否不使用原生控件考虑自实现\n      var tpl = '<input type=\"' + type + '\" ng-model=\"' + modelName + '\" placeholder=\"' + placeholder + '\" name=\"data_' + ic['data-id'] + '\"/>' +\n        '<span class=\"rp-icon-calendar\"></span>';\n\n      scope.setValue(ic['data-id'], value);\n\n      return tpl;\n    },\n\n    // 部门人员选择控件\n    'user': function(ic, modelName, scope) {\n      var selectType = ic['data-select-type'];\n      var single = ic['data-single'];\n      var userSelector;\n      var defaultValue;\n\n      function setModal(modal) {\n        userSelector = modal;\n      }\n\n      var options = {\n        maxSelection: single == 1 ? 1 : false\n      };\n\n      if (selectType == 'position') {\n        defaultValue = User.removePositionPrefix(scope.ic['origin-value']);\n        UserSelector.createPosition(options).then(setModal);\n\n      } else if (selectType == 'department') {\n        defaultValue = User.removeDepartmentPrefix(scope.ic['origin-value']);\n        UserSelector.createDepartment(options).then(setModal);\n\n      } else {\n        defaultValue = User.removePrefix(scope.ic['origin-value']);\n        UserSelector.create(options).then(setModal);\n      }\n\n      scope.select = function() {\n        defaultValue = scope.getValue(ic['data-id']);\n\n        userSelector.show({\n            values: defaultValue ? defaultValue.split(',') : [],\n          },\n          function(selected) {\n            scope.setValue(ic['data-id'], selected.join(','));\n            userSelector.hide();\n          });\n      };\n\n      scope.$on('$destroy', function() {\n        userSelector.remove();\n      });\n\n      scope.setValue(ic['data-id'], defaultValue);\n\n      return '<user-selector select-type=\"' + ic['data-select-type'] + '\" name=\"data_' + ic['data-id'] + '\" ng-model=\"' + modelName + '\"></user-selector> ' +\n        '<i class=\"icon ion-ios-plus positive\" ng-click=\"select()\"></i>';\n    },\n\n    // 宏控件\n    'auto': function(ic, modelName, scope) {\n      var template;\n\n      if (!ic['origin-value']) {\n        scope.setValue(ic['data-id'], attrFromTemplateFilter(ic.value, 'value'));\n      }\n\n      template = removeStyle(ic.value).replace(/<(input|select|textarea)\\s+/, function(match) {\n        return match + ' ' + 'ng-model=\"' + modelName + '\" ';\n      });\n\n\n      return ic['data-hide'] != 1 ? template : template + '隐藏字段';\n    },\n\n    // 计算控件\n    'calc': function(ic, modelName, scope) {\n      // 设置值精度\n      function setPrec(value) {\n        return (+value).toFixed(ic['data-prec']);\n      }\n\n      var calc = {\n        // 获取表单的值\n        getVal: function(id) {\n          var targetIc = scope.getIc(id);\n          var ret = 0;\n\n          if (targetIc && targetIc['data-type'] === 'date') {\n            ret = new Date(scope.getValue(id));\n          } else {\n            ret = parseFloat(scope.getValue(id));\n            if (isNaN(ret)) ret = 0;\n          }\n\n          return ret;\n        },\n\n        // 计算日期\n        date: function(value) {\n          value = value / 1000;\n          return (value >= 0) ?\n            Math.floor(value / 86400) + '天' +\n            Math.floor((value % 86400) / 3600) + '小时' +\n            Math.floor((value % 3600) / 60) + '分' +\n            Math.floor(value % 60) + '秒' :\n            '时间格式无效';\n        },\n\n        // 天数计算\n        day: function(val) {\n          return setPrec(val <= 0 ? 0 : Math.floor(val / 86400000));\n        },\n\n        // 小时\n        hour: function(val) {\n          return setPrec(val <= 0 ? 0 : Math.floor(val / 3600000));\n        },\n\n        sum: function() {\n          if (arguments.length === 0) {\n            return '';\n          }\n          var argu = arguments;\n          var total = 0;\n          for (var i = 0; i < argu.length; i++) {\n            total += argu[i]\n          }\n          return setPrec(parseFloat(total))\n        },\n\n        // 最大值\n        max: function() {\n          if (arguments.length === 0) {\n            return '';\n          }\n          return setPrec(parseFloat(Math.max.apply(null, arguments)));\n        },\n\n        // 最小值\n        min: function() {\n          if (arguments.length === 0) {\n            return '';\n          }\n          return setPrec(parseFloat(Math.min.apply(null, arguments)));\n        },\n\n        // 取模运算\n        mod: function() {\n          if (arguments.length === 0) {\n            return;\n          }\n          var firstNum = arguments[0];\n          var secondNum = arguments[1];\n          var result = firstNum % secondNum;\n          result = isNaN(result) ? \"\" : parseFloat(result);\n          return setPrec(result);\n        },\n\n        // 绝对值\n        abs: function(val) {\n          return setPrec(Math.abs(parseFloat(val)));\n        },\n\n        // 平均值\n        avg: function() {\n          var value = 0;\n          var len = arguments.length;\n\n          for (var i = 0; i < len; i++) {\n            value += parseFloat(arguments[i] || 0);\n          }\n\n          return setPrec(value / len);\n        },\n\n        // 人民币计算大写\n        rmb: function(currencyDigits) {\n          // Constants:\n          var MAXIMUM_NUMBER = 99999999999.99;\n          // Variables:\n          var integral; // Represent integral part of digit number.\n          var decimal; // Represent decimal part of digit number.\n          var outputCharacters; // The output result.\n          var parts;\n          var digits, radices, bigRadices, decimals;\n          var zeroCount;\n          var i, p, d;\n          var quotient, modulus;\n          // Validate input string:\n          currencyDigits = currencyDigits.toString();\n          if (currencyDigits == \"\") {\n            return \"\";\n          }\n          if (currencyDigits.match(/[^,.\\d]/) != null) {\n            return \"\";\n          }\n          if ((currencyDigits).match(/^((\\d{1,3}(,\\d{3})*(.((\\d{3},)*\\d{1,3}))?)|(\\d+(.\\d+)?))$/) == null) {\n            return \"\";\n          }\n          // Normalize the format of input digits:\n          currencyDigits = currencyDigits.replace(/,/g, \"\"); // Remove comma delimiters.\n          currencyDigits = currencyDigits.replace(/^0+/, \"\"); // Trim zeros at the beginning.\n          // Assert the number is not greater than the maximum number.\n          if (Number(currencyDigits) > MAXIMUM_NUMBER) {\n            return \"\";\n          }\n          // Process the coversion from currency digits to characters:\n          // Separate integral and decimal parts before processing coversion:\n          parts = currencyDigits.split(\".\");\n          if (parts.length > 1) {\n            integral = parts[0];\n            decimal = parts[1];\n            // Cut down redundant decimal digits that are after the second.\n            decimal = decimal.substr(0, 2);\n          } else {\n            integral = parts[0];\n            decimal = \"\";\n          }\n          // Prepare the characters corresponding to the digits:\n          digits = ['零', '壹', '贰', '叁', '肆', '伍', '陆', '柒', '捌', '玖'];\n          radices = ['', '拾', '佰', '仟'];\n          bigRadices = ['', '万', '亿'];\n          decimals = ['角', '分'];\n          // Start processing:\n          outputCharacters = \"\";\n          // Process integral part if it is larger than 0:\n          if (Number(integral) > 0) {\n            zeroCount = 0;\n            for (i = 0; i < integral.length; i++) {\n              p = integral.length - i - 1;\n              d = integral.substr(i, 1);\n              quotient = p / 4;\n              modulus = p % 4;\n              if (d == \"0\") {\n                zeroCount++;\n              } else {\n                if (zeroCount > 0) {\n                  outputCharacters += digits[0];\n                }\n                zeroCount = 0;\n                outputCharacters += digits[Number(d)] + radices[modulus];\n              }\n              if (modulus == 0 && zeroCount < 4) {\n                outputCharacters += bigRadices[quotient];\n              }\n            }\n            outputCharacters += '元';\n          }\n          // Process decimal part if there is:\n          if (decimal != \"\") {\n            for (i = 0; i < decimal.length; i++) {\n              d = decimal.substr(i, 1);\n              if (d != \"0\") {\n                outputCharacters += digits[Number(d)] + decimals[i];\n              }\n            }\n          }\n          // Confirm and return the final output string:\n          if (outputCharacters == \"\") {\n            outputCharacters = '零元';\n          }\n          if (decimal == \"\") {\n            outputCharacters += '整';\n          }\n          //outputCharacters = CN_SYMBOL + outputCharacters;\n          return outputCharacters;\n        },\n\n        // 列表控件计算\n        // @todo: 手机端暂时不支持列表控件\n        list: function(olist, col) {\n          var output = 0;\n          var tableID = olist.getAttribute(\"id\");\n          var table = listView.getTable(tableID);\n          var row_length = table.children[1].rows.length;\n          if (document.getElementById(tableID + '_sum')) {\n            row_length--;\n          }\n          for (var i = 0; i < row_length; i++) {\n            for (var j = 0; j < table.children[1].rows[i].cells.length - 1; j++) {\n              if (j == col) {\n                var child_obj = table.children[1].rows[i].cells[j].firstChild;\n                if (child_obj && child_obj.tagName) {\n                  var olist_val = child_obj.value;\n                  olist_val = (olist_val == \"\" || olist_val.replace(/\\s/g, '') == \"\") ? 0 : olist_val;\n                  olist_val = (isNaN(olist_val)) ? NaN : olist_val;\n                  output += parseFloat(olist_val);\n                } else {\n                  output += parseFloat(child_obj.data);\n                }\n              }\n            }\n          }\n          return parseFloat(output);\n        }\n      };\n\n      // 获取计算表达式\n      var exp = attrFromTemplateFilter(ic.value, 'data-exp');\n      var icIds = exp ? exp.match(/\\d+/g) : null;\n\n      if (icIds) {\n        // 监控计算控件相关的字段的变化情况\n        scope.$watch(function() {\n          return icIds.map(function(icId) {\n            return scope.getValue(icId);\n          }).join();\n        }, function() {\n          try {\n            var evalExp = eval(exp);\n            scope.setValue(ic['data-id'], typeof evalExp == \"number\" ? evalExp.toFixed(ic['data-prec']) : evalExp);\n          } catch (e) {\n\n          }\n        });\n      }\n\n      return '<input type=\"text\" ng-model=\"' + modelName + '\" name=\"data_' + ic['data-id'] + '\" />';\n    },\n\n    // 图片上传控件\n    'imgupload': function(ic, modelName) {\n      var src = attrFromTemplateFilter(ic.value, 'data-src');\n      //return src ? '<img src=\"' + $filter('fullUrl')(src) + '\" width=\"' + ic['data-width'] + '\" height=\"' + ic['data-height'] + '\"/>' : '<span>';\n      return '<span>暂不支持图片上传控件</span>';\n    },\n\n    // 列表控件\n    'listview': function(ic, modelName) {\n      return '<span>暂不支持列表控件</span>';\n    },\n\n    // 签章控件\n    'sign': function(ic, modelName) {\n      return '<span>暂不支持签章控件</span>';\n    },\n\n    // 进度条控件\n    'progressbar': function(ic, modelName) {\n      return '<span>暂不支持进度条控件</span>';\n    },\n\n    'qrcode': function(ic, modelName) {\n      return '<span>暂不支持二维码控件</span>';\n    }\n  };\n\n  var ret = {\n    parse: function(ic, scope, pattern) {\n      var type = ic && ic['data-type'];\n      if (!ics[type]) {\n        return ic.value || '';\n      }\n\n      return ics[type].call(null, ic, scope, pattern);\n    }\n  };\n\n  ret.serializes = {\n    // 日期控件\n    date: function(value, field) {\n      if (!value) {\n        return '';\n      }\n\n      var format = field['data-date-format'].replace('mm', 'MM')\n        .replace('hh', 'HH')\n        .replace('ii', 'mm');\n\n      var date;\n\n      if (\n        Utils.isFormTypeSupported('datetime-local') ||\n        Utils.isFormTypeSupported('date')\n      ) {\n        return $filter('date')(value, format);\n      }\n\n      return value;\n    },\n\n    // 部门人员控件\n    user: function(value, field) {\n      var selectType = field['data-select-type'];\n\n      if (selectType == 'user') {\n        return User.addPrefix(value);\n      } else if (selectType == 'position') {\n        return User.addPositionPrefix(value);\n      } else {\n        return User.addDepartmentPrefix(value);\n      }\n    },\n\n    //图片上传控件\n    //imgupload: function(value, field) {\n    //  if(!value) {\n    //    return '';\n    //  }\n    //\n    //  var formData = new FormData();\n    //  var file = value[0];\n    //  formData.append('data_' + field['data-id'], file);\n    //\n    //  return formData;\n    //}\n  };\n\n  // 标准化要提交的控件数据\n  ret.serialize = function(data, fields) {\n    if (!fields || !fields.length) {\n      return data;\n    }\n\n    angular.forEach(fields, function(field) {\n      var type = field['data-type'];\n      var id = field['data-id'];\n\n      if (ret.serializes[type]) {\n        data['data_' + id] = ret.serializes[type].call(null, data['data_' + id], field);\n      }\n    });\n\n    return data;\n  };\n\n  return ret;\n})\n","/**\n * @ngdoc module\n * @name workflow\n * @description\n *   工作流模块\n */\n\nangular.module('workflow', ['ionic', 'workflow.controllers', 'workflow.services', 'workflow.filters', 'workflow.directives'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'workflow', title: '工作流', route: '#/workflow', state: 'workflow.index', icon: 'img/modicon/workflow.png' })\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider, ResolversProvider) {\n\n  $urlRouterProvider.when('/workflow', '/workflow/index');\n\n  $stateProvider\n  .state('workflow', {\n    url: '/workflow',\n    abstract: true,\n    template: '<ion-nav-view name=\"workflow\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  $stateProvider\n  // 工作流-首页\n  .state('workflow.index', {\n    url: '/index',\n    talkingDataLabel: '工作流-首页',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-index.html',\n        controller:'FlowIndexCtrl'\n      }\n    }\n  })\n\n  // 工作流-待办工作\n  .state('workflow.todo', {\n    url: '/todo',\n    talkingDataLabel: '工作流-待办工作',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-list.html',\n        controller: 'FlowTodoCtrl'\n      }\n    }\n  })\n\n\n  // 工作流-已办结（已转交）\n  .state('workflow.trans', {\n    url: '/trans',\n    talkingDataLabel: '工作流-已办结',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-list.html',\n        controller: 'FlowTransCtrl'\n      }\n    }\n  })\n\n  // 工作流-已完成\n  .state('workflow.done', {\n    url: '/done',\n    talkingDataLabel: '工作流-已完成',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-list.html',\n        controller: 'FlowDoneCtrl'\n      }\n    }\n  })\n\n  // 工作流-我的关注\n  .state('workflow.follow', {\n    url: '/follow',\n    talkingDataLabel: '工作流-我的关注',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-follow-list.html',\n        controller: 'FlowFollowCtrl'\n      }\n    }\n  })\n\n  // 工作流-新建\n  .state('workflow.create', {\n    url: '/create',\n    talkingDataLabel: '工作流-发布工作',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-create.html',\n        controller: 'FlowCreateCtrl'\n      }\n    }\n  })\n\n  // 工作流-主办\n  .state('workflow.handle', {\n    url: '/handle/:key?topflag',\n    talkingDataLabel: '工作流-主办',\n    resolve: ResolversProvider.get(['canvasPainter']),\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-handle.html',\n        controller: 'FlowHandleCtrl'\n      }\n    }\n  })\n \n  .state('workflow.handover', {\n    url: '/handover/:key?topflag',\n    talkingDataLabel: '工作流-转交',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-handover.html',\n        controller: 'FlowHandoverCtrl'\n      }\n    }\n  })\n\n  .state('workflow.handoverFree', {\n    url: '/handoverFree/:key',\n    talkingDataLabel: '工作流-转交自由流程',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-handover-free.html',\n        controller: 'FlowHandoverFreeCtrl'\n      }\n    }\n  })\n\n  // 工作流-详细\n  .state('workflow.detail', {\n    url: '/detail/:key',\n    talkingDataLabel: '工作流-查看工作流',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-detail.html',\n        controller: 'FlowDetailCtrl'\n      }\n    }\n  })\n  \n})\n\n.run(function($rootScope, $ionicHistory) {\n\n  // function clearListCache() {\n  //   $ionicHistory.clearCache(['workflow.todo', 'workflow.trans', 'workflow.done']);\n  // }\n\n  // angular.forEach([\n  //   'workflow.handover',\n  //   'workflow.handoverFree',\n  //   'workflow.signFlow',\n  //   'workflow.takeback',\n  // ], function(eventName) {\n  //   $rootScope.$on(eventName, clearListCache);\n  // });\n})"],"sourceRoot":"./"}